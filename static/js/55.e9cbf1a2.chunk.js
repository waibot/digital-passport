(this.webpackJsonp=this.webpackJsonp||[]).push([[55],{3903:function(e,n,t){"use strict";t.r(n),t.d(n,"KeyringBase",(function(){return y})),t.d(n,"KeyringBaseMock",(function(){return h}));var r=t(2),o=t.n(r),i=t(6),a=t.n(i),c=t(9),u=t.n(c),s=t(14),d=t.n(s),l=t(7),f=t.n(l);function p(e){var n=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,r=f()(e);if(n){var o=f()(this).constructor;t=Reflect.construct(r,arguments,o)}else t=r.apply(this,arguments);return d()(this,t)}}var y=function(e){u()(t,e);var n=p(t);function t(e){var t;return(t=n.call(this,e.options)).vault=e,t}return t.prototype.addressFromBase=function(){var e=o()((function*(e){return this.vault.addressFromBase(e)}));return function(n){return e.apply(this,arguments)}}(),a()(t)}(t(1585).VaultContext),h=function(e){u()(t,e);var n=p(t);function t(){return n.apply(this,arguments)}return a()(t)}(y)},3905:function(e,n,t){"use strict";t.r(n),t.d(n,"KeyringSoftwareBase",(function(){return I}));var r=t(4),o=t.n(r),i=t(3),a=t.n(i),c=t(2),u=t.n(c),s=t(6),d=t.n(s),l=t(9),f=t.n(l),p=t(14),y=t.n(p),h=t(7),v=t.n(h),g=t(19),w=t(23);function m(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function T(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?m(Object(t),!0).forEach((function(n){a()(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):m(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function x(e){var n=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,r=v()(e);if(n){var o=v()(this).constructor;t=Reflect.construct(r,arguments,o)}else t=r.apply(this,arguments);return y()(this,t)}}var I=function(e){f()(t,e);var n=x(t);function t(){return n.apply(this,arguments)}var r=t.prototype;return r.signTransaction=function(){var e=u()((function*(e,n){var t=n.password;if("undefined"===typeof t)throw new w.OneKeyInternalError("Software signing requires a password.");var r=yield this.getSigners(t,e.inputs.map((function(e){return e.address})));return g.default.engine.info("signTransaction",this.networkId,e),T(T({},yield this.engine.providerManager.signTransaction(this.networkId,e,r)),{},{encodedTx:e.encodedTx})}));return function(n,t){return e.apply(this,arguments)}}(),r.signMessage=function(){var e=u()((function*(e,n){var t=this,r=n.password;if("undefined"===typeof r)throw new w.OneKeyInternalError("Software signing requires a password.");var i=yield this.getDbAccount(),a=Object.values(yield this.getSigners(r,[i.address])),c=o()(a,1)[0];return g.default.engine.info("signMessage",this.networkId,e),Promise.all(e.map((function(e){return t.engine.providerManager.signMessage(t.networkId,e,c)})))}));return function(n,t){return e.apply(this,arguments)}}(),r.getAddress=function(){throw new Error("Method not implemented.")},r.batchGetAddress=function(){throw new Error("Method not implemented.")},r.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},d()(t)}(t(3903).KeyringBase)},3912:function(e,n,t){"use strict";t.r(n),function(e){t.d(n,"VaultBaseChainOnly",(function(){return F})),t.d(n,"VaultBase",(function(){return K}));var r=t(202),o=t.n(r),i=t(3),a=t.n(i),c=t(60),u=t.n(c),s=t(2),d=t.n(s),l=t(6),f=t.n(l),p=t(9),y=t.n(p),h=t(14),v=t.n(h),g=t(7),w=t.n(g),m=t(21),T=t.n(m),x=t(167),I=t.n(x),b=t(11),E=t(19),O=t(24),A=t(68),P=t(23),N=t(182),C=t(947),S=t(52),k=t(1585);function D(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function R(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?D(Object(t),!0).forEach((function(n){a()(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):D(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function B(e){var n=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,r=w()(e);if(n){var o=w()(this).constructor;t=Reflect.construct(r,arguments,o)}else t=r.apply(this,arguments);return v()(this,t)}}if(O.default.isExtensionUi)throw new Error("engine/VaultBase is not allowed imported from ui");var F=function(e){y()(t,e);var n=B(t);function t(){return n.apply(this,arguments)}var r=t.prototype;return r.initProvider=function(){var e=d()((function*(){var e=(yield this.getNetwork()).impl;u()(C.IMPL_MAPPINGS[e])||(this.engineProvider=yield this.engine.providerManager.getProvider(this.networkId))}));return function(){return e.apply(this,arguments)}}(),r.proxyJsonRPCCall=function(){var e=d()((function*(e){throw new P.NotImplemented}));return function(n){return e.apply(this,arguments)}}(),r.createClientFromURL=function(e){throw new P.NotImplemented},r.getEthersProvider=function(){var e=d()((function*(){throw new P.NotImplemented}));return function(){return e.apply(this,arguments)}}(),r.getClientEndpointStatus=function(){var e=d()((function*(e){var n=this.createClientFromURL(e),t=performance.now(),r=(yield n.getInfo()).bestBlockNumber;return{responseTime:Math.floor(performance.now()-t),latestBlock:r}}));return function(n){return e.apply(this,arguments)}}(),r.checkRpcBatchSupport=function(){var e=d()((function*(e){throw new P.NotImplemented}));return function(n){return e.apply(this,arguments)}}(),r.getDisplayAddress=function(){var e=d()((function*(e){return Promise.resolve(e)}));return function(n){return e.apply(this,arguments)}}(),r.validateAddress=function(){var e=d()((function*(e){var n=yield this.engineProvider.verifyAddress(e),t=n.normalizedAddress;if(!n.isValid||!t)throw new P.InvalidAddress;return Promise.resolve(t)}));return function(n){return e.apply(this,arguments)}}(),r.validateImportedCredential=function(e){return Promise.resolve(this.settings.importedAccountEnabled&&/^(0x)?[0-9a-zA-Z]{64}$/.test(e))},r.validateWatchingCredential=function(){var e=d()((function*(e){return Promise.resolve(this.settings.watchingAccountEnabled&&(yield this.engineProvider.verifyAddress(e)).isValid)}));return function(n){return e.apply(this,arguments)}}(),r.validateTokenAddress=function(){var e=d()((function*(e){var n=yield this.engineProvider.verifyTokenAddress(e),t=n.normalizedAddress;if(!n.isValid||"undefined"===typeof t)throw new P.InvalidTokenAddress;return Promise.resolve(t)}));return function(n){return e.apply(this,arguments)}}(),r.validateCanCreateNextAccount=function(){var e=d()((function*(e,n){return Promise.resolve(!0)}));return function(n,t){return e.apply(this,arguments)}}(),r.checkAccountExistence=function(){var e=d()((function*(e,n){return Promise.resolve(!0)}));return function(n,t){return e.apply(this,arguments)}}(),r.getBalances=function(){var e=d()((function*(e,n,t){return(yield this.engine.providerManager.getClient(this.networkId)).getBalances(e.map((function(e){var n=e.address,t=e.tokenAddress;return{address:n,coin:R({},"string"===typeof t?{tokenAddress:t}:{})}})))}));return function(n,t,r){return e.apply(this,arguments)}}(),r.getFrozenBalance=function(){var e=d()((function*(e){return 0}));return function(n){return e.apply(this,arguments)}}(),r.fetchBalanceDetails=function(){var e=d()((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.password;return Promise.resolve(void 0)}));return function(){return e.apply(this,arguments)}}(),r.getTransactionStatuses=function(e){return this.engine.providerManager.getTransactionStatuses(this.networkId,e)},r.getTransactionFeeInNative=function(e){return Promise.resolve("")},r.isContractAddress=function(){var e=d()((function*(e){return!1}));return function(n){return e.apply(this,arguments)}}(),r.getAccountNameInfoMap=function(){var e=d()((function*(){var e=yield this.getNetwork();return Object(N.getAccountNameInfoByImpl)(e.impl)}));return function(){return e.apply(this,arguments)}}(),r.canAutoCreateNextAccount=function(){var e=d()((function*(e){return Promise.resolve(!1)}));return function(n){return e.apply(this,arguments)}}(),r.filterAccounts=function(){var e=d()((function*(e){var n=e.accounts;e.networkId;return Promise.resolve(n)}));return function(n){return e.apply(this,arguments)}}(),r.shouldChangeAccountWhenNetworkChanged=function(){var e=d()((function*(e){e.previousNetwork,e.newNetwork,e.activeAccountId;return Promise.resolve({shouldReloadAccountList:!1,shouldChangeActiveAccount:!1})}));return function(n){return e.apply(this,arguments)}}(),r.getAccountNameInfosByImportedOrWatchingCredential=function(){var e=d()((function*(e){return Promise.resolve([])}));return function(n){return e.apply(this,arguments)}}(),r.checkIsUnlimitedAllowance=function(){var e=d()((function*(e){throw new P.NotImplemented}));return function(n){return e.apply(this,arguments)}}(),r.checkIsApprovedForAll=function(){var e=d()((function*(e){throw new P.NotImplemented}));return function(n){return e.apply(this,arguments)}}(),r.checkIsBatchTransfer=function(){var e=d()((function*(e){throw new P.NotImplemented}));return function(n){return e.apply(this,arguments)}}(),r.getFeePricePerUnit=function(){var e=d()((function*(){throw new P.NotImplemented}));return function(){return e.apply(this,arguments)}}(),r.fetchRpcChainId=function(){var e=d()((function*(e){return null}));return function(n){return e.apply(this,arguments)}}(),r.getTxWaitingSeconds=function(){var e=d()((function*(){return[]}));return function(){return e.apply(this,arguments)}}(),r.getUserNFTAssets=function(){var e=d()((function*(e){e.serviceData;return Promise.resolve(void 0)}));return function(n){return e.apply(this,arguments)}}(),f()(t)}(k.VaultContext),K=function(n){y()(r,n);var t=B(r);function r(){for(var e,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).uuid=I.a.v4().toString(),e}var i=r.prototype;return i.init=function(){var e=d()((function*(e){yield this.initProvider(),yield this.initKeyring(e)}));return function(n){return e.apply(this,arguments)}}(),i.initKeyring=function(){var e=d()((function*(e){this.keyring=yield e.keyringCreator(this)}));return function(n){return e.apply(this,arguments)}}(),i.signTransaction=function(){var e=d()((function*(e,n){return this.keyring.signTransaction(e,n)}));return function(n,t){return e.apply(this,arguments)}}(),i.signAndSendTransaction=function(){var e=d()((function*(e,n,t){var r=yield this.signTransaction(e,n);return t?R(R({},r),{},{encodedTx:e.encodedTx}):this.broadcastTransaction(R(R({},r),{},{encodedTx:e.encodedTx}))}));return function(n,t,r){return e.apply(this,arguments)}}(),i.broadcastTransaction=function(){var e=d()((function*(e,n){E.default.engine.info("broadcastTransaction START:",{rawTx:e.rawTx});var t=yield this.engine.providerManager.broadcastTransaction(this.networkId,e.rawTx,n);return E.default.engine.info("broadcastTransaction END:",{txid:t,rawTx:e.rawTx}),R(R({},e),{},{txid:t,encodedTx:e.encodedTx})}));return function(n,t){return e.apply(this,arguments)}}(),i.buildEncodedTxFromBatchTransfer=function(){var e=d()((function*(e){throw new P.NotImplemented}));return function(n){return e.apply(this,arguments)}}(),i.buildEncodedTxsFromSetApproveForAll=function(){var e=d()((function*(e,n){throw new P.NotImplemented}));return function(n,t){return e.apply(this,arguments)}}(),i.activateAccount=function(){var e=d()((function*(){throw new P.NotImplemented}));return function(){return e.apply(this,arguments)}}(),i.activateToken=function(){var e=d()((function*(e,n){throw new P.NotImplemented}));return function(n,t){return e.apply(this,arguments)}}(),i.getTokenAllowance=function(){var e=d()((function*(e,n){throw new P.NotImplemented}));return function(n,t){return e.apply(this,arguments)}}(),i.batchTokensAllowance=function(){var e=d()((function*(e,n){throw new P.NotImplemented}));return function(n,t){return e.apply(this,arguments)}}(),i.getOutputAccount=function(){var e=d()((function*(){var e=yield this.getDbAccount({noCache:!0});return{id:e.id,name:e.name,type:e.type,path:e.path,coinType:e.coinType,tokens:[],address:e.address,template:e.template,pubKey:o()(e,"pub","")}}));return function(){return e.apply(this,arguments)}}(),i.getAccountBalance=function(){var e=d()((function*(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],t=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,o=yield this.getDbAccount(),i=o.address;return this.getBalances((n?[{address:i}]:[]).concat(e.map((function(e){return{address:i,tokenAddress:e}}))),t,r)}));return function(n){return e.apply(this,arguments)}}(),i.updatePendingTxs=function(){var e=d()((function*(e){throw new P.NotImplemented}));return function(n){return e.apply(this,arguments)}}(),i.getAccountNonce=function(){var e=d()((function*(){return Promise.resolve(null)}));return function(){return e.apply(this,arguments)}}(),i.fixActionDirection=function(){var e=d()((function*(e){var n,t,r,o,i=e.action,a=e.accountAddress;(i.direction=S.IDecodedTxDirection.OTHER,i.type===S.IDecodedTxActionType.NATIVE_TRANSFER)&&(i.direction=yield this.buildTxActionDirection({from:(null==(n=i.nativeTransfer)?void 0:n.from)||"",to:(null==(t=i.nativeTransfer)?void 0:t.to)||"",address:a}));i.type===S.IDecodedTxActionType.TOKEN_TRANSFER&&(i.direction=yield this.buildTxActionDirection({from:(null==(r=i.tokenTransfer)?void 0:r.from)||"",to:(null==(o=i.tokenTransfer)?void 0:o.to)||"",address:a}));return i}));return function(n){return e.apply(this,arguments)}}(),i.fixDecodedTx=function(){var e=d()((function*(e){var n,t;e.createdAt=null!=(n=e.createdAt)?n:Date.now();var r=null==(t=e.encodedTx)?void 0:t.nonce;e.nonce=u()(r)?e.nonce:new T.a(r).toNumber();for(var o=e.owner,i=0;i<e.actions.length;i+=1){var a=e.actions[i];yield this.fixActionDirection({action:a,accountAddress:o})}if(e.outputActions)for(var c=0;c<e.outputActions.length;c+=1){var s=e.outputActions[c];yield this.fixActionDirection({action:s,accountAddress:o})}return Promise.resolve(e)}));return function(n){return e.apply(this,arguments)}}(),i.fixHistoryTx=function(){var e=d()((function*(e){return e.decodedTx=yield this.fixDecodedTx(e.decodedTx),Promise.resolve(e)}));return function(n){return e.apply(this,arguments)}}(),i.buildHistoryTx=function(){var e=d()((function*(e){var n=e.historyTxToMerge,t=(e.encodedTx,e.decodedTx),r=e.signedTx,o=e.isSigner,i=e.isLocalCreated,a=(null==r?void 0:r.txid)||(null==t?void 0:t.txid)||"";if(!a)throw new Error("buildHistoryTx txid not found");var c=yield this.getAccountAddress();t.txid=a||t.txid,t.owner=c,o&&(t.signer=c),null!=r&&r.txKey&&(t.extraInfo?t.extraInfo.txKey=r.txKey:t.extraInfo={txKey:r.txKey});var u=R(R({id:this.networkId+"_"+a+"_"+this.accountId,isLocalCreated:Boolean(i)},n),{},{decodedTx:t});return u=yield this.fixHistoryTx(u),Promise.resolve(u)}));return function(n){return e.apply(this,arguments)}}(),i.checkIsScamHistoryTx=function(){var e=d()((function*(e){return!1}));return function(n){return e.apply(this,arguments)}}(),i.fetchOnChainHistory=function(){var e=d()((function*(e){throw new P.NotImplemented}));return function(n){return e.apply(this,arguments)}}(),i.fixAddressCase=function(e){return Promise.resolve(e)},i.buildTxActionDirection=function(){var e=d()((function*(e){var n=e.from,t=e.to,r=e.address;return n=yield this.fixAddressCase(n||""),t=yield this.fixAddressCase(t),r=yield this.fixAddressCase(r),n===t&&n===r?S.IDecodedTxDirection.SELF:n&&n===r?S.IDecodedTxDirection.OUT:t&&t===r?S.IDecodedTxDirection.IN:S.IDecodedTxDirection.OTHER}));return function(n){return e.apply(this,arguments)}}(),i.getNextNonce=function(){var e=d()((function*(e,n){var t,r,o=null!=(t=null==(r=(yield this.engine.providerManager.getAddresses(e,[n.address]))[0])?void 0:r.nonce)?t:0,i=(yield this.engine.getHistory(e,n.id,void 0,!1),yield A.default.history.getMaxPendingNonce({accountId:this.accountId,networkId:e})),a=yield A.default.history.getPendingNonceList({accountId:this.accountId,networkId:e}),c=Math.max(u()(i)?0:i+1,o);if(Number.isNaN(c)&&(c=o),c>o)for(var s=o;s<c;s+=1)if(!a.includes(s)){c=s;break}if(c<o&&(c=o),c-o>=b.HISTORY_CONSTS.PENDING_QUEUE_MAX_LENGTH)throw new P.PendingQueueTooLong(b.HISTORY_CONSTS.PENDING_QUEUE_MAX_LENGTH);return c}));return function(n,t){return e.apply(this,arguments)}}(),i.validateSendAmount=function(e,n,t){return Promise.resolve(!0)},i.notifyChainChanged=function(e,n){},i.getFetchBalanceAddress=function(e){return Promise.resolve(e.address)},i.getPrivateKeyByCredential=function(n){return Promise.resolve(e.from(n.startsWith("0x")?n.slice(2):n,"hex"))},i.getMinDepositAmount=function(){var e=d()((function*(){return"0"}));return function(){return e.apply(this,arguments)}}(),i.specialCheckEncodedTx=function(){var e=d()((function*(e){return{success:!0}}));return function(n){return e.apply(this,arguments)}}(),i.getAllUsedAddress=function(){var e=d()((function*(){return Promise.resolve([])}));return function(){return e.apply(this,arguments)}}(),f()(r)}(F)}.call(this,t(26).Buffer)},3913:function(e,n,t){"use strict";t.r(n),function(e){t.d(n,"KeyringHardwareBase",(function(){return v}));var r=t(2),o=t.n(r),i=t(6),a=t.n(i),c=t(9),u=t.n(c),s=t(14),d=t.n(s),l=t(7),f=t.n(l),p=t(431),y=t(163);function h(e){var n=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,r=f()(e);if(n){var o=f()(this).constructor;t=Reflect.construct(r,arguments,o)}else t=r.apply(this,arguments);return d()(this,t)}}var v=function(n){u()(r,n);var t=h(r);function r(){return t.apply(this,arguments)}var i=r.prototype;return i.getHardwareInfo=function(){var e=o()((function*(){var e,n,t,r=yield this.engine.getHWDeviceByWalletId(this.vault.walletId);return{connectId:null!=(e=null==r?void 0:r.mac)?e:"",deviceId:null!=(n=null==r?void 0:r.deviceId)?n:"",deviceType:null!=(t=null==r?void 0:r.deviceType)?t:""}}));return function(){return e.apply(this,arguments)}}(),i.getWalletPassphraseState=function(){var e=o()((function*(){var e=yield this.engine.getWallet(this.vault.walletId);return{passphraseState:null==e?void 0:e.passphraseState,useEmptyPassphrase:!Object(y.isPassphraseWallet)(e)}}));return function(){return e.apply(this,arguments)}}(),i.getHardwareSDKInstance=function(){var n=o()((function*(){var n,t,r,o,i;return null!=(i=yield null==(n=e)||null==(t=n.$backgroundApiProxy)||null==(r=t.backgroundApi)||null==(o=r.serviceHardware)||null==o.getSDKInstance?void 0:o.getSDKInstance())?i:p.HardwareSDK}));return function(){return n.apply(this,arguments)}}(),i.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},a()(r)}(t(3903).KeyringBase)}.call(this,t(58))},3914:function(e,n,t){"use strict";t.r(n),t.d(n,"KeyringHdBase",(function(){return T}));var r=t(3),o=t.n(r),i=t(2),a=t.n(i),c=t(6),u=t.n(c),s=t(9),d=t.n(s),l=t(14),f=t.n(l),p=t(7),y=t.n(p),h=t(610),v=t(23);function g(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function w(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?g(Object(t),!0).forEach((function(n){o()(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):g(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function m(e){var n=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,r=y()(e);if(n){var o=y()(this).constructor;t=Reflect.construct(r,arguments,o)}else t=r.apply(this,arguments);return f()(this,t)}}var T=function(e){d()(t,e);var n=m(t);function t(){return n.apply(this,arguments)}var r=t.prototype;return r.getPrivateKeys=function(){var e=a()((function*(e,n){var t=(yield this.getDbAccount()).path.split("/"),r=n||[t.pop()],o=t.join("/"),i=(yield this.engine.dbApi.getCredential(this.walletId,e)).seed;if("undefined"===typeof i)throw new v.OneKeyInternalError("Unable to get credential.");var a=(yield this.engine.providerManager.getChainInfoByNetworkId(this.networkId)).curve;return Object(h.batchGetPrivateKeys)(a,i,e,o,r).reduce((function(e,n){var t;return w(w({},e),{},((t={})[n.path]=n.extendedKey.key,t))}),{})}));return function(n,t){return e.apply(this,arguments)}}(),r.getAddress=function(){throw new Error("Method not implemented.")},r.batchGetAddress=function(){throw new Error("Method not implemented.")},r.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},u()(t)}(t(3905).KeyringSoftwareBase)},3915:function(e,n,t){"use strict";t.r(n),t.d(n,"KeyringImportedBase",(function(){return h}));var r=t(2),o=t.n(r),i=t(6),a=t.n(i),c=t(9),u=t.n(c),s=t(14),d=t.n(s),l=t(7),f=t.n(l),p=t(23);function y(e){var n=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,r=f()(e);if(n){var o=f()(this).constructor;t=Reflect.construct(r,arguments,o)}else t=r.apply(this,arguments);return d()(this,t)}}var h=function(e){u()(t,e);var n=y(t);function t(){return n.apply(this,arguments)}var r=t.prototype;return r.getPrivateKeys=function(){var e=o()((function*(e,n){if("undefined"!==typeof n)throw new p.NotImplemented("Getting private keys from extended private key");var t=(yield this.engine.dbApi.getCredential(this.accountId,e)).privateKey;if("undefined"===typeof t)throw new p.OneKeyInternalError("Unable to get credential.");return{"":t}}));return function(n,t){return e.apply(this,arguments)}}(),r.getAddress=function(){throw new Error("Method not implemented.")},r.batchGetAddress=function(){throw new Error("Method not implemented.")},r.prepareAccountByAddressIndex=function(){throw new Error("Method not implemented.")},a()(t)}(t(3905).KeyringSoftwareBase)},3916:function(e,n,t){"use strict";t.r(n),t.d(n,"KeyringWatchingBase",(function(){return h}));var r=t(2),o=t.n(r),i=t(6),a=t.n(i),c=t(9),u=t.n(c),s=t(14),d=t.n(s),l=t(7),f=t.n(l),p=t(23);function y(e){var n=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,r=f()(e);if(n){var o=f()(this).constructor;t=Reflect.construct(r,arguments,o)}else t=r.apply(this,arguments);return d()(this,t)}}var h=function(e){u()(t,e);var n=y(t);function t(){return n.apply(this,arguments)}var r=t.prototype;return r.signTransaction=function(){var e=o()((function*(e,n){throw new p.OneKeyInternalError("signTransaction is not supported for watching accounts")}));return function(n,t){return e.apply(this,arguments)}}(),r.signMessage=function(){var e=o()((function*(e,n){throw new p.OneKeyInternalError("signMessage is not supported for watching accounts")}));return function(n,t){return e.apply(this,arguments)}}(),r.getAddress=function(){throw new Error("Method not implemented.")},r.batchGetAddress=function(){throw new Error("Method not implemented.")},r.prepareAccountByAddressIndex=function(){throw new Error("Method not implemented.")},a()(t)}(t(3903).KeyringBase)},3918:function(e,n,t){"use strict";t.r(n),t.d(n,"convertDeviceError",(function(){return c}));var r=t(70),o=t(90),i=t(19);t(24);function a(e,n){return"string"!==typeof n?null:e===r.HardwareErrorCode.DeviceInitializeFailed&&n.includes("ECONNABORTED")?new o.ConnectTimeoutError({message:n}):n.includes("Bridge network error")?new o.BridgeNetworkError({message:n}):null}function c(e){var n,t=e||{},c=t.code,u=t.error,s=t.message,d=null!=(n=null!=u?u:s)?n:"Unknown error";if(a(c,d))return a(c,d);switch(i.default.hardwareSDK.info("Device Utils Convert Device Error:",c,d),c){case r.HardwareErrorCode.UnknownError:return new o.UnknownHardwareError(e);case r.HardwareErrorCode.DeviceFwException:return new o.FirmwareVersionTooLow(e);case r.HardwareErrorCode.DeviceUnexpectedMode:return"string"===typeof d&&-1!==d.indexOf("ui-device_bootloader_mode")?new o.NotInBootLoaderMode(e):new o.UnknownHardwareError(e);case r.HardwareErrorCode.DeviceCheckDeviceIdError:return new o.DeviceNotSame(e);case r.HardwareErrorCode.DeviceNotFound:return new o.DeviceNotFind(e);case r.HardwareErrorCode.DeviceUnexpectedBootloaderMode:return new o.NotInBootLoaderMode(e);case r.HardwareErrorCode.DeviceInterruptedFromOutside:case r.HardwareErrorCode.DeviceInterruptedFromUser:return new o.UserCancelFromOutside(e);case r.HardwareErrorCode.DeviceNotSupportPassphrase:return new o.NotSupportPassphraseError(e);case r.HardwareErrorCode.IFrameLoadFail:return new o.InitIframeLoadFail(e);case r.HardwareErrorCode.IframeTimeout:return new o.InitIframeTimeout(e);case r.HardwareErrorCode.FirmwareUpdateDownloadFailed:return new o.FirmwareDownloadFailed(e);case r.HardwareErrorCode.FirmwareUpdateManuallyEnterBoot:return new o.FirmwareUpdateManuallyEnterBoot(e);case r.HardwareErrorCode.FirmwareUpdateAutoEnterBootFailure:return new o.FirmwareUpdateAutoEnterBootFailure(e);case r.HardwareErrorCode.FirmwareUpdateLimitOneDevice:return new o.FirmwareUpdateLimitOneDevice(e);case r.HardwareErrorCode.CallMethodNeedUpgradeFirmware:return new o.FirmwareVersionTooLow(e);case r.HardwareErrorCode.NewFirmwareUnRelease:return new o.NewFirmwareUnRelease(e);case r.HardwareErrorCode.NewFirmwareForceUpdate:return new o.NewFirmwareForceUpdate(e);case r.HardwareErrorCode.NetworkError:return new o.NetworkError(e);case r.HardwareErrorCode.BlePermissionError:return new o.NeedBluetoothTurnedOn(e);case r.HardwareErrorCode.BleLocationError:return new o.NeedBluetoothPermissions({message:d});case r.HardwareErrorCode.BleLocationServicesDisabled:return new o.BleLocationServiceError({message:d});case r.HardwareErrorCode.BleDeviceNotBonded:return new o.DeviceNotBonded(e);case r.HardwareErrorCode.BleDeviceBondError:return new o.DeviceBondError(e);case r.HardwareErrorCode.BleWriteCharacteristicError:return new o.BleWriteCharacteristicError(e);case r.HardwareErrorCode.BleScanError:return new o.BleScanError({message:d});case r.HardwareErrorCode.BleAlreadyConnected:return new o.BleAlreadyConnectedError(e);case r.HardwareErrorCode.RuntimeError:return-1!==d.indexOf("EIP712 blind sign is disabled")?new o.OpenBlindSign(e):-1!==d.indexOf("Unknown message")||-1!==d.indexOf("Failure_UnexpectedMessage")?new o.UnknownMethod(e):new o.UnknownHardwareError(e);case r.HardwareErrorCode.PinInvalid:return new o.InvalidPIN(e);case r.HardwareErrorCode.DeviceCheckPassphraseStateError:return new o.InvalidPassphrase(e);case r.HardwareErrorCode.DeviceOpenedPassphrase:return new o.DeviceOpenedPassphrase(e);case r.HardwareErrorCode.DeviceNotOpenedPassphrase:return new o.DeviceNotOpenedPassphrase(e);case r.HardwareErrorCode.PinCancelled:case r.HardwareErrorCode.ActionCancelled:return new o.UserCancel(e);case r.HardwareErrorCode.BridgeNotInstalled:case o.CustomOneKeyHardwareError.NeedOneKeyBridge:return new o.NeedOneKeyBridge(e);case r.HardwareErrorCode.BridgeNetworkError:return new o.BridgeNetworkError(e);case r.HardwareErrorCode.BridgeTimeoutError:return new o.BridgeTimeoutError(e);case r.HardwareErrorCode.PollingTimeout:return new o.ConnectTimeoutError(e);case r.HardwareErrorCode.PollingStop:return new o.ConnectPollingStopError(e);case r.HardwareErrorCode.BlindSignDisabled:return new o.OpenBlindSign(e);case r.HardwareErrorCode.FileAlreadyExists:return new o.FileAlreadyExistError(e);case r.HardwareErrorCode.CheckDownloadFileError:return new o.IncompleteFileError(e);case r.HardwareErrorCode.NotInSigningMode:return new o.NotInSigningModeError(e);default:return new o.UnknownHardwareError(e)}}},4050:function(e,n,t){"use strict";t.r(n),function(e){t.d(n,"getAddressHistoryFromExplorer",(function(){return x})),t.d(n,"extractTransactionInfo",(function(){return E})),t.d(n,"decodeTransactionPayload",(function(){return O})),t.d(n,"encodeTokenTransferData",(function(){return A})),t.d(n,"buildSignedTx",(function(){return P})),t.d(n,"buildUnsignedRawTx",(function(){return N})),t.d(n,"pubkeyToAddress",(function(){return C})),t.d(n,"verifyAddress",(function(){return S})),t.d(n,"hashRawTx",(function(){return k})),t.d(n,"buildUnsignedTx",(function(){return D}));var r,o=t(13),i=t.n(o),a=t(4),c=t.n(a),u=t(2),s=t.n(u),d=t(22),l=t(107),f=t.n(l),p=t(21),y=t.n(p),h=t(36),v=t(19),g=t(325),w=t(1345),m=t(4320),T=((r={})[h.OnekeyNetwork.stc]="https://api.stcscan.io/v2/transaction/main/byAddress",r[h.OnekeyNetwork.tstc]="https://api.stcscan.io/v2/transaction/barnard/byAddress",r);function x(e,n){return I.apply(this,arguments)}function I(){return(I=s()((function*(e,n){var t=T[e];if("undefined"===typeof t)return Promise.resolve([]);var r=t+"/"+n;try{return(yield f.a.get(r)).data.contents}catch(o){return v.default.common.error(o),Promise.resolve([])}}))).apply(this,arguments)}function b(e){var n={to:"",tokenAddress:"",amountValue:""};try{var t,r=m.encoding.decodeTransactionPayload(e),o=r.ScriptFunction,i=o.func,a=i.address,u=i.module,s=i.functionName,l=o.args;if("0x00000000000000000000000000000001"===a||"TransferScripts"===u)if("peer_to_peer_v2"===s)t=c()(l,2)[1];else if("peer_to_peer"===s){t=c()(l,3)[2]}if(t){n.amountValue=new y.a(new m.bcs.BcsDeserializer(Object(d.arrayify)(t)).deserializeU128().toString()).toFixed();var f=r,p=c()(f.ScriptFunction.ty_args,1)[0].Struct,h=p.name,g=p.module,w=p.address;n.tokenAddress=w+"::"+g+"::"+h;var T=c()(l,1);n.to=T[0]}}catch(x){v.default.common.error(x)}return n}function E(e){try{var n=b(e.user_transaction.raw_txn.payload),t=n.to,r=n.tokenAddress,o=n.amountValue;return{from:e.user_transaction.raw_txn.sender,to:t,tokenAddress:r,amountValue:o,feeValue:new y.a(e.user_transaction.raw_txn.gas_unit_price).times(e.gas_used).toFixed()}}catch(i){return v.default.common.error(i),null}}function O(e){var n=b(e);if(n.tokenAddress)return{type:"tokenTransfer",payload:n};var t,r="";try{var o=m.encoding.decodeTransactionPayload(e),i=Object.keys(o);t=o[r=c()(i,1)[0]]}catch(a){v.default.common.error("Failed to decode transaction data.",a,e)}return{type:"other",payload:{name:r,params:t}}}function A(e,n,t){return m.encoding.bcsEncode(m.utils.tx.encodeScriptFunction("0x00000000000000000000000000000001::TransferScripts::peer_to_peer_v2",m.utils.tx.encodeStructTypeTags([n.tokenIdOnNetwork]),m.utils.tx.encodeScriptFunctionArgs([{type_tag:"Address"},{type_tag:"U128"}],[e,"0x"+new y.a(t).shiftedBy(n.decimals).toString(16)])))}var P=function(n,t,r){var o=new m.StarcoinTypes.Ed25519PublicKey(e.from(n,"hex")),i=new m.StarcoinTypes.Ed25519Signature(t),a=new m.StarcoinTypes.TransactionAuthenticatorVariantEd25519(o,i),c=new m.StarcoinTypes.SignedUserTransaction(r,a),u=new m.bcs.BcsSerializer;return c.serialize(u),{txid:m.CryptoHash.createUserTransactionHasher().crypto_hash(u.getBytes()),rawTx:Object(d.hexlify)(u.getBytes()),signature:t}},N=function(e,n){var t,r=e.inputs[0].address,o=e.payload,i=o.scriptFn,a=o.data,c=e.feeLimit,u=e.feePricePerUnit,s=e.nonce,d=e.payload.expirationTime;if(!r||!i&&!a||!c||!u||"undefined"===typeof s)throw new Error("invalid unsignedTx");t=i||m.encoding.bcsDecode(m.StarcoinTypes.TransactionPayload,a);var l=m.utils.tx.generateRawUserTransaction(r,t,c.toNumber(),u.toNumber(),s,d,Number(n)),f=new m.bcs.BcsSerializer;return l.serialize(f),[l,f.getBytes()]},C=function(){var e=s()((function*(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"hex",t=new w.Verifier(e,"ed25519"),r="",o=yield t.getPubkey();if("hex"===n)r=m.encoding.publicKeyToAddress(o.toString("hex"));else{if("bech32"!==n)throw new Error("invalid encoding");r=m.encoding.publicKeyToReceiptIdentifier(o.toString("hex"))}return r}));return function(n){return e.apply(this,arguments)}}(),S=function(e){if(e.startsWith("stc"))try{return{normalizedAddress:"0x"+m.encoding.decodeReceiptIdentifier(e).accountAddress,displayAddress:e,isValid:!0,encoding:"bech32"}}catch(r){}else try{var n=e.startsWith("0x")?e.toLowerCase():"0x"+e.toLowerCase(),t=m.encoding.addressToSCS(n);if(m.encoding.addressFromSCS(t)===n)return{normalizedAddress:n,displayAddress:n,isValid:!0,encoding:"hex"}}catch(r){}return{isValid:!1}},k=function(e){var n=m.CryptoHash.createRawUserTransactionHasher().get_salt();return Uint8Array.of.apply(Uint8Array,i()(n).concat(i()(e)))},D=function(){var e=s()((function*(e,n,t){var r,o=e.feePricePerUnit?e.feePricePerUnit:(yield n.getFeePricePerUnit()).normal.price,i=e.inputs[0],a=e.outputs[0],c=e.payload||{},u=e.nonce,s=e.feeLimit,d=i.address;if(i&&a){var l,f=a.address,p=a.value,y=a.tokenAddress;if(f.startsWith("stc")){var h=m.encoding.decodeReceiptIdentifier(f);f=h.accountAddress.startsWith("0x")?h.accountAddress:"0x"+h.accountAddress}var v=[null!=y?y:"0x1::STC::STC"],w=[f,BigInt(p.toNumber())],T=null==(l=n.rpc)?void 0:l.url,x=yield m.utils.tx.encodeScriptFunctionByResolve("0x1::TransferScripts::peer_to_peer_v2",v,w,T);c.scriptFn=x,r=x}else{if(!c.data)throw new Error("invalid unsignedTx payload");r=m.encoding.bcsDecode(m.StarcoinTypes.TransactionPayload,c.data)}var I=i.publicKey||"";if(s||Object(g.check)(I,"senderPublicKey is required"),"undefined"===typeof u)throw new Error("nonce is not available");c.expirationTime=c.expirationTime||Math.floor(Date.now()/1e3)+3600;var b,E=o.toNumber(),O=c.expirationTime||Math.floor(Date.now()/1e3)+3600,A=m.utils.tx.generateRawUserTransaction(d,r,1e7,E,u,O,Number(t)),P=m.encoding.bcsEncode(A);if(!s){var N=yield n.estimateGasLimitAndTokensChangedTo(P,I);s=N.feeLimit,b=N.tokensChangedTo}return{inputs:i?[i]:[],outputs:a?[a]:[],feeLimit:s,tokensChangedTo:b,feePricePerUnit:o,nonce:u,payload:c}}));return function(n,t,r){return e.apply(this,arguments)}}()}.call(this,t(26).Buffer)},4320:function(e,n,t){"use strict";t.r(n),t.d(n,"encoding",(function(){return h.encoding})),t.d(n,"StarcoinTypes",(function(){return h.starcoin_types})),t.d(n,"utils",(function(){return h.utils})),t.d(n,"bcs",(function(){return h.bcs})),t.d(n,"CryptoHash",(function(){return h.crypto_hash})),t.d(n,"ClientStc",(function(){return I}));var r=t(4),o=t.n(r),i=t(2),a=t.n(i),c=t(6),u=t.n(c),s=t(9),d=t.n(s),l=t(14),f=t.n(l),p=t(7),y=t.n(p),h=t(4005),v=t(21),g=t.n(v),w=t(765),m=t(1068),T=t(367);function x(e){var n=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,r=y()(e);if(n){var o=y()(this).constructor;t=Reflect.construct(r,arguments,o)}else t=r.apply(this,arguments);return f()(this,t)}}var I=function(e){d()(t,e);var n=x(t);function t(e){var t;return(t=n.call(this)).rpc=new m.JsonRPCRequest(e),t}var r=t.prototype;return r.getInfo=function(){var e=a()((function*(){var e=yield this.rpc.call("chain.info",[]),n=parseInt(e.head.number);return{bestBlockNumber:n,isReady:!isNaN(n)&&n>0}}));return function(){return e.apply(this,arguments)}}(),r.getAddresses=function(){var e=a()((function*(e){for(var n=e.reduce((function(e,n){return e.push(["state.get_resource",[n,"0x1::Account::Account",{decode:!0}]]),e.push(["txpool.next_sequence_number",[n]]),e.push(["state.get_resource",[n,"0x1::Account::Balance<0x1::STC::STC>",{decode:!0}]]),e}),[]),t=yield this.rpc.batchCall(n),r=[],i=0,a=t.length;i<a;i+=3){var c=t.slice(i,i+3),u=o()(c,3),s=u[0],d=u[1],l=u[2],f=void 0;if("undefined"!==typeof s&&"undefined"!==typeof d&&"undefined"!==typeof l){var p,y,h=null!==s;f={balance:new g.a(null!=(p=null==l?void 0:l.json.token.value)?p:0),nonce:Math.max(null!=(y=null==s?void 0:s.json.sequence_number)?y:0,null!=d?d:0),existing:h}}r.push(f)}return r}));return function(n){return e.apply(this,arguments)}}(),r.getBalances=function(){var e=a()((function*(e){var n=e.map((function(e){var n;return["state.get_resource",[e.address,"0x1::Account::Balance<"+(null!=(n=e.coin.tokenAddress)?n:"0x1::STC::STC")+">",{decode:!0}]]}));return(yield this.rpc.batchCall(n)).map((function(e){var n,t;"undefined"!==typeof e&&(n=new g.a(null!=(t=null==e?void 0:e.json.token.value)?t:0));return n}))}));return function(n){return e.apply(this,arguments)}}(),r.getTransactionStatuses=function(){var e=a()((function*(e){for(var n=e.reduce((function(e,n){return e.push(["txpool.pending_txn",[n]]),e.push(["chain.get_transaction_info",[n]]),e}),[]),t=yield this.rpc.batchCall(n),r=[],i=0,a=t.length;i<a;i+=2){var c=t.slice(i,i+2),u=o()(c,2),s=u[0],d=u[1],l=void 0;"undefined"!==typeof d&&"undefined"!==typeof s&&(l=null===s&&null===d?T.TransactionStatus.NOT_FOUND:s?T.TransactionStatus.PENDING:"Executed"===(null==d?void 0:d.status)?T.TransactionStatus.CONFIRM_AND_SUCCESS:T.TransactionStatus.CONFIRM_BUT_FAILED),r.push(l)}return r}));return function(n){return e.apply(this,arguments)}}(),r.getFeePricePerUnit=function(){var e=a()((function*(){var e=yield this.rpc.call("txpool.gas_price",[]),n=parseInt(null!=e?e:"1");return{normal:{price:new g.a(n)}}}));return function(){return e.apply(this,arguments)}}(),r.broadcastTransaction=function(){var e=a()((function*(e){return this.rpc.call("txpool.submit_hex_transaction",[e])}));return function(n){return e.apply(this,arguments)}}(),r.estimateGasLimitAndTokensChangedTo=function(){var e=a()((function*(e,n){var t,r,o=h.encoding.publicKeyToAddress(n),i=yield this.rpc.call("contract.dry_run_raw",[e,n]);return"Executed"===(null==i?void 0:i.status)?(t=new g.a(parseInt(i.gas_used)),r=this.getTokensChangedTo(i,o)):(t=isNaN(parseInt(null==i?void 0:i.gas_used))?new g.a(127845):new g.a(parseInt(null==i?void 0:i.gas_used)),r={}),{feeLimit:t,tokensChangedTo:r}}));return function(n,t){return e.apply(this,arguments)}}(),r.getTokensChangedTo=function(e,n){return e.write_set.reduce((function(e,t){var r,o=t.access_path.match(/^(0x[a-zA-Z0-9]{32})\/[01]\/0x00000000000000000000000000000001::Account::Balance<(.*)>$/i);o&&3===o.length&&n===o[1]&&(e[o[2]]=new g.a(null!=(r=t.value.Resource.json.token.value)?r:0).toFixed());return e}),{})},u()(t)}(w.BaseClient)},4360:function(e,n,t){"use strict";t.r(n),function(e){t.d(n,"KeyringHardware",(function(){return S}));var r=t(3),o=t.n(r),i=t(4),a=t.n(i),c=t(2),u=t.n(c),s=t(6),d=t.n(s),l=t(9),f=t.n(l),p=t(14),y=t.n(p),h=t(7),v=t.n(h),g=t(22),w=t(3918),m=t(11),T=t(19),x=t(23),I=t(117),b=t(3913),E=t(4320),O=t(4050);function A(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function P(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?A(Object(t),!0).forEach((function(n){o()(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):A(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function N(e){var n=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,r=v()(e);if(n){var o=v()(this).constructor;t=Reflect.construct(r,arguments,o)}else t=r.apply(this,arguments);return y()(this,t)}}var C="m/44'/"+m.COINTYPE_STC+"'/0'/0'",S=function(n){f()(r,n);var t=N(r);function r(){return t.apply(this,arguments)}var o=r.prototype;return o.signTransaction=function(){var n=u()((function*(n,t){var r=yield this.getDbAccount(),o=yield this.getNetworkChainId(),i=Object(O.buildUnsignedRawTx)(n,o),c=a()(i,2),u=c[0],s=c[1],d=a()(n.inputs,1)[0].publicKey;if(!d)throw new x.OneKeyHardwareError(Error("senderPublicKey is required"));var l=yield this.getHardwareInfo(),f=l.connectId,p=l.deviceId,y=yield this.getWalletPassphraseState(),h=yield this.getHardwareSDKInstance(),v=yield h.starcoinSignTransaction(f,p,P({path:r.path,rawTx:e.from(s).toString("hex")},y));if(v.success){var g=v.payload.signature;return Object(O.buildSignedTx)(d,e.from(g,"hex"),u)}throw Object(w.convertDeviceError)(v.payload)}));return function(e,t){return n.apply(this,arguments)}}(),o.signMessage=function(){var e=u()((function*(e,n){var t=yield this.getDbAccount(),r=yield this.getNetworkChainId(),o=yield this.getHardwareInfo(),i=o.connectId,a=o.deviceId,c=yield this.getWalletPassphraseState(),s=yield this.getHardwareSDKInstance();return Promise.all(e.map(function(){var e=u()((function*(e){var n,o=e.type,u=e.message;try{n=yield s.starcoinSignMessage(i,a,P({path:t.path,messageHex:u},c))}catch(h){throw T.default.common.error(h),new x.OneKeyHardwareError(h)}if(!n.success)throw T.default.common.error(n.payload),Object(w.convertDeviceError)(n.payload);var d=n.payload,l=d.public_key,f=d.signature;if(1===o){var p=Object(g.arrayify)(u),y=new E.StarcoinTypes.SigningMessage(p);return yield E.utils.signedMessage.generateSignedMessage(y,parseInt(r),l,f)}return f}));return function(n){return e.apply(this,arguments)}}()))}));return function(n,t){return e.apply(this,arguments)}}(),o.prepareAccounts=function(){var e=u()((function*(e){var n,t=e.type,r=e.indexes,o=e.names,i=r.map((function(e){return C+"/"+e+"'"})),a="SEARCH_ACCOUNTS"===t,c=yield this.getHardwareSDKInstance(),u=yield this.getHardwareInfo(),s=u.connectId,d=u.deviceId,l=yield this.getWalletPassphraseState(),f=[];if(!a){var p;try{p=yield c.starcoinGetPublicKey(s,d,P({bundle:i.map((function(e){return{path:e,showOnOneKey:!1}}))},l))}catch(O){throw T.default.common.error(O),new x.OneKeyHardwareError(O)}if(!p.success)throw T.default.common.error(p.payload),Object(w.convertDeviceError)(p.payload);f=p.payload.map((function(e){return e.public_key})).filter((function(e){return!!e}))}try{n=yield c.starcoinGetAddress(s,d,P({bundle:i.map((function(e){return{path:e,showOnOneKey:!1}}))},l))}catch(O){throw T.default.common.error(O),new x.OneKeyHardwareError(O)}if(!n.success)throw T.default.common.error(n.payload),Object(w.convertDeviceError)(n.payload);var y=[],h=0;for(var v of n.payload){var g=v.address,b=v.path;if(g){var E=(o||[])[h]||"STC #"+(r[h]+1);y.push({id:this.walletId+"--"+b,name:E,type:I.AccountType.SIMPLE,path:b,coinType:m.COINTYPE_STC,pub:f[h]||"",address:g}),h+=1}}return y}));return function(n){return e.apply(this,arguments)}}(),o.getAddress=function(){var e=u()((function*(e){var n,t=yield this.getHardwareSDKInstance(),r=yield this.getHardwareInfo(),o=r.connectId,i=r.deviceId,a=yield this.getWalletPassphraseState(),c=yield t.starcoinGetAddress(o,i,P({path:e.path,showOnOneKey:e.showOnOneKey},a));if(c.success&&null!=(n=c.payload)&&n.address)return c.payload.address;throw Object(w.convertDeviceError)(c.payload)}));return function(n){return e.apply(this,arguments)}}(),o.batchGetAddress=function(){var e=u()((function*(e){var n=yield this.getHardwareSDKInstance(),t=yield this.getHardwareInfo(),r=t.connectId,o=t.deviceId,i=yield this.getWalletPassphraseState(),a=yield n.starcoinGetAddress(r,o,P(P({},i),{},{bundle:e.map((function(e){return{path:e.path,showOnOneKey:!!e.showOnOneKey}}))}));if(!a.success)throw Object(w.convertDeviceError)(a.payload);return a.payload.map((function(e){var n,t;return{path:null!=(n=e.path)?n:"",address:null!=(t=e.address)?t:""}}))}));return function(n){return e.apply(this,arguments)}}(),d()(r)}(b.KeyringHardwareBase)}.call(this,t(26).Buffer)},4363:function(e,n,t){"use strict";t.r(n),function(e){t.d(n,"KeyringHd",(function(){return O}));var r=t(4),o=t.n(r),i=t(2),a=t.n(i),c=t(6),u=t.n(c),s=t(9),d=t.n(s),l=t(14),f=t.n(l),p=t(7),y=t.n(p),h=t(610),v=t(11),g=t(325),w=t(23),m=t(1345),T=t(117),x=t(3914),I=t(4050);function b(e){var n=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,r=y()(e);if(n){var o=y()(this).constructor;t=Reflect.construct(r,arguments,o)}else t=r.apply(this,arguments);return f()(this,t)}}var E="m/44'/"+v.COINTYPE_STC+"'/0'/0'",O=function(n){d()(r,n);var t=b(r);function r(){return t.apply(this,arguments)}var i=r.prototype;return i.getSigners=function(){var e=a()((function*(e,n){var t,r=yield this.getDbAccount();if(1!==n.length)throw new w.OneKeyInternalError("Starcoin signers number should be 1.");if(n[0]!==r.address)throw new w.OneKeyInternalError("Wrong address required for signing.");var o=(yield this.getPrivateKeys(e))[r.path];if("undefined"===typeof o)throw new w.OneKeyInternalError("Unable to get signer.");return(t={})[r.address]=new m.Signer(o,e,"ed25519"),t}));return function(n,t){return e.apply(this,arguments)}}(),i.signTransaction=function(){var n=a()((function*(n,t){var r=yield this.vault.getNetworkChainId(),i=o()(n.inputs,1)[0],a=i.address,c=i.publicKey;("number"!==typeof n.nonce||n.nonce<=0)&&(n.nonce=yield this.vault.getNextNonce((yield this.vault.getNetwork()).id,yield this.getDbAccount()));var u=Object(I.buildUnsignedRawTx)(n,r),s=o()(u,2),d=s[0],l=s[1],f=Object(I.hashRawTx)(l);Object(g.check)("undefined"!==typeof c,"senderPublicKey is required");var p=(yield this.getSigners(t.password||"",[a]))[a],y=yield p.sign(e.from(f)),h=o()(y,1)[0];return Object(I.buildSignedTx)(c,h,d)}));return function(e,t){return n.apply(this,arguments)}}(),i.prepareAccounts=function(){var e=a()((function*(e){var n=e.password,t=e.indexes,r=e.names,o=(yield this.engine.dbApi.getCredential(this.walletId,n)).seed,i=Object(h.batchGetPublicKeys)("ed25519",o,n,E,t.map((function(e){return e.toString()+"'"})));if(i.length!==t.length)throw new w.OneKeyInternalError("Unable to get publick key.");var a=[],c=0;for(var u of i){var s=u.path,d=u.extendedKey.key.toString("hex"),l=yield Object(I.pubkeyToAddress)(d),f=(r||[])[c]||"STC #"+(t[c]+1);a.push({id:this.walletId+"--"+s,name:f,type:T.AccountType.SIMPLE,path:s,coinType:v.COINTYPE_STC,pub:d,address:l}),c+=1}return a}));return function(n){return e.apply(this,arguments)}}(),u()(r)}(x.KeyringHdBase)}.call(this,t(26).Buffer)},4364:function(e,n,t){"use strict";t.r(n),function(e){t.d(n,"KeyringImported",(function(){return E}));var r=t(4),o=t.n(r),i=t(2),a=t.n(i),c=t(6),u=t.n(c),s=t(9),d=t.n(s),l=t(14),f=t.n(l),p=t(7),y=t.n(p),h=t(748),v=t(11),g=t(325),w=t(23),m=t(1345),T=t(117),x=t(3915),I=t(4050);function b(e){var n=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,r=y()(e);if(n){var o=y()(this).constructor;t=Reflect.construct(r,arguments,o)}else t=r.apply(this,arguments);return f()(this,t)}}var E=function(n){d()(r,n);var t=b(r);function r(){return t.apply(this,arguments)}var i=r.prototype;return i.getSigners=function(){var e=a()((function*(e,n){var t,r=yield this.getDbAccount();if(1!==n.length)throw new w.OneKeyInternalError("Starcoin signers number should be 1.");if(n[0]!==r.address)throw new w.OneKeyInternalError("Wrong address required for signing");var i=Object.values(yield this.getPrivateKeys(e)),a=o()(i,1)[0];return(t={})[r.address]=new m.Signer(a,e,"ed25519"),t}));return function(n,t){return e.apply(this,arguments)}}(),i.signTransaction=function(){var n=a()((function*(n,t){var r=yield this.vault.getNetworkChainId(),i=o()(n.inputs,1)[0],a=i.address,c=i.publicKey;("number"!==typeof n.nonce||n.nonce<=0)&&(n.nonce=yield this.vault.getNextNonce((yield this.vault.getNetwork()).id,yield this.getDbAccount()));var u=Object(I.buildUnsignedRawTx)(n,r),s=o()(u,2),d=s[0],l=s[1],f=Object(I.hashRawTx)(l);Object(g.check)("undefined"!==typeof c,"senderPublicKey is required");var p=(yield this.getSigners(t.password||"",[a]))[a],y=yield p.sign(e.from(f)),h=o()(y,1)[0];return Object(I.buildSignedTx)(c,h,d)}));return function(e,t){return n.apply(this,arguments)}}(),i.prepareAccounts=function(){var e=a()((function*(e){var n=e.privateKey,t=e.name;if(32!==n.length)throw new w.OneKeyInternalError("Invalid private key.");var r=h.ed25519.publicFromPrivate(n).toString("hex"),o=yield Object(I.pubkeyToAddress)(r);return Promise.resolve([{id:"imported--"+v.COINTYPE_STC+"--"+r,name:t||"",type:T.AccountType.SIMPLE,path:"",coinType:v.COINTYPE_STC,pub:r,address:o}])}));return function(n){return e.apply(this,arguments)}}(),u()(r)}(x.KeyringImportedBase)}.call(this,t(26).Buffer)},6117:function(e,n,t){"use strict";t.r(n),t.d(n,"default",(function(){return X}));var r=t(15),o=t.n(r),i=t(60),a=t.n(i),c=t(4),u=t.n(c),s=t(3),d=t.n(s),l=t(2),f=t.n(l),p=t(6),y=t.n(p),h=t(9),v=t.n(h),g=t(14),w=t.n(g),m=t(7),T=t.n(m),x=t(21),I=t.n(x),b=t(4171),E=t.n(b),O=t(112),A=t(46),P=t(11),N=t(19),C=t(150),S=t(68),k=t(23),D=t(1345),R=t(52),B=t(196),F=t(3912),K=t(120),j=t(4360),H=t(4363),_=t(4364),U=t(117),M=t(3916),L=t(4050);function V(e){var n=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,r=T()(e);if(n){var o=T()(this).constructor;t=Reflect.construct(r,arguments,o)}else t=r.apply(this,arguments);return w()(this,t)}}var W=function(e){v()(t,e);var n=V(t);function t(){return n.apply(this,arguments)}return t.prototype.prepareAccounts=function(){var e=f()((function*(e){var n=e.name,t=e.target,r=e.accountIdPrefix,o=Object(L.verifyAddress)(t),i=o.normalizedAddress;if(!o.isValid||"undefined"===typeof i)throw new k.InvalidAddress;return Promise.resolve([{id:r+"--"+P.COINTYPE_STC+"--"+t,name:n||"",type:U.AccountType.SIMPLE,path:"",coinType:P.COINTYPE_STC,pub:"",address:i}])}));return function(n){return e.apply(this,arguments)}}(),y()(t)}(M.KeyringWatchingBase),G=t(4320),z=t(2714),J=["gasLimit"];function Y(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function q(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Y(Object(t),!0).forEach((function(n){d()(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Y(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function Q(e){var n=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,r=T()(e);if(n){var o=T()(this).constructor;t=Reflect.construct(r,arguments,o)}else t=r.apply(this,arguments);return w()(this,t)}}var X=function(e){v()(t,e);var n=Q(t);function t(){for(var e,t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];return(e=n.call.apply(n,[this].concat(r))).settings=z.default,e.keyringMap={hd:H.KeyringHd,hw:j.KeyringHardware,imported:_.KeyringImported,watching:W,external:W},e.createClientFromURL=Object(C.memoizee)((function(e){return new G.ClientStc(e)}),{max:1,maxAge:Object(A.getTimeDurationMs)({minute:3})}),e}var r=t.prototype;return r.decodedTxToLegacy=function(e){var n,t=e.actions[0],r=t.type,o=t.nativeTransfer,i=t.tokenTransfer;if(r===R.IDecodedTxActionType.NATIVE_TRANSFER)n={txType:K.EVMDecodedTxType.NATIVE_TRANSFER,symbol:"UNKNOWN",amount:null==o?void 0:o.amount,value:null==o?void 0:o.amountValue,fromAddress:null==o?void 0:o.from,toAddress:null==o?void 0:o.to,data:"",total:"0"};else if(r===R.IDecodedTxActionType.UNKNOWN){var a;n={txType:K.EVMDecodedTxType.NATIVE_TRANSFER,symbol:"UNKNOWN",fromAddress:e.owner,data:null==(a=e.payload)?void 0:a.data,total:"0"}}else{if(r!==R.IDecodedTxActionType.TOKEN_TRANSFER)throw new k.OneKeyInternalError("Incorrect decodedTx.");var c;n={txType:K.EVMDecodedTxType.TOKEN_TRANSFER,symbol:null==i?void 0:i.tokenInfo.symbol,amount:null==i?void 0:i.amount,value:null==i?void 0:i.amountValue,fromAddress:null==i?void 0:i.from,toAddress:null==i?void 0:i.to,data:null==(c=e.payload)?void 0:c.data,total:"0"}}return Promise.resolve(n)},r.decodeTx=function(){var e=f()((function*(e,n){var t,r=yield this.engine.getNetwork(this.networkId),o=yield this.getDbAccount(),i=yield this.engine.getNativeTokenInfo(this.networkId),a=e.data,c=null;if(e.to){var u={tokenInfo:i,from:e.from,to:e.to,amount:new I.a(e.value).shiftedBy(-i.decimals).toFixed(),amountValue:e.value,extraInfo:null};c={type:R.IDecodedTxActionType.NATIVE_TRANSFER,nativeTransfer:u}}else if(a){var s=Object(L.decodeTransactionPayload)(a);if("tokenTransfer"===s.type){var d,l=s.payload,f=l.tokenAddress,p=l.to,y=l.amountValue,h="nativeTransfer",v=R.IDecodedTxActionType.NATIVE_TRANSFER;if("0x00000000000000000000000000000001::STC::STC"!==f){if("undefined"===typeof(i=yield this.engine.ensureTokenInDB(this.networkId,f)))throw new k.OneKeyInternalError("Failed to get token info.");h="tokenTransfer",v=R.IDecodedTxActionType.TOKEN_TRANSFER}var g=new I.a(y).shiftedBy(-i.decimals).toFixed();(d={type:v})[h]={tokenInfo:i,from:e.from,to:p,amount:g,amountValue:y,extraInfo:null},c=d}else c={type:R.IDecodedTxActionType.UNKNOWN,direction:R.IDecodedTxDirection.SELF,unknownAction:{extraInfo:{}}}}else c={type:R.IDecodedTxActionType.UNKNOWN,direction:R.IDecodedTxDirection.OTHER,unknownAction:{extraInfo:{}}};var w={txid:"",owner:o.address,signer:o.address,nonce:0,actions:[c],status:R.IDecodedTxStatus.Pending,networkId:this.networkId,accountId:this.accountId,feeInfo:{price:Object(B.convertFeeValueToGwei)({value:null!=(t=e.gasPrice)?t:"1",network:r}),limit:e.gasLimit},extraInfo:null,encodedTx:e,payload:{data:e.data}};return Promise.resolve(w)}));return function(n,t){return e.apply(this,arguments)}}(),r.buildEncodedTxFromTransfer=function(){var e=f()((function*(e){if(!e.to)throw new Error("Invalid transferInfo.to params");var n=e.from,t=e.to,r=e.amount,o=e.token;if("undefined"!==typeof o&&o.length>0){var i=yield this.engine.ensureTokenInDB(this.networkId,o);if("undefined"===typeof i)throw new k.OneKeyInternalError("Failed to get token info.");return Promise.resolve({from:n,to:"",value:"",data:Object(L.encodeTokenTransferData)(t,i,r)})}var a=yield this.getNetwork();return Promise.resolve({from:n,to:t,value:new I.a(r).shiftedBy(a.decimals).toFixed()})}));return function(n){return e.apply(this,arguments)}}(),r.buildEncodedTxFromApprove=function(){var e=f()((function*(e){throw new k.NotImplemented}));return function(n){return e.apply(this,arguments)}}(),r.getJsonRPCClient=function(){var e=f()((function*(){var e=yield this.getRpcUrl();return this.createClientFromURL(e)}));return function(){return e.apply(this,arguments)}}(),r.getTransactionStatuses=function(){var e=f()((function*(e){return(yield this.getJsonRPCClient()).getTransactionStatuses(e)}));return function(n){return e.apply(this,arguments)}}(),r.getBalances=function(){var e=f()((function*(e){var n=e.map((function(e){var n=e.address,t=e.tokenAddress;return{address:n,coin:q({},"string"===typeof t?{tokenAddress:t}:{})}}));return(yield this.getJsonRPCClient()).getBalances(n)}));return function(n){return e.apply(this,arguments)}}(),r.updateEncodedTxTokenApprove=function(e,n){throw new k.NotImplemented},r.updateEncodedTx=function(){var e=f()((function*(e,n,t){if(t.type===R.IEncodedTxUpdateType.transfer){var r=yield this.getNetwork();e.value=new I.a(n.amount).shiftedBy(r.decimals).toFixed()}return Promise.resolve(e)}));return function(n,t,r){return e.apply(this,arguments)}}(),r.getNextNonce=function(){var e=f()((function*(e,n){var t,r=yield this.getJsonRPCClient(),o=yield r.getAddresses([n.address]),i=u()(o,1)[0],c=null!=(t=null==i?void 0:i.nonce)?t:0,s=yield S.default.history.getMaxPendingNonce({accountId:this.accountId,networkId:e}),d=yield S.default.history.getPendingNonceList({accountId:this.accountId,networkId:e}),l=Math.max(a()(s)?0:s+1,c);if(Number.isNaN(l)&&(l=c),l>c)for(var f=c;f<l;f+=1)if(!d.includes(f)){l=f;break}if(l<c&&(l=c),l-c>=P.HISTORY_CONSTS.PENDING_QUEUE_MAX_LENGTH)throw new k.PendingQueueTooLong(P.HISTORY_CONSTS.PENDING_QUEUE_MAX_LENGTH);return l}));return function(n,t){return e.apply(this,arguments)}}(),r.addressFromBase=function(){var e=f()((function*(e){return this.validateAddress(e.address)}));return function(n){return e.apply(this,arguments)}}(),r.buildUnsignedTxFromEncodedTx=function(){var e=f()((function*(e){var n=yield this.getDbAccount(),t=yield this.getNetwork(),r=yield this.getNetworkChainId(),o=new I.a(e.value),i=yield this.getJsonRPCClient(),a=e.nonce,c=new I.a(null!=a?a:"NaN"),u=c.isNaN()?yield this.getNextNonce(t.id,n):c.toNumber(),s=yield Object(L.buildUnsignedTx)(q({inputs:[{address:n.address,value:o,publicKey:n.pub}],outputs:e.to?[{address:e.to,value:o}]:[],nonce:u,feePricePerUnit:new I.a(e.gasPrice||"1"),payload:q({},e.data?{data:e.data}:{})},"undefined"!==typeof e.gasLimit?{feeLimit:new I.a(e.gasLimit)}:{}),i,r);return N.default.sendTx.info("buildUnsignedTxFromEncodedTx >>>> buildUnsignedTx",s),q(q({},s),{},{encodedTx:e})}));return function(n){return e.apply(this,arguments)}}(),r.getFeePricePerUnit=function(){var e=f()((function*(){return(yield this.getJsonRPCClient()).getFeePricePerUnit()}));return function(){return e.apply(this,arguments)}}(),r.fetchFeeInfo=function(){var e=f()((function*(e){var n,t=q(q({},e),{},{gasPrice:"1"}),r=t.gasLimit,i=o()(t,J),a=yield Promise.all([this.getNetwork(),this.engine.getGasInfo(this.networkId),this.buildUnsignedTxFromEncodedTx(i)]),c=u()(a,3),s=c[0],d=c[1].prices,l=c[2],f=I.a.max(null!=(n=l.feeLimit)?n:"0",null!=r?r:"0").toFixed();return"0"===f&&(e.data||(f="105547")),{nativeSymbol:s.symbol,nativeDecimals:s.decimals,feeSymbol:s.feeSymbol,feeDecimals:s.feeDecimals,limit:f,prices:d,defaultPresetIndex:"0",extraInfo:q({},Object.keys(l.tokensChangedTo||{}).length?{tokensChangedTo:l.tokensChangedTo}:{})}}));return function(n){return e.apply(this,arguments)}}(),r.attachFeeInfoToEncodedTx=function(){var e=f()((function*(e){var n=e.feeInfoValue,t=n.price,r=n.limit;if("undefined"!==typeof t&&"string"!==typeof t)throw new k.OneKeyInternalError("Invalid gas price.");if("string"!==typeof r)throw new k.OneKeyInternalError("Invalid fee limit");var o=yield this.getNetwork(),i=q(q({},e.encodedTx),{},{gasPrice:Object(B.convertFeeGweiToValue)({value:t||"0.000000001",network:o}),gasLimit:r});return Promise.resolve(i)}));return function(n){return e.apply(this,arguments)}}(),r.getExportedCredential=function(){var e=f()((function*(e){var n=yield this.getDbAccount();if(n.id.startsWith("hd-")||n.id.startsWith("imported")){var t=this.keyring,r=Object.values(yield t.getPrivateKeys(e)),o=u()(r,1)[0];return"0x"+Object(O.decrypt)(e,o).toString("hex")}throw new k.OneKeyInternalError("Only credential of HD or imported accounts can be exported")}));return function(n){return e.apply(this,arguments)}}(),r.fetchOnChainHistory=function(){var e=f()((function*(e){var n=this,t=e.localHistory,r=void 0===t?[]:t;if(e.tokenIdOnNetwork)return Promise.resolve([]);var o=yield this.getDbAccount(),i=(yield this.engine.getNetwork(this.networkId)).decimals,a=(yield Object(L.getAddressHistoryFromExplorer)(this.networkId,o.address)).map(function(){var e=f()((function*(e){var t=r.find((function(n){return n.decodedTx.txid===e.transaction_hash}));if(t&&t.decodedTx.isFinal)return Promise.resolve(null);try{var a=Object(L.extractTransactionInfo)(e);if(a){var c,u=a.from,s=a.to,d=a.tokenAddress,l=a.amountValue,f=a.feeValue,p={from:u,to:"",value:"",data:e.user_transaction.raw_txn.payload},y={type:R.IDecodedTxActionType.UNKNOWN};if(l&&d){var h,v=R.IDecodedTxDirection.IN;u===o.address&&(v=s===o.address?R.IDecodedTxDirection.SELF:R.IDecodedTxDirection.OUT);var g=R.IDecodedTxActionType.NATIVE_TRANSFER,w=yield n.engine.getNativeTokenInfo(n.networkId),m="nativeTransfer";if("0x00000000000000000000000000000001::STC::STC"===d)p.to=s,p.value=l;else if(g=R.IDecodedTxActionType.TOKEN_TRANSFER,m="tokenTransfer","undefined"===typeof(w=yield n.engine.ensureTokenInDB(n.networkId,d)))throw new k.OneKeyInternalError("Failed to get token info.");(h={type:g,direction:v})[m]={tokenInfo:w,from:u,to:s,amount:new I.a(l).shiftedBy(-w.decimals).toFixed(),amountValue:l,extraInfo:null},y=h}var T={txid:e.transaction_hash,owner:o.address,signer:u,nonce:0,actions:[y],status:"Executed"===e.status?R.IDecodedTxStatus.Confirmed:R.IDecodedTxStatus.Pending,networkId:n.networkId,accountId:n.accountId,encodedTx:p,extraInfo:null,totalFeeInNative:new I.a(f).shiftedBy(-i).toFixed()};return T.updatedAt=e.timestamp,T.createdAt=null!=(c=null==t?void 0:t.decodedTx.createdAt)?c:T.updatedAt,T.isFinal=T.status===R.IDecodedTxStatus.Confirmed,yield n.buildHistoryTx({decodedTx:T,historyTxToMerge:t})}}catch(x){N.default.common.error(x)}return Promise.resolve(null)}));return function(n){return e.apply(this,arguments)}}());return(yield Promise.all(a)).filter(Boolean)}));return function(n){return e.apply(this,arguments)}}(),r.proxyJsonRPCCall=function(){var e=f()((function*(e){var n=yield this.getJsonRPCClient();try{return yield n.rpc.call(e.method,e.params)}catch(t){throw Object(D.extractResponseError)(t)}}));return function(n){return e.apply(this,arguments)}}(),r.fetchTokenInfos=function(){var e=f()((function*(e){var n=yield this.getJsonRPCClient();try{return(yield n.rpc.batchCall(e.map((function(e){var n=e.split("::");return["state.get_resource",[u()(n,1)[0],"0x1::Token::TokenInfo<"+e+">",{decode:!0}]]})))).map((function(n,t){var r=n.json.scaling_factor;try{var o=e[t].split("::"),i=u()(o,3)[2];return{name:i,symbol:i,decimals:E.a.log10(r).toDP(0).toNumber()}}catch(a){return void N.default.common.error(a)}}))}catch(t){throw Object(D.extractResponseError)(t)}}));return function(n){return e.apply(this,arguments)}}(),r.validateTokenAddress=function(){var e=f()((function*(e){var n=e.split("::"),t=u()(n,3),r=t[0],o=t[1],i=t[2];if(o&&i)try{return(yield this.validateAddress(r))+"::"+o+"::"+i}catch(a){}throw new k.InvalidTokenAddress}));return function(n){return e.apply(this,arguments)}}(),r.validateAddress=function(){var e=f()((function*(e){var n=Object(L.verifyAddress)(e),t=n.normalizedAddress;if(!n.isValid||!t)throw new k.InvalidAddress;return Promise.resolve(t)}));return function(n){return e.apply(this,arguments)}}(),r.validateWatchingCredential=function(){var e=f()((function*(e){return Promise.resolve(this.settings.watchingAccountEnabled&&Object(L.verifyAddress)(e).isValid)}));return function(n){return e.apply(this,arguments)}}(),r.broadcastTransaction=function(){var e=f()((function*(e,n){N.default.engine.info("broadcastTransaction START:",{rawTx:e.rawTx});var t=yield this.getJsonRPCClient(),r=yield t.broadcastTransaction(e.rawTx);return N.default.engine.info("broadcastTransaction END:",{txid:r,rawTx:e.rawTx}),q(q({},e),{},{txid:r,encodedTx:e.encodedTx})}));return function(n,t){return e.apply(this,arguments)}}(),y()(t)}(F.VaultBase)}}]);