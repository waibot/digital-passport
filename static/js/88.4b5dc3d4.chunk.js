(this.webpackJsonp=this.webpackJsonp||[]).push([[88],{4292:function(e,t,n){"use strict";var i;n.r(t),n.d(t,"ManageConnectedSitesRoutes",(function(){return i})),function(e){e.ManageConnectedSitesModel="ManageConnectedSitesModal"}(i||(i={}))},5310:function(e,t,n){"use strict";n.r(t);var i=n(50),o=n(57),l=n(100),c=n(201),s=n(64),r=n(82),a=n(109),d=n(27),u=n(12),f=n(40),j=n(2),p=n.n(j),b=n(4),m=n.n(b),h=n(271),x=n.n(h),O=n(1),g=n(1580),v=n(690),_=n.n(v),C=n(88),y=n(108),w=n(11),M=n(17),I=n(45),S=n(46),A=n(99),P=n(368),V=n(54),D=n(20),L=n(48),k=n(323),W=n(25),E=n(578),T=n(0),R=function(e){var t=e.onClose,n=Object(O.useState)(""),i=m()(n,2),o=i[0],l=i[1],c=Object(C.default)(),s=Object(E.useClipboard)(),r=s.getClipboard,d=s.canGetClipboard,u=Object(W.useActiveWalletAccount)().networkImpl;return Object(T.jsx)(a.default,{visible:!0,onClose:t,footerButtonProps:{primaryActionTranslationId:"action__add",primaryActionProps:{type:"primary"},onPrimaryActionPress:function(){var e=p()((function*(){var e=o.trim();if(/^wc:.+@.+\?.+/.test(e))k.default.openConnectToDappModal({uri:e});else if(e.length>0){e.startsWith("http://")||e.startsWith("https://")||(e="https://"+e);try{var n=new URL(e),i=n.hostname,l=n.origin;if(i.includes(".")||i.includes("localhost")){var s=yield M.default.serviceDapp.getActiveConnectedAccountsAsync({origin:l,impl:u});null!=s&&s.length?L.default.show({title:c.formatMessage({id:"msg__this_address_already_exists"})}):setTimeout(p()((function*(){yield M.default.serviceDapp.openConnectionModal({origin:l})})),600)}}catch(r){}}null==t||t()}));return function(){return e.apply(this,arguments)}}()},contentProps:{title:c.formatMessage({id:"title__add_site_connection"}),contentElement:Object(T.jsx)(P.default,{rightCustomElement:d?Object(T.jsx)(V.default,{type:"plain",onPress:p()((function*(){var e=yield r();e&&l(e)})),children:Object(T.jsx)(D.default,{color:"text-success",children:c.formatMessage({id:"action__paste"})})}):null,autoFocus:!0,w:"full",mt:"2",type:"text",placeholder:c.formatMessage({id:"form__start_with_wc_or_https_placeholder"}),value:o,onChangeText:function(e){l(e)}})}})},z=n(471),B=n(1067),N=n(587),F=Object(O.memo)((function(e){var t=e.connections,n=e.onAddConnectSite,i=e.onDisConnectWalletConnected,o=Object(C.default)(),l=Object(W.useActiveWalletAccount)(),c=l.accountId,a=l.networkId,j=l.walletId,b=Object(O.useState)((function(){return[]})),h=m()(b,2),x=h[0],v=h[1],_=Object(W.useAppSelector)((function(e){return e.refresher.refreshConnectedSitesTs})),w=Object(O.useState)({connected:!1}),I=m()(w,2),A=I[0],P=I[1];Object(O.useEffect)((function(){var e=function(){var e=p()((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;yield Object(S.wait)(e);var t=yield M.default.serviceDapp.getWalletConnectSession(),n=yield M.default.serviceDapp.getWalletConnectSessionV2(),i=n.sessions,o=[];t&&o.push({sessionV1:t}),i.forEach((function(e){o.push({sessionV2:e})})),v((function(){return o}));var l=yield M.default.walletConnect.checkWssConnectionStatusV2();P(l)}));return function(){return e.apply(this,arguments)}}();e(),e(600)}),[t,_,c,a,j]);var D=Object(O.useCallback)((function(e){var t,n,o,l,c,a,f,j,b,m,h,O,v,_,C,w,I,A,P,V,D,L,k,W,E,R,z,B,N,F,H,U,X=e.item,G=e.index,J="",Q="",q=[];X.sessionV1&&(J=null!=(n=null!=(o=null==(l=X.sessionV1)||null==(c=l.peerMeta)?void 0:c.name)?o:null==(a=X.sessionV1)||null==(f=a.peerMeta)?void 0:f.url)?n:"",Q=null!=(j=null==(b=X.sessionV1)||null==(m=b.peerMeta)||null==(h=m.icons)?void 0:h[0])?j:"",q=null!=(O=null==(v=X.sessionV1)?void 0:v.accounts)?O:[]);X.sessionV2&&(J=null!=(_=null!=(C=null==(w=X.sessionV2)||null==(I=w.peer)||null==(A=I.metadata)?void 0:A.name)?C:null==(P=X.sessionV2)||null==(V=P.peer)||null==(D=V.metadata)?void 0:D.url)?_:"",Q=null!=(L=null==(k=X.sessionV2)||null==(W=k.peer)||null==(E=W.metadata)||null==(R=E.icons)?void 0:R[0])?L:"",q=(null==(z=X.sessionV2)||null==(B=z.namespaces)||null==(N=B.eip155)||null==(F=N.accounts)||null==(H=F[0])||null==(U=H.split(":"))?void 0:U.slice(-1))||[]);return Object(T.jsx)(s.default,{children:Object(T.jsx)(u.default,{padding:"16px",height:"76px",width:"100%",bgColor:"surface-default",borderTopRadius:0===G?"12px":"0px",borderRadius:G===(null==x?void 0:x.length)-1?"12px":"0px",borderWidth:1,borderTopWidth:0===G?1:0,borderBottomWidth:G===(null==x?void 0:x.length)-1?1:0,borderColor:"border-subdued",children:Object(T.jsxs)(u.default,{alignItems:"center",flexDirection:"row",flex:1,children:[Object(T.jsx)(u.default,{size:"32px",overflow:"hidden",rounded:"full",children:Object(T.jsx)(g.default,{w:"full",h:"full",src:Q,alt:Q},Q)}),Object(T.jsxs)(u.default,{ml:"3",flex:1,children:[Object(T.jsx)(d.default.Body2Strong,{noOfLines:2,children:J}),Object(T.jsx)(d.default.Body2,{color:"text-subdued",children:q[0]?Object(y.shortenAddress)(null!=(t=q[0])?t:"0x000000")+" \xb7 EVM":"EVM"})]}),Object(T.jsx)(r.default,{name:"XCircleMini",type:"plain",circle:!0,onPress:function(){i(J,p()((function*(){try{X.sessionV1&&(yield M.default.walletConnect.disconnect()),X.sessionV2&&(yield M.default.walletConnect.disconnectV2({sessionV2:X.sessionV2})),yield Object(S.wait)(600)}finally{M.default.walletConnect.refreshConnectedSites()}})))}})]})})})}),[i,null==x?void 0:x.length]);return Object(T.jsx)(u.default,{children:Object(T.jsx)(z.default,{renderItem:D,data:x,ListHeaderComponent:Object(T.jsxs)(u.default,{flexDirection:"column",children:[Object(T.jsxs)(u.default,{flexDirection:"row",alignItems:"center",justifyContent:"space-around",flex:1,children:[Object(T.jsx)(V.default,{type:"basic",leftIconName:"PlusMini",iconSize:20,size:"lg",flex:1,mr:"4",onPress:n,children:o.formatMessage({id:"action__add"})}),Object(T.jsx)(V.default,{type:"basic",size:"lg",flex:1,leftIconName:"ViewfinderCircleMini",iconSize:20,onPress:function(){Object(B.gotoScanQrcode)()},children:o.formatMessage({id:"action__scan"})})]}),Object(T.jsxs)(u.default,{flexDirection:"row",alignItems:"center",mb:1,mt:3,flex:1,children:[Object(T.jsx)(f.default,{name:"WalletconnectLogoIllus"}),Object(T.jsx)(d.default.Subheading,{ml:"2",color:"text-subdued",children:o.formatMessage({id:"form__walletconnect__uppercase"})}),Object(T.jsx)(u.default,{ml:"2",children:Object(T.jsx)(N.default,{borderWidth:0,backgroundColor:A.connected?"icon-success":"icon-critical"})})]})]}),ListFooterComponent:Object(T.jsx)(u.default,{display:"flex",flexDirection:"row",alignItems:"center",flex:1,mb:"1",mt:"6",children:Object(T.jsx)(d.default.Subheading,{color:"text-subdued",children:o.formatMessage({id:"title__connect_sites"})})}),ListEmptyComponent:Object(T.jsx)(s.default,{borderRadius:"12",flexDirection:"row",p:"4",alignItems:"center",bg:"surface-default",onPress:function(){Object(B.gotoScanQrcode)()},children:Object(T.jsxs)(u.default,{display:"flex",alignItems:"center",flexDirection:"row",flex:1,children:[Object(T.jsx)(u.default,{alignItems:"center",justifyContent:"center",size:"32px",overflow:"hidden",rounded:"full",backgroundColor:"surface-neutral-default",children:Object(T.jsx)(f.default,{name:"ViewfinderCircleMini",size:20})}),Object(T.jsx)(d.default.Body2Strong,{ml:"3",children:o.formatMessage({id:"action__scan_to_connect"})})]})})})})})),H=function(e){switch(e){case w.IMPL_SOL:return"Solana";case w.IMPL_EVM:case w.IMPL_NEAR:case w.IMPL_ALGO:case w.IMPL_CFX:case w.IMPL_STC:case w.IMPL_TRON:return e.toUpperCase();default:return""}};function U(e){var t=e.item,n=Object(O.useState)(t.site.icon),i=m()(n,2),o=i[0],l=i[1];return Object(O.useEffect)((function(){t.site.icon||p()((function*(){yield Object(S.wait)(0);var e=yield M.default.serviceDapp.getWalletConnectSession();l((function(){var n,i;return e&&(null==(n=e.peerMeta)?void 0:n.url)===t.site.origin?null==(i=e.peerMeta)?void 0:i.icons[0]:t.site.origin+"/favicon.ico"}))}))()}),[t.site.origin,t.site.icon]),Object(T.jsx)(u.default,{size:"32px",overflow:"hidden",rounded:"full",children:Object(T.jsx)(g.default,{w:"full",h:"full",src:o,alt:o,fallbackElement:Object(T.jsx)(f.default,{name:"LinkOutline",size:32})},o)})}function X(e){var t=e.item,n=M.default.serviceDapp,i=Object(I.useActiveWalletAccount)(),o=i.accountId,l=i.networkId,c=i.walletId,s=Object(O.useState)(t.address),r=m()(s,2),a=r[0],u=r[1];return Object(O.useEffect)((function(){p()((function*(){var e;yield Object(S.wait)(0);var i=yield n.getActiveConnectedAccountsAsync({origin:t.site.origin,impl:t.networkImpl}),o=null==i||null==(e=i[0])?void 0:e.address;u(o)}))()}),[t.networkImpl,t.site.origin,n,o,l,c]),Object(T.jsx)(d.default.Body2,{color:"text-subdued",numberOfLines:1,children:Object(y.shortenAddress)(a)+" \xb7 "+H(t.networkImpl)})}var G=n(4292),J=n(234),Q=Object(J.default)(),q=[{name:G.ManageConnectedSitesRoutes.ManageConnectedSitesModel,component:function(){var e=Object(C.default)(),t=Object(I.useAppSelector)((function(e){return e.dapp.connections})),n=Object(O.useMemo)((function(){return function(e){var t=x()(e),n=[],i=new Map;for(var o of t)if(o.site.origin){var l=o.site.origin+o.address+o.networkImpl;if(!i.has(l)){try{o.site.hostname=new URL(o.site.origin).hostname}catch(c){o.site.hostname=""}n.push(o),i.set(l,1)}}return n.sort((function(e,t){return _()({insensitive:!0})(e.site.hostname,t.site.hostname)}))}(t)}),[t]),i=Object(O.useCallback)((function(t,n){Object(A.showOverlay)((function(i){return Object(T.jsx)(a.default,{visible:!0,onClose:i,footerButtonProps:{primaryActionTranslationId:"action__disconnect",primaryActionProps:{type:"destructive",onPromise:function(){var e=p()((function*(){try{yield n()}finally{i()}}));return function(){return e.apply(this,arguments)}}()},wrap:!0},contentProps:{iconType:"danger",iconName:"ConnectOffOutline",title:e.formatMessage({id:"dialog__disconnect_from_this_site"}),content:e.formatMessage({id:"dialog__disconnect_all_accounts_desc"},{0:t})}})}))}),[e]),j=Object(O.useCallback)((function(){Object(A.showDialog)(Object(T.jsx)(R,{}))}),[]),b=Object(O.useCallback)((function(e){var t=e.item,o=e.index;return Object(T.jsx)(s.default,{children:Object(T.jsx)(u.default,{padding:"16px",height:"76px",width:"100%",bgColor:"surface-default",borderTopRadius:0===o?"12px":"0px",borderRadius:o===(null==n?void 0:n.length)-1?"12px":"0px",borderWidth:1,borderTopWidth:0===o?1:0,borderBottomWidth:o===(null==n?void 0:n.length)-1?1:0,borderColor:"border-subdued",children:Object(T.jsxs)(u.default,{flexDirection:"row",flex:1,alignItems:"center",children:[Object(T.jsx)(U,{item:t}),Object(T.jsxs)(u.default,{flexDirection:"column",ml:"3",justifyContent:"center",flex:1,children:[Object(T.jsx)(d.default.Body1Strong,{children:t.site.hostname}),Object(T.jsx)(X,{item:t})]}),Object(T.jsx)(r.default,{name:"XCircleMini",type:"plain",circle:!0,onPress:function(){i(t.site.origin,p()((function*(){try{yield M.default.serviceDapp.cancellConnectedSite(t)}catch(e){throw e}})))}})]})})})}),[i,null==n?void 0:n.length]),m=Object(O.useCallback)((function(){return Object(T.jsx)(F,{connections:t,onDisConnectWalletConnected:i,onAddConnectSite:j})}),[t,i,j]);return Object(T.jsx)(o.default,{hidePrimaryAction:!0,maxHeight:"560px",header:e.formatMessage({id:"title__connect_sites"}),footer:null,flatListProps:{ListHeaderComponent:m,data:n,renderItem:b,ListEmptyComponent:Object(T.jsx)(u.default,{flexDirection:"column",alignItems:"center",justifyContent:"center",height:"350px",children:Object(T.jsx)(c.default,{icon:Object(T.jsx)(f.default,{name:"InboxOutline",size:48}),title:e.formatMessage({id:"empty__no_connected_sites"}),subTitle:e.formatMessage({id:"empty__no_connected_sites_desc"})})}),ItemSeparatorComponent:l.default,showsVerticalScrollIndicator:!1}})}}];t.default=function(){var e=Object(i.default)();return Object(T.jsx)(Q.Navigator,{screenOptions:{headerShown:!1,animationEnabled:!!e},children:q.map((function(e){return Object(T.jsx)(Q.Screen,{name:e.name,component:e.component},e.name)}))})}}}]);