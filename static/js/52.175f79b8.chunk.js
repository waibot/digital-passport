(this.webpackJsonp=this.webpackJsonp||[]).push([[52],{3903:function(e,n,t){"use strict";t.r(n),t.d(n,"KeyringBase",(function(){return y})),t.d(n,"KeyringBaseMock",(function(){return h}));var r=t(2),o=t.n(r),i=t(6),a=t.n(i),c=t(9),u=t.n(c),s=t(14),d=t.n(s),l=t(7),f=t.n(l);function p(e){var n=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,r=f()(e);if(n){var o=f()(this).constructor;t=Reflect.construct(r,arguments,o)}else t=r.apply(this,arguments);return d()(this,t)}}var y=function(e){u()(t,e);var n=p(t);function t(e){var t;return(t=n.call(this,e.options)).vault=e,t}return t.prototype.addressFromBase=function(){var e=o()((function*(e){return this.vault.addressFromBase(e)}));return function(n){return e.apply(this,arguments)}}(),a()(t)}(t(1585).VaultContext),h=function(e){u()(t,e);var n=p(t);function t(){return n.apply(this,arguments)}return a()(t)}(y)},3905:function(e,n,t){"use strict";t.r(n),t.d(n,"KeyringSoftwareBase",(function(){return x}));var r=t(4),o=t.n(r),i=t(3),a=t.n(i),c=t(2),u=t.n(c),s=t(6),d=t.n(s),l=t(9),f=t.n(l),p=t(14),y=t.n(p),h=t(7),v=t.n(h),g=t(19),w=t(23);function m(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function T(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?m(Object(t),!0).forEach((function(n){a()(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):m(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function I(e){var n=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,r=v()(e);if(n){var o=v()(this).constructor;t=Reflect.construct(r,arguments,o)}else t=r.apply(this,arguments);return y()(this,t)}}var x=function(e){f()(t,e);var n=I(t);function t(){return n.apply(this,arguments)}var r=t.prototype;return r.signTransaction=function(){var e=u()((function*(e,n){var t=n.password;if("undefined"===typeof t)throw new w.OneKeyInternalError("Software signing requires a password.");var r=yield this.getSigners(t,e.inputs.map((function(e){return e.address})));return g.default.engine.info("signTransaction",this.networkId,e),T(T({},yield this.engine.providerManager.signTransaction(this.networkId,e,r)),{},{encodedTx:e.encodedTx})}));return function(n,t){return e.apply(this,arguments)}}(),r.signMessage=function(){var e=u()((function*(e,n){var t=this,r=n.password;if("undefined"===typeof r)throw new w.OneKeyInternalError("Software signing requires a password.");var i=yield this.getDbAccount(),a=Object.values(yield this.getSigners(r,[i.address])),c=o()(a,1)[0];return g.default.engine.info("signMessage",this.networkId,e),Promise.all(e.map((function(e){return t.engine.providerManager.signMessage(t.networkId,e,c)})))}));return function(n,t){return e.apply(this,arguments)}}(),r.getAddress=function(){throw new Error("Method not implemented.")},r.batchGetAddress=function(){throw new Error("Method not implemented.")},r.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},d()(t)}(t(3903).KeyringBase)},3912:function(e,n,t){"use strict";t.r(n),function(e){t.d(n,"VaultBaseChainOnly",(function(){return F})),t.d(n,"VaultBase",(function(){return R}));var r=t(202),o=t.n(r),i=t(3),a=t.n(i),c=t(60),u=t.n(c),s=t(2),d=t.n(s),l=t(6),f=t.n(l),p=t(9),y=t.n(p),h=t(14),v=t.n(h),g=t(7),w=t.n(g),m=t(21),T=t.n(m),I=t(167),x=t.n(I),O=t(11),b=t(19),A=t(24),E=t(68),P=t(23),D=t(182),k=t(947),B=t(52),N=t(1585);function C(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function S(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?C(Object(t),!0).forEach((function(n){a()(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):C(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function j(e){var n=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,r=w()(e);if(n){var o=w()(this).constructor;t=Reflect.construct(r,arguments,o)}else t=r.apply(this,arguments);return v()(this,t)}}if(A.default.isExtensionUi)throw new Error("engine/VaultBase is not allowed imported from ui");var F=function(e){y()(t,e);var n=j(t);function t(){return n.apply(this,arguments)}var r=t.prototype;return r.initProvider=function(){var e=d()((function*(){var e=(yield this.getNetwork()).impl;u()(k.IMPL_MAPPINGS[e])||(this.engineProvider=yield this.engine.providerManager.getProvider(this.networkId))}));return function(){return e.apply(this,arguments)}}(),r.proxyJsonRPCCall=function(){var e=d()((function*(e){throw new P.NotImplemented}));return function(n){return e.apply(this,arguments)}}(),r.createClientFromURL=function(e){throw new P.NotImplemented},r.getEthersProvider=function(){var e=d()((function*(){throw new P.NotImplemented}));return function(){return e.apply(this,arguments)}}(),r.getClientEndpointStatus=function(){var e=d()((function*(e){var n=this.createClientFromURL(e),t=performance.now(),r=(yield n.getInfo()).bestBlockNumber;return{responseTime:Math.floor(performance.now()-t),latestBlock:r}}));return function(n){return e.apply(this,arguments)}}(),r.checkRpcBatchSupport=function(){var e=d()((function*(e){throw new P.NotImplemented}));return function(n){return e.apply(this,arguments)}}(),r.getDisplayAddress=function(){var e=d()((function*(e){return Promise.resolve(e)}));return function(n){return e.apply(this,arguments)}}(),r.validateAddress=function(){var e=d()((function*(e){var n=yield this.engineProvider.verifyAddress(e),t=n.normalizedAddress;if(!n.isValid||!t)throw new P.InvalidAddress;return Promise.resolve(t)}));return function(n){return e.apply(this,arguments)}}(),r.validateImportedCredential=function(e){return Promise.resolve(this.settings.importedAccountEnabled&&/^(0x)?[0-9a-zA-Z]{64}$/.test(e))},r.validateWatchingCredential=function(){var e=d()((function*(e){return Promise.resolve(this.settings.watchingAccountEnabled&&(yield this.engineProvider.verifyAddress(e)).isValid)}));return function(n){return e.apply(this,arguments)}}(),r.validateTokenAddress=function(){var e=d()((function*(e){var n=yield this.engineProvider.verifyTokenAddress(e),t=n.normalizedAddress;if(!n.isValid||"undefined"===typeof t)throw new P.InvalidTokenAddress;return Promise.resolve(t)}));return function(n){return e.apply(this,arguments)}}(),r.validateCanCreateNextAccount=function(){var e=d()((function*(e,n){return Promise.resolve(!0)}));return function(n,t){return e.apply(this,arguments)}}(),r.checkAccountExistence=function(){var e=d()((function*(e,n){return Promise.resolve(!0)}));return function(n,t){return e.apply(this,arguments)}}(),r.getBalances=function(){var e=d()((function*(e,n,t){return(yield this.engine.providerManager.getClient(this.networkId)).getBalances(e.map((function(e){var n=e.address,t=e.tokenAddress;return{address:n,coin:S({},"string"===typeof t?{tokenAddress:t}:{})}})))}));return function(n,t,r){return e.apply(this,arguments)}}(),r.getFrozenBalance=function(){var e=d()((function*(e){return 0}));return function(n){return e.apply(this,arguments)}}(),r.fetchBalanceDetails=function(){var e=d()((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.password;return Promise.resolve(void 0)}));return function(){return e.apply(this,arguments)}}(),r.getTransactionStatuses=function(e){return this.engine.providerManager.getTransactionStatuses(this.networkId,e)},r.getTransactionFeeInNative=function(e){return Promise.resolve("")},r.isContractAddress=function(){var e=d()((function*(e){return!1}));return function(n){return e.apply(this,arguments)}}(),r.getAccountNameInfoMap=function(){var e=d()((function*(){var e=yield this.getNetwork();return Object(D.getAccountNameInfoByImpl)(e.impl)}));return function(){return e.apply(this,arguments)}}(),r.canAutoCreateNextAccount=function(){var e=d()((function*(e){return Promise.resolve(!1)}));return function(n){return e.apply(this,arguments)}}(),r.filterAccounts=function(){var e=d()((function*(e){var n=e.accounts;e.networkId;return Promise.resolve(n)}));return function(n){return e.apply(this,arguments)}}(),r.shouldChangeAccountWhenNetworkChanged=function(){var e=d()((function*(e){e.previousNetwork,e.newNetwork,e.activeAccountId;return Promise.resolve({shouldReloadAccountList:!1,shouldChangeActiveAccount:!1})}));return function(n){return e.apply(this,arguments)}}(),r.getAccountNameInfosByImportedOrWatchingCredential=function(){var e=d()((function*(e){return Promise.resolve([])}));return function(n){return e.apply(this,arguments)}}(),r.checkIsUnlimitedAllowance=function(){var e=d()((function*(e){throw new P.NotImplemented}));return function(n){return e.apply(this,arguments)}}(),r.checkIsApprovedForAll=function(){var e=d()((function*(e){throw new P.NotImplemented}));return function(n){return e.apply(this,arguments)}}(),r.checkIsBatchTransfer=function(){var e=d()((function*(e){throw new P.NotImplemented}));return function(n){return e.apply(this,arguments)}}(),r.getFeePricePerUnit=function(){var e=d()((function*(){throw new P.NotImplemented}));return function(){return e.apply(this,arguments)}}(),r.fetchRpcChainId=function(){var e=d()((function*(e){return null}));return function(n){return e.apply(this,arguments)}}(),r.getTxWaitingSeconds=function(){var e=d()((function*(){return[]}));return function(){return e.apply(this,arguments)}}(),r.getUserNFTAssets=function(){var e=d()((function*(e){e.serviceData;return Promise.resolve(void 0)}));return function(n){return e.apply(this,arguments)}}(),f()(t)}(N.VaultContext),R=function(n){y()(r,n);var t=j(r);function r(){for(var e,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).uuid=x.a.v4().toString(),e}var i=r.prototype;return i.init=function(){var e=d()((function*(e){yield this.initProvider(),yield this.initKeyring(e)}));return function(n){return e.apply(this,arguments)}}(),i.initKeyring=function(){var e=d()((function*(e){this.keyring=yield e.keyringCreator(this)}));return function(n){return e.apply(this,arguments)}}(),i.signTransaction=function(){var e=d()((function*(e,n){return this.keyring.signTransaction(e,n)}));return function(n,t){return e.apply(this,arguments)}}(),i.signAndSendTransaction=function(){var e=d()((function*(e,n,t){var r=yield this.signTransaction(e,n);return t?S(S({},r),{},{encodedTx:e.encodedTx}):this.broadcastTransaction(S(S({},r),{},{encodedTx:e.encodedTx}))}));return function(n,t,r){return e.apply(this,arguments)}}(),i.broadcastTransaction=function(){var e=d()((function*(e,n){b.default.engine.info("broadcastTransaction START:",{rawTx:e.rawTx});var t=yield this.engine.providerManager.broadcastTransaction(this.networkId,e.rawTx,n);return b.default.engine.info("broadcastTransaction END:",{txid:t,rawTx:e.rawTx}),S(S({},e),{},{txid:t,encodedTx:e.encodedTx})}));return function(n,t){return e.apply(this,arguments)}}(),i.buildEncodedTxFromBatchTransfer=function(){var e=d()((function*(e){throw new P.NotImplemented}));return function(n){return e.apply(this,arguments)}}(),i.buildEncodedTxsFromSetApproveForAll=function(){var e=d()((function*(e,n){throw new P.NotImplemented}));return function(n,t){return e.apply(this,arguments)}}(),i.activateAccount=function(){var e=d()((function*(){throw new P.NotImplemented}));return function(){return e.apply(this,arguments)}}(),i.activateToken=function(){var e=d()((function*(e,n){throw new P.NotImplemented}));return function(n,t){return e.apply(this,arguments)}}(),i.getTokenAllowance=function(){var e=d()((function*(e,n){throw new P.NotImplemented}));return function(n,t){return e.apply(this,arguments)}}(),i.batchTokensAllowance=function(){var e=d()((function*(e,n){throw new P.NotImplemented}));return function(n,t){return e.apply(this,arguments)}}(),i.getOutputAccount=function(){var e=d()((function*(){var e=yield this.getDbAccount({noCache:!0});return{id:e.id,name:e.name,type:e.type,path:e.path,coinType:e.coinType,tokens:[],address:e.address,template:e.template,pubKey:o()(e,"pub","")}}));return function(){return e.apply(this,arguments)}}(),i.getAccountBalance=function(){var e=d()((function*(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],t=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,o=yield this.getDbAccount(),i=o.address;return this.getBalances((n?[{address:i}]:[]).concat(e.map((function(e){return{address:i,tokenAddress:e}}))),t,r)}));return function(n){return e.apply(this,arguments)}}(),i.updatePendingTxs=function(){var e=d()((function*(e){throw new P.NotImplemented}));return function(n){return e.apply(this,arguments)}}(),i.getAccountNonce=function(){var e=d()((function*(){return Promise.resolve(null)}));return function(){return e.apply(this,arguments)}}(),i.fixActionDirection=function(){var e=d()((function*(e){var n,t,r,o,i=e.action,a=e.accountAddress;(i.direction=B.IDecodedTxDirection.OTHER,i.type===B.IDecodedTxActionType.NATIVE_TRANSFER)&&(i.direction=yield this.buildTxActionDirection({from:(null==(n=i.nativeTransfer)?void 0:n.from)||"",to:(null==(t=i.nativeTransfer)?void 0:t.to)||"",address:a}));i.type===B.IDecodedTxActionType.TOKEN_TRANSFER&&(i.direction=yield this.buildTxActionDirection({from:(null==(r=i.tokenTransfer)?void 0:r.from)||"",to:(null==(o=i.tokenTransfer)?void 0:o.to)||"",address:a}));return i}));return function(n){return e.apply(this,arguments)}}(),i.fixDecodedTx=function(){var e=d()((function*(e){var n,t;e.createdAt=null!=(n=e.createdAt)?n:Date.now();var r=null==(t=e.encodedTx)?void 0:t.nonce;e.nonce=u()(r)?e.nonce:new T.a(r).toNumber();for(var o=e.owner,i=0;i<e.actions.length;i+=1){var a=e.actions[i];yield this.fixActionDirection({action:a,accountAddress:o})}if(e.outputActions)for(var c=0;c<e.outputActions.length;c+=1){var s=e.outputActions[c];yield this.fixActionDirection({action:s,accountAddress:o})}return Promise.resolve(e)}));return function(n){return e.apply(this,arguments)}}(),i.fixHistoryTx=function(){var e=d()((function*(e){return e.decodedTx=yield this.fixDecodedTx(e.decodedTx),Promise.resolve(e)}));return function(n){return e.apply(this,arguments)}}(),i.buildHistoryTx=function(){var e=d()((function*(e){var n=e.historyTxToMerge,t=(e.encodedTx,e.decodedTx),r=e.signedTx,o=e.isSigner,i=e.isLocalCreated,a=(null==r?void 0:r.txid)||(null==t?void 0:t.txid)||"";if(!a)throw new Error("buildHistoryTx txid not found");var c=yield this.getAccountAddress();t.txid=a||t.txid,t.owner=c,o&&(t.signer=c),null!=r&&r.txKey&&(t.extraInfo?t.extraInfo.txKey=r.txKey:t.extraInfo={txKey:r.txKey});var u=S(S({id:this.networkId+"_"+a+"_"+this.accountId,isLocalCreated:Boolean(i)},n),{},{decodedTx:t});return u=yield this.fixHistoryTx(u),Promise.resolve(u)}));return function(n){return e.apply(this,arguments)}}(),i.checkIsScamHistoryTx=function(){var e=d()((function*(e){return!1}));return function(n){return e.apply(this,arguments)}}(),i.fetchOnChainHistory=function(){var e=d()((function*(e){throw new P.NotImplemented}));return function(n){return e.apply(this,arguments)}}(),i.fixAddressCase=function(e){return Promise.resolve(e)},i.buildTxActionDirection=function(){var e=d()((function*(e){var n=e.from,t=e.to,r=e.address;return n=yield this.fixAddressCase(n||""),t=yield this.fixAddressCase(t),r=yield this.fixAddressCase(r),n===t&&n===r?B.IDecodedTxDirection.SELF:n&&n===r?B.IDecodedTxDirection.OUT:t&&t===r?B.IDecodedTxDirection.IN:B.IDecodedTxDirection.OTHER}));return function(n){return e.apply(this,arguments)}}(),i.getNextNonce=function(){var e=d()((function*(e,n){var t,r,o=null!=(t=null==(r=(yield this.engine.providerManager.getAddresses(e,[n.address]))[0])?void 0:r.nonce)?t:0,i=(yield this.engine.getHistory(e,n.id,void 0,!1),yield E.default.history.getMaxPendingNonce({accountId:this.accountId,networkId:e})),a=yield E.default.history.getPendingNonceList({accountId:this.accountId,networkId:e}),c=Math.max(u()(i)?0:i+1,o);if(Number.isNaN(c)&&(c=o),c>o)for(var s=o;s<c;s+=1)if(!a.includes(s)){c=s;break}if(c<o&&(c=o),c-o>=O.HISTORY_CONSTS.PENDING_QUEUE_MAX_LENGTH)throw new P.PendingQueueTooLong(O.HISTORY_CONSTS.PENDING_QUEUE_MAX_LENGTH);return c}));return function(n,t){return e.apply(this,arguments)}}(),i.validateSendAmount=function(e,n,t){return Promise.resolve(!0)},i.notifyChainChanged=function(e,n){},i.getFetchBalanceAddress=function(e){return Promise.resolve(e.address)},i.getPrivateKeyByCredential=function(n){return Promise.resolve(e.from(n.startsWith("0x")?n.slice(2):n,"hex"))},i.getMinDepositAmount=function(){var e=d()((function*(){return"0"}));return function(){return e.apply(this,arguments)}}(),i.specialCheckEncodedTx=function(){var e=d()((function*(e){return{success:!0}}));return function(n){return e.apply(this,arguments)}}(),i.getAllUsedAddress=function(){var e=d()((function*(){return Promise.resolve([])}));return function(){return e.apply(this,arguments)}}(),f()(r)}(F)}.call(this,t(26).Buffer)},3913:function(e,n,t){"use strict";t.r(n),function(e){t.d(n,"KeyringHardwareBase",(function(){return v}));var r=t(2),o=t.n(r),i=t(6),a=t.n(i),c=t(9),u=t.n(c),s=t(14),d=t.n(s),l=t(7),f=t.n(l),p=t(431),y=t(163);function h(e){var n=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,r=f()(e);if(n){var o=f()(this).constructor;t=Reflect.construct(r,arguments,o)}else t=r.apply(this,arguments);return d()(this,t)}}var v=function(n){u()(r,n);var t=h(r);function r(){return t.apply(this,arguments)}var i=r.prototype;return i.getHardwareInfo=function(){var e=o()((function*(){var e,n,t,r=yield this.engine.getHWDeviceByWalletId(this.vault.walletId);return{connectId:null!=(e=null==r?void 0:r.mac)?e:"",deviceId:null!=(n=null==r?void 0:r.deviceId)?n:"",deviceType:null!=(t=null==r?void 0:r.deviceType)?t:""}}));return function(){return e.apply(this,arguments)}}(),i.getWalletPassphraseState=function(){var e=o()((function*(){var e=yield this.engine.getWallet(this.vault.walletId);return{passphraseState:null==e?void 0:e.passphraseState,useEmptyPassphrase:!Object(y.isPassphraseWallet)(e)}}));return function(){return e.apply(this,arguments)}}(),i.getHardwareSDKInstance=function(){var n=o()((function*(){var n,t,r,o,i;return null!=(i=yield null==(n=e)||null==(t=n.$backgroundApiProxy)||null==(r=t.backgroundApi)||null==(o=r.serviceHardware)||null==o.getSDKInstance?void 0:o.getSDKInstance())?i:p.HardwareSDK}));return function(){return n.apply(this,arguments)}}(),i.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},a()(r)}(t(3903).KeyringBase)}.call(this,t(58))},3914:function(e,n,t){"use strict";t.r(n),t.d(n,"KeyringHdBase",(function(){return T}));var r=t(3),o=t.n(r),i=t(2),a=t.n(i),c=t(6),u=t.n(c),s=t(9),d=t.n(s),l=t(14),f=t.n(l),p=t(7),y=t.n(p),h=t(610),v=t(23);function g(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function w(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?g(Object(t),!0).forEach((function(n){o()(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):g(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function m(e){var n=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,r=y()(e);if(n){var o=y()(this).constructor;t=Reflect.construct(r,arguments,o)}else t=r.apply(this,arguments);return f()(this,t)}}var T=function(e){d()(t,e);var n=m(t);function t(){return n.apply(this,arguments)}var r=t.prototype;return r.getPrivateKeys=function(){var e=a()((function*(e,n){var t=(yield this.getDbAccount()).path.split("/"),r=n||[t.pop()],o=t.join("/"),i=(yield this.engine.dbApi.getCredential(this.walletId,e)).seed;if("undefined"===typeof i)throw new v.OneKeyInternalError("Unable to get credential.");var a=(yield this.engine.providerManager.getChainInfoByNetworkId(this.networkId)).curve;return Object(h.batchGetPrivateKeys)(a,i,e,o,r).reduce((function(e,n){var t;return w(w({},e),{},((t={})[n.path]=n.extendedKey.key,t))}),{})}));return function(n,t){return e.apply(this,arguments)}}(),r.getAddress=function(){throw new Error("Method not implemented.")},r.batchGetAddress=function(){throw new Error("Method not implemented.")},r.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},u()(t)}(t(3905).KeyringSoftwareBase)},3915:function(e,n,t){"use strict";t.r(n),t.d(n,"KeyringImportedBase",(function(){return h}));var r=t(2),o=t.n(r),i=t(6),a=t.n(i),c=t(9),u=t.n(c),s=t(14),d=t.n(s),l=t(7),f=t.n(l),p=t(23);function y(e){var n=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,r=f()(e);if(n){var o=f()(this).constructor;t=Reflect.construct(r,arguments,o)}else t=r.apply(this,arguments);return d()(this,t)}}var h=function(e){u()(t,e);var n=y(t);function t(){return n.apply(this,arguments)}var r=t.prototype;return r.getPrivateKeys=function(){var e=o()((function*(e,n){if("undefined"!==typeof n)throw new p.NotImplemented("Getting private keys from extended private key");var t=(yield this.engine.dbApi.getCredential(this.accountId,e)).privateKey;if("undefined"===typeof t)throw new p.OneKeyInternalError("Unable to get credential.");return{"":t}}));return function(n,t){return e.apply(this,arguments)}}(),r.getAddress=function(){throw new Error("Method not implemented.")},r.batchGetAddress=function(){throw new Error("Method not implemented.")},r.prepareAccountByAddressIndex=function(){throw new Error("Method not implemented.")},a()(t)}(t(3905).KeyringSoftwareBase)},3916:function(e,n,t){"use strict";t.r(n),t.d(n,"KeyringWatchingBase",(function(){return h}));var r=t(2),o=t.n(r),i=t(6),a=t.n(i),c=t(9),u=t.n(c),s=t(14),d=t.n(s),l=t(7),f=t.n(l),p=t(23);function y(e){var n=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,r=f()(e);if(n){var o=f()(this).constructor;t=Reflect.construct(r,arguments,o)}else t=r.apply(this,arguments);return d()(this,t)}}var h=function(e){u()(t,e);var n=y(t);function t(){return n.apply(this,arguments)}var r=t.prototype;return r.signTransaction=function(){var e=o()((function*(e,n){throw new p.OneKeyInternalError("signTransaction is not supported for watching accounts")}));return function(n,t){return e.apply(this,arguments)}}(),r.signMessage=function(){var e=o()((function*(e,n){throw new p.OneKeyInternalError("signMessage is not supported for watching accounts")}));return function(n,t){return e.apply(this,arguments)}}(),r.getAddress=function(){throw new Error("Method not implemented.")},r.batchGetAddress=function(){throw new Error("Method not implemented.")},r.prepareAccountByAddressIndex=function(){throw new Error("Method not implemented.")},a()(t)}(t(3903).KeyringBase)},3918:function(e,n,t){"use strict";t.r(n),t.d(n,"convertDeviceError",(function(){return c}));var r=t(70),o=t(90),i=t(19);t(24);function a(e,n){return"string"!==typeof n?null:e===r.HardwareErrorCode.DeviceInitializeFailed&&n.includes("ECONNABORTED")?new o.ConnectTimeoutError({message:n}):n.includes("Bridge network error")?new o.BridgeNetworkError({message:n}):null}function c(e){var n,t=e||{},c=t.code,u=t.error,s=t.message,d=null!=(n=null!=u?u:s)?n:"Unknown error";if(a(c,d))return a(c,d);switch(i.default.hardwareSDK.info("Device Utils Convert Device Error:",c,d),c){case r.HardwareErrorCode.UnknownError:return new o.UnknownHardwareError(e);case r.HardwareErrorCode.DeviceFwException:return new o.FirmwareVersionTooLow(e);case r.HardwareErrorCode.DeviceUnexpectedMode:return"string"===typeof d&&-1!==d.indexOf("ui-device_bootloader_mode")?new o.NotInBootLoaderMode(e):new o.UnknownHardwareError(e);case r.HardwareErrorCode.DeviceCheckDeviceIdError:return new o.DeviceNotSame(e);case r.HardwareErrorCode.DeviceNotFound:return new o.DeviceNotFind(e);case r.HardwareErrorCode.DeviceUnexpectedBootloaderMode:return new o.NotInBootLoaderMode(e);case r.HardwareErrorCode.DeviceInterruptedFromOutside:case r.HardwareErrorCode.DeviceInterruptedFromUser:return new o.UserCancelFromOutside(e);case r.HardwareErrorCode.DeviceNotSupportPassphrase:return new o.NotSupportPassphraseError(e);case r.HardwareErrorCode.IFrameLoadFail:return new o.InitIframeLoadFail(e);case r.HardwareErrorCode.IframeTimeout:return new o.InitIframeTimeout(e);case r.HardwareErrorCode.FirmwareUpdateDownloadFailed:return new o.FirmwareDownloadFailed(e);case r.HardwareErrorCode.FirmwareUpdateManuallyEnterBoot:return new o.FirmwareUpdateManuallyEnterBoot(e);case r.HardwareErrorCode.FirmwareUpdateAutoEnterBootFailure:return new o.FirmwareUpdateAutoEnterBootFailure(e);case r.HardwareErrorCode.FirmwareUpdateLimitOneDevice:return new o.FirmwareUpdateLimitOneDevice(e);case r.HardwareErrorCode.CallMethodNeedUpgradeFirmware:return new o.FirmwareVersionTooLow(e);case r.HardwareErrorCode.NewFirmwareUnRelease:return new o.NewFirmwareUnRelease(e);case r.HardwareErrorCode.NewFirmwareForceUpdate:return new o.NewFirmwareForceUpdate(e);case r.HardwareErrorCode.NetworkError:return new o.NetworkError(e);case r.HardwareErrorCode.BlePermissionError:return new o.NeedBluetoothTurnedOn(e);case r.HardwareErrorCode.BleLocationError:return new o.NeedBluetoothPermissions({message:d});case r.HardwareErrorCode.BleLocationServicesDisabled:return new o.BleLocationServiceError({message:d});case r.HardwareErrorCode.BleDeviceNotBonded:return new o.DeviceNotBonded(e);case r.HardwareErrorCode.BleDeviceBondError:return new o.DeviceBondError(e);case r.HardwareErrorCode.BleWriteCharacteristicError:return new o.BleWriteCharacteristicError(e);case r.HardwareErrorCode.BleScanError:return new o.BleScanError({message:d});case r.HardwareErrorCode.BleAlreadyConnected:return new o.BleAlreadyConnectedError(e);case r.HardwareErrorCode.RuntimeError:return-1!==d.indexOf("EIP712 blind sign is disabled")?new o.OpenBlindSign(e):-1!==d.indexOf("Unknown message")||-1!==d.indexOf("Failure_UnexpectedMessage")?new o.UnknownMethod(e):new o.UnknownHardwareError(e);case r.HardwareErrorCode.PinInvalid:return new o.InvalidPIN(e);case r.HardwareErrorCode.DeviceCheckPassphraseStateError:return new o.InvalidPassphrase(e);case r.HardwareErrorCode.DeviceOpenedPassphrase:return new o.DeviceOpenedPassphrase(e);case r.HardwareErrorCode.DeviceNotOpenedPassphrase:return new o.DeviceNotOpenedPassphrase(e);case r.HardwareErrorCode.PinCancelled:case r.HardwareErrorCode.ActionCancelled:return new o.UserCancel(e);case r.HardwareErrorCode.BridgeNotInstalled:case o.CustomOneKeyHardwareError.NeedOneKeyBridge:return new o.NeedOneKeyBridge(e);case r.HardwareErrorCode.BridgeNetworkError:return new o.BridgeNetworkError(e);case r.HardwareErrorCode.BridgeTimeoutError:return new o.BridgeTimeoutError(e);case r.HardwareErrorCode.PollingTimeout:return new o.ConnectTimeoutError(e);case r.HardwareErrorCode.PollingStop:return new o.ConnectPollingStopError(e);case r.HardwareErrorCode.BlindSignDisabled:return new o.OpenBlindSign(e);case r.HardwareErrorCode.FileAlreadyExists:return new o.FileAlreadyExistError(e);case r.HardwareErrorCode.CheckDownloadFileError:return new o.IncompleteFileError(e);case r.HardwareErrorCode.NotInSigningMode:return new o.NotInSigningModeError(e);default:return new o.UnknownHardwareError(e)}}},4025:function(e,n,t){"use strict";t.r(n);var r=t(4759);n.default=r},4204:function(e,n,t){"use strict";t.r(n),function(e){t.d(n,"signTransaction",(function(){return u})),t.d(n,"encodeTransaction",(function(){return d}));var r=t(4),o=t.n(r),i=t(2),a=t.n(i),c=t(4025);function u(e,n){return s.apply(this,arguments)}function s(){return(s=a()((function*(n,t){var r=n.payload.encodedTx,i=c.default.Transaction.from_obj_for_encoding(c.default.decodeObj(e.from(r,"base64"))),a=yield t.sign(i.bytesToSign()),u=o()(a,1)[0];return{txid:i.txID(),rawTx:e.from(c.default.encodeObj({sig:u,txn:i.get_obj_for_encoding()})).toString("base64")}}))).apply(this,arguments)}function d(n){return e.from(n.toByte()).toString("base64")}}.call(this,t(26).Buffer)},4758:function(e,n,t){"use strict";t.r(n),function(e){t.d(n,"KeyringHardware",(function(){return E}));var r=t(3),o=t.n(r),i=t(2),a=t.n(i),c=t(6),u=t.n(c),s=t(9),d=t.n(s),l=t(14),f=t.n(l),p=t(7),y=t.n(p),h=t(3918),v=t(11),g=t(19),w=t(23),m=t(117),T=t(3913),I=t(4025);function x(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function O(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?x(Object(t),!0).forEach((function(n){o()(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):x(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function b(e){var n=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,r=y()(e);if(n){var o=y()(this).constructor;t=Reflect.construct(r,arguments,o)}else t=r.apply(this,arguments);return f()(this,t)}}var A="m/44'/"+v.COINTYPE_ALGO+"'/0'/0'",E=function(n){d()(r,n);var t=b(r);function r(){return t.apply(this,arguments)}var o=r.prototype;return o.signTransaction=function(){var n=a()((function*(n){var t=yield this.getHardwareSDKInstance(),r=yield this.getAccountPath(),o=yield this.getHardwareInfo(),i=o.connectId,a=o.deviceId,c=yield this.getWalletPassphraseState(),u=n.payload.encodedTx,s=I.default.Transaction.from_obj_for_encoding(I.default.decodeObj(e.from(u,"base64"))),d=yield t.algoSignTransaction(i,a,O({path:r,rawTx:s.bytesToSign().toString("hex")},c));if(d.success){var l=d.payload.signature;return{txid:s.txID(),rawTx:e.from(I.default.encodeObj({sig:e.from(l,"hex"),txn:s.get_obj_for_encoding()})).toString("base64")}}throw Object(h.convertDeviceError)(d.payload)}));return function(e){return n.apply(this,arguments)}}(),o.signMessage=function(e,n){throw new w.NotImplemented},o.prepareAccounts=function(){var e=a()((function*(e){var n,t=this,r=e.indexes,o=e.names,i=r.map((function(e){return A+"/"+e+"'"})),a=yield this.getHardwareSDKInstance(),c=yield this.getHardwareInfo(),u=c.connectId,s=c.deviceId,d=yield this.getWalletPassphraseState();try{n=yield a.algoGetAddress(u,s,O({bundle:i.map((function(e){return{path:e,showOnOneKey:!1}}))},d))}catch(l){throw g.default.common.error(l),new w.OneKeyHardwareError(l)}if(!n.success)throw g.default.common.error(n.payload),Object(h.convertDeviceError)(n.payload);return n.payload.map((function(e,n){var i=e.address,a=void 0===i?"":i,c=e.path;return{id:t.walletId+"--"+c,name:(o||[])[n]||"ALGO #"+(r[n]+1),type:m.AccountType.SIMPLE,path:c,coinType:v.COINTYPE_ALGO,pub:"",address:a}})).filter((function(e){return!!e.address}))}));return function(n){return e.apply(this,arguments)}}(),o.getAddress=function(){var e=a()((function*(e){var n,t=yield this.getHardwareSDKInstance(),r=yield this.getHardwareInfo(),o=r.connectId,i=r.deviceId,a=yield this.getWalletPassphraseState(),c=yield t.algoGetAddress(o,i,O({path:e.path,showOnOneKey:e.showOnOneKey},a));if(c.success&&null!=(n=c.payload)&&n.address)return c.payload.address;throw Object(h.convertDeviceError)(c.payload)}));return function(n){return e.apply(this,arguments)}}(),o.batchGetAddress=function(){var e=a()((function*(e){var n=yield this.getHardwareSDKInstance(),t=yield this.getHardwareInfo(),r=t.connectId,o=t.deviceId,i=yield this.getWalletPassphraseState(),a=yield n.algoGetAddress(r,o,O(O({},i),{},{bundle:e.map((function(e){return{path:e.path,showOnOneKey:!!e.showOnOneKey}}))}));if(!a.success)throw Object(h.convertDeviceError)(a.payload);return a.payload.map((function(e){var n,t;return{path:null!=(n=e.path)?n:"",address:null!=(t=e.address)?t:""}}))}));return function(n){return e.apply(this,arguments)}}(),u()(r)}(T.KeyringHardwareBase)}.call(this,t(26).Buffer)},4775:function(e,n,t){"use strict";t.r(n),t.d(n,"KeyringHd",(function(){return O}));var r=t(2),o=t.n(r),i=t(6),a=t.n(i),c=t(9),u=t.n(c),s=t(14),d=t.n(s),l=t(7),f=t.n(l),p=t(610),y=t(11),h=t(23),v=t(1345),g=t(117),w=t(3914),m=t(4025),T=t(4204);function I(e){var n=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,r=f()(e);if(n){var o=f()(this).constructor;t=Reflect.construct(r,arguments,o)}else t=r.apply(this,arguments);return d()(this,t)}}var x="m/44'/"+y.COINTYPE_ALGO+"'/0'/0'",O=function(e){u()(t,e);var n=I(t);function t(){return n.apply(this,arguments)}var r=t.prototype;return r.prepareAccounts=function(){var e=o()((function*(e){var n=e.password,t=e.indexes,r=e.names,o=(yield this.engine.dbApi.getCredential(this.walletId,n)).seed,i=Object(p.batchGetPublicKeys)("ed25519",o,n,x,t.map((function(e){return e+"'"})));if(i.length!==t.length)throw new h.OneKeyInternalError("Unable to get publick key.");var a=[],c=0;for(var u of i){var s=u.path,d=u.extendedKey.key,l=m.default.encodeAddress(d),f=(r||[])[c]||"ALGO #"+(t[c]+1);a.push({id:this.walletId+"--"+s,name:f,type:g.AccountType.SIMPLE,path:s,coinType:y.COINTYPE_ALGO,pub:""+d.toString("hex"),address:l}),c+=1}return a}));return function(n){return e.apply(this,arguments)}}(),r.getSigners=function(){var e=o()((function*(e,n){var t,r=yield this.getDbAccount();if(1!==n.length)throw new h.OneKeyInternalError("ALGO signers number should be 1.");if(n[0]!==r.address)throw new h.OneKeyInternalError("Wrong address required for signing.");var o=(yield this.getPrivateKeys(e))[r.path];if("undefined"===typeof o)throw new h.OneKeyInternalError("Unable to get signer.");return(t={})[r.address]=new v.Signer(o,e,"ed25519"),t}));return function(n,t){return e.apply(this,arguments)}}(),r.signTransaction=function(){var e=o()((function*(e,n){var t=yield this.getDbAccount(),r=(yield this.getSigners(n.password||"",[t.address]))[t.address];return Object(T.signTransaction)(e,r)}));return function(n,t){return e.apply(this,arguments)}}(),r.signMessage=function(e,n){},a()(t)}(w.KeyringHdBase)},4776:function(e,n,t){"use strict";t.r(n),t.d(n,"KeyringImported",(function(){return x}));var r=t(2),o=t.n(r),i=t(6),a=t.n(i),c=t(9),u=t.n(c),s=t(14),d=t.n(s),l=t(7),f=t.n(l),p=t(748),y=t(11),h=t(23),v=t(1345),g=t(117),w=t(3915),m=t(4025),T=t(4204);function I(e){var n=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,r=f()(e);if(n){var o=f()(this).constructor;t=Reflect.construct(r,arguments,o)}else t=r.apply(this,arguments);return d()(this,t)}}var x=function(e){u()(t,e);var n=I(t);function t(){return n.apply(this,arguments)}var r=t.prototype;return r.prepareAccounts=function(){var e=o()((function*(e){var n=e.name,t=e.privateKey;if(32!==t.length)throw new h.OneKeyInternalError("Invalid private key.");var r=p.ed25519.publicFromPrivate(t),o=m.default.encodeAddress(r);return Promise.resolve([{id:"imported--"+y.COINTYPE_ALGO+"--"+o,name:n||"",type:g.AccountType.SIMPLE,path:"",coinType:y.COINTYPE_ALGO,pub:""+r.toString("hex"),address:o}])}));return function(n){return e.apply(this,arguments)}}(),r.getSigners=function(){var e=o()((function*(e,n){var t,r=yield this.getDbAccount();if(1!==n.length)throw new h.OneKeyInternalError("ALGO signers number should be 1.");if(n[0]!==r.address)throw new h.OneKeyInternalError("Wrong address required for signing.");var o=(yield this.getPrivateKeys(e))[r.path];if("undefined"===typeof o)throw new h.OneKeyInternalError("Unable to get signer.");return(t={})[r.address]=new v.Signer(o,e,"ed25519"),t}));return function(n,t){return e.apply(this,arguments)}}(),r.signTransaction=function(){var e=o()((function*(e,n){var t=yield this.getDbAccount(),r=(yield this.getSigners(n.password||"",[t.address]))[t.address];return Object(T.signTransaction)(e,r)}));return function(n,t){return e.apply(this,arguments)}}(),r.signMessage=function(e,n){},a()(t)}(w.KeyringImportedBase)},4777:function(e,n,t){"use strict";t.r(n),function(e){t.d(n,"KeyringWatching",(function(){return w}));var r=t(2),o=t.n(r),i=t(6),a=t.n(i),c=t(9),u=t.n(c),s=t(14),d=t.n(s),l=t(7),f=t.n(l),p=t(11),y=t(117),h=t(3916),v=t(4025);function g(e){var n=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,r=f()(e);if(n){var o=f()(this).constructor;t=Reflect.construct(r,arguments,o)}else t=r.apply(this,arguments);return d()(this,t)}}var w=function(n){u()(r,n);var t=g(r);function r(){return t.apply(this,arguments)}return r.prototype.prepareAccounts=function(){var n=o()((function*(n){var t=n.name,r=n.target,o=n.accountIdPrefix,i=yield this.vault.validateAddress(r),a=v.default.decodeAddress(i).publicKey;return Promise.resolve([{id:o+"--"+p.COINTYPE_ALGO+"--"+r,name:t||"",type:y.AccountType.SIMPLE,path:"",coinType:p.COINTYPE_ALGO,pub:""+e.from(a).toString("hex"),address:i}])}));return function(e){return n.apply(this,arguments)}}(),a()(r)}(h.KeyringWatchingBase)}.call(this,t(26).Buffer)},6081:function(e,n,t){"use strict";t.r(n),function(e){t.d(n,"default",(function(){return G}));var r=t(3),o=t.n(r),i=t(4),a=t.n(i),c=t(13),u=t.n(c),s=t(2),d=t.n(s),l=t(6),f=t.n(l),p=t(9),y=t.n(p),h=t(14),v=t.n(h),g=t(7),w=t.n(g),m=t(21),T=t.n(m),I=t(112),x=t(367),O=t(46),b=t(19),A=t(150),E=t(23),P=t(52),D=t(3912),k=t(4758),B=t(4775),N=t(4776),C=t(4777),S=t(4025),j=t(2720),F=t(4204);function R(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function H(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?R(Object(t),!0).forEach((function(n){o()(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):R(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function K(e){var n=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,r=w()(e);if(n){var o=w()(this).constructor;t=Reflect.construct(r,arguments,o)}else t=r.apply(this,arguments);return v()(this,t)}}var M=new T.a("0x10000000000000000"),U=/^.*account \w+ balance \d+ below min (\d+).*$/,_=/^.*asset (\d+) missing from \w+$/,L=S.default,G=function(n){y()(r,n);var t=K(r);function r(){for(var e,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).keyringMap={hd:B.KeyringHd,hw:k.KeyringHardware,imported:N.KeyringImported,watching:C.KeyringWatching,external:C.KeyringWatching},e.settings=j.default,e.getAlgod=Object(A.memoizee)((function(e,n,t){return new L.Algodv2(e,n,t)}),{primitive:!0,maxAge:Object(O.getTimeDurationMs)({minute:3}),max:3}),e.getIndexer=Object(A.memoizee)(d()((function*(){var n=(yield e.engine.getNetwork(e.networkId)).isTestnet,t=void 0===n||n?"testnet":"mainnet";return new L.Indexer("","https://algosigner.api.purestake.io/"+t+"/indexer",443)})),{maxAge:Object(O.getTimeDurationMs)({minute:3}),promise:!0,max:1}),e.getSuggestedParams=Object(A.memoizee)(d()((function*(){return(yield e.getClient()).getTransactionParams().do()})),{promise:!0,maxAge:Object(O.getTimeDurationMs)({minute:3})}),e}var o=r.prototype;return o.getClient=function(){var e=d()((function*(){var e=yield this.getRpcUrl();return this.getAlgod("",e,443)}));return function(){return e.apply(this,arguments)}}(),o.getClientEndpointStatus=function(){var e=d()((function*(e){var n=this.getAlgod("",e,443),t=performance.now(),r=(yield n.status().do())["last-round"];return{responseTime:Math.floor(performance.now()-t),latestBlock:r}}));return function(n){return e.apply(this,arguments)}}(),o.fetchTokenInfos=function(){var e=d()((function*(e){var n=yield this.getClient();return Promise.all(e.map(function(){var e=d()((function*(e){try{var t=(yield n.getAssetByID(parseInt(e)).do()).params;return{decimals:t.decimals,name:t.name,symbol:t["unit-name"]}}catch(r){}}));return function(n){return e.apply(this,arguments)}}()))}));return function(n){return e.apply(this,arguments)}}(),o.validateAddress=function(e){return L.isValidAddress(e)?Promise.resolve(e):Promise.reject(new E.InvalidAddress)},o.validateWatchingCredential=function(e){return Promise.resolve(this.settings.watchingAccountEnabled&&L.isValidAddress(e))},o.validateTokenAddress=function(e){var n=new T.a(e);return n.isFinite()&&n.gte(0)&&n.lt(M)?Promise.resolve(e):Promise.reject(new E.InvalidTokenAddress)},o.getBalances=function(){var e=d()((function*(e){var n=yield this.getClient(),t=u()(new Set(e.map((function(e){return e.address})))),r=(yield Promise.all(t.map(function(){var e=d()((function*(e){try{return yield n.accountInformation(e).do()}catch(t){}}));return function(n){return e.apply(this,arguments)}}()))).filter(Boolean),o=Object.fromEntries(r.map((function(e){var n=e.address,t=e.amount,r=e.assets;return[n,Object.fromEntries([["main",new T.a(t)]].concat(r.map((function(e){var n=e.amount;return[e["asset-id"].toString(),new T.a(n)]}))))]})));return e.map((function(e){var n,t=e.address,r=e.tokenAddress;if("undefined"!==typeof o[t])return null!=(n=o[t][r||"main"])?n:new T.a(0)}))}));return function(n){return e.apply(this,arguments)}}(),o.getTransactionStatuses=function(){var e=d()((function*(e){var n=yield this.getClient(),t=yield this.getIndexer();return Promise.all(e.map(function(){var e=d()((function*(e){try{var r=yield n.pendingTransactionInformation(e).do(),o=r["confirmed-round"];return r["pool-error"]?x.TransactionStatus.CONFIRM_BUT_FAILED:o>0?x.TransactionStatus.CONFIRM_AND_SUCCESS:x.TransactionStatus.PENDING}catch(i){if(404===i.status)try{return yield t.lookupTransactionByID(e).do(),x.TransactionStatus.CONFIRM_AND_SUCCESS}catch(a){if(404===a.status)return x.TransactionStatus.NOT_FOUND;throw a}throw i}}));return function(n){return e.apply(this,arguments)}}()))}));return function(n){return e.apply(this,arguments)}}(),o.activateToken=function(){var e=d()((function*(e,n){var t=(yield this.getDbAccount()).address,r=yield this.getClient(),o=(yield r.accountInformation(t).do()).assets;for(var i of o){if(i["asset-id"]===parseInt(e))return Promise.resolve(!0)}var a=yield this.buildEncodedTxFromTransfer({from:t,to:t,amount:"0",token:e}),c=yield this.buildUnsignedTxFromEncodedTx(a);return!!(yield this.signAndSendTransaction(c,{password:n},!1)).txid}));return function(n,t){return e.apply(this,arguments)}}(),o.attachFeeInfoToEncodedTx=function(e){return Promise.resolve(e.encodedTx)},o.decodeTx=function(){var n=d()((function*(n,t){var r,o=yield this.getDbAccount(),i=yield this.engine.getNativeTokenInfo(this.networkId),c={type:P.IDecodedTxActionType.UNKNOWN},u=L.decodeObj(e.from(n,"base64")),s=L.encodeAddress(u.snd);if(u.type===L.TransactionType.pay){var d,l=(null==(d=u.amt)?void 0:d.toString())||"0",f=L.encodeAddress(u.rcv);c={type:P.IDecodedTxActionType.NATIVE_TRANSFER,nativeTransfer:{tokenInfo:i,from:s,to:f,amount:new T.a(l).shiftedBy(-i.decimals).toFixed(),amountValue:l.toString(),extraInfo:null}}}if(u.type===L.TransactionType.axfer){var p,y,h=L.encodeAddress(u.arcv),v=yield this.engine.ensureTokenInDB(this.networkId,u.xaid.toString()),g=new T.a(null!=(p=null==(y=u.aamt)?void 0:y.toString())?p:0).toFixed();if("undefined"!==typeof v)if(s===h&&"0"===g)c={type:P.IDecodedTxActionType.TOKEN_ACTIVATE,tokenActivate:{tokenAddress:v.tokenIdOnNetwork,logoURI:"",decimals:v.decimals,name:v.name,symbol:v.symbol,extraInfo:null,networkId:this.networkId}};else{var w=u.asnd&&L.encodeAddress(u.asnd);if(u.aclose){var m=yield this.getBalances([{address:o.address,tokenAddress:v.tokenIdOnNetwork}]),I=a()(m,1)[0];g=new T.a(null!=I?I:0).toFixed()}c={type:P.IDecodedTxActionType.TOKEN_TRANSFER,tokenTransfer:{tokenInfo:v,from:null!=w?w:s,to:h,amount:new T.a(g).shiftedBy(-v.decimals).toFixed(),amountValue:g,extraInfo:null}}}}return{txid:"",owner:o.address,signer:s,nonce:0,actions:[c],status:P.IDecodedTxStatus.Pending,networkId:this.networkId,accountId:this.accountId,totalFeeInNative:new T.a(u.fee).shiftedBy(-i.decimals).toFixed(),extraInfo:{note:e.from(null!=(r=u.note)?r:"").toString()},encodedTx:n}}));return function(e,t){return n.apply(this,arguments)}}(),o.decodedTxToLegacy=function(e){return Promise.resolve({})},o.buildEncodedTxFromTransfer=function(){var e=d()((function*(e){if(!e.to)throw new Error("Invalid transferInfo.to params");var n=e.from,t=e.to,r=e.amount,o=e.token,i=yield this.engine.ensureTokenInDB(this.networkId,o||"");if(!i)throw new E.OneKeyInternalError("Token not found: "+(o||"ALGO"));var a=yield this.getSuggestedParams();return o?Object(F.encodeTransaction)(L.makeAssetTransferTxnWithSuggestedParamsFromObject({amount:BigInt(new T.a(r).shiftedBy(i.decimals).toFixed()),assetIndex:parseInt(o),from:n,to:t,suggestedParams:a})):Object(F.encodeTransaction)(L.makePaymentTxnWithSuggestedParamsFromObject({amount:BigInt(new T.a(r).shiftedBy(i.decimals).toFixed()),from:n,to:t,suggestedParams:a}))}));return function(n){return e.apply(this,arguments)}}(),o.buildEncodedTxFromApprove=function(e){throw new E.NotImplemented},o.updateEncodedTxTokenApprove=function(e,n){throw new E.NotImplemented},o.getFrozenBalance=function(){var e=d()((function*(){var e=yield this.getClient(),n=(yield this.engine.getNativeTokenInfo(this.networkId)).decimals,t=(yield this.getDbAccount()).address;try{var r=(yield e.accountInformation(t).do())["min-balance"],o=void 0===r?0:r;return{main:new T.a(null!=o?o:0).shiftedBy(-n).toNumber()}}catch(i){return 0}}));return function(){return e.apply(this,arguments)}}(),o.updateEncodedTx=function(){var n=d()((function*(n,t,r){var o=L.decodeObj(e.from(n,"base64"));if(r.type===P.IEncodedTxUpdateType.transfer&&o.type===L.TransactionType.pay){var i=(yield this.engine.getNativeTokenInfo(this.networkId)).decimals,a=t.amount;return Object(F.encodeTransaction)(L.Transaction.from_obj_for_encoding(H(H({},o),{},{amt:BigInt(new T.a(a).shiftedBy(i).toFixed())})))}return Promise.resolve(n)}));return function(e,t,r){return n.apply(this,arguments)}}(),o.buildUnsignedTxFromEncodedTx=function(e){return Promise.resolve({inputs:[],outputs:[],payload:{encodedTx:e},encodedTx:e})},o.fetchFeeInfo=function(){var n=d()((function*(n){var t=yield this.getNetwork(),r=L.decodeObj(e.from(n,"base64")).fee,o=void 0===r?0:r;return{nativeSymbol:t.symbol,nativeDecimals:t.decimals,feeSymbol:t.feeSymbol,feeDecimals:t.feeDecimals,limit:"0",prices:["0"],defaultPresetIndex:"0",tx:null,baseFeeValue:new T.a(o.toString()).shiftedBy(-t.feeDecimals).toFixed()}}));return function(e){return n.apply(this,arguments)}}(),o.broadcastTransaction=function(){var n=d()((function*(n){b.default.engine.info("broadcastTransaction START:",{rawTx:n.rawTx});var t=yield this.getClient();try{var r=(yield t.sendRawTransaction(e.from(n.rawTx,"base64")).do()).txId;return b.default.engine.info("broadcastTransaction END:",{txid:r,rawTx:n.rawTx}),H(H({},n),{},{txid:r})}catch(l){var o=l.message;if(_.test(o)){var i=o.match(_)[1],a=yield this.engine.ensureTokenInDB(this.networkId,i.toString());return Promise.reject(new E.RecipientHasNotActived((null==a?void 0:a.name)||i))}if(U.test(o)){var c=yield this.engine.getNativeTokenInfo(this.networkId),u=c.name,s=c.decimals,d=o.match(U)[1];return Promise.reject(new E.MimimumBalanceRequired(u,new T.a(d).shiftedBy(-s).toFixed()))}return Promise.reject(l)}}));return function(e){return n.apply(this,arguments)}}(),o.getExportedCredential=function(){var e=d()((function*(e){var n=yield this.getDbAccount();if(n.id.startsWith("hd-")||n.id.startsWith("imported")){var t=this.keyring,r=Object.values(yield t.getPrivateKeys(e)),o=a()(r,1)[0];return L.mnemonicFromSeed(Object(I.decrypt)(e,o))}throw new E.OneKeyInternalError("Only credential of HD or imported accounts can be exported")}));return function(n){return e.apply(this,arguments)}}(),o.fetchOnChainHistory=function(){var e=d()((function*(e){var n=this,t=e.localHistory,r=void 0===t?[]:t;if(e.tokenIdOnNetwork)return Promise.resolve([]);var o=(yield this.getDbAccount()).address,i=yield this.engine.getNativeTokenInfo(this.networkId),a=yield this.getIndexer(),c=(yield a.lookupAccountTransactions(o).limit(50).do()).transactions.map(function(){var e=d()((function*(e){var t=r.find((function(n){return n.decodedTx.txid===e.id}));if(t&&t.decodedTx.isFinal)return Promise.resolve(null);try{var a,c={txid:e.id,owner:o,signer:e.sender,nonce:0,actions:[{type:P.IDecodedTxActionType.UNKNOWN}],status:P.IDecodedTxStatus.Confirmed,networkId:n.networkId,accountId:n.accountId,extraInfo:null==t?void 0:t.decodedTx.extraInfo,totalFeeInNative:new T.a(e.fee).shiftedBy(-i.decimals).toFixed(),updatedAt:1e3*e["round-time"],createdAt:null!=(a=null==t?void 0:t.decodedTx.createdAt)?a:1e3*e["round-time"],isFinal:!0};if(e["tx-type"]===L.TransactionType.pay&&"undefined"!==typeof e["payment-transaction"]){var u=e["payment-transaction"],s=u.receiver,d=u.amount,l=P.IDecodedTxDirection.IN;e.sender===o&&(l=s===o?P.IDecodedTxDirection.SELF:P.IDecodedTxDirection.OUT),c.actions[0]={type:P.IDecodedTxActionType.NATIVE_TRANSFER,direction:l,nativeTransfer:{tokenInfo:i,from:e.sender,to:s,amount:new T.a(d).shiftedBy(-i.decimals).toFixed(),amountValue:d.toString(),extraInfo:null}}}else if(e["tx-type"]===L.TransactionType.axfer&&"undefined"!==typeof e["asset-transfer-transaction"]){var f=e["asset-transfer-transaction"],p=f.receiver,y=f.amount,h=(f["close-to"],f["close-amount"]),v=f["asset-id"],g=yield n.engine.ensureTokenInDB(n.networkId,v.toString());if("undefined"===typeof g)throw new E.OneKeyInternalError("Failed to get token info.");if(e.sender===o&&p===o&&0===y)c.actions[0]={type:P.IDecodedTxActionType.TOKEN_ACTIVATE,tokenActivate:{tokenAddress:g.tokenIdOnNetwork,logoURI:"",decimals:g.decimals,name:g.name,symbol:g.symbol,networkId:n.networkId,extraInfo:null}};else{var w=P.IDecodedTxDirection.IN;e.sender===o&&(w=p===o?P.IDecodedTxDirection.SELF:P.IDecodedTxDirection.OUT),c.actions[0]={type:P.IDecodedTxActionType.TOKEN_TRANSFER,direction:w,tokenTransfer:{tokenInfo:g,from:e.sender,to:p,amount:new T.a(h>0?h:y).shiftedBy(-g.decimals).toFixed(),amountValue:y.toString(),extraInfo:null}}}}return yield n.buildHistoryTx({decodedTx:c,historyTxToMerge:t})}catch(m){b.default.common.error(m)}}));return function(n){return e.apply(this,arguments)}}());return(yield Promise.all(c)).filter(Boolean)}));return function(n){return e.apply(this,arguments)}}(),o.getPrivateKeyByCredential=function(){var n=d()((function*(n){return Promise.resolve(e.from(L.seedFromMnemonic(n)))}));return function(e){return n.apply(this,arguments)}}(),o.validateImportedCredential=function(e){if(this.settings.importedAccountEnabled)try{if(L.seedFromMnemonic(e))return Promise.resolve(!0)}catch(n){}return Promise.resolve(!1)},f()(r)}(D.VaultBase)}.call(this,t(26).Buffer)}}]);