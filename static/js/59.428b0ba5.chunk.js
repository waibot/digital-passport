(this.webpackJsonp=this.webpackJsonp||[]).push([[59],{3903:function(e,t,n){"use strict";n.r(t),n.d(t,"KeyringBase",(function(){return y})),n.d(t,"KeyringBaseMock",(function(){return h}));var r=n(2),i=n.n(r),o=n(6),a=n.n(o),c=n(9),u=n.n(c),s=n(14),d=n.n(s),l=n(7),f=n.n(l);function p(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f()(e);if(t){var i=f()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return d()(this,n)}}var y=function(e){u()(n,e);var t=p(n);function n(e){var n;return(n=t.call(this,e.options)).vault=e,n}return n.prototype.addressFromBase=function(){var e=i()((function*(e){return this.vault.addressFromBase(e)}));return function(t){return e.apply(this,arguments)}}(),a()(n)}(n(1585).VaultContext),h=function(e){u()(n,e);var t=p(n);function n(){return t.apply(this,arguments)}return a()(n)}(y)},3905:function(e,t,n){"use strict";n.r(t),n.d(t,"KeyringSoftwareBase",(function(){return A}));var r=n(4),i=n.n(r),o=n(3),a=n.n(o),c=n(2),u=n.n(c),s=n(6),d=n.n(s),l=n(9),f=n.n(l),p=n(14),y=n.n(p),h=n(7),v=n.n(h),g=n(19),w=n(23);function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach((function(t){a()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function T(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=v()(e);if(t){var i=v()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return y()(this,n)}}var A=function(e){f()(n,e);var t=T(n);function n(){return t.apply(this,arguments)}var r=n.prototype;return r.signTransaction=function(){var e=u()((function*(e,t){var n=t.password;if("undefined"===typeof n)throw new w.OneKeyInternalError("Software signing requires a password.");var r=yield this.getSigners(n,e.inputs.map((function(e){return e.address})));return g.default.engine.info("signTransaction",this.networkId,e),b(b({},yield this.engine.providerManager.signTransaction(this.networkId,e,r)),{},{encodedTx:e.encodedTx})}));return function(t,n){return e.apply(this,arguments)}}(),r.signMessage=function(){var e=u()((function*(e,t){var n=this,r=t.password;if("undefined"===typeof r)throw new w.OneKeyInternalError("Software signing requires a password.");var o=yield this.getDbAccount(),a=Object.values(yield this.getSigners(r,[o.address])),c=i()(a,1)[0];return g.default.engine.info("signMessage",this.networkId,e),Promise.all(e.map((function(e){return n.engine.providerManager.signMessage(n.networkId,e,c)})))}));return function(t,n){return e.apply(this,arguments)}}(),r.getAddress=function(){throw new Error("Method not implemented.")},r.batchGetAddress=function(){throw new Error("Method not implemented.")},r.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},d()(n)}(n(3903).KeyringBase)},3912:function(e,t,n){"use strict";n.r(t),function(e){n.d(t,"VaultBaseChainOnly",(function(){return R})),n.d(t,"VaultBase",(function(){return F}));var r=n(202),i=n.n(r),o=n(3),a=n.n(o),c=n(60),u=n.n(c),s=n(2),d=n.n(s),l=n(6),f=n.n(l),p=n(9),y=n.n(p),h=n(14),v=n.n(h),g=n(7),w=n.n(g),m=n(21),b=n.n(m),T=n(167),A=n.n(T),E=n(11),I=n(19),O=n(24),x=n(68),N=n(23),P=n(182),C=n(947),_=n(52),k=n(1585);function B(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function S(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?B(Object(n),!0).forEach((function(t){a()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):B(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function D(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=w()(e);if(t){var i=w()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return v()(this,n)}}if(O.default.isExtensionUi)throw new Error("engine/VaultBase is not allowed imported from ui");var R=function(e){y()(n,e);var t=D(n);function n(){return t.apply(this,arguments)}var r=n.prototype;return r.initProvider=function(){var e=d()((function*(){var e=(yield this.getNetwork()).impl;u()(C.IMPL_MAPPINGS[e])||(this.engineProvider=yield this.engine.providerManager.getProvider(this.networkId))}));return function(){return e.apply(this,arguments)}}(),r.proxyJsonRPCCall=function(){var e=d()((function*(e){throw new N.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),r.createClientFromURL=function(e){throw new N.NotImplemented},r.getEthersProvider=function(){var e=d()((function*(){throw new N.NotImplemented}));return function(){return e.apply(this,arguments)}}(),r.getClientEndpointStatus=function(){var e=d()((function*(e){var t=this.createClientFromURL(e),n=performance.now(),r=(yield t.getInfo()).bestBlockNumber;return{responseTime:Math.floor(performance.now()-n),latestBlock:r}}));return function(t){return e.apply(this,arguments)}}(),r.checkRpcBatchSupport=function(){var e=d()((function*(e){throw new N.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),r.getDisplayAddress=function(){var e=d()((function*(e){return Promise.resolve(e)}));return function(t){return e.apply(this,arguments)}}(),r.validateAddress=function(){var e=d()((function*(e){var t=yield this.engineProvider.verifyAddress(e),n=t.normalizedAddress;if(!t.isValid||!n)throw new N.InvalidAddress;return Promise.resolve(n)}));return function(t){return e.apply(this,arguments)}}(),r.validateImportedCredential=function(e){return Promise.resolve(this.settings.importedAccountEnabled&&/^(0x)?[0-9a-zA-Z]{64}$/.test(e))},r.validateWatchingCredential=function(){var e=d()((function*(e){return Promise.resolve(this.settings.watchingAccountEnabled&&(yield this.engineProvider.verifyAddress(e)).isValid)}));return function(t){return e.apply(this,arguments)}}(),r.validateTokenAddress=function(){var e=d()((function*(e){var t=yield this.engineProvider.verifyTokenAddress(e),n=t.normalizedAddress;if(!t.isValid||"undefined"===typeof n)throw new N.InvalidTokenAddress;return Promise.resolve(n)}));return function(t){return e.apply(this,arguments)}}(),r.validateCanCreateNextAccount=function(){var e=d()((function*(e,t){return Promise.resolve(!0)}));return function(t,n){return e.apply(this,arguments)}}(),r.checkAccountExistence=function(){var e=d()((function*(e,t){return Promise.resolve(!0)}));return function(t,n){return e.apply(this,arguments)}}(),r.getBalances=function(){var e=d()((function*(e,t,n){return(yield this.engine.providerManager.getClient(this.networkId)).getBalances(e.map((function(e){var t=e.address,n=e.tokenAddress;return{address:t,coin:S({},"string"===typeof n?{tokenAddress:n}:{})}})))}));return function(t,n,r){return e.apply(this,arguments)}}(),r.getFrozenBalance=function(){var e=d()((function*(e){return 0}));return function(t){return e.apply(this,arguments)}}(),r.fetchBalanceDetails=function(){var e=d()((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.password;return Promise.resolve(void 0)}));return function(){return e.apply(this,arguments)}}(),r.getTransactionStatuses=function(e){return this.engine.providerManager.getTransactionStatuses(this.networkId,e)},r.getTransactionFeeInNative=function(e){return Promise.resolve("")},r.isContractAddress=function(){var e=d()((function*(e){return!1}));return function(t){return e.apply(this,arguments)}}(),r.getAccountNameInfoMap=function(){var e=d()((function*(){var e=yield this.getNetwork();return Object(P.getAccountNameInfoByImpl)(e.impl)}));return function(){return e.apply(this,arguments)}}(),r.canAutoCreateNextAccount=function(){var e=d()((function*(e){return Promise.resolve(!1)}));return function(t){return e.apply(this,arguments)}}(),r.filterAccounts=function(){var e=d()((function*(e){var t=e.accounts;e.networkId;return Promise.resolve(t)}));return function(t){return e.apply(this,arguments)}}(),r.shouldChangeAccountWhenNetworkChanged=function(){var e=d()((function*(e){e.previousNetwork,e.newNetwork,e.activeAccountId;return Promise.resolve({shouldReloadAccountList:!1,shouldChangeActiveAccount:!1})}));return function(t){return e.apply(this,arguments)}}(),r.getAccountNameInfosByImportedOrWatchingCredential=function(){var e=d()((function*(e){return Promise.resolve([])}));return function(t){return e.apply(this,arguments)}}(),r.checkIsUnlimitedAllowance=function(){var e=d()((function*(e){throw new N.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),r.checkIsApprovedForAll=function(){var e=d()((function*(e){throw new N.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),r.checkIsBatchTransfer=function(){var e=d()((function*(e){throw new N.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),r.getFeePricePerUnit=function(){var e=d()((function*(){throw new N.NotImplemented}));return function(){return e.apply(this,arguments)}}(),r.fetchRpcChainId=function(){var e=d()((function*(e){return null}));return function(t){return e.apply(this,arguments)}}(),r.getTxWaitingSeconds=function(){var e=d()((function*(){return[]}));return function(){return e.apply(this,arguments)}}(),r.getUserNFTAssets=function(){var e=d()((function*(e){e.serviceData;return Promise.resolve(void 0)}));return function(t){return e.apply(this,arguments)}}(),f()(n)}(k.VaultContext),F=function(t){y()(r,t);var n=D(r);function r(){for(var e,t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return(e=n.call.apply(n,[this].concat(r))).uuid=A.a.v4().toString(),e}var o=r.prototype;return o.init=function(){var e=d()((function*(e){yield this.initProvider(),yield this.initKeyring(e)}));return function(t){return e.apply(this,arguments)}}(),o.initKeyring=function(){var e=d()((function*(e){this.keyring=yield e.keyringCreator(this)}));return function(t){return e.apply(this,arguments)}}(),o.signTransaction=function(){var e=d()((function*(e,t){return this.keyring.signTransaction(e,t)}));return function(t,n){return e.apply(this,arguments)}}(),o.signAndSendTransaction=function(){var e=d()((function*(e,t,n){var r=yield this.signTransaction(e,t);return n?S(S({},r),{},{encodedTx:e.encodedTx}):this.broadcastTransaction(S(S({},r),{},{encodedTx:e.encodedTx}))}));return function(t,n,r){return e.apply(this,arguments)}}(),o.broadcastTransaction=function(){var e=d()((function*(e,t){I.default.engine.info("broadcastTransaction START:",{rawTx:e.rawTx});var n=yield this.engine.providerManager.broadcastTransaction(this.networkId,e.rawTx,t);return I.default.engine.info("broadcastTransaction END:",{txid:n,rawTx:e.rawTx}),S(S({},e),{},{txid:n,encodedTx:e.encodedTx})}));return function(t,n){return e.apply(this,arguments)}}(),o.buildEncodedTxFromBatchTransfer=function(){var e=d()((function*(e){throw new N.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),o.buildEncodedTxsFromSetApproveForAll=function(){var e=d()((function*(e,t){throw new N.NotImplemented}));return function(t,n){return e.apply(this,arguments)}}(),o.activateAccount=function(){var e=d()((function*(){throw new N.NotImplemented}));return function(){return e.apply(this,arguments)}}(),o.activateToken=function(){var e=d()((function*(e,t){throw new N.NotImplemented}));return function(t,n){return e.apply(this,arguments)}}(),o.getTokenAllowance=function(){var e=d()((function*(e,t){throw new N.NotImplemented}));return function(t,n){return e.apply(this,arguments)}}(),o.batchTokensAllowance=function(){var e=d()((function*(e,t){throw new N.NotImplemented}));return function(t,n){return e.apply(this,arguments)}}(),o.getOutputAccount=function(){var e=d()((function*(){var e=yield this.getDbAccount({noCache:!0});return{id:e.id,name:e.name,type:e.type,path:e.path,coinType:e.coinType,tokens:[],address:e.address,template:e.template,pubKey:i()(e,"pub","")}}));return function(){return e.apply(this,arguments)}}(),o.getAccountBalance=function(){var e=d()((function*(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,i=yield this.getDbAccount(),o=i.address;return this.getBalances((t?[{address:o}]:[]).concat(e.map((function(e){return{address:o,tokenAddress:e}}))),n,r)}));return function(t){return e.apply(this,arguments)}}(),o.updatePendingTxs=function(){var e=d()((function*(e){throw new N.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),o.getAccountNonce=function(){var e=d()((function*(){return Promise.resolve(null)}));return function(){return e.apply(this,arguments)}}(),o.fixActionDirection=function(){var e=d()((function*(e){var t,n,r,i,o=e.action,a=e.accountAddress;(o.direction=_.IDecodedTxDirection.OTHER,o.type===_.IDecodedTxActionType.NATIVE_TRANSFER)&&(o.direction=yield this.buildTxActionDirection({from:(null==(t=o.nativeTransfer)?void 0:t.from)||"",to:(null==(n=o.nativeTransfer)?void 0:n.to)||"",address:a}));o.type===_.IDecodedTxActionType.TOKEN_TRANSFER&&(o.direction=yield this.buildTxActionDirection({from:(null==(r=o.tokenTransfer)?void 0:r.from)||"",to:(null==(i=o.tokenTransfer)?void 0:i.to)||"",address:a}));return o}));return function(t){return e.apply(this,arguments)}}(),o.fixDecodedTx=function(){var e=d()((function*(e){var t,n;e.createdAt=null!=(t=e.createdAt)?t:Date.now();var r=null==(n=e.encodedTx)?void 0:n.nonce;e.nonce=u()(r)?e.nonce:new b.a(r).toNumber();for(var i=e.owner,o=0;o<e.actions.length;o+=1){var a=e.actions[o];yield this.fixActionDirection({action:a,accountAddress:i})}if(e.outputActions)for(var c=0;c<e.outputActions.length;c+=1){var s=e.outputActions[c];yield this.fixActionDirection({action:s,accountAddress:i})}return Promise.resolve(e)}));return function(t){return e.apply(this,arguments)}}(),o.fixHistoryTx=function(){var e=d()((function*(e){return e.decodedTx=yield this.fixDecodedTx(e.decodedTx),Promise.resolve(e)}));return function(t){return e.apply(this,arguments)}}(),o.buildHistoryTx=function(){var e=d()((function*(e){var t=e.historyTxToMerge,n=(e.encodedTx,e.decodedTx),r=e.signedTx,i=e.isSigner,o=e.isLocalCreated,a=(null==r?void 0:r.txid)||(null==n?void 0:n.txid)||"";if(!a)throw new Error("buildHistoryTx txid not found");var c=yield this.getAccountAddress();n.txid=a||n.txid,n.owner=c,i&&(n.signer=c),null!=r&&r.txKey&&(n.extraInfo?n.extraInfo.txKey=r.txKey:n.extraInfo={txKey:r.txKey});var u=S(S({id:this.networkId+"_"+a+"_"+this.accountId,isLocalCreated:Boolean(o)},t),{},{decodedTx:n});return u=yield this.fixHistoryTx(u),Promise.resolve(u)}));return function(t){return e.apply(this,arguments)}}(),o.checkIsScamHistoryTx=function(){var e=d()((function*(e){return!1}));return function(t){return e.apply(this,arguments)}}(),o.fetchOnChainHistory=function(){var e=d()((function*(e){throw new N.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),o.fixAddressCase=function(e){return Promise.resolve(e)},o.buildTxActionDirection=function(){var e=d()((function*(e){var t=e.from,n=e.to,r=e.address;return t=yield this.fixAddressCase(t||""),n=yield this.fixAddressCase(n),r=yield this.fixAddressCase(r),t===n&&t===r?_.IDecodedTxDirection.SELF:t&&t===r?_.IDecodedTxDirection.OUT:n&&n===r?_.IDecodedTxDirection.IN:_.IDecodedTxDirection.OTHER}));return function(t){return e.apply(this,arguments)}}(),o.getNextNonce=function(){var e=d()((function*(e,t){var n,r,i=null!=(n=null==(r=(yield this.engine.providerManager.getAddresses(e,[t.address]))[0])?void 0:r.nonce)?n:0,o=(yield this.engine.getHistory(e,t.id,void 0,!1),yield x.default.history.getMaxPendingNonce({accountId:this.accountId,networkId:e})),a=yield x.default.history.getPendingNonceList({accountId:this.accountId,networkId:e}),c=Math.max(u()(o)?0:o+1,i);if(Number.isNaN(c)&&(c=i),c>i)for(var s=i;s<c;s+=1)if(!a.includes(s)){c=s;break}if(c<i&&(c=i),c-i>=E.HISTORY_CONSTS.PENDING_QUEUE_MAX_LENGTH)throw new N.PendingQueueTooLong(E.HISTORY_CONSTS.PENDING_QUEUE_MAX_LENGTH);return c}));return function(t,n){return e.apply(this,arguments)}}(),o.validateSendAmount=function(e,t,n){return Promise.resolve(!0)},o.notifyChainChanged=function(e,t){},o.getFetchBalanceAddress=function(e){return Promise.resolve(e.address)},o.getPrivateKeyByCredential=function(t){return Promise.resolve(e.from(t.startsWith("0x")?t.slice(2):t,"hex"))},o.getMinDepositAmount=function(){var e=d()((function*(){return"0"}));return function(){return e.apply(this,arguments)}}(),o.specialCheckEncodedTx=function(){var e=d()((function*(e){return{success:!0}}));return function(t){return e.apply(this,arguments)}}(),o.getAllUsedAddress=function(){var e=d()((function*(){return Promise.resolve([])}));return function(){return e.apply(this,arguments)}}(),f()(r)}(R)}.call(this,n(26).Buffer)},3913:function(e,t,n){"use strict";n.r(t),function(e){n.d(t,"KeyringHardwareBase",(function(){return v}));var r=n(2),i=n.n(r),o=n(6),a=n.n(o),c=n(9),u=n.n(c),s=n(14),d=n.n(s),l=n(7),f=n.n(l),p=n(431),y=n(163);function h(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f()(e);if(t){var i=f()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return d()(this,n)}}var v=function(t){u()(r,t);var n=h(r);function r(){return n.apply(this,arguments)}var o=r.prototype;return o.getHardwareInfo=function(){var e=i()((function*(){var e,t,n,r=yield this.engine.getHWDeviceByWalletId(this.vault.walletId);return{connectId:null!=(e=null==r?void 0:r.mac)?e:"",deviceId:null!=(t=null==r?void 0:r.deviceId)?t:"",deviceType:null!=(n=null==r?void 0:r.deviceType)?n:""}}));return function(){return e.apply(this,arguments)}}(),o.getWalletPassphraseState=function(){var e=i()((function*(){var e=yield this.engine.getWallet(this.vault.walletId);return{passphraseState:null==e?void 0:e.passphraseState,useEmptyPassphrase:!Object(y.isPassphraseWallet)(e)}}));return function(){return e.apply(this,arguments)}}(),o.getHardwareSDKInstance=function(){var t=i()((function*(){var t,n,r,i,o;return null!=(o=yield null==(t=e)||null==(n=t.$backgroundApiProxy)||null==(r=n.backgroundApi)||null==(i=r.serviceHardware)||null==i.getSDKInstance?void 0:i.getSDKInstance())?o:p.HardwareSDK}));return function(){return t.apply(this,arguments)}}(),o.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},a()(r)}(n(3903).KeyringBase)}.call(this,n(58))},3914:function(e,t,n){"use strict";n.r(t),n.d(t,"KeyringHdBase",(function(){return b}));var r=n(3),i=n.n(r),o=n(2),a=n.n(o),c=n(6),u=n.n(c),s=n(9),d=n.n(s),l=n(14),f=n.n(l),p=n(7),y=n.n(p),h=n(610),v=n(23);function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function w(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function m(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=y()(e);if(t){var i=y()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f()(this,n)}}var b=function(e){d()(n,e);var t=m(n);function n(){return t.apply(this,arguments)}var r=n.prototype;return r.getPrivateKeys=function(){var e=a()((function*(e,t){var n=(yield this.getDbAccount()).path.split("/"),r=t||[n.pop()],i=n.join("/"),o=(yield this.engine.dbApi.getCredential(this.walletId,e)).seed;if("undefined"===typeof o)throw new v.OneKeyInternalError("Unable to get credential.");var a=(yield this.engine.providerManager.getChainInfoByNetworkId(this.networkId)).curve;return Object(h.batchGetPrivateKeys)(a,o,e,i,r).reduce((function(e,t){var n;return w(w({},e),{},((n={})[t.path]=t.extendedKey.key,n))}),{})}));return function(t,n){return e.apply(this,arguments)}}(),r.getAddress=function(){throw new Error("Method not implemented.")},r.batchGetAddress=function(){throw new Error("Method not implemented.")},r.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},u()(n)}(n(3905).KeyringSoftwareBase)},3915:function(e,t,n){"use strict";n.r(t),n.d(t,"KeyringImportedBase",(function(){return h}));var r=n(2),i=n.n(r),o=n(6),a=n.n(o),c=n(9),u=n.n(c),s=n(14),d=n.n(s),l=n(7),f=n.n(l),p=n(23);function y(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f()(e);if(t){var i=f()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return d()(this,n)}}var h=function(e){u()(n,e);var t=y(n);function n(){return t.apply(this,arguments)}var r=n.prototype;return r.getPrivateKeys=function(){var e=i()((function*(e,t){if("undefined"!==typeof t)throw new p.NotImplemented("Getting private keys from extended private key");var n=(yield this.engine.dbApi.getCredential(this.accountId,e)).privateKey;if("undefined"===typeof n)throw new p.OneKeyInternalError("Unable to get credential.");return{"":n}}));return function(t,n){return e.apply(this,arguments)}}(),r.getAddress=function(){throw new Error("Method not implemented.")},r.batchGetAddress=function(){throw new Error("Method not implemented.")},r.prepareAccountByAddressIndex=function(){throw new Error("Method not implemented.")},a()(n)}(n(3905).KeyringSoftwareBase)},3916:function(e,t,n){"use strict";n.r(t),n.d(t,"KeyringWatchingBase",(function(){return h}));var r=n(2),i=n.n(r),o=n(6),a=n.n(o),c=n(9),u=n.n(c),s=n(14),d=n.n(s),l=n(7),f=n.n(l),p=n(23);function y(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f()(e);if(t){var i=f()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return d()(this,n)}}var h=function(e){u()(n,e);var t=y(n);function n(){return t.apply(this,arguments)}var r=n.prototype;return r.signTransaction=function(){var e=i()((function*(e,t){throw new p.OneKeyInternalError("signTransaction is not supported for watching accounts")}));return function(t,n){return e.apply(this,arguments)}}(),r.signMessage=function(){var e=i()((function*(e,t){throw new p.OneKeyInternalError("signMessage is not supported for watching accounts")}));return function(t,n){return e.apply(this,arguments)}}(),r.getAddress=function(){throw new Error("Method not implemented.")},r.batchGetAddress=function(){throw new Error("Method not implemented.")},r.prepareAccountByAddressIndex=function(){throw new Error("Method not implemented.")},a()(n)}(n(3903).KeyringBase)},3918:function(e,t,n){"use strict";n.r(t),n.d(t,"convertDeviceError",(function(){return c}));var r=n(70),i=n(90),o=n(19);n(24);function a(e,t){return"string"!==typeof t?null:e===r.HardwareErrorCode.DeviceInitializeFailed&&t.includes("ECONNABORTED")?new i.ConnectTimeoutError({message:t}):t.includes("Bridge network error")?new i.BridgeNetworkError({message:t}):null}function c(e){var t,n=e||{},c=n.code,u=n.error,s=n.message,d=null!=(t=null!=u?u:s)?t:"Unknown error";if(a(c,d))return a(c,d);switch(o.default.hardwareSDK.info("Device Utils Convert Device Error:",c,d),c){case r.HardwareErrorCode.UnknownError:return new i.UnknownHardwareError(e);case r.HardwareErrorCode.DeviceFwException:return new i.FirmwareVersionTooLow(e);case r.HardwareErrorCode.DeviceUnexpectedMode:return"string"===typeof d&&-1!==d.indexOf("ui-device_bootloader_mode")?new i.NotInBootLoaderMode(e):new i.UnknownHardwareError(e);case r.HardwareErrorCode.DeviceCheckDeviceIdError:return new i.DeviceNotSame(e);case r.HardwareErrorCode.DeviceNotFound:return new i.DeviceNotFind(e);case r.HardwareErrorCode.DeviceUnexpectedBootloaderMode:return new i.NotInBootLoaderMode(e);case r.HardwareErrorCode.DeviceInterruptedFromOutside:case r.HardwareErrorCode.DeviceInterruptedFromUser:return new i.UserCancelFromOutside(e);case r.HardwareErrorCode.DeviceNotSupportPassphrase:return new i.NotSupportPassphraseError(e);case r.HardwareErrorCode.IFrameLoadFail:return new i.InitIframeLoadFail(e);case r.HardwareErrorCode.IframeTimeout:return new i.InitIframeTimeout(e);case r.HardwareErrorCode.FirmwareUpdateDownloadFailed:return new i.FirmwareDownloadFailed(e);case r.HardwareErrorCode.FirmwareUpdateManuallyEnterBoot:return new i.FirmwareUpdateManuallyEnterBoot(e);case r.HardwareErrorCode.FirmwareUpdateAutoEnterBootFailure:return new i.FirmwareUpdateAutoEnterBootFailure(e);case r.HardwareErrorCode.FirmwareUpdateLimitOneDevice:return new i.FirmwareUpdateLimitOneDevice(e);case r.HardwareErrorCode.CallMethodNeedUpgradeFirmware:return new i.FirmwareVersionTooLow(e);case r.HardwareErrorCode.NewFirmwareUnRelease:return new i.NewFirmwareUnRelease(e);case r.HardwareErrorCode.NewFirmwareForceUpdate:return new i.NewFirmwareForceUpdate(e);case r.HardwareErrorCode.NetworkError:return new i.NetworkError(e);case r.HardwareErrorCode.BlePermissionError:return new i.NeedBluetoothTurnedOn(e);case r.HardwareErrorCode.BleLocationError:return new i.NeedBluetoothPermissions({message:d});case r.HardwareErrorCode.BleLocationServicesDisabled:return new i.BleLocationServiceError({message:d});case r.HardwareErrorCode.BleDeviceNotBonded:return new i.DeviceNotBonded(e);case r.HardwareErrorCode.BleDeviceBondError:return new i.DeviceBondError(e);case r.HardwareErrorCode.BleWriteCharacteristicError:return new i.BleWriteCharacteristicError(e);case r.HardwareErrorCode.BleScanError:return new i.BleScanError({message:d});case r.HardwareErrorCode.BleAlreadyConnected:return new i.BleAlreadyConnectedError(e);case r.HardwareErrorCode.RuntimeError:return-1!==d.indexOf("EIP712 blind sign is disabled")?new i.OpenBlindSign(e):-1!==d.indexOf("Unknown message")||-1!==d.indexOf("Failure_UnexpectedMessage")?new i.UnknownMethod(e):new i.UnknownHardwareError(e);case r.HardwareErrorCode.PinInvalid:return new i.InvalidPIN(e);case r.HardwareErrorCode.DeviceCheckPassphraseStateError:return new i.InvalidPassphrase(e);case r.HardwareErrorCode.DeviceOpenedPassphrase:return new i.DeviceOpenedPassphrase(e);case r.HardwareErrorCode.DeviceNotOpenedPassphrase:return new i.DeviceNotOpenedPassphrase(e);case r.HardwareErrorCode.PinCancelled:case r.HardwareErrorCode.ActionCancelled:return new i.UserCancel(e);case r.HardwareErrorCode.BridgeNotInstalled:case i.CustomOneKeyHardwareError.NeedOneKeyBridge:return new i.NeedOneKeyBridge(e);case r.HardwareErrorCode.BridgeNetworkError:return new i.BridgeNetworkError(e);case r.HardwareErrorCode.BridgeTimeoutError:return new i.BridgeTimeoutError(e);case r.HardwareErrorCode.PollingTimeout:return new i.ConnectTimeoutError(e);case r.HardwareErrorCode.PollingStop:return new i.ConnectPollingStopError(e);case r.HardwareErrorCode.BlindSignDisabled:return new i.OpenBlindSign(e);case r.HardwareErrorCode.FileAlreadyExists:return new i.FileAlreadyExistError(e);case r.HardwareErrorCode.CheckDownloadFileError:return new i.IncompleteFileError(e);case r.HardwareErrorCode.NotInSigningMode:return new i.NotInSigningModeError(e);default:return new i.UnknownHardwareError(e)}}},4336:function(e,t,n){"use strict";n.r(t),function(e){n.d(t,"KeyringHardware",(function(){return P}));var r=n(3),i=n.n(r),o=n(2),a=n.n(o),c=n(6),u=n.n(c),s=n(9),d=n.n(s),l=n(14),f=n.n(l),p=n(7),y=n.n(p),h=n(731),v=n(3918),g=n(11),w=n(19),m=n(23),b=n(117),T=n(3913),A=n(1603);function E(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function I(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?E(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):E(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function O(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=y()(e);if(t){var i=y()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f()(this,n)}}var x="m/44'/"+g.COINTYPE_NEAR+"'";function N(e){return e.slice(e.startsWith("0x")?2:0)}var P=function(t){d()(r,t);var n=O(r);function r(){return n.apply(this,arguments)}var i=r.prototype;return i.signTransaction=function(){var t=a()((function*(t,n){var r=yield this.getDbAccount(),i=yield this.getHardwareSDKInstance(),o=yield this.getHardwareInfo(),a=o.connectId,c=o.deviceId,u=yield this.getWalletPassphraseState(),s=t.payload.nativeTx,d=yield i.nearSignTransaction(a,c,I({path:r.path,rawTx:e.from(Object(A.serializeTransaction)(s),"base64").toString("hex")},u));if(d.success&&d.payload.signature)return{txid:Object(A.serializeTransaction)(s,{encoding:"sha256_bs58"}),rawTx:Object(A.serializeTransaction)(new h.transactions.SignedTransaction({transaction:s,signature:new h.transactions.Signature({keyType:s.publicKey.keyType,data:e.from(d.payload.signature,"hex")})}))};throw Object(v.convertDeviceError)(d.payload)}));return function(e,n){return t.apply(this,arguments)}}(),i.signMessage=function(e,t){throw new m.NotImplemented("Signing near message with hardware is not supported yet.")},i.prepareAccounts=function(){var t=a()((function*(t){var n,r=this,i=t.indexes,o=t.names,a=i.map((function(e){return x+"/"+e+"'"})),c=yield this.getHardwareSDKInstance(),u=yield this.getHardwareInfo(),s=u.connectId,d=u.deviceId,l=yield this.getWalletPassphraseState();try{n=yield c.nearGetAddress(s,d,I({bundle:a.map((function(e){return{path:e,showOnOneKey:!1}}))},l))}catch(f){throw w.default.common.error(f),new m.OneKeyHardwareError(f)}if(!n.success)throw w.default.common.error(n.payload),Object(v.convertDeviceError)(n.payload);return n.payload.map((function(t,n){var a=t.address,c=t.path;return{id:r.walletId+"--"+c,name:(o||[])[n]||"NEAR #"+(i[n]+1),type:b.AccountType.SIMPLE,path:c,coinType:g.COINTYPE_NEAR,pub:"ed25519:"+Object(A.baseEncode)(e.from(N(null!=a?a:""),"hex")),address:N(null!=a?a:"")}})).filter((function(e){return!!e.address}))}));return function(e){return t.apply(this,arguments)}}(),i.getAddress=function(){var e=a()((function*(e){var t,n=yield this.getHardwareSDKInstance(),r=yield this.getHardwareInfo(),i=r.connectId,o=r.deviceId,a=yield this.getWalletPassphraseState(),c=yield n.nearGetAddress(i,o,I({path:e.path,showOnOneKey:e.showOnOneKey},a));if(c.success&&null!=(t=c.payload)&&t.address)return N(c.payload.address);throw Object(v.convertDeviceError)(c.payload)}));return function(t){return e.apply(this,arguments)}}(),i.batchGetAddress=function(){var e=a()((function*(e){var t=yield this.getHardwareSDKInstance(),n=yield this.getHardwareInfo(),r=n.connectId,i=n.deviceId,o=yield this.getWalletPassphraseState(),a=yield t.nearGetAddress(r,i,I(I({},o),{},{bundle:e.map((function(e){return{path:e.path,showOnOneKey:!!e.showOnOneKey}}))}));if(!a.success)throw Object(v.convertDeviceError)(a.payload);return a.payload.map((function(e){var t,n;return{path:null!=(t=e.path)?t:"",address:null!=(n=e.address)?n:""}}))}));return function(t){return e.apply(this,arguments)}}(),u()(r)}(T.KeyringHardwareBase)}.call(this,n(26).Buffer)},4337:function(e,t,n){"use strict";n.r(t),function(e){n.d(t,"NearCli",(function(){return O}));var r=n(4),i=n.n(r),o=n(2),a=n.n(o),c=n(6),u=n.n(c),s=n(9),d=n.n(s),l=n(14),f=n.n(l),p=n(7),y=n.n(p),h=n(21),v=n.n(h),g=n(633),w=n(765),m=n(367),b=n(556),T=n(1068);function A(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=y()(e);if(t){var i=y()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f()(this,n)}}function E(t){return JSON.parse(e.from(t).toString())}function I(t){return e.from(JSON.stringify(t))}var O=function(t){d()(r,t);var n=A(r);function r(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"optimistic";return(t=n.call(this)).defaultFinality=r,t.getBalance=function(){var e=a()((function*(e,n){if(null!=n&&n.tokenAddress){var r=yield t.callContract(n.tokenAddress,"ft_balance_of",{account_id:e});return new v.a(r)}var i=yield t.rpc.call("query",{request_type:"view_account",account_id:e,finality:t.defaultFinality});return new v.a(i.amount)}));return function(t,n){return e.apply(this,arguments)}}(),t.rpc=new T.JsonRPCRequest(e),t}var o=r.prototype;return o.getInfo=function(){var e=a()((function*(){var e=(yield this.getBestBlock()).blockNumber;return{bestBlockNumber:e,isReady:Number.isFinite(e)&&e>0}}));return function(){return e.apply(this,arguments)}}(),o.getTxCostConfig=function(){var e=a()((function*(){var e=(yield this.rpc.call("EXPERIMENTAL_protocol_config",{finality:this.defaultFinality})).runtime_config.transaction_costs;return{action_receipt_creation_config:e.action_receipt_creation_config,transfer_cost:e.action_creation_config.transfer_cost}}));return function(){return e.apply(this,arguments)}}(),o.getBestBlock=function(){var e=a()((function*(){var e=yield this.rpc.call("status",[]);return{blockNumber:Number(e.sync_info.latest_block_height),blockHash:e.sync_info.latest_block_hash}}));return function(){return e.apply(this,arguments)}}(),o.getAddress=function(){var e=a()((function*(e){try{var t=yield this.rpc.call("query",{request_type:"view_account",account_id:e,finality:this.defaultFinality}),n=new v.a(t.amount),r=yield this.getAccessKeys(e),o=r.filter((function(e){return"FullAccess"===e.type})),a=o.length>0?o:r,c=i()(a,1)[0].nonce;return{existing:!0,balance:n,nonce:Number.isFinite(c)&&c>0?c:void 0}}catch(d){if(d instanceof b.JsonPRCResponseError&&d.response)try{var u,s=yield d.response.json();if("UNKNOWN_ACCOUNT"===(null==s||null==(u=s.cause)?void 0:u.name))return{existing:!1,balance:new v.a(0)}}catch(d){}throw d}}));return function(t){return e.apply(this,arguments)}}(),o.getAccessKeys=function(){var e=a()((function*(e){return(yield this.rpc.call("query",{request_type:"view_access_key_list",account_id:e,finality:this.defaultFinality})).keys.map((function(e){var t=e.access_key.permission,n="FullAccess"===t;return{type:n?"FullAccess":"FunctionCall",pubkey:e.public_key,pubkeyHex:g.baseDecode(e.public_key.split(":")[1]||"").toString("hex"),nonce:e.access_key.nonce+1,functionCall:n?void 0:{allowance:t.FunctionCall.allowance,receiverId:t.FunctionCall.receiver_id,methodNames:t.FunctionCall.method_names}}}))}));return function(t){return e.apply(this,arguments)}}(),o.getFeePricePerUnit=function(){var e=a()((function*(){var e=yield this.rpc.call("gas_price",[null]);return{normal:{price:new v.a(e.gas_price)}}}));return function(){return e.apply(this,arguments)}}(),o.getTransactionStatus=function(){var e=a()((function*(e){try{var t=yield this.rpc.call("tx",[e,"dontcare"]);return"object"===typeof t.status&&"SuccessValue"in t.status?m.TransactionStatus.CONFIRM_AND_SUCCESS:m.TransactionStatus.CONFIRM_BUT_FAILED}catch(i){if(i instanceof b.JsonPRCResponseError&&i.response)try{var n,r=yield i.response.json();if("UNKNOWN_TRANSACTION"===(null==r||null==(n=r.cause)?void 0:n.name))return m.TransactionStatus.NOT_FOUND}catch(i){}throw i}}));return function(t){return e.apply(this,arguments)}}(),o.callContract=function(){var t=a()((function*(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=i.parse,a=void 0===o?E:o,c=i.stringify,u=void 0===c?I:c,s=u(r).toString("base64"),d=yield this.rpc.call("query",{request_type:"call_function",finality:this.defaultFinality,method_name:n,account_id:t,args_base64:s});return d.result&&d.result.length>0&&a(e.from(d.result))}));return function(e,n){return t.apply(this,arguments)}}(),o.broadcastTransaction=function(){var e=a()((function*(e){return(yield this.rpc.call("broadcast_tx_commit",[e])).transaction.hash}));return function(t){return e.apply(this,arguments)}}(),u()(r)}(w.SimpleClient)}.call(this,n(26).Buffer)},4566:function(e,t,n){"use strict";n.r(t);var r=n(4337);n.d(t,"NearCli",(function(){return r.NearCli}))},5307:function(e,t,n){"use strict";n.r(t),n.d(t,"KeyringHardware",(function(){return r.KeyringHardware})),n.d(t,"KeyringHd",(function(){return E})),n.d(t,"KeyringImported",(function(){return x})),n.d(t,"KeyringWatching",(function(){return P}));var r=n(4336),i=n(2),o=n.n(i),a=n(6),c=n.n(a),u=n(9),s=n.n(u),d=n(14),l=n.n(d),f=n(7),p=n.n(f),y=n(610),h=n(11),v=n(23),g=n(1345),w=n(117),m=n(3914),b=n(1603);function T(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=p()(e);if(t){var i=p()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return l()(this,n)}}var A="m/44'/"+h.COINTYPE_NEAR+"'",E=function(e){s()(n,e);var t=T(n);function n(){return t.apply(this,arguments)}var r=n.prototype;return r.prepareAccounts=function(){var e=o()((function*(e){var t=e.password,n=e.indexes,r=e.names,i=(yield this.engine.dbApi.getCredential(this.walletId,t)).seed,o=Object(y.batchGetPublicKeys)("ed25519",i,t,A,n.map((function(e){return e+"'"})));if(o.length!==n.length)throw new v.OneKeyInternalError("Unable to get publick key.");var a=[],c=0;for(var u of o){var s=u.path,d=u.extendedKey.key,l=d.toString("hex"),f=(r||[])[c]||"NEAR #"+(n[c]+1);a.push({id:this.walletId+"--"+s,name:f,type:w.AccountType.SIMPLE,path:s,coinType:h.COINTYPE_NEAR,pub:"ed25519:"+Object(b.baseEncode)(d),address:l}),c+=1}return a}));return function(t){return e.apply(this,arguments)}}(),r.getSigners=function(){var e=o()((function*(e,t){var n,r=yield this.getDbAccount();if(1!==t.length)throw new v.OneKeyInternalError("NEAR signers number should be 1.");if(t[0]!==r.address)throw new v.OneKeyInternalError("Wrong address required for signing.");var i=(yield this.getPrivateKeys(e))[r.path];if("undefined"===typeof i)throw new v.OneKeyInternalError("Unable to get signer.");return(n={})[r.address]=new g.Signer(i,e,"ed25519"),n}));return function(t,n){return e.apply(this,arguments)}}(),r.getSigner=function(){var e=o()((function*(e,t){var n=t.address;return(yield this.getSigners((null==e?void 0:e.password)||"",[n]))[n]}));return function(t,n){return e.apply(this,arguments)}}(),r.signTransaction=function(){var e=o()((function*(e,t){var n=yield this.getDbAccount(),r=yield this.getSigner(t,{address:n.address});return Object(b.signTransaction)(e,r)}));return function(t,n){return e.apply(this,arguments)}}(),r.signMessage=function(e,t){},c()(n)}(m.KeyringHdBase),I=n(748);function O(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=p()(e);if(t){var i=p()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return l()(this,n)}}var x=function(e){s()(n,e);var t=O(n);function n(){return t.apply(this,arguments)}var r=n.prototype;return r.prepareAccounts=function(){var e=o()((function*(e){var t=e.name,n=e.privateKey;if(32!==n.length)throw new v.OneKeyInternalError("Invalid private key.");var r=I.ed25519.publicFromPrivate(n),i=r.toString("hex");return Promise.resolve([{id:"imported--"+h.COINTYPE_NEAR+"--"+i,name:t||"",type:w.AccountType.SIMPLE,path:"",coinType:h.COINTYPE_NEAR,pub:"ed25519:"+Object(b.baseEncode)(r),address:i}])}));return function(t){return e.apply(this,arguments)}}(),r.getSigners=function(){var e=o()((function*(e,t){var n,r=yield this.getDbAccount();if(1!==t.length)throw new v.OneKeyInternalError("NEAR signers number should be 1.");if(t[0]!==r.address)throw new v.OneKeyInternalError("Wrong address required for signing.");var i=(yield this.getPrivateKeys(e))[r.path];if("undefined"===typeof i)throw new v.OneKeyInternalError("Unable to get signer.");return(n={})[r.address]=new g.Signer(i,e,"ed25519"),n}));return function(t,n){return e.apply(this,arguments)}}(),r.getSigner=function(){var e=o()((function*(e,t){var n=t.address;return(yield this.getSigners(e.password||"",[n]))[n]}));return function(t,n){return e.apply(this,arguments)}}(),r.signTransaction=function(){var e=o()((function*(e,t){var n=yield this.getDbAccount(),r=yield this.getSigner(t,n);return Object(b.signTransaction)(e,r)}));return function(t,n){return e.apply(this,arguments)}}(),r.signMessage=function(e,t){},c()(n)}(n(3915).KeyringImportedBase);function N(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=p()(e);if(t){var i=p()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return l()(this,n)}}var P=function(e){s()(n,e);var t=N(n);function n(){return t.apply(this,arguments)}return n.prototype.prepareAccounts=function(){var e=o()((function*(e){var t=e.name,n=e.target,r=e.accountIdPrefix,i=Object(b.verifyNearAddress)(n),o=i.normalizedAddress;if(!i.isValid||"undefined"===typeof o)throw new v.InvalidAddress;return Promise.resolve([{id:r+"--"+h.COINTYPE_NEAR+"--"+n,name:t||"",type:w.AccountType.SIMPLE,path:"",coinType:h.COINTYPE_NEAR,pub:"",address:o}])}));return function(t){return e.apply(this,arguments)}}(),c()(n)}(n(3916).KeyringWatchingBase)},6078:function(e,t,n){"use strict";n.r(t),function(e){n.d(t,"default",(function(){return H}));var r=n(3),i=n.n(r),o=n(4),a=n.n(o),c=n(790),u=n.n(c),s=n(2),d=n.n(s),l=n(6),f=n.n(l),p=n(9),y=n.n(p),h=n(14),v=n.n(h),g=n(7),w=n.n(g),m=n(107),b=n.n(m),T=n(21),A=n.n(T),E=n(748),I=n(112),O=n(367),x=n(19),N=n(150),P=n(23),C=n(1345),_=n(52),k=n(3912),B=n(5307),S=n(4566),D=n(2712),R=n(1603);function F(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function K(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?F(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):F(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function j(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=w()(e);if(t){var i=w()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return v()(this,n)}}var H=function(t){y()(r,t);var n=j(r);function r(){for(var e,t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return(e=n.call.apply(n,[this].concat(r))).keyringMap={hd:B.KeyringHd,hw:B.KeyringHardware,imported:B.KeyringImported,watching:B.KeyringWatching,external:B.KeyringWatching},e.settings=D.default,e.helperApi=b.a.create({baseURL:"https://helper.mainnet.near.org",headers:{"X-Custom-Header":"foobar","Content-Encoding":"gzip","Content-Type":"application/json"}}),e._createNearCli=Object(N.memoizee)(function(){var t=d()((function*(t,n){var r=new S.NearCli(""+t),i=yield e.engine.providerManager.getChainInfoByNetworkId(n);return r.setChainInfo(i),r}));return function(e,n){return t.apply(this,arguments)}}(),{promise:!0,primitive:!0,normalizer:function(e){return e[0]+":"+e[1]},max:1,maxAge:9e5}),e.isStorageBalanceAvailable=Object(N.memoizee)(function(){var t=d()((function*(t){var n=t.address,r=t.tokenAddress,i=yield e.fetchAccountStorageBalance({address:n,tokenAddress:r});return void 0!==(null==i?void 0:i.total)}));return function(e){return t.apply(this,arguments)}}(),{promise:!0,primitive:!0,max:1,maxAge:3e4}),e.getStorageAmountPerByte=Object(N.memoizee)(d()((function*(){var t=yield e._getNearCli(),n=(yield t.rpc.call("EXPERIMENTAL_protocol_config",{finality:t.defaultFinality})).runtime_config.storage_amount_per_byte;return new A.a(n)})),{promise:!0,primitive:!0,maxAge:18e5}),e}var i=r.prototype;return i._getNearCli=function(){var e=d()((function*(){var e=(yield this.getNetwork()).rpcURL;return yield this._createNearCli(e,this.networkId)}));return function(){return e.apply(this,arguments)}}(),i._getPublicKey=function(){var e=d()((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.encoding,n=void 0===t?"base58":t,r=e.prefix,i=void 0===r||r,o=yield this.getDbAccount(),a=o.pub.startsWith("ed25519:")?Object(R.baseDecode)(o.pub.split(":")[1]).toString("hex"):o.pub,c=this.engine.providerManager.getVerifier(this.networkId,a),u=yield c.getPubkey(!0);if("base58"===n){var s=i?"ed25519:":"";return s+Object(R.baseEncode)(u)}return"hex"===n?u.toString("hex"):""}));return function(){return e.apply(this,arguments)}}(),i.proxyJsonRPCCall=function(){var e=d()((function*(e){var t=yield this._getNearCli();try{return yield t.rpc.call(e.method,e.params)}catch(n){throw Object(C.extractResponseError)(n)}}));return function(t){return e.apply(this,arguments)}}(),i.attachFeeInfoToEncodedTx=function(e){return Promise.resolve(e.encodedTx)},i.nativeTxActionToEncodedTxAction=function(){var e=d()((function*(e){var t=this,n=(yield this.getAccountAddress(),yield this.engine.getNativeTokenInfo(this.networkId));return yield Promise.all(e.actions.map(function(){var r=d()((function*(r){var i,o={type:_.IDecodedTxActionType.UNKNOWN,direction:_.IDecodedTxDirection.SELF,unknownAction:{extraInfo:null}};if("transfer"===r.enum){o.type=_.IDecodedTxActionType.NATIVE_TRANSFER;var a=r.transfer.deposit.toString(),c=new A.a(a).shiftedBy(-1*n.decimals).toFixed();o.nativeTransfer={tokenInfo:n,from:e.signerId,to:e.receiverId,amount:c,amountValue:a,extraInfo:null}}if("functionCall"===r.enum&&"ft_transfer"===(null==r||null==(i=r.functionCall)?void 0:i.methodName)){o.type=_.IDecodedTxActionType.TOKEN_TRANSFER;var u=yield t.engine.ensureTokenInDB(t.networkId,e.receiverId);if(u){var s,d=Object(R.parseJsonFromRawResponse)(null==(s=r.functionCall)?void 0:s.args),l=d.amount,f=new A.a(l).shiftedBy(-1*u.decimals).toFixed();o.tokenTransfer={tokenInfo:u,from:d.sender_id||e.signerId,to:d.receiver_id,amount:f,amountValue:l,extraInfo:null}}}return o}));return function(e){return r.apply(this,arguments)}}()))}));return function(t){return e.apply(this,arguments)}}(),i.decodedTxToLegacy=function(e){return Promise.resolve(Object(R.decodedTxToLegacy)(e))},i.decodeTx=function(){var e=d()((function*(e,t){var n=yield this.helper.parseToNativeTx(e);return{txid:"",owner:yield this.getAccountAddress(),signer:n.signerId,nonce:parseFloat(n.nonce.toString()),actions:yield this.nativeTxActionToEncodedTxAction(n),status:_.IDecodedTxStatus.Pending,networkId:this.networkId,accountId:this.accountId,extraInfo:null}}));return function(t,n){return e.apply(this,arguments)}}(),i._buildStorageDepositAction=function(){var e=d()((function*(e){var t=e.amount,n=e.address;return R.nearApiJs.transactions.functionCall("storage_deposit",{account_id:n,registration_only:!0},new R.BN(null!=R.FT_STORAGE_DEPOSIT_GAS?R.FT_STORAGE_DEPOSIT_GAS:"0"),t)}));return function(t){return e.apply(this,arguments)}}(),i._buildNativeTokenTransferAction=function(){var e=d()((function*(e){var t=e.amount,n=yield this.getNetwork(),r=new A.a(t||0),i=new R.BN(r.shiftedBy(n.decimals).toFixed());return R.nearApiJs.transactions.transfer(i)}));return function(t){return e.apply(this,arguments)}}(),i._buildTokenTransferAction=function(){var e=d()((function*(e){var t=e.transferInfo,n=e.token,r=new A.a(t.amount||0).shiftedBy(n.decimals).toFixed();return R.nearApiJs.transactions.functionCall("ft_transfer",{amount:r,receiver_id:t.to},new R.BN(R.FT_TRANSFER_GAS),new R.BN(R.FT_TRANSFER_DEPOSIT))}));return function(t){return e.apply(this,arguments)}}(),i.buildEncodedTxFromTransfer=function(){var e=d()((function*(e){if(!e.to)throw new Error("Invalid transferInfo.to params");var t=yield this.getDbAccount();if(!t.pub&&t.id.startsWith("watching--"))throw new P.WatchedAccountTradeError;var n=[];if(e.token){var r,i=yield this.engine.ensureTokenInDB(this.networkId,null!=(r=e.token)?r:"");if(i)(yield this.isStorageBalanceAvailable({address:e.to,tokenAddress:e.token}))||n.push(yield this._buildStorageDepositAction({amount:new R.BN(null!=R.FT_MINIMUM_STORAGE_BALANCE_LARGE?R.FT_MINIMUM_STORAGE_BALANCE_LARGE:"0"),address:e.to})),n.push(yield this._buildTokenTransferAction({transferInfo:e,token:i}))}else n.push(yield this._buildNativeTokenTransferAction({amount:e.amount}));var o=yield this._getPublicKey({prefix:!1}),a=R.nearApiJs.utils.key_pair.PublicKey.from(o),c=R.nearApiJs.transactions.createTransaction(e.from,a,e.token||e.to,0,n,Object(R.baseDecode)("91737S76o1EfWfjxUQ4k3dyD3qmxDQ7hqgKUKxgxsSUW")),u=Object(R.serializeTransaction)(c);return Promise.resolve(u)}));return function(t){return e.apply(this,arguments)}}(),i.buildUnsignedTxFromEncodedTx=function(){var e=d()((function*(e){var t,n=yield this.helper.parseToNativeTx(e),r=yield this._getNearCli(),i=yield this.fetchAccountAccessKey(),o=(yield r.getBestBlock()).blockHash;return n.nonce=null!=(t=null==i?void 0:i.nonce)?t:0,n.blockHash=Object(R.baseDecode)(o),{inputs:[],outputs:[],payload:{nativeTx:n},encodedTx:e}}));return function(t){return e.apply(this,arguments)}}(),i.fetchFeeInfo=function(){var e=d()((function*(e){var t=yield this._getNearCli(),n=yield t.getTxCostConfig(),r=yield t.getFeePricePerUnit(),i=yield this.getNetwork(),o=r.normal.price.shiftedBy(-i.decimals).toFixed(),a=n.transfer_cost,c=n.action_receipt_creation_config,s="0";s=new A.a(R.FT_TRANSFER_GAS).toFixed();var d=yield this.decodeTx(e),l=u()(null==d?void 0:d.actions);if(l&&l.type===_.IDecodedTxActionType.TOKEN_TRANSFER){var f=l.tokenTransfer;if(f)(yield this.isStorageBalanceAvailable({address:f.to,tokenAddress:f.tokenInfo.tokenIdOnNetwork}))||(s=new A.a(a.execution).plus(c.execution).multipliedBy(2).toFixed())}return{nativeSymbol:i.symbol,nativeDecimals:i.decimals,feeSymbol:i.feeSymbol,feeDecimals:i.feeDecimals,limit:s,prices:[o],defaultPresetIndex:"0",tx:null}}));return function(t){return e.apply(this,arguments)}}(),i.updateEncodedTx=function(){var e=d()((function*(e,t,n){var r,i,o=Object(R.deserializeTransaction)(e);if("transfer"===n.type&&(1===(null==o||null==(r=o.actions)?void 0:r.length)&&"transfer"===(null==o||null==(i=o.actions[0])?void 0:i.enum))){var a=t,c=yield this._buildNativeTokenTransferAction(a);return o.actions=[c],Object(R.serializeTransaction)(o)}return Promise.resolve(e)}));return function(t,n,r){return e.apply(this,arguments)}}(),i.buildEncodedTxFromApprove=function(e){throw new Error("Method not implemented: buildEncodedTxFromApprove")},i.updateEncodedTxTokenApprove=function(e,t){throw new Error("Method not implemented: updateEncodedTxTokenApprove")},i.getExportedCredential=function(){var t=d()((function*(t){var n=yield this.getDbAccount();if(n.id.startsWith("hd-")||n.id.startsWith("imported")){var r=this.keyring,i=Object.values(yield r.getPrivateKeys(t)),o=a()(i,1)[0],c=Object(I.decrypt)(t,o),u=E.ed25519.publicFromPrivate(c);return"ed25519:"+Object(R.baseEncode)(e.concat([c,u]))}throw new P.OneKeyInternalError("Only credential of HD or imported accounts can be exported")}));return function(e){return t.apply(this,arguments)}}(),i.fetchAccountStorageBalance=function(){var e=d()((function*(e){var t=e.address,n=e.tokenAddress,r=yield this._getNearCli();return yield r.callContract(n,"storage_balance_of",{account_id:t})}));return function(t){return e.apply(this,arguments)}}(),i.fetchDomainAccountsFromPublicKey=function(){var e=d()((function*(e){var t=e.publicKey;return(yield this.helperApi.get("/publicKey/"+t+"/accounts")).data}));return function(t){return e.apply(this,arguments)}}(),i.fetchDomainAccounts=function(){var e=d()((function*(){try{var e=yield this._getPublicKey({encoding:"base58",prefix:!0}),t=yield this.fetchDomainAccountsFromPublicKey({publicKey:e});if(t.length)return t.map((function(e){return{address:e,isDomainAccount:!0}}))}catch(n){}return[]}));return function(){return e.apply(this,arguments)}}(),i.fetchAccountAccessKey=function(){var e=d()((function*(){var e=yield this._getNearCli(),t=yield this.getDbAccount(),n=(yield e.getAccessKeys(t.address))||[],r=yield this._getPublicKey();return n.find((function(e){return e.pubkey===r}))}));return function(){return e.apply(this,arguments)}}(),i.validateImportedCredential=function(t){var n=!1;if(this.settings.importedAccountEnabled){var r=t.split(":"),i=a()(r,2),o=i[0],c=i[1];try{n="ed25519"===o&&64===e.from(Object(R.baseDecode)(c)).length}catch(u){}}return Promise.resolve(n)},i.fetchTokenInfos=function(){var e=d()((function*(e){var t=yield this._getNearCli();return yield Promise.all(e.map(function(){var e=d()((function*(e){return t.callContract(e,"ft_metadata",{})}));return function(t){return e.apply(this,arguments)}}()))}));return function(t){return e.apply(this,arguments)}}(),i.getBalances=function(){var e=d()((function*(e){var t=yield this._getNearCli();return t.batchCall2SingleCall(e,function(){var e=d()((function*(e){var n=e.address,r=e.tokenAddress;if("undefined"!==typeof r){var i=yield t.callContract(r,"ft_balance_of",{account_id:n});return new A.a(i)}var o=yield t.rpc.call("query",{request_type:"view_account",account_id:n,finality:t.defaultFinality}),a=o.amount;o.storage_usage;return new A.a(a)}));return function(t){return e.apply(this,arguments)}}())}));return function(t){return e.apply(this,arguments)}}(),i.getFrozenBalance=function(){var e=d()((function*(){var e=yield this._getNearCli(),t=yield this.getAccountAddress(),n=(yield this.engine.getNativeTokenInfo(this.networkId)).decimals;try{var r=(yield e.rpc.call("query",{request_type:"view_account",account_id:t,finality:e.defaultFinality})).storage_usage;return{main:new A.a(yield this.getStorageAmountPerByte()).times(r).shiftedBy(-n).toNumber()}}catch(i){return 0}}));return function(){return e.apply(this,arguments)}}(),i.getClientEndpointStatus=function(){var e=d()((function*(e){var t=yield this._createNearCli(e,this.networkId),n=performance.now(),r=(yield t.getBestBlock()).blockNumber;return{responseTime:Math.floor(performance.now()-n),latestBlock:r}}));return function(t){return e.apply(this,arguments)}}(),i.getPrivateKeyByCredential=function(){var t=d()((function*(t){var n,r=t.split(":"),i=a()(r,2),o=i[0],c=i[1],u=e.from(Object(R.baseDecode)(c));return"ed25519"===o&&64===u.length&&(n=u.slice(0,32)),Promise.resolve(n)}));return function(e){return t.apply(this,arguments)}}(),i.getTransactionStatuses=function(){var e=d()((function*(e){var t=yield this._getNearCli();return yield Promise.all(e.map((function(e){return t.getTransactionStatus(e).then((function(e){return e})).catch((function(){return O.TransactionStatus.PENDING}))})))}));return function(t){return e.apply(this,arguments)}}(),i.validateWatchingCredential=function(e){return Promise.resolve(this.settings.watchingAccountEnabled&&Object(R.verifyNearAddress)(e).isValid)},i.validateAddress=function(){var e=d()((function*(e){var t=Object(R.verifyNearAddress)(e);return t.isValid?Promise.resolve(t.normalizedAddress||e):Promise.reject(new P.InvalidAddress)}));return function(t){return e.apply(this,arguments)}}(),i.validateTokenAddress=function(){var e=d()((function*(e){return this.validateAddress(e)}));return function(t){return e.apply(this,arguments)}}(),i.broadcastTransaction=function(){var e=d()((function*(e,t){x.default.engine.info("broadcastTransaction START:",{rawTx:e.rawTx});var n=yield this._getNearCli(),r=yield n.broadcastTransaction(e.rawTx);return x.default.engine.info("broadcastTransaction END:",{txid:r,rawTx:e.rawTx}),K(K({},e),{},{txid:r,encodedTx:e.encodedTx})}));return function(t,n){return e.apply(this,arguments)}}(),f()(r)}(k.VaultBase)}.call(this,n(26).Buffer)}}]);