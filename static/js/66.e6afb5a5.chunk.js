(this.webpackJsonp=this.webpackJsonp||[]).push([[66,845],{3903:function(e,t,n){"use strict";n.r(t),n.d(t,"KeyringBase",(function(){return h})),n.d(t,"KeyringBaseMock",(function(){return y}));var r=n(2),o=n.n(r),i=n(6),a=n.n(i),c=n(9),u=n.n(c),s=n(14),d=n.n(s),l=n(7),f=n.n(l);function p(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f()(e);if(t){var o=f()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return d()(this,n)}}var h=function(e){u()(n,e);var t=p(n);function n(e){var n;return(n=t.call(this,e.options)).vault=e,n}return n.prototype.addressFromBase=function(){var e=o()((function*(e){return this.vault.addressFromBase(e)}));return function(t){return e.apply(this,arguments)}}(),a()(n)}(n(1585).VaultContext),y=function(e){u()(n,e);var t=p(n);function n(){return t.apply(this,arguments)}return a()(n)}(h)},3905:function(e,t,n){"use strict";n.r(t),n.d(t,"KeyringSoftwareBase",(function(){return I}));var r=n(4),o=n.n(r),i=n(3),a=n.n(i),c=n(2),u=n.n(c),s=n(6),d=n.n(s),l=n(9),f=n.n(l),p=n(14),h=n.n(p),y=n(7),v=n.n(y),w=n(19),g=n(23);function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function T(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach((function(t){a()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function x(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=v()(e);if(t){var o=v()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return h()(this,n)}}var I=function(e){f()(n,e);var t=x(n);function n(){return t.apply(this,arguments)}var r=n.prototype;return r.signTransaction=function(){var e=u()((function*(e,t){var n=t.password;if("undefined"===typeof n)throw new g.OneKeyInternalError("Software signing requires a password.");var r=yield this.getSigners(n,e.inputs.map((function(e){return e.address})));return w.default.engine.info("signTransaction",this.networkId,e),T(T({},yield this.engine.providerManager.signTransaction(this.networkId,e,r)),{},{encodedTx:e.encodedTx})}));return function(t,n){return e.apply(this,arguments)}}(),r.signMessage=function(){var e=u()((function*(e,t){var n=this,r=t.password;if("undefined"===typeof r)throw new g.OneKeyInternalError("Software signing requires a password.");var i=yield this.getDbAccount(),a=Object.values(yield this.getSigners(r,[i.address])),c=o()(a,1)[0];return w.default.engine.info("signMessage",this.networkId,e),Promise.all(e.map((function(e){return n.engine.providerManager.signMessage(n.networkId,e,c)})))}));return function(t,n){return e.apply(this,arguments)}}(),r.getAddress=function(){throw new Error("Method not implemented.")},r.batchGetAddress=function(){throw new Error("Method not implemented.")},r.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},d()(n)}(n(3903).KeyringBase)},3912:function(e,t,n){"use strict";n.r(t),function(e){n.d(t,"VaultBaseChainOnly",(function(){return j})),n.d(t,"VaultBase",(function(){return H}));var r=n(202),o=n.n(r),i=n(3),a=n.n(i),c=n(60),u=n.n(c),s=n(2),d=n.n(s),l=n(6),f=n.n(l),p=n(9),h=n.n(p),y=n(14),v=n.n(y),w=n(7),g=n.n(w),m=n(21),T=n.n(m),x=n(167),I=n.n(x),O=n(11),b=n(19),E=n(24),A=n(68),P=n(23),C=n(182),D=n(947),S=n(52),B=n(1585);function N(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function k(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?N(Object(n),!0).forEach((function(t){a()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):N(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function R(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=g()(e);if(t){var o=g()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return v()(this,n)}}if(E.default.isExtensionUi)throw new Error("engine/VaultBase is not allowed imported from ui");var j=function(e){h()(n,e);var t=R(n);function n(){return t.apply(this,arguments)}var r=n.prototype;return r.initProvider=function(){var e=d()((function*(){var e=(yield this.getNetwork()).impl;u()(D.IMPL_MAPPINGS[e])||(this.engineProvider=yield this.engine.providerManager.getProvider(this.networkId))}));return function(){return e.apply(this,arguments)}}(),r.proxyJsonRPCCall=function(){var e=d()((function*(e){throw new P.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),r.createClientFromURL=function(e){throw new P.NotImplemented},r.getEthersProvider=function(){var e=d()((function*(){throw new P.NotImplemented}));return function(){return e.apply(this,arguments)}}(),r.getClientEndpointStatus=function(){var e=d()((function*(e){var t=this.createClientFromURL(e),n=performance.now(),r=(yield t.getInfo()).bestBlockNumber;return{responseTime:Math.floor(performance.now()-n),latestBlock:r}}));return function(t){return e.apply(this,arguments)}}(),r.checkRpcBatchSupport=function(){var e=d()((function*(e){throw new P.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),r.getDisplayAddress=function(){var e=d()((function*(e){return Promise.resolve(e)}));return function(t){return e.apply(this,arguments)}}(),r.validateAddress=function(){var e=d()((function*(e){var t=yield this.engineProvider.verifyAddress(e),n=t.normalizedAddress;if(!t.isValid||!n)throw new P.InvalidAddress;return Promise.resolve(n)}));return function(t){return e.apply(this,arguments)}}(),r.validateImportedCredential=function(e){return Promise.resolve(this.settings.importedAccountEnabled&&/^(0x)?[0-9a-zA-Z]{64}$/.test(e))},r.validateWatchingCredential=function(){var e=d()((function*(e){return Promise.resolve(this.settings.watchingAccountEnabled&&(yield this.engineProvider.verifyAddress(e)).isValid)}));return function(t){return e.apply(this,arguments)}}(),r.validateTokenAddress=function(){var e=d()((function*(e){var t=yield this.engineProvider.verifyTokenAddress(e),n=t.normalizedAddress;if(!t.isValid||"undefined"===typeof n)throw new P.InvalidTokenAddress;return Promise.resolve(n)}));return function(t){return e.apply(this,arguments)}}(),r.validateCanCreateNextAccount=function(){var e=d()((function*(e,t){return Promise.resolve(!0)}));return function(t,n){return e.apply(this,arguments)}}(),r.checkAccountExistence=function(){var e=d()((function*(e,t){return Promise.resolve(!0)}));return function(t,n){return e.apply(this,arguments)}}(),r.getBalances=function(){var e=d()((function*(e,t,n){return(yield this.engine.providerManager.getClient(this.networkId)).getBalances(e.map((function(e){var t=e.address,n=e.tokenAddress;return{address:t,coin:k({},"string"===typeof n?{tokenAddress:n}:{})}})))}));return function(t,n,r){return e.apply(this,arguments)}}(),r.getFrozenBalance=function(){var e=d()((function*(e){return 0}));return function(t){return e.apply(this,arguments)}}(),r.fetchBalanceDetails=function(){var e=d()((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.password;return Promise.resolve(void 0)}));return function(){return e.apply(this,arguments)}}(),r.getTransactionStatuses=function(e){return this.engine.providerManager.getTransactionStatuses(this.networkId,e)},r.getTransactionFeeInNative=function(e){return Promise.resolve("")},r.isContractAddress=function(){var e=d()((function*(e){return!1}));return function(t){return e.apply(this,arguments)}}(),r.getAccountNameInfoMap=function(){var e=d()((function*(){var e=yield this.getNetwork();return Object(C.getAccountNameInfoByImpl)(e.impl)}));return function(){return e.apply(this,arguments)}}(),r.canAutoCreateNextAccount=function(){var e=d()((function*(e){return Promise.resolve(!1)}));return function(t){return e.apply(this,arguments)}}(),r.filterAccounts=function(){var e=d()((function*(e){var t=e.accounts;e.networkId;return Promise.resolve(t)}));return function(t){return e.apply(this,arguments)}}(),r.shouldChangeAccountWhenNetworkChanged=function(){var e=d()((function*(e){e.previousNetwork,e.newNetwork,e.activeAccountId;return Promise.resolve({shouldReloadAccountList:!1,shouldChangeActiveAccount:!1})}));return function(t){return e.apply(this,arguments)}}(),r.getAccountNameInfosByImportedOrWatchingCredential=function(){var e=d()((function*(e){return Promise.resolve([])}));return function(t){return e.apply(this,arguments)}}(),r.checkIsUnlimitedAllowance=function(){var e=d()((function*(e){throw new P.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),r.checkIsApprovedForAll=function(){var e=d()((function*(e){throw new P.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),r.checkIsBatchTransfer=function(){var e=d()((function*(e){throw new P.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),r.getFeePricePerUnit=function(){var e=d()((function*(){throw new P.NotImplemented}));return function(){return e.apply(this,arguments)}}(),r.fetchRpcChainId=function(){var e=d()((function*(e){return null}));return function(t){return e.apply(this,arguments)}}(),r.getTxWaitingSeconds=function(){var e=d()((function*(){return[]}));return function(){return e.apply(this,arguments)}}(),r.getUserNFTAssets=function(){var e=d()((function*(e){e.serviceData;return Promise.resolve(void 0)}));return function(t){return e.apply(this,arguments)}}(),f()(n)}(B.VaultContext),H=function(t){h()(r,t);var n=R(r);function r(){for(var e,t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];return(e=n.call.apply(n,[this].concat(r))).uuid=I.a.v4().toString(),e}var i=r.prototype;return i.init=function(){var e=d()((function*(e){yield this.initProvider(),yield this.initKeyring(e)}));return function(t){return e.apply(this,arguments)}}(),i.initKeyring=function(){var e=d()((function*(e){this.keyring=yield e.keyringCreator(this)}));return function(t){return e.apply(this,arguments)}}(),i.signTransaction=function(){var e=d()((function*(e,t){return this.keyring.signTransaction(e,t)}));return function(t,n){return e.apply(this,arguments)}}(),i.signAndSendTransaction=function(){var e=d()((function*(e,t,n){var r=yield this.signTransaction(e,t);return n?k(k({},r),{},{encodedTx:e.encodedTx}):this.broadcastTransaction(k(k({},r),{},{encodedTx:e.encodedTx}))}));return function(t,n,r){return e.apply(this,arguments)}}(),i.broadcastTransaction=function(){var e=d()((function*(e,t){b.default.engine.info("broadcastTransaction START:",{rawTx:e.rawTx});var n=yield this.engine.providerManager.broadcastTransaction(this.networkId,e.rawTx,t);return b.default.engine.info("broadcastTransaction END:",{txid:n,rawTx:e.rawTx}),k(k({},e),{},{txid:n,encodedTx:e.encodedTx})}));return function(t,n){return e.apply(this,arguments)}}(),i.buildEncodedTxFromBatchTransfer=function(){var e=d()((function*(e){throw new P.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),i.buildEncodedTxsFromSetApproveForAll=function(){var e=d()((function*(e,t){throw new P.NotImplemented}));return function(t,n){return e.apply(this,arguments)}}(),i.activateAccount=function(){var e=d()((function*(){throw new P.NotImplemented}));return function(){return e.apply(this,arguments)}}(),i.activateToken=function(){var e=d()((function*(e,t){throw new P.NotImplemented}));return function(t,n){return e.apply(this,arguments)}}(),i.getTokenAllowance=function(){var e=d()((function*(e,t){throw new P.NotImplemented}));return function(t,n){return e.apply(this,arguments)}}(),i.batchTokensAllowance=function(){var e=d()((function*(e,t){throw new P.NotImplemented}));return function(t,n){return e.apply(this,arguments)}}(),i.getOutputAccount=function(){var e=d()((function*(){var e=yield this.getDbAccount({noCache:!0});return{id:e.id,name:e.name,type:e.type,path:e.path,coinType:e.coinType,tokens:[],address:e.address,template:e.template,pubKey:o()(e,"pub","")}}));return function(){return e.apply(this,arguments)}}(),i.getAccountBalance=function(){var e=d()((function*(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,o=yield this.getDbAccount(),i=o.address;return this.getBalances((t?[{address:i}]:[]).concat(e.map((function(e){return{address:i,tokenAddress:e}}))),n,r)}));return function(t){return e.apply(this,arguments)}}(),i.updatePendingTxs=function(){var e=d()((function*(e){throw new P.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),i.getAccountNonce=function(){var e=d()((function*(){return Promise.resolve(null)}));return function(){return e.apply(this,arguments)}}(),i.fixActionDirection=function(){var e=d()((function*(e){var t,n,r,o,i=e.action,a=e.accountAddress;(i.direction=S.IDecodedTxDirection.OTHER,i.type===S.IDecodedTxActionType.NATIVE_TRANSFER)&&(i.direction=yield this.buildTxActionDirection({from:(null==(t=i.nativeTransfer)?void 0:t.from)||"",to:(null==(n=i.nativeTransfer)?void 0:n.to)||"",address:a}));i.type===S.IDecodedTxActionType.TOKEN_TRANSFER&&(i.direction=yield this.buildTxActionDirection({from:(null==(r=i.tokenTransfer)?void 0:r.from)||"",to:(null==(o=i.tokenTransfer)?void 0:o.to)||"",address:a}));return i}));return function(t){return e.apply(this,arguments)}}(),i.fixDecodedTx=function(){var e=d()((function*(e){var t,n;e.createdAt=null!=(t=e.createdAt)?t:Date.now();var r=null==(n=e.encodedTx)?void 0:n.nonce;e.nonce=u()(r)?e.nonce:new T.a(r).toNumber();for(var o=e.owner,i=0;i<e.actions.length;i+=1){var a=e.actions[i];yield this.fixActionDirection({action:a,accountAddress:o})}if(e.outputActions)for(var c=0;c<e.outputActions.length;c+=1){var s=e.outputActions[c];yield this.fixActionDirection({action:s,accountAddress:o})}return Promise.resolve(e)}));return function(t){return e.apply(this,arguments)}}(),i.fixHistoryTx=function(){var e=d()((function*(e){return e.decodedTx=yield this.fixDecodedTx(e.decodedTx),Promise.resolve(e)}));return function(t){return e.apply(this,arguments)}}(),i.buildHistoryTx=function(){var e=d()((function*(e){var t=e.historyTxToMerge,n=(e.encodedTx,e.decodedTx),r=e.signedTx,o=e.isSigner,i=e.isLocalCreated,a=(null==r?void 0:r.txid)||(null==n?void 0:n.txid)||"";if(!a)throw new Error("buildHistoryTx txid not found");var c=yield this.getAccountAddress();n.txid=a||n.txid,n.owner=c,o&&(n.signer=c),null!=r&&r.txKey&&(n.extraInfo?n.extraInfo.txKey=r.txKey:n.extraInfo={txKey:r.txKey});var u=k(k({id:this.networkId+"_"+a+"_"+this.accountId,isLocalCreated:Boolean(i)},t),{},{decodedTx:n});return u=yield this.fixHistoryTx(u),Promise.resolve(u)}));return function(t){return e.apply(this,arguments)}}(),i.checkIsScamHistoryTx=function(){var e=d()((function*(e){return!1}));return function(t){return e.apply(this,arguments)}}(),i.fetchOnChainHistory=function(){var e=d()((function*(e){throw new P.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),i.fixAddressCase=function(e){return Promise.resolve(e)},i.buildTxActionDirection=function(){var e=d()((function*(e){var t=e.from,n=e.to,r=e.address;return t=yield this.fixAddressCase(t||""),n=yield this.fixAddressCase(n),r=yield this.fixAddressCase(r),t===n&&t===r?S.IDecodedTxDirection.SELF:t&&t===r?S.IDecodedTxDirection.OUT:n&&n===r?S.IDecodedTxDirection.IN:S.IDecodedTxDirection.OTHER}));return function(t){return e.apply(this,arguments)}}(),i.getNextNonce=function(){var e=d()((function*(e,t){var n,r,o=null!=(n=null==(r=(yield this.engine.providerManager.getAddresses(e,[t.address]))[0])?void 0:r.nonce)?n:0,i=(yield this.engine.getHistory(e,t.id,void 0,!1),yield A.default.history.getMaxPendingNonce({accountId:this.accountId,networkId:e})),a=yield A.default.history.getPendingNonceList({accountId:this.accountId,networkId:e}),c=Math.max(u()(i)?0:i+1,o);if(Number.isNaN(c)&&(c=o),c>o)for(var s=o;s<c;s+=1)if(!a.includes(s)){c=s;break}if(c<o&&(c=o),c-o>=O.HISTORY_CONSTS.PENDING_QUEUE_MAX_LENGTH)throw new P.PendingQueueTooLong(O.HISTORY_CONSTS.PENDING_QUEUE_MAX_LENGTH);return c}));return function(t,n){return e.apply(this,arguments)}}(),i.validateSendAmount=function(e,t,n){return Promise.resolve(!0)},i.notifyChainChanged=function(e,t){},i.getFetchBalanceAddress=function(e){return Promise.resolve(e.address)},i.getPrivateKeyByCredential=function(t){return Promise.resolve(e.from(t.startsWith("0x")?t.slice(2):t,"hex"))},i.getMinDepositAmount=function(){var e=d()((function*(){return"0"}));return function(){return e.apply(this,arguments)}}(),i.specialCheckEncodedTx=function(){var e=d()((function*(e){return{success:!0}}));return function(t){return e.apply(this,arguments)}}(),i.getAllUsedAddress=function(){var e=d()((function*(){return Promise.resolve([])}));return function(){return e.apply(this,arguments)}}(),f()(r)}(j)}.call(this,n(26).Buffer)},3913:function(e,t,n){"use strict";n.r(t),function(e){n.d(t,"KeyringHardwareBase",(function(){return v}));var r=n(2),o=n.n(r),i=n(6),a=n.n(i),c=n(9),u=n.n(c),s=n(14),d=n.n(s),l=n(7),f=n.n(l),p=n(431),h=n(163);function y(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f()(e);if(t){var o=f()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return d()(this,n)}}var v=function(t){u()(r,t);var n=y(r);function r(){return n.apply(this,arguments)}var i=r.prototype;return i.getHardwareInfo=function(){var e=o()((function*(){var e,t,n,r=yield this.engine.getHWDeviceByWalletId(this.vault.walletId);return{connectId:null!=(e=null==r?void 0:r.mac)?e:"",deviceId:null!=(t=null==r?void 0:r.deviceId)?t:"",deviceType:null!=(n=null==r?void 0:r.deviceType)?n:""}}));return function(){return e.apply(this,arguments)}}(),i.getWalletPassphraseState=function(){var e=o()((function*(){var e=yield this.engine.getWallet(this.vault.walletId);return{passphraseState:null==e?void 0:e.passphraseState,useEmptyPassphrase:!Object(h.isPassphraseWallet)(e)}}));return function(){return e.apply(this,arguments)}}(),i.getHardwareSDKInstance=function(){var t=o()((function*(){var t,n,r,o,i;return null!=(i=yield null==(t=e)||null==(n=t.$backgroundApiProxy)||null==(r=n.backgroundApi)||null==(o=r.serviceHardware)||null==o.getSDKInstance?void 0:o.getSDKInstance())?i:p.HardwareSDK}));return function(){return t.apply(this,arguments)}}(),i.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},a()(r)}(n(3903).KeyringBase)}.call(this,n(58))},3914:function(e,t,n){"use strict";n.r(t),n.d(t,"KeyringHdBase",(function(){return T}));var r=n(3),o=n.n(r),i=n(2),a=n.n(i),c=n(6),u=n.n(c),s=n(9),d=n.n(s),l=n(14),f=n.n(l),p=n(7),h=n.n(p),y=n(610),v=n(23);function w(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?w(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function m(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=h()(e);if(t){var o=h()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return f()(this,n)}}var T=function(e){d()(n,e);var t=m(n);function n(){return t.apply(this,arguments)}var r=n.prototype;return r.getPrivateKeys=function(){var e=a()((function*(e,t){var n=(yield this.getDbAccount()).path.split("/"),r=t||[n.pop()],o=n.join("/"),i=(yield this.engine.dbApi.getCredential(this.walletId,e)).seed;if("undefined"===typeof i)throw new v.OneKeyInternalError("Unable to get credential.");var a=(yield this.engine.providerManager.getChainInfoByNetworkId(this.networkId)).curve;return Object(y.batchGetPrivateKeys)(a,i,e,o,r).reduce((function(e,t){var n;return g(g({},e),{},((n={})[t.path]=t.extendedKey.key,n))}),{})}));return function(t,n){return e.apply(this,arguments)}}(),r.getAddress=function(){throw new Error("Method not implemented.")},r.batchGetAddress=function(){throw new Error("Method not implemented.")},r.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},u()(n)}(n(3905).KeyringSoftwareBase)},3915:function(e,t,n){"use strict";n.r(t),n.d(t,"KeyringImportedBase",(function(){return y}));var r=n(2),o=n.n(r),i=n(6),a=n.n(i),c=n(9),u=n.n(c),s=n(14),d=n.n(s),l=n(7),f=n.n(l),p=n(23);function h(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f()(e);if(t){var o=f()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return d()(this,n)}}var y=function(e){u()(n,e);var t=h(n);function n(){return t.apply(this,arguments)}var r=n.prototype;return r.getPrivateKeys=function(){var e=o()((function*(e,t){if("undefined"!==typeof t)throw new p.NotImplemented("Getting private keys from extended private key");var n=(yield this.engine.dbApi.getCredential(this.accountId,e)).privateKey;if("undefined"===typeof n)throw new p.OneKeyInternalError("Unable to get credential.");return{"":n}}));return function(t,n){return e.apply(this,arguments)}}(),r.getAddress=function(){throw new Error("Method not implemented.")},r.batchGetAddress=function(){throw new Error("Method not implemented.")},r.prepareAccountByAddressIndex=function(){throw new Error("Method not implemented.")},a()(n)}(n(3905).KeyringSoftwareBase)},3916:function(e,t,n){"use strict";n.r(t),n.d(t,"KeyringWatchingBase",(function(){return y}));var r=n(2),o=n.n(r),i=n(6),a=n.n(i),c=n(9),u=n.n(c),s=n(14),d=n.n(s),l=n(7),f=n.n(l),p=n(23);function h(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f()(e);if(t){var o=f()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return d()(this,n)}}var y=function(e){u()(n,e);var t=h(n);function n(){return t.apply(this,arguments)}var r=n.prototype;return r.signTransaction=function(){var e=o()((function*(e,t){throw new p.OneKeyInternalError("signTransaction is not supported for watching accounts")}));return function(t,n){return e.apply(this,arguments)}}(),r.signMessage=function(){var e=o()((function*(e,t){throw new p.OneKeyInternalError("signMessage is not supported for watching accounts")}));return function(t,n){return e.apply(this,arguments)}}(),r.getAddress=function(){throw new Error("Method not implemented.")},r.batchGetAddress=function(){throw new Error("Method not implemented.")},r.prepareAccountByAddressIndex=function(){throw new Error("Method not implemented.")},a()(n)}(n(3903).KeyringBase)},3918:function(e,t,n){"use strict";n.r(t),n.d(t,"convertDeviceError",(function(){return c}));var r=n(70),o=n(90),i=n(19);n(24);function a(e,t){return"string"!==typeof t?null:e===r.HardwareErrorCode.DeviceInitializeFailed&&t.includes("ECONNABORTED")?new o.ConnectTimeoutError({message:t}):t.includes("Bridge network error")?new o.BridgeNetworkError({message:t}):null}function c(e){var t,n=e||{},c=n.code,u=n.error,s=n.message,d=null!=(t=null!=u?u:s)?t:"Unknown error";if(a(c,d))return a(c,d);switch(i.default.hardwareSDK.info("Device Utils Convert Device Error:",c,d),c){case r.HardwareErrorCode.UnknownError:return new o.UnknownHardwareError(e);case r.HardwareErrorCode.DeviceFwException:return new o.FirmwareVersionTooLow(e);case r.HardwareErrorCode.DeviceUnexpectedMode:return"string"===typeof d&&-1!==d.indexOf("ui-device_bootloader_mode")?new o.NotInBootLoaderMode(e):new o.UnknownHardwareError(e);case r.HardwareErrorCode.DeviceCheckDeviceIdError:return new o.DeviceNotSame(e);case r.HardwareErrorCode.DeviceNotFound:return new o.DeviceNotFind(e);case r.HardwareErrorCode.DeviceUnexpectedBootloaderMode:return new o.NotInBootLoaderMode(e);case r.HardwareErrorCode.DeviceInterruptedFromOutside:case r.HardwareErrorCode.DeviceInterruptedFromUser:return new o.UserCancelFromOutside(e);case r.HardwareErrorCode.DeviceNotSupportPassphrase:return new o.NotSupportPassphraseError(e);case r.HardwareErrorCode.IFrameLoadFail:return new o.InitIframeLoadFail(e);case r.HardwareErrorCode.IframeTimeout:return new o.InitIframeTimeout(e);case r.HardwareErrorCode.FirmwareUpdateDownloadFailed:return new o.FirmwareDownloadFailed(e);case r.HardwareErrorCode.FirmwareUpdateManuallyEnterBoot:return new o.FirmwareUpdateManuallyEnterBoot(e);case r.HardwareErrorCode.FirmwareUpdateAutoEnterBootFailure:return new o.FirmwareUpdateAutoEnterBootFailure(e);case r.HardwareErrorCode.FirmwareUpdateLimitOneDevice:return new o.FirmwareUpdateLimitOneDevice(e);case r.HardwareErrorCode.CallMethodNeedUpgradeFirmware:return new o.FirmwareVersionTooLow(e);case r.HardwareErrorCode.NewFirmwareUnRelease:return new o.NewFirmwareUnRelease(e);case r.HardwareErrorCode.NewFirmwareForceUpdate:return new o.NewFirmwareForceUpdate(e);case r.HardwareErrorCode.NetworkError:return new o.NetworkError(e);case r.HardwareErrorCode.BlePermissionError:return new o.NeedBluetoothTurnedOn(e);case r.HardwareErrorCode.BleLocationError:return new o.NeedBluetoothPermissions({message:d});case r.HardwareErrorCode.BleLocationServicesDisabled:return new o.BleLocationServiceError({message:d});case r.HardwareErrorCode.BleDeviceNotBonded:return new o.DeviceNotBonded(e);case r.HardwareErrorCode.BleDeviceBondError:return new o.DeviceBondError(e);case r.HardwareErrorCode.BleWriteCharacteristicError:return new o.BleWriteCharacteristicError(e);case r.HardwareErrorCode.BleScanError:return new o.BleScanError({message:d});case r.HardwareErrorCode.BleAlreadyConnected:return new o.BleAlreadyConnectedError(e);case r.HardwareErrorCode.RuntimeError:return-1!==d.indexOf("EIP712 blind sign is disabled")?new o.OpenBlindSign(e):-1!==d.indexOf("Unknown message")||-1!==d.indexOf("Failure_UnexpectedMessage")?new o.UnknownMethod(e):new o.UnknownHardwareError(e);case r.HardwareErrorCode.PinInvalid:return new o.InvalidPIN(e);case r.HardwareErrorCode.DeviceCheckPassphraseStateError:return new o.InvalidPassphrase(e);case r.HardwareErrorCode.DeviceOpenedPassphrase:return new o.DeviceOpenedPassphrase(e);case r.HardwareErrorCode.DeviceNotOpenedPassphrase:return new o.DeviceNotOpenedPassphrase(e);case r.HardwareErrorCode.PinCancelled:case r.HardwareErrorCode.ActionCancelled:return new o.UserCancel(e);case r.HardwareErrorCode.BridgeNotInstalled:case o.CustomOneKeyHardwareError.NeedOneKeyBridge:return new o.NeedOneKeyBridge(e);case r.HardwareErrorCode.BridgeNetworkError:return new o.BridgeNetworkError(e);case r.HardwareErrorCode.BridgeTimeoutError:return new o.BridgeTimeoutError(e);case r.HardwareErrorCode.PollingTimeout:return new o.ConnectTimeoutError(e);case r.HardwareErrorCode.PollingStop:return new o.ConnectPollingStopError(e);case r.HardwareErrorCode.BlindSignDisabled:return new o.OpenBlindSign(e);case r.HardwareErrorCode.FileAlreadyExists:return new o.FileAlreadyExistError(e);case r.HardwareErrorCode.CheckDownloadFileError:return new o.IncompleteFileError(e);case r.HardwareErrorCode.NotInSigningMode:return new o.NotInSigningModeError(e);default:return new o.UnknownHardwareError(e)}}},4335:function(e,t){},6111:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return oe}));var r=n(3),o=n.n(r),i=n(4),a=n.n(i),c=n(2),u=n.n(c),s=n(6),d=n.n(s),l=n(9),f=n.n(l),p=n(14),h=n.n(p),y=n(7),v=n.n(y),w=n(21),g=n.n(w),m=n(4061),T=n(112),x=n(46),I=n(19),O=n(150),b=n(23),E=n(52),A=n(3912),P=n(3918),C=n(11),D=n(117),S=n(3913);function B(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function N(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?B(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):B(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function k(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=v()(e);if(t){var o=v()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return h()(this,n)}}var R="m/44'/"+C.COINTYPE_XRP+"'",j=function(e){f()(n,e);var t=k(n);function n(){return t.apply(this,arguments)}var r=n.prototype;return r.prepareAccounts=function(){var e=u()((function*(e){var t,n=e.indexes,r=e.names,o=n.map((function(e){return R+"/"+e+"'/0/0"})),i=yield this.getHardwareSDKInstance(),a=yield this.getHardwareInfo(),c=a.connectId,u=a.deviceId,s=yield this.getWalletPassphraseState();try{t=yield i.xrpGetAddress(c,u,N({bundle:o.map((function(e){return{path:e,showOnOneKey:!1}}))},s))}catch(w){throw I.default.common.error(w),new b.OneKeyHardwareError(w)}if(!t.success)throw I.default.common.error(t.payload),Object(P.convertDeviceError)(t.payload);var d=[],l=0;for(var f of t.payload){var p=f.address,h=f.path,y=f.publicKey;if(p){var v=(r||[])[l]||"RIPPLE #"+(n[l]+1);d.push({id:this.walletId+"--"+h,name:v,type:D.AccountType.SIMPLE,path:h,coinType:C.COINTYPE_XRP,pub:null!=y?y:"",address:p}),l+=1}}return d}));return function(t){return e.apply(this,arguments)}}(),r.getAddress=function(){var e=u()((function*(e){var t,n=yield this.getHardwareSDKInstance(),r=yield this.getHardwareInfo(),o=r.connectId,i=r.deviceId,a=yield this.getWalletPassphraseState(),c=yield n.xrpGetAddress(o,i,N({path:e.path,showOnOneKey:e.showOnOneKey},a));if(c.success&&null!=(t=c.payload)&&t.address)return c.payload.address;throw Object(P.convertDeviceError)(c.payload)}));return function(t){return e.apply(this,arguments)}}(),r.batchGetAddress=function(){var e=u()((function*(e){var t=yield this.getHardwareSDKInstance(),n=yield this.getHardwareInfo(),r=n.connectId,o=n.deviceId,i=yield this.getWalletPassphraseState(),a=yield t.xrpGetAddress(r,o,N(N({},i),{},{bundle:e.map((function(e){return{path:e.path,showOnOneKey:!!e.showOnOneKey}}))}));if(!a.success)throw Object(P.convertDeviceError)(a.payload);return a.payload.map((function(e){var t,n;return{path:null!=(t=e.path)?t:"",address:null!=(n=e.address)?n:""}}))}));return function(t){return e.apply(this,arguments)}}(),r.signTransaction=function(){var e=u()((function*(e){var t;I.default.common.info("signTransaction",e);var n=e.payload.encodedTx,r={path:(yield this.getDbAccount()).path,transaction:{fee:n.Fee,flags:n.Flags,sequence:n.Sequence,maxLedgerVersion:n.LastLedgerSequence,payment:{amount:+n.Amount,destination:n.Destination,destinationTag:null!=(t=n.DestinationTag)?t:void 0}}},o=yield this.getHardwareInfo(),i=o.connectId,a=o.deviceId,c=yield this.getWalletPassphraseState(),u=yield this.getHardwareSDKInstance(),s=yield u.xrpSignTransaction(i,a,N(N({},c),r));if(s.success){var d=s.payload.serializedTx;return{txid:m.hashes.hashSignedTx(d),rawTx:d}}throw Object(P.convertDeviceError)(s.payload)}));return function(t){return e.apply(this,arguments)}}(),r.signMessage=function(){throw new b.NotImplemented},d()(n)}(S.KeyringHardwareBase),H=n(610),F=n(1345),K=n(3914),U=n(3987),M=n(367);function _(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function L(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function W(e,t,n){var r=L({},e);if(r.TxnSignature||r.Signers)throw new Error('txJSON must not contain "TxnSignature" or "Signers" properties');!function(e){"Payment"===e.TransactionType&&"string"!==typeof e.Amount&&e.Amount.value.includes(".")&&e.Amount.value.endsWith("0")&&(e.Amount=L({},e.Amount),e.Amount.value=new g.a(e.Amount.value).toString())}(r);var o=L({},r);o.SigningPubKey=t,o.TxnSignature=function(e,t){return Object(U.sign)(Object(m.encodeForSigning)(e),t)}(o,n);var i=Object(m.encode)(o);return{tx_blob:i,hash:m.hashes.hashSignedTx(i)}}function V(e){var t,n=null!=(t=null==e?void 0:e.TransactionResult)?t:"";return"tesSUCCESS"===n?E.IDecodedTxStatus.Confirmed:n.startsWith("tef")||n.startsWith("tec")?E.IDecodedTxStatus.Failed:E.IDecodedTxStatus.Pending}function G(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=v()(e);if(t){var o=v()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return h()(this,n)}}var q="m/44'/"+C.COINTYPE_XRP+"'",X=function(e){f()(n,e);var t=G(n);function n(){return t.apply(this,arguments)}var r=n.prototype;return r.getSigners=function(){var e=u()((function*(e,t){var n,r=yield this.getDbAccount();if(1!==t.length)throw new b.OneKeyInternalError("Starcoin signers number should be 1.");if(t[0]!==r.address)throw new b.OneKeyInternalError("Wrong address required for signing.");var o=(yield this.getPrivateKeys(e))[r.path];if("undefined"===typeof o)throw new b.OneKeyInternalError("Unable to get signer.");return(n={})[r.address]=new F.Signer(o,e,"secp256k1"),n}));return function(t,n){return e.apply(this,arguments)}}(),r.prepareAccounts=function(){var e=u()((function*(e){var t=e.password,n=e.indexes,r=e.names,o=(yield this.engine.dbApi.getCredential(this.walletId,t)).seed,i=Object(H.batchGetPublicKeys)("secp256k1",o,t,q,n.map((function(e){return e.toString()+"'/0/0"})));if(i.length!==n.length)throw new b.OneKeyInternalError("Unable to get publick key.");var a=[],c=0;for(var u of i){var s=u.path,d=u.extendedKey.key.toString("hex").toUpperCase(),l=m.deriveAddress(d),f=(r||[])[c]||"RIPPLE #"+(n[c]+1);a.push({id:this.walletId+"--"+s,name:f,type:D.AccountType.SIMPLE,path:s,coinType:C.COINTYPE_XRP,pub:d,address:l}),c+=1}return a}));return function(t){return e.apply(this,arguments)}}(),r.signTransaction=function(){var e=u()((function*(e,t){I.default.sendTx.info("signTransaction result",e);var n=yield this.getDbAccount(),r=(yield this.getSigners(t.password||"",[n.address]))[n.address],o=(yield r.getPrvkey()).toString("hex").toUpperCase(),i=W(e.payload.encodedTx,n.pub,"00"+o);return{txid:i.hash,rawTx:i.tx_blob}}));return function(t,n){return e.apply(this,arguments)}}(),d()(n)}(K.KeyringHdBase),z=n(748);function Y(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=v()(e);if(t){var o=v()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return h()(this,n)}}var J=function(e){f()(n,e);var t=Y(n);function n(){return t.apply(this,arguments)}var r=n.prototype;return r.getSigners=function(){var e=u()((function*(e,t){var n,r=yield this.getDbAccount();if(1!==t.length)throw new b.OneKeyInternalError("Starcoin signers number should be 1.");if(t[0]!==r.address)throw new b.OneKeyInternalError("Wrong address required for signing.");var o=(yield this.getPrivateKeys(e))[r.path];if("undefined"===typeof o)throw new b.OneKeyInternalError("Unable to get signer.");return(n={})[r.address]=new F.Signer(o,e,"secp256k1"),n}));return function(t,n){return e.apply(this,arguments)}}(),r.prepareAccounts=function(e){var t=e.privateKey,n=e.name;if(32!==t.length&&33!==t.length)throw new b.OneKeyInternalError("Invalid private key.");var r=z.secp256k1.publicFromPrivate(t).toString("hex").toUpperCase(),o=m.deriveAddress(r);return Promise.resolve([{id:"imported--"+C.COINTYPE_XRP+"--"+r,name:n||"",type:D.AccountType.SIMPLE,path:"",coinType:C.COINTYPE_XRP,pub:r,address:o}])},r.signTransaction=function(){var e=u()((function*(e,t){I.default.sendTx.info("signTransaction result",e);var n=yield this.getDbAccount(),r=(yield this.getSigners(t.password||"",[n.address]))[n.address],o=(yield r.getPrvkey()).toString("hex").toUpperCase(),i=W(e.payload.encodedTx,n.pub,"00"+o);return{txid:i.hash,rawTx:i.tx_blob}}));return function(t,n){return e.apply(this,arguments)}}(),d()(n)}(n(3915).KeyringImportedBase);function Q(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=v()(e);if(t){var o=v()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return h()(this,n)}}var $=function(e){f()(n,e);var t=Q(n);function n(){return t.apply(this,arguments)}return n.prototype.prepareAccounts=function(){var e=u()((function*(e){var t=e.name,n=e.target,r=e.accountIdPrefix,o=yield this.vault.validateAddress(n);if("undefined"===typeof o)throw new b.InvalidAddress;return Promise.resolve([{id:r+"--"+C.COINTYPE_XRP+"--"+n,name:t||"",type:D.AccountType.SIMPLE,path:"",coinType:C.COINTYPE_XRP,pub:"",address:o}])}));return function(t){return e.apply(this,arguments)}}(),d()(n)}(n(3916).KeyringWatchingBase),Z=n(2722);function ee(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function te(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ee(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ee(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ne(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=v()(e);if(t){var o=v()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return h()(this,n)}}var re=null,oe=function(e){f()(n,e);var t=ne(n);function n(){for(var e,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).keyringMap={hd:X,hw:j,imported:J,watching:$,external:$},e.settings=Z.default,e.getClientCache=Object(O.memoizee)(function(){var t=u()((function*(t){var n,r;return re&&(null==(n=re)||null==(r=n.connection)||null==r.getUrl?void 0:r.getUrl())===t||(re&&(yield e.disconnect()),re=new m.Client(t)),re.isConnected()||(yield re.connect()),re}));return function(e){return t.apply(this,arguments)}}(),{promise:!0,max:1,maxAge:Object(x.getTimeDurationMs)({minute:3})}),e.disconnect=u()((function*(){if(re&&re.isConnected())try{yield re.disconnect(),re=null}catch(e){I.default.common.error(e)}})),e.getAccountInfo=Object(O.memoizee)(function(){var t=u()((function*(t){var n=yield e.getClient();try{return(yield n.request({command:"account_info",account:t,ledger_index:"validated"})).result}catch(r){throw I.default.common.info("xrp vault getAccountInfo error: ",r),r}}));return function(e){return t.apply(this,arguments)}}(),{promise:!0,max:1,maxAge:3e4}),e}var r=n.prototype;return r.getClient=function(){var e=u()((function*(){var e=(yield this.engine.getNetwork(this.networkId)).rpcURL;return this.getClientCache(e)}));return function(){return e.apply(this,arguments)}}(),r.getClientEndpointStatus=function(){var e=u()((function*(e){var t=new m.Client(e);t.isConnected()||(yield t.connect());var n=performance.now(),r=(yield t.request({command:"ledger",ledger_index:"validated"})).result.ledger_index;return t.disconnect(),{responseTime:Math.floor(performance.now()-n),latestBlock:r}}));return function(t){return e.apply(this,arguments)}}(),r.validateAddress=function(){var e=u()((function*(e){return m.isValidClassicAddress(e)?Promise.resolve(e):Promise.reject(new b.InvalidAddress)}));return function(t){return e.apply(this,arguments)}}(),r.validateTokenAddress=function(){var e=u()((function*(e){throw new b.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),r.validateWatchingCredential=function(){var e=u()((function*(e){var t=!1;try{this.settings.watchingAccountEnabled&&m.isValidClassicAddress(e)&&(t=!0)}catch(n){}return Promise.resolve(t)}));return function(t){return e.apply(this,arguments)}}(),r.validateImportedCredential=function(){var e=u()((function*(e){return Promise.resolve(this.settings.importedAccountEnabled&&/^(00)?[0-9a-zA-Z]{64}$/.test(e))}));return function(t){return e.apply(this,arguments)}}(),r.getExportedCredential=function(){var e=u()((function*(e){var t=yield this.getDbAccount();if(t.id.startsWith("hd-")||t.id.startsWith("imported")){var n=this.keyring,r=Object.values(yield n.getPrivateKeys(e)),o=a()(r,1)[0];return"00"+Object(T.decrypt)(e,o).toString("hex").toUpperCase()}throw new b.OneKeyInternalError("Only credential of HD or imported accounts can be exported")}));return function(t){return e.apply(this,arguments)}}(),r.decodeTx=function(){var e=u()((function*(e,t){var n=yield this.engine.getNetwork(this.networkId),r=yield this.getDbAccount(),o=yield this.engine.getNativeTokenInfo(this.networkId);return{txid:"",owner:e.Account,signer:e.Account,nonce:0,actions:[{type:E.IDecodedTxActionType.NATIVE_TRANSFER,nativeTransfer:{tokenInfo:o,from:e.Account,to:e.Destination,amount:new g.a(e.Amount).shiftedBy(-n.decimals).toFixed(),amountValue:e.Amount,extraInfo:null},direction:e.Destination===r.address?E.IDecodedTxDirection.SELF:E.IDecodedTxDirection.OUT}],status:E.IDecodedTxStatus.Pending,networkId:this.networkId,accountId:this.accountId,encodedTx:e,payload:t,extraInfo:null}}));return function(t,n){return e.apply(this,arguments)}}(),r.decodedTxToLegacy=function(e){return Promise.resolve({})},r.buildEncodedTxFromTransfer=function(){var e=u()((function*(e){if(!e.to)throw new Error("Invalid transferInfo.to params");var t=e.to,n=e.amount,r=yield this.getDbAccount(),o=t,i=e.destinationTag?Number(e.destinationTag):void 0;if(!m.isValidAddress(t)&&t.indexOf("#")>-1){var c=t.split("#"),u=a()(c,2),s=u[0],d=u[1];if(o=s,i=d?Number(d):void 0,!m.isValidAddress(s))throw new b.InvalidAddress}var l=yield this.getClient(),f=yield l.getLedgerIndex();return te({},yield l.autofill({TransactionType:"Payment",Account:r.address,Amount:m.xrpToDrops(n),Destination:o,DestinationTag:i,LastLedgerSequence:f+50}))}));return function(t){return e.apply(this,arguments)}}(),r.buildUnsignedTxFromEncodedTx=function(){var e=u()((function*(e){return Promise.resolve({inputs:[],outputs:[],payload:{encodedTx:e},encodedTx:e})}));return function(t){return e.apply(this,arguments)}}(),r.updateEncodedTx=function(e,t,n){var r=t.amount;if(r){var o=m.xrpToDrops(r);e.Amount=o}return Promise.resolve(e)},r.broadcastTransaction=function(){var e=u()((function*(e){I.default.engine.info("broadcastTransaction START:",{rawTx:e.rawTx});var t=yield this.getClient();try{yield t.submitAndWait(e.rawTx)}catch(n){throw I.default.sendTx.info("broadcastTransaction ERROR:",n),n}return I.default.engine.info("broadcastTransaction END:",{txid:e.txid,rawTx:e.rawTx}),te(te({},e),{},{encodedTx:e.encodedTx})}));return function(t){return e.apply(this,arguments)}}(),r.getTransactionStatuses=function(){var e=u()((function*(e){var t=this;return Promise.all(e.map(function(){var e=u()((function*(e){var n=yield t.getClient();return function(e){var t,n=null!=(t=null==e?void 0:e.TransactionResult)?t:"";return"tesSUCCESS"===n?M.TransactionStatus.CONFIRM_AND_SUCCESS:n.startsWith("tef")||n.startsWith("tec")?M.TransactionStatus.CONFIRM_BUT_FAILED:M.TransactionStatus.PENDING}((yield n.request({command:"tx",transaction:e,binary:!1})).result.meta)}));return function(t){return e.apply(this,arguments)}}()))}));return function(t){return e.apply(this,arguments)}}(),r.fetchOnChainHistory=function(){var e=u()((function*(e){var t=this,n=e.localHistory,r=yield this.getDbAccount(),o=yield this.engine.getNetwork(this.networkId),i=o.decimals,a=(o.symbol,yield this.engine.getNativeTokenInfo(this.networkId)),c=yield this.getClient(),u=[];try{u=(yield c.request({command:"account_tx",account:r.address,ledger_index_min:-1,ledger_index_max:-1,binary:!1,limit:100,forward:!1})).result.transactions}catch(d){}var s=u.map((function(e){try{var o,c,u,s,l=e.tx,f=e.meta,p=n.find((function(e){return e.decodedTx.txid===(null==l?void 0:l.hash)}));if(p&&p.decodedTx.isFinal)return null;if("Payment"!==(null==l?void 0:l.TransactionType))return null;var h=E.IDecodedTxDirection.OUT;l.Destination===r.address&&(h=l.Account===r.address?E.IDecodedTxDirection.SELF:E.IDecodedTxDirection.IN);var y=new g.a("string"===typeof l.Amount?l.Amount:l.Amount.value).shiftedBy(-i).toFixed(),v="string"===typeof l.Amount?l.Amount:l.Amount.value,w={txid:null!=(o=l.hash)?o:"",owner:r.address,signer:r.address,nonce:null!=(c=l.Sequence)?c:0,actions:[{type:E.IDecodedTxActionType.NATIVE_TRANSFER,direction:h,nativeTransfer:{tokenInfo:a,from:l.Account,to:l.Destination,amount:y,amountValue:v,extraInfo:null}}],status:V(f),networkId:t.networkId,accountId:t.accountId,extraInfo:null,totalFeeInNative:new g.a(null!=(u=l.Fee)?u:0).shiftedBy(-i).toFixed()};return w.updatedAt="undefined"!==typeof l.date?m.rippleTimeToUnixTime(l.date):Date.now(),w.createdAt=null!=(s=null==p?void 0:p.decodedTx.createdAt)?s:w.updatedAt,w.isFinal=w.status===E.IDecodedTxStatus.Confirmed,t.buildHistoryTx({decodedTx:w,historyTxToMerge:p})}catch(d){return Promise.resolve(null)}}));return(yield Promise.all(s)).filter(Boolean)}));return function(t){return e.apply(this,arguments)}}(),r.attachFeeInfoToEncodedTx=function(e){return Promise.resolve(e.encodedTx)},r.fetchFeeInfo=function(){var e=u()((function*(e){var t,n=yield this.engine.getNetwork(this.networkId);return{customDisabled:!0,limit:m.dropsToXrp(null!=(t=e.Fee)?t:"0"),prices:["1"],defaultPresetIndex:"0",feeSymbol:"XRP",feeDecimals:n.feeDecimals,nativeSymbol:n.symbol,nativeDecimals:n.decimals,tx:null}}));return function(t){return e.apply(this,arguments)}}(),r.getBalances=function(){var e=u()((function*(e){var t=this;return yield Promise.all(e.map(function(){var e=u()((function*(e){var n=e.address,r=yield t.getClient();try{var o,i,a=yield r.request({command:"account_info",account:n,ledger_index:"validated"});return new g.a(null==(o=a.result)||null==(i=o.account_data)?void 0:i.Balance)}catch(u){var c;if(null!=u&&null!=(c=u.message)&&null!=c.includes&&c.includes("Account not found"))return new g.a(0);throw u}}));return function(t){return e.apply(this,arguments)}}()))}));return function(t){return e.apply(this,arguments)}}(),r.validateSendAmount=function(){var e=u()((function*(e,t,n){var r=new g.a(e),o=new g.a(t);try{yield this.getAccountInfo(n)}catch(a){var i;if(null!=a&&null!=(i=a.message)&&i.includes("Account not found")){if(r.lt(10))throw new b.InvalidTransferValue("form__amount_recipient_activate",{amount:"10",unit:"XRP"});return!0}throw a}if(o.minus(10).isLessThan(r))throw new b.InvalidTransferValue("form__amount_above_required_reserve",{amount:"10",unit:"XRP"});return!0}));return function(t,n,r){return e.apply(this,arguments)}}(),r.notifyChainChanged=function(e,t){e!==this.networkId&&this.disconnect()},r.getFrozenBalance=function(){var e=u()((function*(){return 10}));return function(){return e.apply(this,arguments)}}(),d()(n)}(A.VaultBase)}}]);