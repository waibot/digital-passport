(this.webpackJsonp=this.webpackJsonp||[]).push([[58],{3903:function(e,t,r){"use strict";r.r(t),r.d(t,"KeyringBase",(function(){return y})),r.d(t,"KeyringBaseMock",(function(){return h}));var n=r(2),i=r.n(n),o=r(6),a=r.n(o),u=r(9),c=r.n(u),s=r(14),d=r.n(s),l=r(7),f=r.n(l);function p(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=f()(e);if(t){var i=f()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return d()(this,r)}}var y=function(e){c()(r,e);var t=p(r);function r(e){var r;return(r=t.call(this,e.options)).vault=e,r}return r.prototype.addressFromBase=function(){var e=i()((function*(e){return this.vault.addressFromBase(e)}));return function(t){return e.apply(this,arguments)}}(),a()(r)}(r(1585).VaultContext),h=function(e){c()(r,e);var t=p(r);function r(){return t.apply(this,arguments)}return a()(r)}(y)},3905:function(e,t,r){"use strict";r.r(t),r.d(t,"KeyringSoftwareBase",(function(){return O}));var n=r(4),i=r.n(n),o=r(3),a=r.n(o),u=r(2),c=r.n(u),s=r(6),d=r.n(s),l=r(9),f=r.n(l),p=r(14),y=r.n(p),h=r(7),v=r.n(h),g=r(19),w=r(23);function m(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function I(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?m(Object(r),!0).forEach((function(t){a()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):m(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function b(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=v()(e);if(t){var i=v()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return y()(this,r)}}var O=function(e){f()(r,e);var t=b(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.signTransaction=function(){var e=c()((function*(e,t){var r=t.password;if("undefined"===typeof r)throw new w.OneKeyInternalError("Software signing requires a password.");var n=yield this.getSigners(r,e.inputs.map((function(e){return e.address})));return g.default.engine.info("signTransaction",this.networkId,e),I(I({},yield this.engine.providerManager.signTransaction(this.networkId,e,n)),{},{encodedTx:e.encodedTx})}));return function(t,r){return e.apply(this,arguments)}}(),n.signMessage=function(){var e=c()((function*(e,t){var r=this,n=t.password;if("undefined"===typeof n)throw new w.OneKeyInternalError("Software signing requires a password.");var o=yield this.getDbAccount(),a=Object.values(yield this.getSigners(n,[o.address])),u=i()(a,1)[0];return g.default.engine.info("signMessage",this.networkId,e),Promise.all(e.map((function(e){return r.engine.providerManager.signMessage(r.networkId,e,u)})))}));return function(t,r){return e.apply(this,arguments)}}(),n.getAddress=function(){throw new Error("Method not implemented.")},n.batchGetAddress=function(){throw new Error("Method not implemented.")},n.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},d()(r)}(r(3903).KeyringBase)},3912:function(e,t,r){"use strict";r.r(t),function(e){r.d(t,"VaultBaseChainOnly",(function(){return j})),r.d(t,"VaultBase",(function(){return F}));var n=r(202),i=r.n(n),o=r(3),a=r.n(o),u=r(60),c=r.n(u),s=r(2),d=r.n(s),l=r(6),f=r.n(l),p=r(9),y=r.n(p),h=r(14),v=r.n(h),g=r(7),w=r.n(g),m=r(21),I=r.n(m),b=r(167),O=r.n(b),T=r(11),x=r(19),E=r(24),P=r(68),A=r(23),S=r(182),C=r(947),k=r(52),B=r(1585);function N(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function D(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?N(Object(r),!0).forEach((function(t){a()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):N(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function K(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=w()(e);if(t){var i=w()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return v()(this,r)}}if(E.default.isExtensionUi)throw new Error("engine/VaultBase is not allowed imported from ui");var j=function(e){y()(r,e);var t=K(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.initProvider=function(){var e=d()((function*(){var e=(yield this.getNetwork()).impl;c()(C.IMPL_MAPPINGS[e])||(this.engineProvider=yield this.engine.providerManager.getProvider(this.networkId))}));return function(){return e.apply(this,arguments)}}(),n.proxyJsonRPCCall=function(){var e=d()((function*(e){throw new A.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.createClientFromURL=function(e){throw new A.NotImplemented},n.getEthersProvider=function(){var e=d()((function*(){throw new A.NotImplemented}));return function(){return e.apply(this,arguments)}}(),n.getClientEndpointStatus=function(){var e=d()((function*(e){var t=this.createClientFromURL(e),r=performance.now(),n=(yield t.getInfo()).bestBlockNumber;return{responseTime:Math.floor(performance.now()-r),latestBlock:n}}));return function(t){return e.apply(this,arguments)}}(),n.checkRpcBatchSupport=function(){var e=d()((function*(e){throw new A.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.getDisplayAddress=function(){var e=d()((function*(e){return Promise.resolve(e)}));return function(t){return e.apply(this,arguments)}}(),n.validateAddress=function(){var e=d()((function*(e){var t=yield this.engineProvider.verifyAddress(e),r=t.normalizedAddress;if(!t.isValid||!r)throw new A.InvalidAddress;return Promise.resolve(r)}));return function(t){return e.apply(this,arguments)}}(),n.validateImportedCredential=function(e){return Promise.resolve(this.settings.importedAccountEnabled&&/^(0x)?[0-9a-zA-Z]{64}$/.test(e))},n.validateWatchingCredential=function(){var e=d()((function*(e){return Promise.resolve(this.settings.watchingAccountEnabled&&(yield this.engineProvider.verifyAddress(e)).isValid)}));return function(t){return e.apply(this,arguments)}}(),n.validateTokenAddress=function(){var e=d()((function*(e){var t=yield this.engineProvider.verifyTokenAddress(e),r=t.normalizedAddress;if(!t.isValid||"undefined"===typeof r)throw new A.InvalidTokenAddress;return Promise.resolve(r)}));return function(t){return e.apply(this,arguments)}}(),n.validateCanCreateNextAccount=function(){var e=d()((function*(e,t){return Promise.resolve(!0)}));return function(t,r){return e.apply(this,arguments)}}(),n.checkAccountExistence=function(){var e=d()((function*(e,t){return Promise.resolve(!0)}));return function(t,r){return e.apply(this,arguments)}}(),n.getBalances=function(){var e=d()((function*(e,t,r){return(yield this.engine.providerManager.getClient(this.networkId)).getBalances(e.map((function(e){var t=e.address,r=e.tokenAddress;return{address:t,coin:D({},"string"===typeof r?{tokenAddress:r}:{})}})))}));return function(t,r,n){return e.apply(this,arguments)}}(),n.getFrozenBalance=function(){var e=d()((function*(e){return 0}));return function(t){return e.apply(this,arguments)}}(),n.fetchBalanceDetails=function(){var e=d()((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.password;return Promise.resolve(void 0)}));return function(){return e.apply(this,arguments)}}(),n.getTransactionStatuses=function(e){return this.engine.providerManager.getTransactionStatuses(this.networkId,e)},n.getTransactionFeeInNative=function(e){return Promise.resolve("")},n.isContractAddress=function(){var e=d()((function*(e){return!1}));return function(t){return e.apply(this,arguments)}}(),n.getAccountNameInfoMap=function(){var e=d()((function*(){var e=yield this.getNetwork();return Object(S.getAccountNameInfoByImpl)(e.impl)}));return function(){return e.apply(this,arguments)}}(),n.canAutoCreateNextAccount=function(){var e=d()((function*(e){return Promise.resolve(!1)}));return function(t){return e.apply(this,arguments)}}(),n.filterAccounts=function(){var e=d()((function*(e){var t=e.accounts;e.networkId;return Promise.resolve(t)}));return function(t){return e.apply(this,arguments)}}(),n.shouldChangeAccountWhenNetworkChanged=function(){var e=d()((function*(e){e.previousNetwork,e.newNetwork,e.activeAccountId;return Promise.resolve({shouldReloadAccountList:!1,shouldChangeActiveAccount:!1})}));return function(t){return e.apply(this,arguments)}}(),n.getAccountNameInfosByImportedOrWatchingCredential=function(){var e=d()((function*(e){return Promise.resolve([])}));return function(t){return e.apply(this,arguments)}}(),n.checkIsUnlimitedAllowance=function(){var e=d()((function*(e){throw new A.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.checkIsApprovedForAll=function(){var e=d()((function*(e){throw new A.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.checkIsBatchTransfer=function(){var e=d()((function*(e){throw new A.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.getFeePricePerUnit=function(){var e=d()((function*(){throw new A.NotImplemented}));return function(){return e.apply(this,arguments)}}(),n.fetchRpcChainId=function(){var e=d()((function*(e){return null}));return function(t){return e.apply(this,arguments)}}(),n.getTxWaitingSeconds=function(){var e=d()((function*(){return[]}));return function(){return e.apply(this,arguments)}}(),n.getUserNFTAssets=function(){var e=d()((function*(e){e.serviceData;return Promise.resolve(void 0)}));return function(t){return e.apply(this,arguments)}}(),f()(r)}(B.VaultContext),F=function(t){y()(n,t);var r=K(n);function n(){for(var e,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return(e=r.call.apply(r,[this].concat(n))).uuid=O.a.v4().toString(),e}var o=n.prototype;return o.init=function(){var e=d()((function*(e){yield this.initProvider(),yield this.initKeyring(e)}));return function(t){return e.apply(this,arguments)}}(),o.initKeyring=function(){var e=d()((function*(e){this.keyring=yield e.keyringCreator(this)}));return function(t){return e.apply(this,arguments)}}(),o.signTransaction=function(){var e=d()((function*(e,t){return this.keyring.signTransaction(e,t)}));return function(t,r){return e.apply(this,arguments)}}(),o.signAndSendTransaction=function(){var e=d()((function*(e,t,r){var n=yield this.signTransaction(e,t);return r?D(D({},n),{},{encodedTx:e.encodedTx}):this.broadcastTransaction(D(D({},n),{},{encodedTx:e.encodedTx}))}));return function(t,r,n){return e.apply(this,arguments)}}(),o.broadcastTransaction=function(){var e=d()((function*(e,t){x.default.engine.info("broadcastTransaction START:",{rawTx:e.rawTx});var r=yield this.engine.providerManager.broadcastTransaction(this.networkId,e.rawTx,t);return x.default.engine.info("broadcastTransaction END:",{txid:r,rawTx:e.rawTx}),D(D({},e),{},{txid:r,encodedTx:e.encodedTx})}));return function(t,r){return e.apply(this,arguments)}}(),o.buildEncodedTxFromBatchTransfer=function(){var e=d()((function*(e){throw new A.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),o.buildEncodedTxsFromSetApproveForAll=function(){var e=d()((function*(e,t){throw new A.NotImplemented}));return function(t,r){return e.apply(this,arguments)}}(),o.activateAccount=function(){var e=d()((function*(){throw new A.NotImplemented}));return function(){return e.apply(this,arguments)}}(),o.activateToken=function(){var e=d()((function*(e,t){throw new A.NotImplemented}));return function(t,r){return e.apply(this,arguments)}}(),o.getTokenAllowance=function(){var e=d()((function*(e,t){throw new A.NotImplemented}));return function(t,r){return e.apply(this,arguments)}}(),o.batchTokensAllowance=function(){var e=d()((function*(e,t){throw new A.NotImplemented}));return function(t,r){return e.apply(this,arguments)}}(),o.getOutputAccount=function(){var e=d()((function*(){var e=yield this.getDbAccount({noCache:!0});return{id:e.id,name:e.name,type:e.type,path:e.path,coinType:e.coinType,tokens:[],address:e.address,template:e.template,pubKey:i()(e,"pub","")}}));return function(){return e.apply(this,arguments)}}(),o.getAccountBalance=function(){var e=d()((function*(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,i=yield this.getDbAccount(),o=i.address;return this.getBalances((t?[{address:o}]:[]).concat(e.map((function(e){return{address:o,tokenAddress:e}}))),r,n)}));return function(t){return e.apply(this,arguments)}}(),o.updatePendingTxs=function(){var e=d()((function*(e){throw new A.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),o.getAccountNonce=function(){var e=d()((function*(){return Promise.resolve(null)}));return function(){return e.apply(this,arguments)}}(),o.fixActionDirection=function(){var e=d()((function*(e){var t,r,n,i,o=e.action,a=e.accountAddress;(o.direction=k.IDecodedTxDirection.OTHER,o.type===k.IDecodedTxActionType.NATIVE_TRANSFER)&&(o.direction=yield this.buildTxActionDirection({from:(null==(t=o.nativeTransfer)?void 0:t.from)||"",to:(null==(r=o.nativeTransfer)?void 0:r.to)||"",address:a}));o.type===k.IDecodedTxActionType.TOKEN_TRANSFER&&(o.direction=yield this.buildTxActionDirection({from:(null==(n=o.tokenTransfer)?void 0:n.from)||"",to:(null==(i=o.tokenTransfer)?void 0:i.to)||"",address:a}));return o}));return function(t){return e.apply(this,arguments)}}(),o.fixDecodedTx=function(){var e=d()((function*(e){var t,r;e.createdAt=null!=(t=e.createdAt)?t:Date.now();var n=null==(r=e.encodedTx)?void 0:r.nonce;e.nonce=c()(n)?e.nonce:new I.a(n).toNumber();for(var i=e.owner,o=0;o<e.actions.length;o+=1){var a=e.actions[o];yield this.fixActionDirection({action:a,accountAddress:i})}if(e.outputActions)for(var u=0;u<e.outputActions.length;u+=1){var s=e.outputActions[u];yield this.fixActionDirection({action:s,accountAddress:i})}return Promise.resolve(e)}));return function(t){return e.apply(this,arguments)}}(),o.fixHistoryTx=function(){var e=d()((function*(e){return e.decodedTx=yield this.fixDecodedTx(e.decodedTx),Promise.resolve(e)}));return function(t){return e.apply(this,arguments)}}(),o.buildHistoryTx=function(){var e=d()((function*(e){var t=e.historyTxToMerge,r=(e.encodedTx,e.decodedTx),n=e.signedTx,i=e.isSigner,o=e.isLocalCreated,a=(null==n?void 0:n.txid)||(null==r?void 0:r.txid)||"";if(!a)throw new Error("buildHistoryTx txid not found");var u=yield this.getAccountAddress();r.txid=a||r.txid,r.owner=u,i&&(r.signer=u),null!=n&&n.txKey&&(r.extraInfo?r.extraInfo.txKey=n.txKey:r.extraInfo={txKey:n.txKey});var c=D(D({id:this.networkId+"_"+a+"_"+this.accountId,isLocalCreated:Boolean(o)},t),{},{decodedTx:r});return c=yield this.fixHistoryTx(c),Promise.resolve(c)}));return function(t){return e.apply(this,arguments)}}(),o.checkIsScamHistoryTx=function(){var e=d()((function*(e){return!1}));return function(t){return e.apply(this,arguments)}}(),o.fetchOnChainHistory=function(){var e=d()((function*(e){throw new A.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),o.fixAddressCase=function(e){return Promise.resolve(e)},o.buildTxActionDirection=function(){var e=d()((function*(e){var t=e.from,r=e.to,n=e.address;return t=yield this.fixAddressCase(t||""),r=yield this.fixAddressCase(r),n=yield this.fixAddressCase(n),t===r&&t===n?k.IDecodedTxDirection.SELF:t&&t===n?k.IDecodedTxDirection.OUT:r&&r===n?k.IDecodedTxDirection.IN:k.IDecodedTxDirection.OTHER}));return function(t){return e.apply(this,arguments)}}(),o.getNextNonce=function(){var e=d()((function*(e,t){var r,n,i=null!=(r=null==(n=(yield this.engine.providerManager.getAddresses(e,[t.address]))[0])?void 0:n.nonce)?r:0,o=(yield this.engine.getHistory(e,t.id,void 0,!1),yield P.default.history.getMaxPendingNonce({accountId:this.accountId,networkId:e})),a=yield P.default.history.getPendingNonceList({accountId:this.accountId,networkId:e}),u=Math.max(c()(o)?0:o+1,i);if(Number.isNaN(u)&&(u=i),u>i)for(var s=i;s<u;s+=1)if(!a.includes(s)){u=s;break}if(u<i&&(u=i),u-i>=T.HISTORY_CONSTS.PENDING_QUEUE_MAX_LENGTH)throw new A.PendingQueueTooLong(T.HISTORY_CONSTS.PENDING_QUEUE_MAX_LENGTH);return u}));return function(t,r){return e.apply(this,arguments)}}(),o.validateSendAmount=function(e,t,r){return Promise.resolve(!0)},o.notifyChainChanged=function(e,t){},o.getFetchBalanceAddress=function(e){return Promise.resolve(e.address)},o.getPrivateKeyByCredential=function(t){return Promise.resolve(e.from(t.startsWith("0x")?t.slice(2):t,"hex"))},o.getMinDepositAmount=function(){var e=d()((function*(){return"0"}));return function(){return e.apply(this,arguments)}}(),o.specialCheckEncodedTx=function(){var e=d()((function*(e){return{success:!0}}));return function(t){return e.apply(this,arguments)}}(),o.getAllUsedAddress=function(){var e=d()((function*(){return Promise.resolve([])}));return function(){return e.apply(this,arguments)}}(),f()(n)}(j)}.call(this,r(26).Buffer)},3913:function(e,t,r){"use strict";r.r(t),function(e){r.d(t,"KeyringHardwareBase",(function(){return v}));var n=r(2),i=r.n(n),o=r(6),a=r.n(o),u=r(9),c=r.n(u),s=r(14),d=r.n(s),l=r(7),f=r.n(l),p=r(431),y=r(163);function h(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=f()(e);if(t){var i=f()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return d()(this,r)}}var v=function(t){c()(n,t);var r=h(n);function n(){return r.apply(this,arguments)}var o=n.prototype;return o.getHardwareInfo=function(){var e=i()((function*(){var e,t,r,n=yield this.engine.getHWDeviceByWalletId(this.vault.walletId);return{connectId:null!=(e=null==n?void 0:n.mac)?e:"",deviceId:null!=(t=null==n?void 0:n.deviceId)?t:"",deviceType:null!=(r=null==n?void 0:n.deviceType)?r:""}}));return function(){return e.apply(this,arguments)}}(),o.getWalletPassphraseState=function(){var e=i()((function*(){var e=yield this.engine.getWallet(this.vault.walletId);return{passphraseState:null==e?void 0:e.passphraseState,useEmptyPassphrase:!Object(y.isPassphraseWallet)(e)}}));return function(){return e.apply(this,arguments)}}(),o.getHardwareSDKInstance=function(){var t=i()((function*(){var t,r,n,i,o;return null!=(o=yield null==(t=e)||null==(r=t.$backgroundApiProxy)||null==(n=r.backgroundApi)||null==(i=n.serviceHardware)||null==i.getSDKInstance?void 0:i.getSDKInstance())?o:p.HardwareSDK}));return function(){return t.apply(this,arguments)}}(),o.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},a()(n)}(r(3903).KeyringBase)}.call(this,r(58))},3914:function(e,t,r){"use strict";r.r(t),r.d(t,"KeyringHdBase",(function(){return I}));var n=r(3),i=r.n(n),o=r(2),a=r.n(o),u=r(6),c=r.n(u),s=r(9),d=r.n(s),l=r(14),f=r.n(l),p=r(7),y=r.n(p),h=r(610),v=r(23);function g(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function w(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?g(Object(r),!0).forEach((function(t){i()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):g(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function m(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=y()(e);if(t){var i=y()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return f()(this,r)}}var I=function(e){d()(r,e);var t=m(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.getPrivateKeys=function(){var e=a()((function*(e,t){var r=(yield this.getDbAccount()).path.split("/"),n=t||[r.pop()],i=r.join("/"),o=(yield this.engine.dbApi.getCredential(this.walletId,e)).seed;if("undefined"===typeof o)throw new v.OneKeyInternalError("Unable to get credential.");var a=(yield this.engine.providerManager.getChainInfoByNetworkId(this.networkId)).curve;return Object(h.batchGetPrivateKeys)(a,o,e,i,n).reduce((function(e,t){var r;return w(w({},e),{},((r={})[t.path]=t.extendedKey.key,r))}),{})}));return function(t,r){return e.apply(this,arguments)}}(),n.getAddress=function(){throw new Error("Method not implemented.")},n.batchGetAddress=function(){throw new Error("Method not implemented.")},n.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},c()(r)}(r(3905).KeyringSoftwareBase)},3915:function(e,t,r){"use strict";r.r(t),r.d(t,"KeyringImportedBase",(function(){return h}));var n=r(2),i=r.n(n),o=r(6),a=r.n(o),u=r(9),c=r.n(u),s=r(14),d=r.n(s),l=r(7),f=r.n(l),p=r(23);function y(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=f()(e);if(t){var i=f()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return d()(this,r)}}var h=function(e){c()(r,e);var t=y(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.getPrivateKeys=function(){var e=i()((function*(e,t){if("undefined"!==typeof t)throw new p.NotImplemented("Getting private keys from extended private key");var r=(yield this.engine.dbApi.getCredential(this.accountId,e)).privateKey;if("undefined"===typeof r)throw new p.OneKeyInternalError("Unable to get credential.");return{"":r}}));return function(t,r){return e.apply(this,arguments)}}(),n.getAddress=function(){throw new Error("Method not implemented.")},n.batchGetAddress=function(){throw new Error("Method not implemented.")},n.prepareAccountByAddressIndex=function(){throw new Error("Method not implemented.")},a()(r)}(r(3905).KeyringSoftwareBase)},3916:function(e,t,r){"use strict";r.r(t),r.d(t,"KeyringWatchingBase",(function(){return h}));var n=r(2),i=r.n(n),o=r(6),a=r.n(o),u=r(9),c=r.n(u),s=r(14),d=r.n(s),l=r(7),f=r.n(l),p=r(23);function y(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=f()(e);if(t){var i=f()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return d()(this,r)}}var h=function(e){c()(r,e);var t=y(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.signTransaction=function(){var e=i()((function*(e,t){throw new p.OneKeyInternalError("signTransaction is not supported for watching accounts")}));return function(t,r){return e.apply(this,arguments)}}(),n.signMessage=function(){var e=i()((function*(e,t){throw new p.OneKeyInternalError("signMessage is not supported for watching accounts")}));return function(t,r){return e.apply(this,arguments)}}(),n.getAddress=function(){throw new Error("Method not implemented.")},n.batchGetAddress=function(){throw new Error("Method not implemented.")},n.prepareAccountByAddressIndex=function(){throw new Error("Method not implemented.")},a()(r)}(r(3903).KeyringBase)},3918:function(e,t,r){"use strict";r.r(t),r.d(t,"convertDeviceError",(function(){return u}));var n=r(70),i=r(90),o=r(19);r(24);function a(e,t){return"string"!==typeof t?null:e===n.HardwareErrorCode.DeviceInitializeFailed&&t.includes("ECONNABORTED")?new i.ConnectTimeoutError({message:t}):t.includes("Bridge network error")?new i.BridgeNetworkError({message:t}):null}function u(e){var t,r=e||{},u=r.code,c=r.error,s=r.message,d=null!=(t=null!=c?c:s)?t:"Unknown error";if(a(u,d))return a(u,d);switch(o.default.hardwareSDK.info("Device Utils Convert Device Error:",u,d),u){case n.HardwareErrorCode.UnknownError:return new i.UnknownHardwareError(e);case n.HardwareErrorCode.DeviceFwException:return new i.FirmwareVersionTooLow(e);case n.HardwareErrorCode.DeviceUnexpectedMode:return"string"===typeof d&&-1!==d.indexOf("ui-device_bootloader_mode")?new i.NotInBootLoaderMode(e):new i.UnknownHardwareError(e);case n.HardwareErrorCode.DeviceCheckDeviceIdError:return new i.DeviceNotSame(e);case n.HardwareErrorCode.DeviceNotFound:return new i.DeviceNotFind(e);case n.HardwareErrorCode.DeviceUnexpectedBootloaderMode:return new i.NotInBootLoaderMode(e);case n.HardwareErrorCode.DeviceInterruptedFromOutside:case n.HardwareErrorCode.DeviceInterruptedFromUser:return new i.UserCancelFromOutside(e);case n.HardwareErrorCode.DeviceNotSupportPassphrase:return new i.NotSupportPassphraseError(e);case n.HardwareErrorCode.IFrameLoadFail:return new i.InitIframeLoadFail(e);case n.HardwareErrorCode.IframeTimeout:return new i.InitIframeTimeout(e);case n.HardwareErrorCode.FirmwareUpdateDownloadFailed:return new i.FirmwareDownloadFailed(e);case n.HardwareErrorCode.FirmwareUpdateManuallyEnterBoot:return new i.FirmwareUpdateManuallyEnterBoot(e);case n.HardwareErrorCode.FirmwareUpdateAutoEnterBootFailure:return new i.FirmwareUpdateAutoEnterBootFailure(e);case n.HardwareErrorCode.FirmwareUpdateLimitOneDevice:return new i.FirmwareUpdateLimitOneDevice(e);case n.HardwareErrorCode.CallMethodNeedUpgradeFirmware:return new i.FirmwareVersionTooLow(e);case n.HardwareErrorCode.NewFirmwareUnRelease:return new i.NewFirmwareUnRelease(e);case n.HardwareErrorCode.NewFirmwareForceUpdate:return new i.NewFirmwareForceUpdate(e);case n.HardwareErrorCode.NetworkError:return new i.NetworkError(e);case n.HardwareErrorCode.BlePermissionError:return new i.NeedBluetoothTurnedOn(e);case n.HardwareErrorCode.BleLocationError:return new i.NeedBluetoothPermissions({message:d});case n.HardwareErrorCode.BleLocationServicesDisabled:return new i.BleLocationServiceError({message:d});case n.HardwareErrorCode.BleDeviceNotBonded:return new i.DeviceNotBonded(e);case n.HardwareErrorCode.BleDeviceBondError:return new i.DeviceBondError(e);case n.HardwareErrorCode.BleWriteCharacteristicError:return new i.BleWriteCharacteristicError(e);case n.HardwareErrorCode.BleScanError:return new i.BleScanError({message:d});case n.HardwareErrorCode.BleAlreadyConnected:return new i.BleAlreadyConnectedError(e);case n.HardwareErrorCode.RuntimeError:return-1!==d.indexOf("EIP712 blind sign is disabled")?new i.OpenBlindSign(e):-1!==d.indexOf("Unknown message")||-1!==d.indexOf("Failure_UnexpectedMessage")?new i.UnknownMethod(e):new i.UnknownHardwareError(e);case n.HardwareErrorCode.PinInvalid:return new i.InvalidPIN(e);case n.HardwareErrorCode.DeviceCheckPassphraseStateError:return new i.InvalidPassphrase(e);case n.HardwareErrorCode.DeviceOpenedPassphrase:return new i.DeviceOpenedPassphrase(e);case n.HardwareErrorCode.DeviceNotOpenedPassphrase:return new i.DeviceNotOpenedPassphrase(e);case n.HardwareErrorCode.PinCancelled:case n.HardwareErrorCode.ActionCancelled:return new i.UserCancel(e);case n.HardwareErrorCode.BridgeNotInstalled:case i.CustomOneKeyHardwareError.NeedOneKeyBridge:return new i.NeedOneKeyBridge(e);case n.HardwareErrorCode.BridgeNetworkError:return new i.BridgeNetworkError(e);case n.HardwareErrorCode.BridgeTimeoutError:return new i.BridgeTimeoutError(e);case n.HardwareErrorCode.PollingTimeout:return new i.ConnectTimeoutError(e);case n.HardwareErrorCode.PollingStop:return new i.ConnectPollingStopError(e);case n.HardwareErrorCode.BlindSignDisabled:return new i.OpenBlindSign(e);case n.HardwareErrorCode.FileAlreadyExists:return new i.FileAlreadyExistError(e);case n.HardwareErrorCode.CheckDownloadFileError:return new i.IncompleteFileError(e);case n.HardwareErrorCode.NotInSigningMode:return new i.NotInSigningModeError(e);default:return new i.UnknownHardwareError(e)}}},5072:function(e,t,r){"use strict";r.r(t),function(e){r.d(t,"KeyringHardware",(function(){return k}));var n=r(3),i=r.n(n),o=r(2),a=r.n(o),u=r(6),c=r.n(u),s=r(9),d=r.n(s),l=r(14),f=r.n(l),p=r(7),y=r.n(p),h=r(253),v=r(73),g=r(23),w=r(317),m=r(182),I=r(117),b=r(3913),O=r(3918),T=r(11),x=r(19),E=r(1609),P=r(1610);function A(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function S(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?A(Object(r),!0).forEach((function(t){i()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):A(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function C(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=y()(e);if(t){var i=y()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return f()(this,r)}}var k=function(t){d()(n,t);var r=C(n);function n(){return r.apply(this,arguments)}var i=n.prototype;return i.prepareAccounts=function(){var e=a()((function*(e){var t,r=e.indexes,n=e.names,i=e.template,o=Object(w.slicePathTemplate)(i).pathPrefix,a=r.map((function(e){return o+"/"+e})),u=yield this.getHardwareSDKInstance(),c=yield this.getHardwareInfo(),s=c.connectId,d=c.deviceId,l=yield this.getWalletPassphraseState(),f=Object(m.getAccountNameInfoByImpl)(T.IMPL_KASPA).default.prefix,p=yield this.getNetworkChainId();try{t=yield u.kaspaGetAddress(s,d,S({bundle:a.map((function(e){return{path:e,showOnOneKey:!1,prefix:p,scheme:E.SignType.Schnorr}}))},l))}catch(C){throw x.default.common.error(C),new g.OneKeyHardwareError(C)}if(!t.success)throw x.default.common.error(t.payload),Object(O.convertDeviceError)(t.payload);var y=[],h=0;for(var v of t.payload){var b=v.address,P=v.path,A=(n||[])[h]||f+" #"+(r[h]+1);y.push({id:this.walletId+"--"+P,name:A,type:I.AccountType.SIMPLE,path:P,coinType:T.COINTYPE_KASPA,pub:"",address:b}),h+=1}return y}));return function(t){return e.apply(this,arguments)}}(),i.getAddress=function(){var e=a()((function*(e){var t,r,n=yield this.getHardwareSDKInstance(),i=yield this.getHardwareInfo(),o=i.connectId,a=i.deviceId,u=yield this.getWalletPassphraseState(),c=yield this.getNetworkChainId(),s=yield n.kaspaGetAddress(o,a,S({path:e.path,showOnOneKey:e.showOnOneKey,prefix:c,scheme:E.SignType.Schnorr},u));if(s.success&&null!=(t=s.payload)&&t.address)return null==(r=s.payload)?void 0:r.address;throw Object(O.convertDeviceError)(s.payload)}));return function(t){return e.apply(this,arguments)}}(),i.batchGetAddress=function(){var e=a()((function*(e){var t=yield this.getHardwareSDKInstance(),r=yield this.getHardwareInfo(),n=r.connectId,i=r.deviceId,o=yield this.getWalletPassphraseState(),a=yield this.getNetworkChainId(),u=yield t.kaspaGetAddress(n,i,S(S({},o),{},{bundle:e.map((function(e){return{path:e.path,showOnOneKey:!!e.showOnOneKey,prefix:a,scheme:E.SignType.Schnorr}}))}));if(!u.success)throw Object(O.convertDeviceError)(u.payload);return u.payload.map((function(e){var t,r;return{path:null!=(t=e.path)?t:"",address:null!=(r=e.address)?r:""}}))}));return function(t){return e.apply(this,arguments)}}(),i.signTransaction=function(){var t=a()((function*(t){x.default.common.info("signTransaction",t);var r=yield this.getDbAccount(),n=yield this.getNetworkChainId(),i=Object(P.toTransaction)(t.payload.encodedTx),o={version:i.version,inputs:i.inputs.map((function(t){var n,i,o,a,u,c,s,d;return{path:r.path,prevTxId:t.prevTxId.toString("hex"),outputIndex:t.outputIndex,sequenceNumber:t.sequenceNumber.toString(),output:{satoshis:null!=(n=null==t||null==(i=t.output)?void 0:i.satoshis.toString())?n:"",script:Object(v.bytesToHex)(null!=(o=null==t||null==(a=t.output)||null==(u=a.script)?void 0:u.toBuffer())?o:e.alloc(0))},sigOpCount:null!=(c=null==t||null==(s=t.output)||null==(d=s.script)?void 0:d.getSignatureOperationsCount())?c:1}})),outputs:i.outputs.map((function(e){return{satoshis:e.satoshis.toString(),script:Object(v.bytesToHex)(e.script.toBuffer()),scriptVersion:0}})),lockTime:i.nLockTime.toString(),sigHashType:P.SignatureType.SIGHASH_ALL,sigOpCount:1,scheme:E.SignType.Schnorr,prefix:n},a=yield this.getHardwareInfo(),u=a.connectId,c=a.deviceId,s=yield this.getWalletPassphraseState(),d=yield this.getHardwareSDKInstance(),l=yield d.kaspaSignTransaction(u,c,S(S({},o),s));if(l.success){var f=l.payload;for(var p of f){var y,g,w=i.inputs[p.index],m=null==w||null==(y=w.output)||null==(g=y.script)?void 0:g.getPublicKey(),I=Object(E.publicKeyFromX)(!0,Object(v.bytesToHex)(m));i.inputs[p.index].addSignature(i,new h.Transaction.Signature({publicKey:I,prevTxId:w.prevTxId,outputIndex:w.outputIndex,inputIndex:p.index,signature:p.signature,sigtype:P.SignatureType.SIGHASH_ALL}),P.SigningMethodType.Schnorr)}return{txid:"",rawTx:Object(v.bytesToHex)(i.toBuffer())}}throw Object(O.convertDeviceError)(l.payload)}));return function(e){return t.apply(this,arguments)}}(),c()(n)}(b.KeyringHardwareBase)}.call(this,r(26).Buffer)},5073:function(e,t,r){"use strict";r.r(t),function(e){r.d(t,"KeyringHd",(function(){return P}));var n=r(2),i=r.n(n),o=r(6),a=r.n(o),u=r(9),c=r.n(u),s=r(14),d=r.n(s),l=r(7),f=r.n(l),p=r(73),y=r(23),h=r(317),v=r(182),g=r(1345),w=r(610),m=r(117),I=r(3914),b=r(11),O=r(19),T=r(1609),x=r(1610);function E(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=f()(e);if(t){var i=f()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return d()(this,r)}}var P=function(t){c()(n,t);var r=E(n);function n(){return r.apply(this,arguments)}var o=n.prototype;return o.getSigners=function(){var e=i()((function*(e,t){var r,n=yield this.getDbAccount();if(1!==t.length)throw new y.OneKeyInternalError("Kaspa signers number should be 1.");if(t[0]!==n.address)throw new y.OneKeyInternalError("Wrong address required for signing.");var i=(yield this.getPrivateKeys(e))[n.path];if("undefined"===typeof i)throw new y.OneKeyInternalError("Unable to get signer.");return(r={})[n.address]=new g.Signer(i,e,"secp256k1"),r}));return function(t,r){return e.apply(this,arguments)}}(),o.prepareAccounts=function(){var e=i()((function*(e){var t=e.password,r=e.indexes,n=e.names,i=e.template,o=(yield this.engine.dbApi.getCredential(this.walletId,t)).seed,a=Object(h.slicePathTemplate)(i).pathPrefix,u=Object(w.batchGetPublicKeys)("secp256k1",o,t,a,r.map((function(e){return""+e.toString()})));if(u.length!==r.length)throw new y.OneKeyInternalError("Unable to get publick key.");var c=Object(v.getAccountNameInfoByImpl)(b.IMPL_KASPA).default.prefix,s=yield this.getNetworkChainId(),d=[],l=0;for(var f of u){var g=f.path,I=f.extendedKey.key,O=Object(p.bytesToHex)(I),x=Object(T.publicKeyFromOriginPubkey)(I),E=Object(T.addressFromPublicKey)(x,s),P=(n||[])[l]||c+" #"+(r[l]+1);d.push({id:this.walletId+"--"+g,name:P,type:m.AccountType.SIMPLE,path:g,coinType:b.COINTYPE_KASPA,pub:O,address:E}),l+=1}return d}));return function(t){return e.apply(this,arguments)}}(),o.signTransaction=function(){var t=i()((function*(t,r){O.default.common.info("signTransaction result",t);var n=yield this.getDbAccount(),o=n.address,a=(yield this.getSigners(r.password||"",[o]))[o],u=yield this.getNetworkChainId(),c=t.payload.encodedTx,s=Object(x.toTransaction)(c);return{txid:"",rawTx:yield Object(x.signTransaction)(s,{getPublicKey:function(){return Object(T.publicKeyFromOriginPubkey)(e.from(Object(p.hexToBytes)(n.pub)))},getPrivateKey:function(){var e=i()((function*(){var e=yield a.getPrvkey(),t=yield a.getPubkey(!0);return Object(T.privateKeyFromOriginPrivateKey)(e,t,u)}));return function(){return e.apply(this,arguments)}}()})}}));return function(e,r){return t.apply(this,arguments)}}(),a()(n)}(I.KeyringHdBase)}.call(this,r(26).Buffer)},5074:function(e,t,r){"use strict";r.r(t),function(e){r.d(t,"KeyringImported",(function(){return x}));var n=r(2),i=r.n(n),o=r(6),a=r.n(o),u=r(9),c=r.n(u),s=r(14),d=r.n(s),l=r(7),f=r.n(l),p=r(73),y=r(23),h=r(1345),v=r(748),g=r(117),w=r(3915),m=r(11),I=r(19),b=r(1609),O=r(1610);function T(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=f()(e);if(t){var i=f()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return d()(this,r)}}var x=function(t){c()(n,t);var r=T(n);function n(){return r.apply(this,arguments)}var o=n.prototype;return o.getSigners=function(){var e=i()((function*(e,t){var r,n=yield this.getDbAccount();if(1!==t.length)throw new y.OneKeyInternalError("Kaspa signers number should be 1.");if(t[0]!==n.address)throw new y.OneKeyInternalError("Wrong address required for signing.");var i=(yield this.getPrivateKeys(e))[n.path];if("undefined"===typeof i)throw new y.OneKeyInternalError("Unable to get signer.");return(r={})[n.address]=new h.Signer(i,e,"secp256k1"),r}));return function(t,r){return e.apply(this,arguments)}}(),o.prepareAccounts=function(){var e=i()((function*(e){var t=e.privateKey,r=e.name;if(32!==t.length)throw new y.OneKeyInternalError("Invalid private key.");var n=yield this.getNetworkChainId(),i=v.secp256k1.publicFromPrivate(t),o=Object(p.bytesToHex)(i),a=Object(b.publicKeyFromOriginPubkey)(i),u=Object(b.addressFromPublicKey)(a,n);return[{id:"imported--"+m.COINTYPE_KASPA+"--"+o,name:r,type:g.AccountType.SIMPLE,path:"",coinType:m.COINTYPE_KASPA,pub:o,address:u}]}));return function(t){return e.apply(this,arguments)}}(),o.signTransaction=function(){var t=i()((function*(t,r){I.default.common.info("signTransaction result",t);var n=yield this.getDbAccount(),o=n.address,a=(yield this.getSigners(r.password||"",[o]))[o],u=yield this.getNetworkChainId(),c=t.payload.encodedTx,s=Object(O.toTransaction)(c);return{txid:"",rawTx:yield Object(O.signTransaction)(s,{getPublicKey:function(){return Object(b.publicKeyFromOriginPubkey)(e.from(Object(p.hexToBytes)(n.pub)))},getPrivateKey:function(){var e=i()((function*(){var e=yield a.getPrvkey(),t=yield a.getPubkey(!0);return Object(b.privateKeyFromOriginPrivateKey)(e,t,u)}));return function(){return e.apply(this,arguments)}}()})}}));return function(e,r){return t.apply(this,arguments)}}(),a()(n)}(w.KeyringImportedBase)}.call(this,r(26).Buffer)},5075:function(e,t,r){"use strict";r.r(t),r.d(t,"KeyringWatching",(function(){return w}));var n=r(2),i=r.n(n),o=r(6),a=r.n(o),u=r(9),c=r.n(u),s=r(14),d=r.n(s),l=r(7),f=r.n(l),p=r(23),y=r(117),h=r(3916),v=r(11);function g(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=f()(e);if(t){var i=f()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return d()(this,r)}}var w=function(e){c()(r,e);var t=g(r);function r(){return t.apply(this,arguments)}return r.prototype.prepareAccounts=function(){var e=i()((function*(e){var t=e.name,r=e.target,n=e.accountIdPrefix,i=yield this.vault.validateAddress(r);if("undefined"===typeof i)throw new p.InvalidAddress;return Promise.resolve([{id:n+"--"+v.COINTYPE_KASPA+"--"+r,name:t||"",type:y.AccountType.SIMPLE,path:"",coinType:v.COINTYPE_KASPA,pub:"",address:i}])}));return function(t){return e.apply(this,arguments)}}(),a()(r)}(h.KeyringWatchingBase)},6086:function(e,t,r){"use strict";r.r(t),function(e){r.d(t,"default",(function(){return M}));var n=r(3),i=r.n(n),o=r(4),a=r.n(o),u=r(823),c=r.n(u),s=r(2),d=r.n(s),l=r(6),f=r.n(l),p=r(9),y=r.n(p),h=r(14),v=r.n(h),g=r(7),w=r.n(g),m=r(73),I=r(21),b=r.n(I),O=r(23),T=r(112),x=r(367),E=r(52),P=r(196),A=r(3912),S=r(46),C=r(150),k=r(5072),B=r(5073),N=r(5074),D=r(5075),K=r(1609),j=r(1610),F=r(2729);function H(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function R(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?H(Object(r),!0).forEach((function(t){i()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):H(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=w()(e);if(t){var i=w()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return v()(this,r)}}var M=function(t){y()(n,t);var r=_(n);function n(){for(var e,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return(e=r.call.apply(r,[this].concat(n))).keyringMap={hd:B.KeyringHd,hw:k.KeyringHardware,imported:N.KeyringImported,watching:D.KeyringWatching,external:D.KeyringWatching},e.settings=F.default,e.getClientCache=Object(C.memoizee)(function(){var t=d()((function*(t){return e.getKaspaClient(t)}));return function(e){return t.apply(this,arguments)}}(),{promise:!0,max:1,maxAge:Object(S.getTimeDurationMs)({minute:3})}),e}var i=n.prototype;return i.getClient=function(){var e=d()((function*(){var e=yield this.getRpcUrl();return this.getClientCache(e)}));return function(){return e.apply(this,arguments)}}(),i.getKaspaClient=function(e){return new K.RestAPIClient(e)},i.getClientEndpointStatus=function(){var e=d()((function*(e){var t=yield this.getClientCache(e),r=performance.now(),n=(yield t.getNetworkInfo()).virtualDaaScore,i=parseInt(n);return{responseTime:Math.floor(performance.now()-r),latestBlock:i}}));return function(t){return e.apply(this,arguments)}}(),i.getBalances=function(){var e=d()((function*(e){var t=yield this.getClient(),r=c()(e,(function(e){return e.address})),n=new Map;return yield Promise.all(Object.entries(r).map(function(){var e=d()((function*(e){var r=a()(e,2),i=r[0];r[1];try{var o=yield t.queryBalance(i);try{n.set(i,new b.a(o.toString()))}catch(u){}}catch(c){}}));return function(t){return e.apply(this,arguments)}}())),e.map((function(e){var t,r=e.address;return null!=(t=n.get(r))?t:new b.a(0)}))}));return function(t){return e.apply(this,arguments)}}(),i.buildEncodedTxFromTransfer=function(){var e=d()((function*(e,t){if(!e.to)throw new Error("Invalid transferInfo.to params");var r=e.to,n=e.amount;if(e.token)throw new O.OneKeyInternalError("Kaspa does not support token transfer");var i=yield this.getClient(),o=(yield this.getDbAccount()).address,a=yield this.getNetwork(),u=new b.a(n).shiftedBy(a.decimals).toFixed();if(new b.a(u).isLessThan(K.DUST_AMOUNT))throw new O.OneKeyInternalError("Amount is too small");var c=Object(P.convertFeeValueToGwei)({value:"1",network:a}),s=yield Object(K.queryConfirmUTXOs)(i,o),d=Object(K.selectUTXOs)(s,parseInt(u)),l=d.utxoIds,f=d.utxos,p=d.mass,y=null!=t?t:p.toString(),h=!1;if(f.length===s.length&&(h=f.reduce((function(e,t){var r=t.satoshis;return e.plus(r)}),new b.a("0")).shiftedBy(-a.decimals).lte(n)),!h&&f.reduce((function(e,t){var r=t.satoshis;return e.plus(r)}),new b.a("0")).shiftedBy(-a.decimals).lte(n)){var v=Object(K.selectUTXOs)(s,parseInt(u)+p);l=v.utxoIds,f=v.utxos,p=v.mass}return{utxoIds:l,inputs:f,outputs:[{address:r,value:u}],feeInfo:{price:c,limit:y},hasMaxSend:h,mass:parseInt(y)}}));return function(t,r){return e.apply(this,arguments)}}(),i.buildUnsignedTxFromEncodedTx=function(){var e=d()((function*(e){var t=e.inputs,r=e.outputs,n=[];for(var i of t){var o=new b.a(i.satoshis);n.push({address:i.address.toString(),value:o,utxo:{txid:i.txid,vout:i.vout,value:o}})}var a={inputs:n,outputs:r.map((function(e){var t=e.address,r=e.value;return{address:t,value:new b.a(r),payload:{}}})),payload:{},encodedTx:e};return Promise.resolve(a)}));return function(t){return e.apply(this,arguments)}}(),i.decodedTxToLegacy=function(e){return Promise.resolve({})},i.decodeTx=function(){var e=d()((function*(e,t){var r,n,i,o=e.inputs,a=e.outputs,u=e.feeInfo,c=yield this.engine.getNetwork(this.networkId),s=yield this.getDbAccount(),d={tokenInfo:yield this.engine.getNativeTokenInfo(this.networkId),utxoFrom:o.map((function(e){var t,r;return{address:e.address.toString(),balance:new b.a(e.satoshis.toString()).shiftedBy(-c.decimals).toFixed(),balanceValue:null!=(t=null==(r=e.satoshis)?void 0:r.toString())?t:"0",symbol:c.symbol,isMine:!0}})),utxoTo:a.map((function(e){return{address:e.address,balance:new b.a(e.value).shiftedBy(-c.decimals).toFixed(),balanceValue:e.value.toString(),symbol:c.symbol,isMine:!1}})),from:s.address,to:a[0].address,amount:new b.a(a[0].value).shiftedBy(-c.decimals).toFixed(),amountValue:a[0].value,extraInfo:null};return{txid:"",owner:s.address,signer:s.address,nonce:0,actions:[{type:E.IDecodedTxActionType.NATIVE_TRANSFER,direction:a[0].address===s.address?E.IDecodedTxDirection.OUT:E.IDecodedTxDirection.SELF,nativeTransfer:d}],status:E.IDecodedTxStatus.Pending,networkId:this.networkId,accountId:this.accountId,extraInfo:null,totalFeeInNative:new b.a(null!=(r=null==(n=e.feeInfo)?void 0:n.limit)?r:"0").multipliedBy(null!=(i=null==u?void 0:u.price)?i:"0.00000001").toFixed()}}));return function(t,r){return e.apply(this,arguments)}}(),i.updateEncodedTx=function(){var e=d()((function*(e,t,r){var n=e.outputs;if(r.type===E.IEncodedTxUpdateType.transfer&&n.length>0){var i,o,a,u=yield this.getNetwork(),c=new b.a(null!=(i=null==(o=t.feeInfo)?void 0:o.limit)?i:"3000").multipliedBy("1.2"),s=new b.a(null!=(a=t.totalBalance)?a:t.amount).shiftedBy(u.decimals).toFixed(0);return Promise.resolve(R(R({},e),{},{hasMaxSend:!0,outputs:[{address:n[0].address,value:s}],mass:parseInt(c.toFixed(0))}))}return Promise.resolve(e)}));return function(t,r,n){return e.apply(this,arguments)}}(),i.minimumRequiredTransactionRelayFee=function(e){var t=e*K.MINIMUM_RELAY_TRANSACTION_FEE/1e3;return 0===t&&K.MINIMUM_RELAY_TRANSACTION_FEE>0&&(t=K.MINIMUM_RELAY_TRANSACTION_FEE),t>K.MAX_SOMPI&&(t=K.MAX_SOMPI),t},i.fetchFeeInfo=function(){var e=d()((function*(e){var t=yield this.engine.getNetwork(this.networkId),r=Object(j.toTransaction)(e).getMassAndSize(),n=r.txSize,i=r.mass,o=this.minimumRequiredTransactionRelayFee(i);if(n>K.MAX_BLOCK_SIZE)throw new Error("Transaction size is too large");var a=Object(P.convertFeeValueToGwei)({value:"1",network:t});return{nativeSymbol:t.symbol,nativeDecimals:t.decimals,feeSymbol:t.feeSymbol,feeDecimals:t.feeDecimals,limit:new b.a(null!=o?o:"1").multipliedBy(1.1).toFixed(0),prices:[a],defaultPresetIndex:"0"}}));return function(t){return e.apply(this,arguments)}}(),i.attachFeeInfoToEncodedTx=function(){var e=d()((function*(e){var t=e.feeInfoValue,r=t.price,n=t.limit;if("undefined"!==typeof r&&"string"!==typeof r)throw new O.OneKeyInternalError("Invalid gas price.");if("string"!==typeof n)throw new O.OneKeyInternalError("Invalid fee limit");return Promise.resolve(R(R({},e.encodedTx),{},{feeInfo:{price:r,limit:n},mass:parseInt(null!=n?n:"1000")}))}));return function(t){return e.apply(this,arguments)}}(),i.broadcastTransaction=function(){var e=d()((function*(e){var t=yield this.getClient(),r=e.rawTx,n=yield t.sendRawTransaction(r);return R(R({},e),{},{txid:n})}));return function(t){return e.apply(this,arguments)}}(),i.getExportedCredential=function(){var e=d()((function*(e){var t=yield this.getDbAccount();if(t.id.startsWith("hd-")||t.id.startsWith("imported")){var r=this.keyring,n=Object.values(yield r.getPrivateKeys(e)),i=a()(n,1)[0],o=yield this.getNetworkChainId();return Object(K.privateKeyFromBuffer)(Object(T.decrypt)(e,i),o).toWIF()}throw new O.OneKeyInternalError("Only credential of HD or imported accounts can be exported")}));return function(t){return e.apply(this,arguments)}}(),i.getTransactionStatuses=function(){var e=d()((function*(e){var t=yield this.getClient(),r=(yield t.getNetworkInfo()).virtualDaaScore,n=yield t.getTransactions(e),i=new Map;for(var o of n){var a=x.TransactionStatus.PENDING;o.accepting_block_blue_score&&new b.a(r).minus(o.accepting_block_blue_score).isGreaterThanOrEqualTo(K.CONFIRMATION_COUNT)&&(a=x.TransactionStatus.CONFIRM_AND_SUCCESS),i.set(o.transaction_id,a)}return e.map((function(e){return i.get(e)}))}));return function(t){return e.apply(this,arguments)}}(),i.fetchOnChainHistory=function(){var e=d()((function*(e){var t=this,r=e.localHistory,n=void 0===r?[]:r;if(e.tokenIdOnNetwork)return Promise.resolve([]);var i=yield this.getClient(),o=yield this.getDbAccount(),a=yield this.engine.getNativeTokenInfo(this.networkId),u=a.decimals,c=a.symbol,s=(yield i.getNetworkInfo()).virtualDaaScore,l=yield this.engine.getNativeTokenInfo(this.networkId),f=(yield i.getTransactionsByAddress(o.address)).map(function(){var e=d()((function*(e){var r=n.find((function(t){return t.decodedTx.txid===e.transaction_id}));if(r&&r.decodedTx.isFinal)return Promise.resolve(null);try{var i,a=e.inputs,d=e.outputs,f=[],p=a.find((function(e){return e.previous_outpoint_address===o.address})),y=d.find((function(e){return e.script_public_key_address===o.address})),h="",v="";if(y&&!p){try{h=a[0].previous_outpoint_address}catch(P){h="kaspa:00000000"}v=o.address}else{if(!p||!y)return yield Promise.resolve(null);h=o.address;var g=d.filter((function(e){return e.script_public_key_address!==o.address}));v=g.length>0?g[0].script_public_key_address:o.address}var w=d.find((function(e){return e.script_public_key_address===v}));if(!w)return yield Promise.resolve(null);var m={tokenInfo:l,utxoFrom:a.map((function(e){var t,r;return{address:e.previous_outpoint_address,balance:new b.a(e.previous_outpoint_amount.toString()).shiftedBy(-u).toFixed(),balanceValue:null!=(t=null==(r=e.previous_outpoint_amount)?void 0:r.toString())?t:"0",symbol:c,isMine:!0}})),utxoTo:d.map((function(e){return{address:e.script_public_key_address,balance:new b.a(e.amount.toString()).shiftedBy(-u).toFixed(),balanceValue:e.amount.toString(),symbol:c,isMine:e.script_public_key_address===o.address}})),from:h,to:v,amount:new b.a(w.amount.toString()).shiftedBy(-u).toFixed(),amountValue:w.amount.toString(),extraInfo:null};f.push({type:E.IDecodedTxActionType.NATIVE_TRANSFER,nativeTransfer:m});var I="";try{var O=e.inputs.reduce((function(e,t){return e.plus(t.previous_outpoint_amount.toString())}),new b.a(0)),T=e.outputs.reduce((function(e,t){return e.plus(t.amount.toString())}),new b.a(0));I=O.isLessThanOrEqualTo(0)?"0":O.minus(T).shiftedBy(-u).toFixed()}catch(A){I=new b.a(e.mass).shiftedBy(-u).toFixed()}var x={txid:e.transaction_id,owner:o.address,signer:o.address,nonce:0,actions:f,status:new b.a(s).minus(e.accepting_block_blue_score).isGreaterThanOrEqualTo(K.CONFIRMATION_COUNT)?E.IDecodedTxStatus.Confirmed:E.IDecodedTxStatus.Pending,networkId:t.networkId,accountId:t.accountId,extraInfo:null,totalFeeInNative:I};return x.updatedAt="undefined"!==typeof e.block_time?e.block_time:Date.now(),x.createdAt=null!=(i=null==r?void 0:r.decodedTx.createdAt)?i:x.updatedAt,x.isFinal=x.status===E.IDecodedTxStatus.Confirmed,yield t.buildHistoryTx({decodedTx:x,historyTxToMerge:r})}catch(P){}}));return function(t){return e.apply(this,arguments)}}());return(yield Promise.all(f)).filter(Boolean)}));return function(t){return e.apply(this,arguments)}}(),i.validateAddress=function(){var e=d()((function*(e){var t=yield this.getNetworkChainId();return Object(K.isValidAddress)(e,t)?Promise.resolve(e):Promise.reject(new O.InvalidAddress)}));return function(t){return e.apply(this,arguments)}}(),i.validateWatchingCredential=function(){var e=d()((function*(e){var t=this;return this.validateAddress(e).then((function(e){return t.settings.watchingAccountEnabled&&!!e})).catch((function(){return!1}))}));return function(t){return e.apply(this,arguments)}}(),i.validateImportedCredential=function(){var e=d()((function*(e){return Promise.resolve(this.settings.importedAccountEnabled&&(this.isHexPrivateKey(e)||this.isWIFPrivateKey(e)))}));return function(t){return e.apply(this,arguments)}}(),i.isHexPrivateKey=function(e){return/^(0x)?[0-9a-zA-Z]{64}$/.test(e)},i.isWIFPrivateKey=function(e){return/^[5KL][1-9A-HJ-NP-Za-km-z]{50,51}$/.test(e)},i.getPrivateKeyByCredential=function(){var t=d()((function*(t){if(this.isHexPrivateKey(t))return Promise.resolve(e.from(t.startsWith("0x")?t.slice(2):t,"hex"));if(this.isWIFPrivateKey(t)){var r=Object(K.privateKeyFromWIF)(t);return Promise.resolve(e.from(Object(m.hexToBytes)(r.toString())))}}));return function(e){return t.apply(this,arguments)}}(),f()(n)}(A.VaultBase)}.call(this,r(26).Buffer)}}]);