(this.webpackJsonp=this.webpackJsonp||[]).push([[61],{3903:function(e,t,n){"use strict";n.r(t),n.d(t,"KeyringBase",(function(){return y})),n.d(t,"KeyringBaseMock",(function(){return h}));var r=n(2),i=n.n(r),o=n(6),a=n.n(o),c=n(9),u=n.n(c),s=n(14),l=n.n(s),d=n(7),f=n.n(d);function p(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f()(e);if(t){var i=f()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return l()(this,n)}}var y=function(e){u()(n,e);var t=p(n);function n(e){var n;return(n=t.call(this,e.options)).vault=e,n}return n.prototype.addressFromBase=function(){var e=i()((function*(e){return this.vault.addressFromBase(e)}));return function(t){return e.apply(this,arguments)}}(),a()(n)}(n(1585).VaultContext),h=function(e){u()(n,e);var t=p(n);function n(){return t.apply(this,arguments)}return a()(n)}(y)},3905:function(e,t,n){"use strict";n.r(t),n.d(t,"KeyringSoftwareBase",(function(){return T}));var r=n(4),i=n.n(r),o=n(3),a=n.n(o),c=n(2),u=n.n(c),s=n(6),l=n.n(s),d=n(9),f=n.n(d),p=n(14),y=n.n(p),h=n(7),v=n.n(h),g=n(19),w=n(23);function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach((function(t){a()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function O(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=v()(e);if(t){var i=v()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return y()(this,n)}}var T=function(e){f()(n,e);var t=O(n);function n(){return t.apply(this,arguments)}var r=n.prototype;return r.signTransaction=function(){var e=u()((function*(e,t){var n=t.password;if("undefined"===typeof n)throw new w.OneKeyInternalError("Software signing requires a password.");var r=yield this.getSigners(n,e.inputs.map((function(e){return e.address})));return g.default.engine.info("signTransaction",this.networkId,e),b(b({},yield this.engine.providerManager.signTransaction(this.networkId,e,r)),{},{encodedTx:e.encodedTx})}));return function(t,n){return e.apply(this,arguments)}}(),r.signMessage=function(){var e=u()((function*(e,t){var n=this,r=t.password;if("undefined"===typeof r)throw new w.OneKeyInternalError("Software signing requires a password.");var o=yield this.getDbAccount(),a=Object.values(yield this.getSigners(r,[o.address])),c=i()(a,1)[0];return g.default.engine.info("signMessage",this.networkId,e),Promise.all(e.map((function(e){return n.engine.providerManager.signMessage(n.networkId,e,c)})))}));return function(t,n){return e.apply(this,arguments)}}(),r.getAddress=function(){throw new Error("Method not implemented.")},r.batchGetAddress=function(){throw new Error("Method not implemented.")},r.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},l()(n)}(n(3903).KeyringBase)},3912:function(e,t,n){"use strict";n.r(t),function(e){n.d(t,"VaultBaseChainOnly",(function(){return R})),n.d(t,"VaultBase",(function(){return K}));var r=n(202),i=n.n(r),o=n(3),a=n.n(o),c=n(60),u=n.n(c),s=n(2),l=n.n(s),d=n(6),f=n.n(d),p=n(9),y=n.n(p),h=n(14),v=n.n(h),g=n(7),w=n.n(g),m=n(21),b=n.n(m),O=n(167),T=n.n(O),I=n(11),E=n(19),x=n(24),A=n(68),P=n(23),j=n(182),S=n(947),C=n(52),k=n(1585);function D(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function B(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?D(Object(n),!0).forEach((function(t){a()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):D(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function N(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=w()(e);if(t){var i=w()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return v()(this,n)}}if(x.default.isExtensionUi)throw new Error("engine/VaultBase is not allowed imported from ui");var R=function(e){y()(n,e);var t=N(n);function n(){return t.apply(this,arguments)}var r=n.prototype;return r.initProvider=function(){var e=l()((function*(){var e=(yield this.getNetwork()).impl;u()(S.IMPL_MAPPINGS[e])||(this.engineProvider=yield this.engine.providerManager.getProvider(this.networkId))}));return function(){return e.apply(this,arguments)}}(),r.proxyJsonRPCCall=function(){var e=l()((function*(e){throw new P.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),r.createClientFromURL=function(e){throw new P.NotImplemented},r.getEthersProvider=function(){var e=l()((function*(){throw new P.NotImplemented}));return function(){return e.apply(this,arguments)}}(),r.getClientEndpointStatus=function(){var e=l()((function*(e){var t=this.createClientFromURL(e),n=performance.now(),r=(yield t.getInfo()).bestBlockNumber;return{responseTime:Math.floor(performance.now()-n),latestBlock:r}}));return function(t){return e.apply(this,arguments)}}(),r.checkRpcBatchSupport=function(){var e=l()((function*(e){throw new P.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),r.getDisplayAddress=function(){var e=l()((function*(e){return Promise.resolve(e)}));return function(t){return e.apply(this,arguments)}}(),r.validateAddress=function(){var e=l()((function*(e){var t=yield this.engineProvider.verifyAddress(e),n=t.normalizedAddress;if(!t.isValid||!n)throw new P.InvalidAddress;return Promise.resolve(n)}));return function(t){return e.apply(this,arguments)}}(),r.validateImportedCredential=function(e){return Promise.resolve(this.settings.importedAccountEnabled&&/^(0x)?[0-9a-zA-Z]{64}$/.test(e))},r.validateWatchingCredential=function(){var e=l()((function*(e){return Promise.resolve(this.settings.watchingAccountEnabled&&(yield this.engineProvider.verifyAddress(e)).isValid)}));return function(t){return e.apply(this,arguments)}}(),r.validateTokenAddress=function(){var e=l()((function*(e){var t=yield this.engineProvider.verifyTokenAddress(e),n=t.normalizedAddress;if(!t.isValid||"undefined"===typeof n)throw new P.InvalidTokenAddress;return Promise.resolve(n)}));return function(t){return e.apply(this,arguments)}}(),r.validateCanCreateNextAccount=function(){var e=l()((function*(e,t){return Promise.resolve(!0)}));return function(t,n){return e.apply(this,arguments)}}(),r.checkAccountExistence=function(){var e=l()((function*(e,t){return Promise.resolve(!0)}));return function(t,n){return e.apply(this,arguments)}}(),r.getBalances=function(){var e=l()((function*(e,t,n){return(yield this.engine.providerManager.getClient(this.networkId)).getBalances(e.map((function(e){var t=e.address,n=e.tokenAddress;return{address:t,coin:B({},"string"===typeof n?{tokenAddress:n}:{})}})))}));return function(t,n,r){return e.apply(this,arguments)}}(),r.getFrozenBalance=function(){var e=l()((function*(e){return 0}));return function(t){return e.apply(this,arguments)}}(),r.fetchBalanceDetails=function(){var e=l()((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.password;return Promise.resolve(void 0)}));return function(){return e.apply(this,arguments)}}(),r.getTransactionStatuses=function(e){return this.engine.providerManager.getTransactionStatuses(this.networkId,e)},r.getTransactionFeeInNative=function(e){return Promise.resolve("")},r.isContractAddress=function(){var e=l()((function*(e){return!1}));return function(t){return e.apply(this,arguments)}}(),r.getAccountNameInfoMap=function(){var e=l()((function*(){var e=yield this.getNetwork();return Object(j.getAccountNameInfoByImpl)(e.impl)}));return function(){return e.apply(this,arguments)}}(),r.canAutoCreateNextAccount=function(){var e=l()((function*(e){return Promise.resolve(!1)}));return function(t){return e.apply(this,arguments)}}(),r.filterAccounts=function(){var e=l()((function*(e){var t=e.accounts;e.networkId;return Promise.resolve(t)}));return function(t){return e.apply(this,arguments)}}(),r.shouldChangeAccountWhenNetworkChanged=function(){var e=l()((function*(e){e.previousNetwork,e.newNetwork,e.activeAccountId;return Promise.resolve({shouldReloadAccountList:!1,shouldChangeActiveAccount:!1})}));return function(t){return e.apply(this,arguments)}}(),r.getAccountNameInfosByImportedOrWatchingCredential=function(){var e=l()((function*(e){return Promise.resolve([])}));return function(t){return e.apply(this,arguments)}}(),r.checkIsUnlimitedAllowance=function(){var e=l()((function*(e){throw new P.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),r.checkIsApprovedForAll=function(){var e=l()((function*(e){throw new P.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),r.checkIsBatchTransfer=function(){var e=l()((function*(e){throw new P.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),r.getFeePricePerUnit=function(){var e=l()((function*(){throw new P.NotImplemented}));return function(){return e.apply(this,arguments)}}(),r.fetchRpcChainId=function(){var e=l()((function*(e){return null}));return function(t){return e.apply(this,arguments)}}(),r.getTxWaitingSeconds=function(){var e=l()((function*(){return[]}));return function(){return e.apply(this,arguments)}}(),r.getUserNFTAssets=function(){var e=l()((function*(e){e.serviceData;return Promise.resolve(void 0)}));return function(t){return e.apply(this,arguments)}}(),f()(n)}(k.VaultContext),K=function(t){y()(r,t);var n=N(r);function r(){for(var e,t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return(e=n.call.apply(n,[this].concat(r))).uuid=T.a.v4().toString(),e}var o=r.prototype;return o.init=function(){var e=l()((function*(e){yield this.initProvider(),yield this.initKeyring(e)}));return function(t){return e.apply(this,arguments)}}(),o.initKeyring=function(){var e=l()((function*(e){this.keyring=yield e.keyringCreator(this)}));return function(t){return e.apply(this,arguments)}}(),o.signTransaction=function(){var e=l()((function*(e,t){return this.keyring.signTransaction(e,t)}));return function(t,n){return e.apply(this,arguments)}}(),o.signAndSendTransaction=function(){var e=l()((function*(e,t,n){var r=yield this.signTransaction(e,t);return n?B(B({},r),{},{encodedTx:e.encodedTx}):this.broadcastTransaction(B(B({},r),{},{encodedTx:e.encodedTx}))}));return function(t,n,r){return e.apply(this,arguments)}}(),o.broadcastTransaction=function(){var e=l()((function*(e,t){E.default.engine.info("broadcastTransaction START:",{rawTx:e.rawTx});var n=yield this.engine.providerManager.broadcastTransaction(this.networkId,e.rawTx,t);return E.default.engine.info("broadcastTransaction END:",{txid:n,rawTx:e.rawTx}),B(B({},e),{},{txid:n,encodedTx:e.encodedTx})}));return function(t,n){return e.apply(this,arguments)}}(),o.buildEncodedTxFromBatchTransfer=function(){var e=l()((function*(e){throw new P.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),o.buildEncodedTxsFromSetApproveForAll=function(){var e=l()((function*(e,t){throw new P.NotImplemented}));return function(t,n){return e.apply(this,arguments)}}(),o.activateAccount=function(){var e=l()((function*(){throw new P.NotImplemented}));return function(){return e.apply(this,arguments)}}(),o.activateToken=function(){var e=l()((function*(e,t){throw new P.NotImplemented}));return function(t,n){return e.apply(this,arguments)}}(),o.getTokenAllowance=function(){var e=l()((function*(e,t){throw new P.NotImplemented}));return function(t,n){return e.apply(this,arguments)}}(),o.batchTokensAllowance=function(){var e=l()((function*(e,t){throw new P.NotImplemented}));return function(t,n){return e.apply(this,arguments)}}(),o.getOutputAccount=function(){var e=l()((function*(){var e=yield this.getDbAccount({noCache:!0});return{id:e.id,name:e.name,type:e.type,path:e.path,coinType:e.coinType,tokens:[],address:e.address,template:e.template,pubKey:i()(e,"pub","")}}));return function(){return e.apply(this,arguments)}}(),o.getAccountBalance=function(){var e=l()((function*(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,i=yield this.getDbAccount(),o=i.address;return this.getBalances((t?[{address:o}]:[]).concat(e.map((function(e){return{address:o,tokenAddress:e}}))),n,r)}));return function(t){return e.apply(this,arguments)}}(),o.updatePendingTxs=function(){var e=l()((function*(e){throw new P.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),o.getAccountNonce=function(){var e=l()((function*(){return Promise.resolve(null)}));return function(){return e.apply(this,arguments)}}(),o.fixActionDirection=function(){var e=l()((function*(e){var t,n,r,i,o=e.action,a=e.accountAddress;(o.direction=C.IDecodedTxDirection.OTHER,o.type===C.IDecodedTxActionType.NATIVE_TRANSFER)&&(o.direction=yield this.buildTxActionDirection({from:(null==(t=o.nativeTransfer)?void 0:t.from)||"",to:(null==(n=o.nativeTransfer)?void 0:n.to)||"",address:a}));o.type===C.IDecodedTxActionType.TOKEN_TRANSFER&&(o.direction=yield this.buildTxActionDirection({from:(null==(r=o.tokenTransfer)?void 0:r.from)||"",to:(null==(i=o.tokenTransfer)?void 0:i.to)||"",address:a}));return o}));return function(t){return e.apply(this,arguments)}}(),o.fixDecodedTx=function(){var e=l()((function*(e){var t,n;e.createdAt=null!=(t=e.createdAt)?t:Date.now();var r=null==(n=e.encodedTx)?void 0:n.nonce;e.nonce=u()(r)?e.nonce:new b.a(r).toNumber();for(var i=e.owner,o=0;o<e.actions.length;o+=1){var a=e.actions[o];yield this.fixActionDirection({action:a,accountAddress:i})}if(e.outputActions)for(var c=0;c<e.outputActions.length;c+=1){var s=e.outputActions[c];yield this.fixActionDirection({action:s,accountAddress:i})}return Promise.resolve(e)}));return function(t){return e.apply(this,arguments)}}(),o.fixHistoryTx=function(){var e=l()((function*(e){return e.decodedTx=yield this.fixDecodedTx(e.decodedTx),Promise.resolve(e)}));return function(t){return e.apply(this,arguments)}}(),o.buildHistoryTx=function(){var e=l()((function*(e){var t=e.historyTxToMerge,n=(e.encodedTx,e.decodedTx),r=e.signedTx,i=e.isSigner,o=e.isLocalCreated,a=(null==r?void 0:r.txid)||(null==n?void 0:n.txid)||"";if(!a)throw new Error("buildHistoryTx txid not found");var c=yield this.getAccountAddress();n.txid=a||n.txid,n.owner=c,i&&(n.signer=c),null!=r&&r.txKey&&(n.extraInfo?n.extraInfo.txKey=r.txKey:n.extraInfo={txKey:r.txKey});var u=B(B({id:this.networkId+"_"+a+"_"+this.accountId,isLocalCreated:Boolean(o)},t),{},{decodedTx:n});return u=yield this.fixHistoryTx(u),Promise.resolve(u)}));return function(t){return e.apply(this,arguments)}}(),o.checkIsScamHistoryTx=function(){var e=l()((function*(e){return!1}));return function(t){return e.apply(this,arguments)}}(),o.fetchOnChainHistory=function(){var e=l()((function*(e){throw new P.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),o.fixAddressCase=function(e){return Promise.resolve(e)},o.buildTxActionDirection=function(){var e=l()((function*(e){var t=e.from,n=e.to,r=e.address;return t=yield this.fixAddressCase(t||""),n=yield this.fixAddressCase(n),r=yield this.fixAddressCase(r),t===n&&t===r?C.IDecodedTxDirection.SELF:t&&t===r?C.IDecodedTxDirection.OUT:n&&n===r?C.IDecodedTxDirection.IN:C.IDecodedTxDirection.OTHER}));return function(t){return e.apply(this,arguments)}}(),o.getNextNonce=function(){var e=l()((function*(e,t){var n,r,i=null!=(n=null==(r=(yield this.engine.providerManager.getAddresses(e,[t.address]))[0])?void 0:r.nonce)?n:0,o=(yield this.engine.getHistory(e,t.id,void 0,!1),yield A.default.history.getMaxPendingNonce({accountId:this.accountId,networkId:e})),a=yield A.default.history.getPendingNonceList({accountId:this.accountId,networkId:e}),c=Math.max(u()(o)?0:o+1,i);if(Number.isNaN(c)&&(c=i),c>i)for(var s=i;s<c;s+=1)if(!a.includes(s)){c=s;break}if(c<i&&(c=i),c-i>=I.HISTORY_CONSTS.PENDING_QUEUE_MAX_LENGTH)throw new P.PendingQueueTooLong(I.HISTORY_CONSTS.PENDING_QUEUE_MAX_LENGTH);return c}));return function(t,n){return e.apply(this,arguments)}}(),o.validateSendAmount=function(e,t,n){return Promise.resolve(!0)},o.notifyChainChanged=function(e,t){},o.getFetchBalanceAddress=function(e){return Promise.resolve(e.address)},o.getPrivateKeyByCredential=function(t){return Promise.resolve(e.from(t.startsWith("0x")?t.slice(2):t,"hex"))},o.getMinDepositAmount=function(){var e=l()((function*(){return"0"}));return function(){return e.apply(this,arguments)}}(),o.specialCheckEncodedTx=function(){var e=l()((function*(e){return{success:!0}}));return function(t){return e.apply(this,arguments)}}(),o.getAllUsedAddress=function(){var e=l()((function*(){return Promise.resolve([])}));return function(){return e.apply(this,arguments)}}(),f()(r)}(R)}.call(this,n(26).Buffer)},3913:function(e,t,n){"use strict";n.r(t),function(e){n.d(t,"KeyringHardwareBase",(function(){return v}));var r=n(2),i=n.n(r),o=n(6),a=n.n(o),c=n(9),u=n.n(c),s=n(14),l=n.n(s),d=n(7),f=n.n(d),p=n(431),y=n(163);function h(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f()(e);if(t){var i=f()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return l()(this,n)}}var v=function(t){u()(r,t);var n=h(r);function r(){return n.apply(this,arguments)}var o=r.prototype;return o.getHardwareInfo=function(){var e=i()((function*(){var e,t,n,r=yield this.engine.getHWDeviceByWalletId(this.vault.walletId);return{connectId:null!=(e=null==r?void 0:r.mac)?e:"",deviceId:null!=(t=null==r?void 0:r.deviceId)?t:"",deviceType:null!=(n=null==r?void 0:r.deviceType)?n:""}}));return function(){return e.apply(this,arguments)}}(),o.getWalletPassphraseState=function(){var e=i()((function*(){var e=yield this.engine.getWallet(this.vault.walletId);return{passphraseState:null==e?void 0:e.passphraseState,useEmptyPassphrase:!Object(y.isPassphraseWallet)(e)}}));return function(){return e.apply(this,arguments)}}(),o.getHardwareSDKInstance=function(){var t=i()((function*(){var t,n,r,i,o;return null!=(o=yield null==(t=e)||null==(n=t.$backgroundApiProxy)||null==(r=n.backgroundApi)||null==(i=r.serviceHardware)||null==i.getSDKInstance?void 0:i.getSDKInstance())?o:p.HardwareSDK}));return function(){return t.apply(this,arguments)}}(),o.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},a()(r)}(n(3903).KeyringBase)}.call(this,n(58))},3914:function(e,t,n){"use strict";n.r(t),n.d(t,"KeyringHdBase",(function(){return b}));var r=n(3),i=n.n(r),o=n(2),a=n.n(o),c=n(6),u=n.n(c),s=n(9),l=n.n(s),d=n(14),f=n.n(d),p=n(7),y=n.n(p),h=n(610),v=n(23);function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function w(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function m(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=y()(e);if(t){var i=y()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f()(this,n)}}var b=function(e){l()(n,e);var t=m(n);function n(){return t.apply(this,arguments)}var r=n.prototype;return r.getPrivateKeys=function(){var e=a()((function*(e,t){var n=(yield this.getDbAccount()).path.split("/"),r=t||[n.pop()],i=n.join("/"),o=(yield this.engine.dbApi.getCredential(this.walletId,e)).seed;if("undefined"===typeof o)throw new v.OneKeyInternalError("Unable to get credential.");var a=(yield this.engine.providerManager.getChainInfoByNetworkId(this.networkId)).curve;return Object(h.batchGetPrivateKeys)(a,o,e,i,r).reduce((function(e,t){var n;return w(w({},e),{},((n={})[t.path]=t.extendedKey.key,n))}),{})}));return function(t,n){return e.apply(this,arguments)}}(),r.getAddress=function(){throw new Error("Method not implemented.")},r.batchGetAddress=function(){throw new Error("Method not implemented.")},r.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},u()(n)}(n(3905).KeyringSoftwareBase)},3915:function(e,t,n){"use strict";n.r(t),n.d(t,"KeyringImportedBase",(function(){return h}));var r=n(2),i=n.n(r),o=n(6),a=n.n(o),c=n(9),u=n.n(c),s=n(14),l=n.n(s),d=n(7),f=n.n(d),p=n(23);function y(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f()(e);if(t){var i=f()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return l()(this,n)}}var h=function(e){u()(n,e);var t=y(n);function n(){return t.apply(this,arguments)}var r=n.prototype;return r.getPrivateKeys=function(){var e=i()((function*(e,t){if("undefined"!==typeof t)throw new p.NotImplemented("Getting private keys from extended private key");var n=(yield this.engine.dbApi.getCredential(this.accountId,e)).privateKey;if("undefined"===typeof n)throw new p.OneKeyInternalError("Unable to get credential.");return{"":n}}));return function(t,n){return e.apply(this,arguments)}}(),r.getAddress=function(){throw new Error("Method not implemented.")},r.batchGetAddress=function(){throw new Error("Method not implemented.")},r.prepareAccountByAddressIndex=function(){throw new Error("Method not implemented.")},a()(n)}(n(3905).KeyringSoftwareBase)},3916:function(e,t,n){"use strict";n.r(t),n.d(t,"KeyringWatchingBase",(function(){return h}));var r=n(2),i=n.n(r),o=n(6),a=n.n(o),c=n(9),u=n.n(c),s=n(14),l=n.n(s),d=n(7),f=n.n(d),p=n(23);function y(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f()(e);if(t){var i=f()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return l()(this,n)}}var h=function(e){u()(n,e);var t=y(n);function n(){return t.apply(this,arguments)}var r=n.prototype;return r.signTransaction=function(){var e=i()((function*(e,t){throw new p.OneKeyInternalError("signTransaction is not supported for watching accounts")}));return function(t,n){return e.apply(this,arguments)}}(),r.signMessage=function(){var e=i()((function*(e,t){throw new p.OneKeyInternalError("signMessage is not supported for watching accounts")}));return function(t,n){return e.apply(this,arguments)}}(),r.getAddress=function(){throw new Error("Method not implemented.")},r.batchGetAddress=function(){throw new Error("Method not implemented.")},r.prepareAccountByAddressIndex=function(){throw new Error("Method not implemented.")},a()(n)}(n(3903).KeyringBase)},3918:function(e,t,n){"use strict";n.r(t),n.d(t,"convertDeviceError",(function(){return c}));var r=n(70),i=n(90),o=n(19);n(24);function a(e,t){return"string"!==typeof t?null:e===r.HardwareErrorCode.DeviceInitializeFailed&&t.includes("ECONNABORTED")?new i.ConnectTimeoutError({message:t}):t.includes("Bridge network error")?new i.BridgeNetworkError({message:t}):null}function c(e){var t,n=e||{},c=n.code,u=n.error,s=n.message,l=null!=(t=null!=u?u:s)?t:"Unknown error";if(a(c,l))return a(c,l);switch(o.default.hardwareSDK.info("Device Utils Convert Device Error:",c,l),c){case r.HardwareErrorCode.UnknownError:return new i.UnknownHardwareError(e);case r.HardwareErrorCode.DeviceFwException:return new i.FirmwareVersionTooLow(e);case r.HardwareErrorCode.DeviceUnexpectedMode:return"string"===typeof l&&-1!==l.indexOf("ui-device_bootloader_mode")?new i.NotInBootLoaderMode(e):new i.UnknownHardwareError(e);case r.HardwareErrorCode.DeviceCheckDeviceIdError:return new i.DeviceNotSame(e);case r.HardwareErrorCode.DeviceNotFound:return new i.DeviceNotFind(e);case r.HardwareErrorCode.DeviceUnexpectedBootloaderMode:return new i.NotInBootLoaderMode(e);case r.HardwareErrorCode.DeviceInterruptedFromOutside:case r.HardwareErrorCode.DeviceInterruptedFromUser:return new i.UserCancelFromOutside(e);case r.HardwareErrorCode.DeviceNotSupportPassphrase:return new i.NotSupportPassphraseError(e);case r.HardwareErrorCode.IFrameLoadFail:return new i.InitIframeLoadFail(e);case r.HardwareErrorCode.IframeTimeout:return new i.InitIframeTimeout(e);case r.HardwareErrorCode.FirmwareUpdateDownloadFailed:return new i.FirmwareDownloadFailed(e);case r.HardwareErrorCode.FirmwareUpdateManuallyEnterBoot:return new i.FirmwareUpdateManuallyEnterBoot(e);case r.HardwareErrorCode.FirmwareUpdateAutoEnterBootFailure:return new i.FirmwareUpdateAutoEnterBootFailure(e);case r.HardwareErrorCode.FirmwareUpdateLimitOneDevice:return new i.FirmwareUpdateLimitOneDevice(e);case r.HardwareErrorCode.CallMethodNeedUpgradeFirmware:return new i.FirmwareVersionTooLow(e);case r.HardwareErrorCode.NewFirmwareUnRelease:return new i.NewFirmwareUnRelease(e);case r.HardwareErrorCode.NewFirmwareForceUpdate:return new i.NewFirmwareForceUpdate(e);case r.HardwareErrorCode.NetworkError:return new i.NetworkError(e);case r.HardwareErrorCode.BlePermissionError:return new i.NeedBluetoothTurnedOn(e);case r.HardwareErrorCode.BleLocationError:return new i.NeedBluetoothPermissions({message:l});case r.HardwareErrorCode.BleLocationServicesDisabled:return new i.BleLocationServiceError({message:l});case r.HardwareErrorCode.BleDeviceNotBonded:return new i.DeviceNotBonded(e);case r.HardwareErrorCode.BleDeviceBondError:return new i.DeviceBondError(e);case r.HardwareErrorCode.BleWriteCharacteristicError:return new i.BleWriteCharacteristicError(e);case r.HardwareErrorCode.BleScanError:return new i.BleScanError({message:l});case r.HardwareErrorCode.BleAlreadyConnected:return new i.BleAlreadyConnectedError(e);case r.HardwareErrorCode.RuntimeError:return-1!==l.indexOf("EIP712 blind sign is disabled")?new i.OpenBlindSign(e):-1!==l.indexOf("Unknown message")||-1!==l.indexOf("Failure_UnexpectedMessage")?new i.UnknownMethod(e):new i.UnknownHardwareError(e);case r.HardwareErrorCode.PinInvalid:return new i.InvalidPIN(e);case r.HardwareErrorCode.DeviceCheckPassphraseStateError:return new i.InvalidPassphrase(e);case r.HardwareErrorCode.DeviceOpenedPassphrase:return new i.DeviceOpenedPassphrase(e);case r.HardwareErrorCode.DeviceNotOpenedPassphrase:return new i.DeviceNotOpenedPassphrase(e);case r.HardwareErrorCode.PinCancelled:case r.HardwareErrorCode.ActionCancelled:return new i.UserCancel(e);case r.HardwareErrorCode.BridgeNotInstalled:case i.CustomOneKeyHardwareError.NeedOneKeyBridge:return new i.NeedOneKeyBridge(e);case r.HardwareErrorCode.BridgeNetworkError:return new i.BridgeNetworkError(e);case r.HardwareErrorCode.BridgeTimeoutError:return new i.BridgeTimeoutError(e);case r.HardwareErrorCode.PollingTimeout:return new i.ConnectTimeoutError(e);case r.HardwareErrorCode.PollingStop:return new i.ConnectPollingStopError(e);case r.HardwareErrorCode.BlindSignDisabled:return new i.OpenBlindSign(e);case r.HardwareErrorCode.FileAlreadyExists:return new i.FileAlreadyExistError(e);case r.HardwareErrorCode.CheckDownloadFileError:return new i.IncompleteFileError(e);case r.HardwareErrorCode.NotInSigningMode:return new i.NotInSigningModeError(e);default:return new i.UnknownHardwareError(e)}}},4010:function(e,t,n){"use strict";n.r(t),n.d(t,"APTOS_SIGN_MESSAGE_PREFIX",(function(){return s})),n.d(t,"ED25519_PUBLIC_KEY_SIZE",(function(){return l})),n.d(t,"SECP256K1_PUBLIC_KEY_SIZE",(function(){return d})),n.d(t,"DEFAULT_GAS_BUDGET_FOR_PAY",(function(){return f})),n.d(t,"DEFAULT_GAS_BUDGET_FOR_STAKE",(function(){return p})),n.d(t,"GAS_SAFE_OVERHEAD",(function(){return y})),n.d(t,"GAS_TYPE_ARG",(function(){return h})),n.d(t,"GAS_SYMBOL",(function(){return v})),n.d(t,"DEFAULT_NFT_TRANSFER_GAS_FEE",(function(){return g})),n.d(t,"SUI_SYSTEM_STATE_OBJECT_ID",(function(){return w})),n.d(t,"SUI_NATIVE_COIN",(function(){return m})),n.d(t,"handleSignData",(function(){return b})),n.d(t,"toTransaction",(function(){return O})),n.d(t,"computeGasBudget",(function(){return I})),n.d(t,"deduplicate",(function(){return E})),n.d(t,"moveCallTxnName",(function(){return x})),n.d(t,"dryRunTransactionBlock",(function(){return A})),n.d(t,"normalizeSuiCoinType",(function(){return j}));var r=n(4),i=n.n(r),o=n(2),a=n.n(o),c=n(1352),u=n(566),s="APTOS",l=32,d=33,f=150,p=1e4,y=1e3,h="0x2::sui::SUI",v="SUI",g=450,w="0x0000000000000000000000000000000000000005",m=c.SUI_TYPE_ARG;function b(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=Object(c.messageWithIntent)(c.IntentScope.TransactionData,e);return t?n:Object(u.blake2b)(n,{dkLen:32})}function O(e,t,n){return T.apply(this,arguments)}function T(){return(T=a()((function*(e,t,n){var r;if(n instanceof Uint8Array)r=n;else{var i=c.TransactionBlock.from(n.rawTx);i.setSenderIfNotSet(t),r=yield i.build({provider:e})}return r}))).apply(this,arguments)}function I(e){return f*Math.max(2,Math.min(100,e/2))}var E=function(e){return e?e.filter((function(e,t,n){return n.indexOf(e)===t})):[]},x=function(e){return e?e.replace(/_/g," "):""};function A(e){return P.apply(this,arguments)}function P(){return(P=a()((function*(e){var t;if(c.TransactionBlock.is(e.transactionBlock))e.transactionBlock.setSenderIfNotSet(e.sender),t=yield e.transactionBlock.build({provider:e.provider});else if("string"===typeof e.transactionBlock)t=Object(c.fromB64)(e.transactionBlock);else{if(!(e.transactionBlock instanceof Uint8Array))throw new Error("Unknown transaction format");t=e.transactionBlock}return e.provider.dryRunTransactionBlock({transactionBlock:t})}))).apply(this,arguments)}function j(e){if(e!==c.SUI_TYPE_ARG){var t=e.split("::"),n=i()(t,3),r=n[0],o=n[1],a=n[2];if(o&&a)try{return Object(c.normalizeSuiAddress)(r).toLowerCase()+"::"+o+"::"+a}catch(u){}}return e}},4926:function(e,t,n){"use strict";n.r(t),function(e){n.d(t,"KeyringHardware",(function(){return S}));var r=n(3),i=n.n(r),o=n(2),a=n.n(o),c=n(6),u=n.n(c),s=n(9),l=n.n(s),d=n(14),f=n.n(d),p=n(7),y=n.n(p),h=n(1352),v=n(73),g=n(3918),w=n(11),m=n(19),b=n(23),O=n(117),T=n(3913),I=n(303),E=n(4010);function x(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function A(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?x(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):x(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function P(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=y()(e);if(t){var i=y()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f()(this,n)}}var j="m/44'/"+w.COINTYPE_SUI+"'",S=function(t){l()(r,t);var n=P(r);function r(){return n.apply(this,arguments)}var i=r.prototype;return i.getPublicKey=function(){var e=a()((function*(e,t,n){var r,i=yield this.getHardwareSDKInstance(),o=yield this.getWalletPassphraseState();try{r=yield i.suiGetPublicKey(e,t,A({bundle:n.map((function(e){return{path:e}}))},o))}catch(a){throw m.default.common.error(a),new b.OneKeyHardwareError(a)}if(!r.success)throw m.default.common.error(r.payload),Object(g.convertDeviceError)(r.payload);return r.payload.map((function(e){return e.publicKey})).filter((function(e){return!!e}))}));return function(t,n,r){return e.apply(this,arguments)}}(),i.prepareAccounts=function(){var e=a()((function*(e){var t,n=e.type,r=e.indexes,i=e.names,o=r.map((function(e){return j+"/"+e+"'/0'/0'"})),a="SEARCH_ACCOUNTS"===n,c=yield this.getHardwareSDKInstance(),u=yield this.getHardwareInfo(),s=u.connectId,l=u.deviceId,d=yield this.getWalletPassphraseState();try{t=yield c.suiGetAddress(s,l,A({bundle:o.map((function(e){return{path:e,showOnOneKey:!1}}))},d))}catch(C){throw m.default.common.error(C),new b.OneKeyHardwareError(C)}if(!t.success)throw m.default.common.error(t.payload),Object(g.convertDeviceError)(t.payload);var f,p,y=[];a||(!(null==(f=t.payload)||null==(p=f[0])||!p.publicKey)||(y=yield this.getPublicKey(s,l,o)));var h=[],v=0;for(var T of t.payload){var E=T.address,x=T.path,P=T.publicKey;if(E){var S=(i||[])[v]||"SUI #"+(r[v]+1);h.push({id:this.walletId+"--"+x,name:S,type:O.AccountType.SIMPLE,path:x,coinType:w.COINTYPE_SUI,pub:null!=P?P:y[v]||"",address:Object(I.addHexPrefix)(E)}),v+=1}}return h}));return function(t){return e.apply(this,arguments)}}(),i.getAddress=function(){var e=a()((function*(e){var t,n=yield this.getHardwareSDKInstance(),r=yield this.getHardwareInfo(),i=r.connectId,o=r.deviceId,a=yield this.getWalletPassphraseState(),c=yield n.suiGetAddress(i,o,A({path:e.path,showOnOneKey:e.showOnOneKey},a));if(c.success&&null!=(t=c.payload)&&t.address)return c.payload.address.toLowerCase();throw Object(g.convertDeviceError)(c.payload)}));return function(t){return e.apply(this,arguments)}}(),i.batchGetAddress=function(){var e=a()((function*(e){var t=yield this.getHardwareSDKInstance(),n=yield this.getHardwareInfo(),r=n.connectId,i=n.deviceId,o=yield this.getWalletPassphraseState(),a=yield t.suiGetAddress(r,i,A(A({},o),{},{bundle:e.map((function(e){return{path:e.path,showOnOneKey:!!e.showOnOneKey}}))}));if(!a.success)throw Object(g.convertDeviceError)(a.payload);return a.payload.map((function(e){var t,n;return{path:null!=(t=e.path)?t:"",address:null!=(n=e.address)?n:""}}))}));return function(t){return e.apply(this,arguments)}}(),i.signTransaction=function(){var t=a()((function*(t,n){var r,i;m.default.common.info("signTransaction",t);var o=yield this.getDbAccount(),a=(yield this.engine.getNetwork(this.networkId)).rpcURL,c=new h.JsonRpcProvider(new h.Connection({fullnode:a})),u=o.address,s=null==(r=t.inputs)||null==(i=r[0])?void 0:i.publicKey;if(!s)throw new b.OneKeyInternalError("Unable to get sender public key.");var l=t.payload.encodedTx,d=yield Object(E.toTransaction)(c,u,l),f=Object(E.handleSignData)(d,!0),p=yield this.getHardwareInfo(),y=p.connectId,w=p.deviceId,O=yield this.getWalletPassphraseState(),T=yield this.getHardwareSDKInstance(),x=yield T.suiSignTransaction(y,w,A({path:o.path,rawTx:Object(I.hexlify)(e.from(f))},O));if(x.success){var P=x.payload.signature,j=Object(h.toSerializedSignature)({signatureScheme:"ED25519",signature:Object(v.hexToBytes)(P),pubKey:new h.Ed25519PublicKey(Object(v.hexToBytes)(s))});return{txid:"",rawTx:Object(h.toB64)(d),signatureScheme:"ed25519",signature:j,publicKey:Object(I.addHexPrefix)(s)}}throw Object(g.convertDeviceError)(x.payload)}));return function(e,n){return t.apply(this,arguments)}}(),i.signMessage=function(){var e=a()((function*(e,t){return m.default.common.info("signMessage",e),Promise.reject(new Error("Not implemented"))}));return function(t,n){return e.apply(this,arguments)}}(),u()(r)}(T.KeyringHardwareBase)}.call(this,n(26).Buffer)},4927:function(e,t,n){"use strict";n.r(t),function(e){n.d(t,"KeyringHd",(function(){return S}));var r=n(4),i=n.n(r),o=n(2),a=n.n(o),c=n(6),u=n.n(c),s=n(9),l=n.n(s),d=n(14),f=n.n(d),p=n(7),y=n.n(p),h=n(1352),v=n(566),g=n(73),w=n(610),m=n(11),b=n(19),O=n(23),T=n(1345),I=n(117),E=n(3914),x=n(303),A=n(4010);function P(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=y()(e);if(t){var i=y()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f()(this,n)}}var j="m/44'/"+m.COINTYPE_SUI+"'",S=function(t){l()(r,t);var n=P(r);function r(){return n.apply(this,arguments)}var o=r.prototype;return o.getSigners=function(){var e=a()((function*(e,t){var n,r=yield this.getDbAccount();if(1!==t.length)throw new O.OneKeyInternalError("Sui signers number should be 1.");if(t[0]!==r.address)throw new O.OneKeyInternalError("Wrong address required for signing.");var i=(yield this.getPrivateKeys(e))[r.path];if("undefined"===typeof i)throw new O.OneKeyInternalError("Unable to get signer.");return(n={})[r.address]=new T.Signer(i,e,"ed25519"),n}));return function(t,n){return e.apply(this,arguments)}}(),o.prepareAccounts=function(){var e=a()((function*(e){var t=e.password,n=e.indexes,r=e.names,i=(yield this.engine.dbApi.getCredential(this.walletId,t)).seed,o=Object(w.batchGetPublicKeys)("ed25519",i,t,j,n.map((function(e){return e.toString()+"'/0'/0'"})));if(o.length!==n.length)throw new O.OneKeyInternalError("Unable to get publick key.");var a=[],c=0;for(var u of o){var s=u.path,l=u.extendedKey.key,d=l.toString("hex"),f=new h.Ed25519PublicKey(l),p=Object(x.addHexPrefix)(f.toSuiAddress()),y=(r||[])[c]||"SUI #"+(n[c]+1);a.push({id:this.walletId+"--"+s,name:y,type:I.AccountType.SIMPLE,path:s,coinType:m.COINTYPE_SUI,pub:d,address:p}),c+=1}return a}));return function(t){return e.apply(this,arguments)}}(),o.signTransaction=function(){var t=a()((function*(t,n){var r,o;b.default.common.info("signTransaction result",t);var a=yield this.getDbAccount(),c=(yield this.engine.getNetwork(this.networkId)).rpcURL,u=new h.JsonRpcProvider(new h.Connection({fullnode:c})),s=a.address,l=(yield this.getSigners(n.password||"",[s]))[s],d=null==(r=t.inputs)||null==(o=r[0])?void 0:o.publicKey;if(!d)throw new O.OneKeyInternalError("Unable to get sender public key.");var f=t.payload.encodedTx,p=yield Object(A.toTransaction)(u,s,f),y=yield l.sign(e.from(Object(A.handleSignData)(p))),v=i()(y,1)[0],w=Object(h.toSerializedSignature)({signatureScheme:"ED25519",signature:v,pubKey:new h.Ed25519PublicKey(Object(g.hexToBytes)(d))});return{txid:"",rawTx:Object(h.toB64)(p),signatureScheme:"ed25519",signature:w,publicKey:Object(x.addHexPrefix)(d)}}));return function(e,n){return t.apply(this,arguments)}}(),o.signMessage=function(){var t=a()((function*(t,n){var r=yield this.getDbAccount(),o=(yield this.getSigners(n.password||"",[r.address]))[r.address];return Promise.all(t.map(function(){var t=a()((function*(t){var n=Object(h.messageWithIntent)(h.IntentScope.PersonalMessage,Object(g.hexToBytes)(t.message)),a=Object(v.blake2b)(n,{dkLen:32}),c=yield o.sign(e.from(a)),u=i()(c,1)[0];return Object(h.toSerializedSignature)({signatureScheme:"ED25519",signature:u,pubKey:new h.Ed25519PublicKey(Object(g.hexToBytes)(r.pub))})}));return function(e){return t.apply(this,arguments)}}()))}));return function(e,n){return t.apply(this,arguments)}}(),u()(r)}(E.KeyringHdBase)}.call(this,n(26).Buffer)},4928:function(e,t,n){"use strict";n.r(t),function(e){n.d(t,"KeyringImported",(function(){return P}));var r=n(4),i=n.n(r),o=n(2),a=n.n(o),c=n(6),u=n.n(c),s=n(9),l=n.n(s),d=n(14),f=n.n(d),p=n(7),y=n.n(p),h=n(1352),v=n(566),g=n(73),w=n(748),m=n(11),b=n(23),O=n(1345),T=n(117),I=n(3915),E=n(303),x=n(4010);function A(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=y()(e);if(t){var i=y()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f()(this,n)}}var P=function(t){l()(r,t);var n=A(r);function r(){return n.apply(this,arguments)}var o=r.prototype;return o.getSigners=function(){var e=a()((function*(e,t){var n,r=yield this.getDbAccount();if(1!==t.length)throw new b.OneKeyInternalError("Starcoin signers number should be 1.");if(t[0]!==r.address)throw new b.OneKeyInternalError("Wrong address required for signing.");var i=(yield this.getPrivateKeys(e))[r.path];if("undefined"===typeof i)throw new b.OneKeyInternalError("Unable to get signer.");return(n={})[r.address]=new O.Signer(i,e,"ed25519"),n}));return function(t,n){return e.apply(this,arguments)}}(),o.prepareAccounts=function(){var e=a()((function*(e){var t=e.privateKey,n=e.name;if(32!==t.length)throw new b.OneKeyInternalError("Invalid private key.");var r=w.ed25519.publicFromPrivate(t),i=r.toString("hex"),o=new h.Ed25519PublicKey(r),a=Object(E.addHexPrefix)(o.toSuiAddress());return Promise.resolve([{id:"imported--"+m.COINTYPE_SUI+"--"+i,name:n||"",type:T.AccountType.SIMPLE,path:"",coinType:m.COINTYPE_SUI,pub:i,address:a}])}));return function(t){return e.apply(this,arguments)}}(),o.signTransaction=function(){var t=a()((function*(t,n){var r,o,a=yield this.getDbAccount(),c=(yield this.engine.getNetwork(this.networkId)).rpcURL,u=new h.JsonRpcProvider(new h.Connection({fullnode:c})),s=a.address,l=(yield this.getSigners(n.password||"",[a.address]))[s],d=null==(r=t.inputs)||null==(o=r[0])?void 0:o.publicKey;if(!d)throw new b.OneKeyInternalError("Unable to get sender public key.");var f=t.payload.encodedTx,p=yield Object(x.toTransaction)(u,s,f),y=Object(x.handleSignData)(p),v=yield l.sign(e.from(y)),w=i()(v,1)[0],m=Object(h.toSerializedSignature)({signatureScheme:"ED25519",signature:w,pubKey:new h.Ed25519PublicKey(Object(g.hexToBytes)(d))});return{txid:"",rawTx:Object(h.toB64)(p),signatureScheme:"ed25519",signature:m,publicKey:Object(E.addHexPrefix)(d)}}));return function(e,n){return t.apply(this,arguments)}}(),o.signMessage=function(){var t=a()((function*(t,n){var r=yield this.getDbAccount(),o=(yield this.getSigners(n.password||"",[r.address]))[r.address];return Promise.all(t.map(function(){var t=a()((function*(t){var n=Object(h.messageWithIntent)(h.IntentScope.PersonalMessage,Object(g.hexToBytes)(t.message)),a=Object(v.blake2b)(n,{dkLen:32}),c=yield o.sign(e.from(a)),u=i()(c,1)[0];return Object(h.toSerializedSignature)({signatureScheme:"ED25519",signature:u,pubKey:new h.Ed25519PublicKey(Object(g.hexToBytes)(r.pub))})}));return function(e){return t.apply(this,arguments)}}()))}));return function(e,n){return t.apply(this,arguments)}}(),u()(r)}(I.KeyringImportedBase)}.call(this,n(26).Buffer)},6112:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return Oe}));var r=n(13),i=n.n(r),o=n(3),a=n.n(o),c=n(316),u=n.n(c),s=n(202),l=n.n(s),d=n(4),f=n.n(d),p=n(823),y=n.n(p),h=n(2),v=n.n(h),g=n(6),w=n.n(g),m=n(9),b=n.n(m),O=n(14),T=n.n(O),I=n(7),E=n.n(I),x=n(1352),A=n(21),P=n.n(A),j=n(112),S=n(367),C=n(46),k=n(19),D=n(150),B=n(23),N=n(52),R=n(196),K=n(303),_=n(3912),H=n(4926),U=n(4927),F=n(4928),M=n(11),G=n(117);function L(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=E()(e);if(t){var i=E()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return T()(this,n)}}var V=function(e){b()(n,e);var t=L(n);function n(){return t.apply(this,arguments)}return n.prototype.prepareAccounts=function(){var e=v()((function*(e){var t=e.name,n=e.target,r=e.accountIdPrefix,i=yield this.vault.validateAddress(n);if("undefined"===typeof i)throw new B.InvalidAddress;return Promise.resolve([{id:r+"--"+M.COINTYPE_SUI+"--"+n,name:t||"",type:G.AccountType.SIMPLE,path:"",coinType:M.COINTYPE_SUI,pub:"",address:i}])}));return function(t){return e.apply(this,arguments)}}(),w()(n)}(n(3916).KeyringWatchingBase),W=n(4010);function z(e){return Y.apply(this,arguments)}function Y(){return(Y=v()((function*(e){var t,n,r,i,o=new Map,a=null!=(t=null==(n=e.payments)?void 0:n.map((function(e){return{objectId:e.objectId,version:""+e.version}})))?t:[],c=null!=(r=yield null==(i=e.client)?void 0:i.tryMultiGetPastObjects({past_objects:a,options:{showType:!0,showOwner:!0,showContent:!0,showPreviousTransaction:!1,showDisplay:!1,showBcs:!1,showStorageRebate:!1}}))?r:[];for(var u of c)if("VersionNotFound"!==u.status){var s=u.details.type.match(/<([^>]+)>/);if(s){var l=s[1];if(u.details.type.startsWith("0x2::coin::Coin<")){var d,f=null!=(d=o.get(l))?d:BigInt(0);o.set(l,f+BigInt(u.details.content.fields.balance))}}}return o}))).apply(this,arguments)}function q(e,t,n){return J.apply(this,arguments)}function J(){return(J=v()((function*(e,t,n){var r=f()(e,2),i=r[0],o=r[1],a="",c=[];if("string"===typeof i&&"GasCoin"===i)a=W.GAS_TYPE_ARG;else if("object"===typeof i&&"Input"in i){var u=t[i.Input];if("object"===u.type&&"immOrOwnedObject"===u.objectType){var s=yield null==n?void 0:n.tryGetPastObject({object_id:u.objectId,version:new P.a(u.version).toNumber(),options:{showType:!0,showOwner:!0,showContent:!0,showPreviousTransaction:!1,showDisplay:!1,showBcs:!1,showStorageRebate:!1}});if("VersionNotFound"!==(null==s?void 0:s.status)){var l=null==s?void 0:s.details.type.match(/<([^>]+)>/);if(l){var d=l[1];null!=s&&s.details.type.startsWith("0x2::coin::Coin<")&&(a=d)}}}}if(Array.isArray(o))for(var p of o)"object"===typeof p&&"Input"in p&&c.push(t[p.Input]);return{coin:a,amounts:c}}))).apply(this,arguments)}function Q(e){return X.apply(this,arguments)}function X(){return(X=v()((function*(e){var t=new Map,n=yield q(e.argument,e.inputs,e.client),r=n.coin,i=n.amounts;for(var o of i)"pure"===(null==o?void 0:o.type)&&"u64"===o.valueType&&t.set(r,o.value);return t}))).apply(this,arguments)}function Z(){return(Z=v()((function*(e){var t="",n=new Map,r=f()(e.argument,2),i=r[0],o=r[1];if(Array.isArray(i))for(var a=0;a<i.length;a+=1){var c=i[a];if(0===a&&"string"===typeof c&&"GasCoin"===c){var u=yield z({payments:e.payments,client:e.client});for(var s of u.entries()){var l=f()(s,2),d=l[0],p=l[1];n.has(d)?n.set(d,n.get(d)+p):n.set(d,p)}}if("object"===typeof c&&"Result"in c){var y=e.actions[c.Result];if("SplitCoins"in y){var h=yield Q({argument:y.SplitCoins,inputs:e.inputs,client:e.client});for(var v of h.entries()){var g=f()(v,2),w=g[0],m=g[1];n.has(w)?n.set(w,h.get(w)+m):n.set(w,m)}}}}if("object"===typeof o&&"Input"in o){var b=e.inputs[o.Input];"address"===b.valueType&&(t=b.value)}return{receive:t,amounts:n}}))).apply(this,arguments)}var $=n(270);function ee(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=E()(e);if(t){var i=E()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return T()(this,n)}}var te=Object($.object)({balance:Object($.string)(),id:Object($.string)()}),ne=Object($.object)({dataType:Object($.string)(),type:Object($.string)(),hasPublicTransfer:Object($.boolean)(),fields:te}),re=Object($.object)({status:Object($.string)(),details:Object($.object)({objectId:Object($.string)(),version:Object($.string)(),digest:Object($.string)(),type:Object($.string)(),owner:Object($.object)({AddressOwner:Object($.string)()}),content:ne})}),ie=function(e){b()(n,e);var t=ee(n);function n(){return t.apply(this,arguments)}var r=n.prototype;return r.tryGetPastObject=function(){var e=v()((function*(e){return this.client.requestWithType("sui_tryGetPastObject",[e.object_id,e.version,e.options],re)}));return function(t){return e.apply(this,arguments)}}(),r.tryMultiGetPastObjects=function(){var e=v()((function*(e){return this.client.requestWithType("sui_tryMultiGetPastObjects",[e.past_objects,e.options],Object($.array)(re))}));return function(t){return e.apply(this,arguments)}}(),w()(n)}(x.JsonRpcProvider),oe=n(2725),ae=n(342),ce=n.n(ae);function ue(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function se(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ue(Object(n),!0).forEach((function(t){a()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ue(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function le(e,t,n){return de.apply(this,arguments)}function de(){return(de=v()((function*(e,t,n){var r=null,i=[];do{var o=yield e.getCoins({owner:t,coinType:n,cursor:r,limit:50}),a=o.data,c=o.nextCursor;if(!a||!a.length)break;for(var u of a){var s=Object(W.normalizeSuiCoinType)(u.coinType);i.push(se(se({},u),{},{coinType:s}))}r=c}while(r);return i}))).apply(this,arguments)}function fe(e){return pe.apply(this,arguments)}function pe(){return(pe=v()((function*(e){var t=e.client,n=e.address,r=e.to,i=e.amount,o=e.coinType,a=void 0===o?x.SUI_TYPE_ARG:o,c=e.isPayAllSui,u=new x.TransactionBlock,s=yield le(t,n,a),l=null==s?void 0:s.filter((function(e){return!e.lockedUntilEpoch}));if(c&&a===x.SUI_TYPE_ARG)return u.transferObjects([u.gas],u.pure(r)),u.setGasPayment(l.filter((function(e){return Object(W.normalizeSuiCoinType)(e.coinType)===Object(W.normalizeSuiCoinType)(a)})).map((function(e){return{objectId:e.coinObjectId,digest:e.digest,version:e.version}}))),u;var d=l.filter((function(e){return Object(W.normalizeSuiCoinType)(e.coinType)===Object(W.normalizeSuiCoinType)(a)})),f=ce()(d),p=f[0],y=f.slice(1);if(a===x.SUI_TYPE_ARG){var h=u.splitCoins(u.gas,[u.pure(i)]);u.transferObjects([h],u.pure(r))}else{var v=u.object(p.coinObjectId);y.length&&u.mergeCoins(v,y.map((function(e){return u.object(e.coinObjectId)})));var g=u.splitCoins(v,[u.pure(i)]);u.transferObjects([g],u.pure(r))}return u}))).apply(this,arguments)}function ye(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function he(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ye(Object(n),!0).forEach((function(t){a()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ye(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ve(e,t,n,r,i){return ge.apply(this,arguments)}function ge(){return(ge=v()((function*(e,t,n,r,i){if("TransferObjects"!==t.kind)throw new Error("Invalid transaction kind");var o=new P.a("0"),a=W.SUI_NATIVE_COIN;for(var c of t.objects)if("GasCoin"===c.kind&&i){a=W.SUI_NATIVE_COIN;var u=null==i?void 0:i.reduce((function(e,t){return t.objectId&&e.push(t.objectId),e}),new Array(r.length));o=(yield e.multiGetObjects({ids:u,options:{showType:!0,showOwner:!0,showContent:!0}})).reduce((function(e,t){var n,r=e,i=null==(n=t.data)?void 0:n.content;if("moveObject"===(null==i?void 0:i.dataType)){var o,a=null==(o=i.fields)?void 0:o.balance;r=r.plus(new P.a(a))}return r}),new P.a(0))}else if("Result"===c.kind){var s=n[c.index];if("SplitCoins"===s.kind&&"Input"===s.coin.kind){var l,d,f=yield e.getObject({id:s.coin.value,options:{showType:!0,showOwner:!0,showContent:!0}}),p=null==(l=f.data)||null==(d=l.type)?void 0:d.match(/<([^>]+)>/);if(p){var y,h,v=p[1];null!=(y=f.data)&&null!=(h=y.type)&&h.startsWith("0x2::coin::Coin<")&&(a=v)}o=s.amounts.reduce((function(e,t){var n=e;return"Input"===t.kind&&(n=n.plus(new P.a(t.value))),n}),new P.a(0));break}}else if("Input"===c.kind){var g=r[c.index];if("pure"===g.type){o=new P.a(g.value);break}g.type}else if("NestedResult"===c.kind){var w,m=r[c.index];o.plus(new P.a(null!=(w=m.value)?w:"0"))}var b="";"Input"===t.address.kind&&(b=t.address.value);var O=a===W.SUI_NATIVE_COIN;return{type:O?N.IDecodedTxActionType.NATIVE_TRANSFER:N.IDecodedTxActionType.TOKEN_TRANSFER,isNative:O,coinType:a,amount:o,recipient:b}}))).apply(this,arguments)}function we(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function me(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?we(Object(n),!0).forEach((function(t){a()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):we(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function be(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=E()(e);if(t){var i=E()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return T()(this,n)}}var Oe=function(e){b()(n,e);var t=be(n);function n(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).keyringMap={hd:U.KeyringHd,hw:H.KeyringHardware,imported:F.KeyringImported,watching:V,external:V},e.settings=oe.default,e.getClientCache=Object(D.memoizee)(function(){var t=v()((function*(t){return e.getSuiClient(t)}));return function(e){return t.apply(this,arguments)}}(),{promise:!0,max:1,maxAge:Object(C.getTimeDurationMs)({minute:3})}),e}var r=n.prototype;return r.getClient=function(){var e=v()((function*(){var e=(yield this.engine.getNetwork(this.networkId)).rpcURL;return this.getClientCache(e)}));return function(){return e.apply(this,arguments)}}(),r.getSuiClient=function(e){return new ie(new x.Connection({fullnode:e,faucet:"https://faucet.testnet.sui.io/gas"}))},r.getClientEndpointStatus=function(){var e=v()((function*(e){var t=yield this.getClientCache(e),n=performance.now(),r=yield t.getTotalTransactionBlocks();return{responseTime:Math.floor(performance.now()-n),latestBlock:Number(r)}}));return function(t){return e.apply(this,arguments)}}(),r._getPublicKey=function(){var e=v()((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.prefix,n=void 0===t||t,r=yield this.getDbAccount(),i=r.pub;return n&&(i=Object(K.addHexPrefix)(i)),Promise.resolve(i)}));return function(){return e.apply(this,arguments)}}(),r.validateAddress=function(){var e=v()((function*(e){return Object(x.isValidSuiAddress)(e)?Promise.resolve(e):Promise.reject(new B.InvalidAddress)}));return function(t){return e.apply(this,arguments)}}(),r.validateWatchingCredential=function(e){var t=this;return this.validateAddress(e).then((function(e){return t.settings.watchingAccountEnabled&&!!e})).catch((function(){return!1}))},r.checkAccountExistence=function(){var e=v()((function*(e){var t=yield this.getClient();return!(yield t.getObject({id:Object(K.stripHexPrefix)(e)})).error}));return function(t){return e.apply(this,arguments)}}(),r.getBalances=function(){var e=v()((function*(e){var t=yield this.getClient(),n=y()(e,(function(e){return e.address})),r=new Map;return yield Promise.all(Object.entries(n).map(function(){var e=v()((function*(e){var n=f()(e,2),i=n[0],o=n[1];try{var a=yield t.getAllBalances({owner:i}),c={};for(var u of a)c[u.coinType]=u.totalBalance.toString();o.forEach((function(e){var t,n,o=e.tokenAddress,a=null!=o?Object(W.normalizeSuiCoinType)(o):W.SUI_NATIVE_COIN,u=(null!=o?o:W.SUI_NATIVE_COIN).replace(/^0x0*/,"0x"),s=null!=(t=null==(n=c[u])?void 0:n.toString())?t:"0",l=i+"-"+a;try{r.set(l,new P.a(s))}catch(d){}}))}catch(s){}}));return function(t){return e.apply(this,arguments)}}())),e.map((function(e){var t,n=e.address,i=e.tokenAddress,o=n+"-"+(null!=i?i:W.SUI_NATIVE_COIN);return null!=(t=r.get(o))?t:new P.a(0)}))}));return function(t){return e.apply(this,arguments)}}(),r.activateAccount=function(){var e=v()((function*(){var e=yield this.getClient();yield e.requestSuiFromFaucet(yield this.getAccountAddress())}));return function(){return e.apply(this,arguments)}}(),r.fetchTokenInfos=function(){var e=v()((function*(e){var t=yield this.getClient();return Promise.all(e.map(function(){var e=v()((function*(e){try{var n=yield t.getCoinMetadata({coinType:Object(W.normalizeSuiCoinType)(e)});if(!n)return;return yield Promise.resolve({name:n.name,symbol:n.symbol,decimals:n.decimals})}catch(r){}}));return function(t){return e.apply(this,arguments)}}()))}));return function(t){return e.apply(this,arguments)}}(),r.validateTokenAddress=function(){var e=v()((function*(e){var t=e.split("::"),n=f()(t,3),r=n[0],i=n[1],o=n[2];if(i&&o)try{return(yield this.validateAddress(r)).toLowerCase()+"::"+i+"::"+o}catch(a){}throw new B.InvalidTokenAddress}));return function(t){return e.apply(this,arguments)}}(),r.attachFeeInfoToEncodedTx=function(){var e=v()((function*(e){var t=e.feeInfoValue,n=t.price,r=t.limit;if("undefined"!==typeof n&&"string"!==typeof n)throw new B.OneKeyInternalError("Invalid gas price.");if("string"!==typeof r)throw new B.OneKeyInternalError("Invalid fee limit");var i=x.TransactionBlock.from(e.encodedTx.rawTx);return i.blockData.gasConfig.price=n,i.blockData.gasConfig.budget=r,Promise.resolve({rawTx:i.serialize(),feeInfo:{price:n,limit:r}})}));return function(t){return e.apply(this,arguments)}}(),r.decodedTxToLegacy=function(e){return Promise.resolve({})},r.decodeTx=function(){var e=v()((function*(e,t){var n=yield this.engine.getNetwork(this.networkId),r=yield this.getDbAccount(),i=yield this.engine.getNativeTokenInfo(this.networkId),o=yield this.getClient(),a=yield this.getAccountAddress(),c=x.TransactionBlock.from(e.rawTx);if(!c)throw new B.OneKeyError("Invalid transaction data.");var u,s=[],d=c.blockData,f=d.inputs,p=d.transactions,y=d.gasConfig,h="0";c.blockData.gasConfig.budget&&(h=null!=(u=c.blockData.gasConfig.budget)?u:"0");try{for(var v of p)switch(v.kind){case"TransferObjects":var g=yield ve(o,v,p,f,y.payment);if(g){var w,m,b,O,T="nativeTransfer";if(!g.isNative){if(T="tokenTransfer",!g.coinType)throw new B.OneKeyInternalError("Invalid coin type");if(!(i=yield this.engine.ensureTokenInDB(this.networkId,Object(W.normalizeSuiCoinType)(g.coinType))))throw new B.OneKeyInternalError("Invalid coin type")}s.push(((O={type:g.type})[T]={tokenInfo:i,from:a,to:g.recipient,amount:new P.a(null!=(w=g.amount.toString())?w:"0").shiftedBy(-i.decimals).toFixed(),amountValue:null!=(m=null==(b=g.amount)?void 0:b.toString())?m:"0",extraInfo:null},O))}break;case"MoveCall":var I;if("MoveCall"!==v.kind)break;var E=[],A=void 0;for(var j of null!=(S=v.arguments)?S:[]){var S;switch(j.kind){case"Input":case"Result":case"NestedResult":if("pure"===(A=f[j.index]).type){var C=l()(A.value,"Pure",A.value);try{E.push(x.builder.de("vector<u8>",C))}catch(K){try{E.push(C.toString())}catch(_){}}}else"object"===A.type&&E.push(A.value)}}var k=Object(W.moveCallTxnName)(v.target).split("::");s.push({type:N.IDecodedTxActionType.FUNCTION_CALL,functionCall:{target:(null==k?void 0:k[1])+"::"+(null==k?void 0:k[2]),functionName:null!=(I=null==k?void 0:k[0])?I:"",args:E,extraInfo:null}});break;case"MakeMoveVec":case"SplitCoins":case"MergeCoins":break;default:s.push({type:N.IDecodedTxActionType.UNKNOWN,direction:N.IDecodedTxDirection.OTHER,unknownAction:{extraInfo:{}}})}}catch(K){}var D={txid:"",owner:r.address,signer:r.address,nonce:0,actions:s,status:N.IDecodedTxStatus.Pending,networkId:this.networkId,accountId:this.accountId,feeInfo:{price:Object(R.convertFeeValueToGwei)({value:"1",network:n}),limit:h},extraInfo:null,encodedTx:e};return Promise.resolve(D)}));return function(t,n){return e.apply(this,arguments)}}(),r.buildEncodedTxFromTransfer=function(){var e=v()((function*(e){if(!e.to)throw new Error("Invalid transferInfo.to params");var t,n=e.to,r=e.amount,i=e.token,o=(yield this.getDbAccount()).address,a=Object(K.addHexPrefix)(n),c=Object(K.addHexPrefix)(o),s=null==i||u()(i);if(s){var l=yield this.getNetwork();t=new P.a(r).shiftedBy(l.decimals).toFixed()}else{var d=yield this.engine.ensureTokenInDB(this.networkId,i);if("undefined"===typeof d)throw new B.OneKeyInternalError("Failed to get token info.");t=new P.a(r).shiftedBy(d.decimals).toFixed()}var f=yield this.getClient(),p=s?W.SUI_NATIVE_COIN:i;return{rawTx:(yield fe({client:f,address:c,to:a,amount:t,coinType:Object(W.normalizeSuiCoinType)(p)})).serialize()}}));return function(t){return e.apply(this,arguments)}}(),r.buildEncodedTxFromApprove=function(e){throw new B.NotImplemented},r.updateEncodedTxTokenApprove=function(e,t){throw new B.NotImplemented},r.updateEncodedTx=function(){var e=v()((function*(e,t,n){if("transfer"===n.type){var r,i=e.rawTx,o=x.TransactionBlock.from(i),a=o.blockData.transactions.find((function(e){return"TransferObjects"===e.kind?e:void 0}));if(!a||"TransferObjects"!==a.kind)return Promise.resolve(e);var c=yield this.getClient(),u=yield fe({client:c,address:null!=(r=o.blockData.sender)?r:yield this.getAccountAddress(),to:l()(a.address,"value"),amount:t.amount,coinType:W.SUI_NATIVE_COIN,isPayAllSui:!0});return me(me({},e),{},{rawTx:u.serialize()})}return Promise.resolve(e)}));return function(t,n,r){return e.apply(this,arguments)}}(),r.buildUnsignedTxFromEncodedTx=function(){var e=v()((function*(e){var t=e,n=yield this.getDbAccount();return Promise.resolve({inputs:[{address:Object(K.stripHexPrefix)(n.address),value:new P.a(0),publicKey:Object(K.stripHexPrefix)(n.pub)}],outputs:[],payload:{encodedTx:t},encodedTx:t})}));return function(t){return e.apply(this,arguments)}}(),r.tryFixFeePayment=function(){var e=v()((function*(e){var t=x.TransactionBlock.from(e.rawTx);if(!t.blockData.gasConfig.payment){var n,r=yield this.getClient(),i=yield this.getAccountAddress(),o=yield le(r,i,null),a=o[0];t.blockData.gasConfig.payment=[{objectId:a.coinObjectId,version:a.version,digest:a.digest}];var c={rawTx:x.TransactionBlock.from(t.serialize()).serialize()},u=yield this.fetchFeeInfo(c),s=new P.a(null!=(n=u.limit)?n:"0").toNumber(),l=[],d=new P.a(0);do{var f=o.shift();if(!f)throw new B.OneKeyInternalError("Insufficient balance");var p,y=new P.a(null!=(p=null==f?void 0:f.balance)?p:"0");d=d.plus(y),l.push(f)}while(d.isLessThan(s));return t.blockData.gasConfig.payment=l.map((function(e){return{objectId:e.coinObjectId,version:e.version,digest:e.digest}})),me(me({},e),{},{rawTx:x.TransactionBlock.from(t.serialize()).serialize()})}return e}));return function(t){return e.apply(this,arguments)}}(),r.fetchFeeInfo=function(){var e=v()((function*(e){var t,n=yield this.getClient(),r=yield this.getNetwork(),i=Object(R.convertFeeValueToGwei)({value:"1",network:r});try{var o=x.TransactionBlock.from(e.rawTx),a=(yield Object(W.dryRunTransactionBlock)({provider:n,sender:yield this.getAccountAddress(),transactionBlock:o})).effects;if(!a)throw new B.OneKeyError;var c,u,s,l=(null==a||null==(c=a.gasUsed)?void 0:c.computationCost)||"0",d=(null==(u=a.gasUsed)?void 0:u.storageCost)||"0",f=(null==(s=a.gasUsed)?void 0:s.storageRebate)||"0",p=new P.a(W.GAS_SAFE_OVERHEAD).multipliedBy(1),y=new P.a(l).plus(p),h=y.plus(d).minus(f),v=h.gt(y)?h:y;if(v.isEqualTo(0))throw new B.OneKeyError;t=v.multipliedBy(1.1).toFixed()}catch(m){var g=x.TransactionBlock.from(e.rawTx);if(!g.blockData.transactions.some((function(e){return"TransferObjects"===e.kind})))throw new B.OneKeyError;var w=g.blockData.inputs;t=Object(W.computeGasBudget)(w.length).toString()}return{nativeSymbol:r.symbol,nativeDecimals:r.decimals,feeSymbol:r.feeSymbol,feeDecimals:r.feeDecimals,limit:t,prices:[i],defaultPresetIndex:"0"}}));return function(t){return e.apply(this,arguments)}}(),r.broadcastTransaction=function(){var e=v()((function*(e){var t=yield this.getClient();k.default.engine.info("broadcastTransaction START:",{rawTx:e.rawTx});try{var n=e.signature,r=e.signatureScheme,i=e.publicKey;switch(r){case"ed25519":"ED25519";break;case"secp256k1":"Secp256k1";break;default:throw new B.OneKeyInternalError("Unsupported signature scheme")}if(!n)throw new Error("signature is empty");if(!i)throw new Error("publicKey is empty");var o=yield t.executeTransactionBlock({transactionBlock:e.rawTx,signature:n,requestType:e.encodedTx.requestType}),a=Object(x.getTransactionDigest)(o);return k.default.engine.info("broadcastTransaction Done:",{txid:a,rawTx:e.rawTx,transactionResponse:o}),me(me({},e),{},{txid:a})}catch(d){var c=d||{},u=c.errorCode,s=c.message,l=(null!=u?u:"")+" "+s;throw-1!==s.indexOf("Insufficient gas:")?new B.OneKeyInternalError(l,"msg__broadcast_tx_Insufficient_fee"):new B.OneKeyInternalError(l)}}));return function(t){return e.apply(this,arguments)}}(),r.getExportedCredential=function(){var e=v()((function*(e){var t=yield this.getDbAccount();if(t.id.startsWith("hd-")||t.id.startsWith("imported")){var n=this.keyring,r=Object.values(yield n.getPrivateKeys(e)),i=f()(r,1)[0];return"0x"+Object(j.decrypt)(e,i).toString("hex")}throw new B.OneKeyInternalError("Only credential of HD or imported accounts can be exported")}));return function(t){return e.apply(this,arguments)}}(),r.fetchOnChainHistory=function(){var e=v()((function*(e){var t=this,n=e.localHistory,r=void 0===n?[]:n;if(e.tokenIdOnNetwork)return Promise.resolve([]);var o=yield this.getClient(),a=yield this.getDbAccount(),c=(yield this.engine.getNativeTokenInfo(this.networkId)).decimals,u=yield o.queryTransactionBlocks({filter:{FromAddress:a.address},limit:20,order:"descending"}),s=yield o.queryTransactionBlocks({filter:{ToAddress:a.address},limit:20,order:"descending"}),l=u.data.map((function(e){return e.digest})),d=s.data.map((function(e){return e.digest})),p=[].concat(i()(l),i()(d));if(!p||!p.length)return[];var y=(yield o.multiGetTransactionBlocks({digests:Object(W.deduplicate)(p),options:{showInput:!0,showEffects:!0}})).map(function(){var e=v()((function*(e){var n=r.find((function(t){return t.decodedTx.txid===Object(x.getTransactionDigest)(e)}));if(n&&n.decodedTx.isFinal)return Promise.resolve(null);try{var i,u,s,l,d,p,y,h,g,w=yield t.engine.getNativeTokenInfo(t.networkId),m=Object(x.getExecutionStatus)(e),b="success"===(null==m?void 0:m.status),O="failure"===(null==m?void 0:m.status);if(!e)throw new Error("current transaction is empty, continue");var T=null!=(i=Object(x.getTimestampFromTransactionResponse)(e))?i:Object(C.getTimeStamp)(),I=null==(u=Object(x.getTransaction)(e))||null==(s=u.data)?void 0:s.transaction,E=null==(l=Object(x.getTransaction)(e))||null==(d=l.data)?void 0:d.gasData.payment;if(!I||"ProgrammableTransaction"!==I.kind)throw new Error("current transaction is empty, continue");var A=I.transactions,j=null!=(p=Object(x.getTransactionSender)(e))?p:"",S=[],D="";yield Promise.all(A.map(function(){var e=v()((function*(e){var n=new P.a("0");if("TransferObjects"in e){var r,i,a,c,u,s,l="nativeTransfer",d=N.IDecodedTxActionType.NATIVE_TRANSFER,p=yield function(e){return Z.apply(this,arguments)}({argument:e.TransferObjects,actions:A,inputs:I.inputs,payments:E,client:o});if(D=p.receive,p.amounts.has(W.GAS_TYPE_ARG))l="nativeTransfer",d=N.IDecodedTxActionType.NATIVE_TRANSFER,n=new P.a(null!=(u=null==(s=p.amounts.get(W.GAS_TYPE_ARG))?void 0:s.toString())?u:"0");else for(var y of(l="tokenTransfer",d=N.IDecodedTxActionType.TOKEN_TRANSFER,p.amounts.entries())){var h=f()(y,2),v=h[0],g=h[1];n=new P.a(g.toString()),l="tokenTransfer",w=yield t.engine.ensureTokenInDB(t.networkId,v)}if(!w)return null;S.push(((c={type:d})[l]={tokenInfo:w,from:j,to:D,amount:new P.a(null!=(r=n)?r:"0").shiftedBy(-w.decimals).toFixed(),amountValue:null!=(i=null==(a=n)?void 0:a.toString())?i:"0",extraInfo:null},c))}else if("MoveCall"in e){var m,b,O=e.MoveCall,T="";if(O.package&&"object"===typeof O.package)T=null!=(m=null==(b=O.package)?void 0:b.objectId)?m:"";else T=O.package;var x=[];for(var C of null!=(k=O.arguments)?k:[]){var k;if("object"===typeof C)if("Input"in C){var B=C.Input,R=I.inputs[B];"pure"===R.type?x.push(R.value.toString()):"object"===R.type&&x.push(R.objectId)}else if("Result"in C){var K=C.Result,_=I.inputs[K];"pure"===_.type?x.push(_.value.toString()):"object"===_.type&&x.push(_.objectId)}else if("NestedResult"in C){var H=f()(C.NestedResult,1)[0],U=I.inputs[H];"pure"===U.type?x.push(U.value.toString()):"object"===U.type&&x.push(U.objectId)}}S.push({type:N.IDecodedTxActionType.FUNCTION_CALL,functionCall:{target:Object(W.moveCallTxnName)(O.function),functionName:T,args:x,extraInfo:null}})}else"SplitCoins"in e||"MergeCoins"in e||"MakeMoveVec"in e||S.push({type:N.IDecodedTxActionType.UNKNOWN,direction:N.IDecodedTxDirection.OTHER,unknownAction:{extraInfo:{}}})}));return function(t){return e.apply(this,arguments)}}()));var B={from:j,to:D,value:""},R=null!=(y=null==(h=Object(x.getTotalGasUsed)(e))?void 0:h.toString())?y:"0",K=N.IDecodedTxStatus.Pending;O?K=N.IDecodedTxStatus.Failed:b&&(K=N.IDecodedTxStatus.Confirmed);var _={txid:Object(x.getTransactionDigest)(e),owner:a.address,signer:j,nonce:0,actions:S,status:K,networkId:t.networkId,accountId:t.accountId,encodedTx:B,extraInfo:null,totalFeeInNative:new P.a(R).shiftedBy(-c).toFixed()};return"number"===typeof T?_.updatedAt=T:"string"===typeof T&&(_.updatedAt=parseInt(T)),_.createdAt=null!=(g=null==n?void 0:n.decodedTx.createdAt)?g:_.updatedAt,_.isFinal=_.status===N.IDecodedTxStatus.Confirmed,yield t.buildHistoryTx({decodedTx:_,historyTxToMerge:n})}catch(H){k.default.common.error(H)}return Promise.resolve(null)}));return function(t){return e.apply(this,arguments)}}());return(yield Promise.all(y)).filter(Boolean)}));return function(t){return e.apply(this,arguments)}}(),r.getTransactionStatuses=function(){var e=v()((function*(e){var t=yield this.getClient(),n=yield t.multiGetTransactionBlocks({digests:e}),r=new Map;return n.forEach(function(){var e=v()((function*(e){var t=Object(x.getTransactionDigest)(e);try{var n=Object(x.getExecutionStatus)(e),i="success"===(null==n?void 0:n.status),o="failure"===(null==n?void 0:n.status),a=S.TransactionStatus.PENDING;o?a=S.TransactionStatus.CONFIRM_BUT_FAILED:i&&(a=S.TransactionStatus.CONFIRM_AND_SUCCESS),r.set(t,a)}catch(c){-1!==c.message.indexOf("Could not find the referenced transaction")&&r.set(t,S.TransactionStatus.NOT_FOUND)}}));return function(t){return e.apply(this,arguments)}}()),e.map((function(e){return r.get(e)}))}));return function(t){return e.apply(this,arguments)}}(),r.getTransactionByTxId=function(){var e=v()((function*(e,t){var n=yield this.getClient();return yield n.getTransactionBlock({digest:e,options:t})}));return function(t,n){return e.apply(this,arguments)}}(),r.waitPendingTransaction=function(){var e=v()((function*(e,t){return function(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:10,o=0,a=function(){var c=v()((function*(){var c,u,s,l,d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2e3;o+=1;try{l=yield e.getTransactionBlock({digest:t,options:he(he({},n),{},{showEffects:!0})})}catch(p){if(r&&-32e3!==p.code&&-32602!==p.code)return Promise.reject(new B.OneKeyError(p))}var f="success"===(null==(c=l)||null==(u=c.effects)||null==(s=u.status)?void 0:s.status);return!0===f?Promise.resolve(l):o>i?Promise.reject(new B.OneKeyError("transaction timeout")):new Promise((function(e){return setTimeout((function(){return e(a(d))}),d)}))}));return function(){return c.apply(this,arguments)}}();return a()}(yield this.getClient(),e,t)}));return function(t,n){return e.apply(this,arguments)}}(),w()(n)}(_.VaultBase)}}]);