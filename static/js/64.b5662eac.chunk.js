(this.webpackJsonp=this.webpackJsonp||[]).push([[64],{3903:function(e,t,n){"use strict";n.r(t),n.d(t,"KeyringBase",(function(){return y})),n.d(t,"KeyringBaseMock",(function(){return h}));var r=n(2),i=n.n(r),o=n(6),a=n.n(o),s=n(9),u=n.n(s),c=n(14),d=n.n(c),l=n(7),f=n.n(l);function p(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f()(e);if(t){var i=f()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return d()(this,n)}}var y=function(e){u()(n,e);var t=p(n);function n(e){var n;return(n=t.call(this,e.options)).vault=e,n}return n.prototype.addressFromBase=function(){var e=i()((function*(e){return this.vault.addressFromBase(e)}));return function(t){return e.apply(this,arguments)}}(),a()(n)}(n(1585).VaultContext),h=function(e){u()(n,e);var t=p(n);function n(){return t.apply(this,arguments)}return a()(n)}(y)},3905:function(e,t,n){"use strict";n.r(t),n.d(t,"KeyringSoftwareBase",(function(){return O}));var r=n(4),i=n.n(r),o=n(3),a=n.n(o),s=n(2),u=n.n(s),c=n(6),d=n.n(c),l=n(9),f=n.n(l),p=n(14),y=n.n(p),h=n(7),v=n.n(h),g=n(19),w=n(23);function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function T(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach((function(t){a()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function A(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=v()(e);if(t){var i=v()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return y()(this,n)}}var O=function(e){f()(n,e);var t=A(n);function n(){return t.apply(this,arguments)}var r=n.prototype;return r.signTransaction=function(){var e=u()((function*(e,t){var n=t.password;if("undefined"===typeof n)throw new w.OneKeyInternalError("Software signing requires a password.");var r=yield this.getSigners(n,e.inputs.map((function(e){return e.address})));return g.default.engine.info("signTransaction",this.networkId,e),T(T({},yield this.engine.providerManager.signTransaction(this.networkId,e,r)),{},{encodedTx:e.encodedTx})}));return function(t,n){return e.apply(this,arguments)}}(),r.signMessage=function(){var e=u()((function*(e,t){var n=this,r=t.password;if("undefined"===typeof r)throw new w.OneKeyInternalError("Software signing requires a password.");var o=yield this.getDbAccount(),a=Object.values(yield this.getSigners(r,[o.address])),s=i()(a,1)[0];return g.default.engine.info("signMessage",this.networkId,e),Promise.all(e.map((function(e){return n.engine.providerManager.signMessage(n.networkId,e,s)})))}));return function(t,n){return e.apply(this,arguments)}}(),r.getAddress=function(){throw new Error("Method not implemented.")},r.batchGetAddress=function(){throw new Error("Method not implemented.")},r.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},d()(n)}(n(3903).KeyringBase)},3912:function(e,t,n){"use strict";n.r(t),function(e){n.d(t,"VaultBaseChainOnly",(function(){return j})),n.d(t,"VaultBase",(function(){return H}));var r=n(202),i=n.n(r),o=n(3),a=n.n(o),s=n(60),u=n.n(s),c=n(2),d=n.n(c),l=n(6),f=n.n(l),p=n(9),y=n.n(p),h=n(14),v=n.n(h),g=n(7),w=n.n(g),m=n(21),T=n.n(m),A=n(167),O=n.n(A),b=n(11),I=n(19),E=n(24),x=n(68),P=n(23),D=n(182),k=n(947),C=n(52),S=n(1585);function N(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function R(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?N(Object(n),!0).forEach((function(t){a()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):N(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function B(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=w()(e);if(t){var i=w()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return v()(this,n)}}if(E.default.isExtensionUi)throw new Error("engine/VaultBase is not allowed imported from ui");var j=function(e){y()(n,e);var t=B(n);function n(){return t.apply(this,arguments)}var r=n.prototype;return r.initProvider=function(){var e=d()((function*(){var e=(yield this.getNetwork()).impl;u()(k.IMPL_MAPPINGS[e])||(this.engineProvider=yield this.engine.providerManager.getProvider(this.networkId))}));return function(){return e.apply(this,arguments)}}(),r.proxyJsonRPCCall=function(){var e=d()((function*(e){throw new P.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),r.createClientFromURL=function(e){throw new P.NotImplemented},r.getEthersProvider=function(){var e=d()((function*(){throw new P.NotImplemented}));return function(){return e.apply(this,arguments)}}(),r.getClientEndpointStatus=function(){var e=d()((function*(e){var t=this.createClientFromURL(e),n=performance.now(),r=(yield t.getInfo()).bestBlockNumber;return{responseTime:Math.floor(performance.now()-n),latestBlock:r}}));return function(t){return e.apply(this,arguments)}}(),r.checkRpcBatchSupport=function(){var e=d()((function*(e){throw new P.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),r.getDisplayAddress=function(){var e=d()((function*(e){return Promise.resolve(e)}));return function(t){return e.apply(this,arguments)}}(),r.validateAddress=function(){var e=d()((function*(e){var t=yield this.engineProvider.verifyAddress(e),n=t.normalizedAddress;if(!t.isValid||!n)throw new P.InvalidAddress;return Promise.resolve(n)}));return function(t){return e.apply(this,arguments)}}(),r.validateImportedCredential=function(e){return Promise.resolve(this.settings.importedAccountEnabled&&/^(0x)?[0-9a-zA-Z]{64}$/.test(e))},r.validateWatchingCredential=function(){var e=d()((function*(e){return Promise.resolve(this.settings.watchingAccountEnabled&&(yield this.engineProvider.verifyAddress(e)).isValid)}));return function(t){return e.apply(this,arguments)}}(),r.validateTokenAddress=function(){var e=d()((function*(e){var t=yield this.engineProvider.verifyTokenAddress(e),n=t.normalizedAddress;if(!t.isValid||"undefined"===typeof n)throw new P.InvalidTokenAddress;return Promise.resolve(n)}));return function(t){return e.apply(this,arguments)}}(),r.validateCanCreateNextAccount=function(){var e=d()((function*(e,t){return Promise.resolve(!0)}));return function(t,n){return e.apply(this,arguments)}}(),r.checkAccountExistence=function(){var e=d()((function*(e,t){return Promise.resolve(!0)}));return function(t,n){return e.apply(this,arguments)}}(),r.getBalances=function(){var e=d()((function*(e,t,n){return(yield this.engine.providerManager.getClient(this.networkId)).getBalances(e.map((function(e){var t=e.address,n=e.tokenAddress;return{address:t,coin:R({},"string"===typeof n?{tokenAddress:n}:{})}})))}));return function(t,n,r){return e.apply(this,arguments)}}(),r.getFrozenBalance=function(){var e=d()((function*(e){return 0}));return function(t){return e.apply(this,arguments)}}(),r.fetchBalanceDetails=function(){var e=d()((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.password;return Promise.resolve(void 0)}));return function(){return e.apply(this,arguments)}}(),r.getTransactionStatuses=function(e){return this.engine.providerManager.getTransactionStatuses(this.networkId,e)},r.getTransactionFeeInNative=function(e){return Promise.resolve("")},r.isContractAddress=function(){var e=d()((function*(e){return!1}));return function(t){return e.apply(this,arguments)}}(),r.getAccountNameInfoMap=function(){var e=d()((function*(){var e=yield this.getNetwork();return Object(D.getAccountNameInfoByImpl)(e.impl)}));return function(){return e.apply(this,arguments)}}(),r.canAutoCreateNextAccount=function(){var e=d()((function*(e){return Promise.resolve(!1)}));return function(t){return e.apply(this,arguments)}}(),r.filterAccounts=function(){var e=d()((function*(e){var t=e.accounts;e.networkId;return Promise.resolve(t)}));return function(t){return e.apply(this,arguments)}}(),r.shouldChangeAccountWhenNetworkChanged=function(){var e=d()((function*(e){e.previousNetwork,e.newNetwork,e.activeAccountId;return Promise.resolve({shouldReloadAccountList:!1,shouldChangeActiveAccount:!1})}));return function(t){return e.apply(this,arguments)}}(),r.getAccountNameInfosByImportedOrWatchingCredential=function(){var e=d()((function*(e){return Promise.resolve([])}));return function(t){return e.apply(this,arguments)}}(),r.checkIsUnlimitedAllowance=function(){var e=d()((function*(e){throw new P.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),r.checkIsApprovedForAll=function(){var e=d()((function*(e){throw new P.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),r.checkIsBatchTransfer=function(){var e=d()((function*(e){throw new P.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),r.getFeePricePerUnit=function(){var e=d()((function*(){throw new P.NotImplemented}));return function(){return e.apply(this,arguments)}}(),r.fetchRpcChainId=function(){var e=d()((function*(e){return null}));return function(t){return e.apply(this,arguments)}}(),r.getTxWaitingSeconds=function(){var e=d()((function*(){return[]}));return function(){return e.apply(this,arguments)}}(),r.getUserNFTAssets=function(){var e=d()((function*(e){e.serviceData;return Promise.resolve(void 0)}));return function(t){return e.apply(this,arguments)}}(),f()(n)}(S.VaultContext),H=function(t){y()(r,t);var n=B(r);function r(){for(var e,t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return(e=n.call.apply(n,[this].concat(r))).uuid=O.a.v4().toString(),e}var o=r.prototype;return o.init=function(){var e=d()((function*(e){yield this.initProvider(),yield this.initKeyring(e)}));return function(t){return e.apply(this,arguments)}}(),o.initKeyring=function(){var e=d()((function*(e){this.keyring=yield e.keyringCreator(this)}));return function(t){return e.apply(this,arguments)}}(),o.signTransaction=function(){var e=d()((function*(e,t){return this.keyring.signTransaction(e,t)}));return function(t,n){return e.apply(this,arguments)}}(),o.signAndSendTransaction=function(){var e=d()((function*(e,t,n){var r=yield this.signTransaction(e,t);return n?R(R({},r),{},{encodedTx:e.encodedTx}):this.broadcastTransaction(R(R({},r),{},{encodedTx:e.encodedTx}))}));return function(t,n,r){return e.apply(this,arguments)}}(),o.broadcastTransaction=function(){var e=d()((function*(e,t){I.default.engine.info("broadcastTransaction START:",{rawTx:e.rawTx});var n=yield this.engine.providerManager.broadcastTransaction(this.networkId,e.rawTx,t);return I.default.engine.info("broadcastTransaction END:",{txid:n,rawTx:e.rawTx}),R(R({},e),{},{txid:n,encodedTx:e.encodedTx})}));return function(t,n){return e.apply(this,arguments)}}(),o.buildEncodedTxFromBatchTransfer=function(){var e=d()((function*(e){throw new P.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),o.buildEncodedTxsFromSetApproveForAll=function(){var e=d()((function*(e,t){throw new P.NotImplemented}));return function(t,n){return e.apply(this,arguments)}}(),o.activateAccount=function(){var e=d()((function*(){throw new P.NotImplemented}));return function(){return e.apply(this,arguments)}}(),o.activateToken=function(){var e=d()((function*(e,t){throw new P.NotImplemented}));return function(t,n){return e.apply(this,arguments)}}(),o.getTokenAllowance=function(){var e=d()((function*(e,t){throw new P.NotImplemented}));return function(t,n){return e.apply(this,arguments)}}(),o.batchTokensAllowance=function(){var e=d()((function*(e,t){throw new P.NotImplemented}));return function(t,n){return e.apply(this,arguments)}}(),o.getOutputAccount=function(){var e=d()((function*(){var e=yield this.getDbAccount({noCache:!0});return{id:e.id,name:e.name,type:e.type,path:e.path,coinType:e.coinType,tokens:[],address:e.address,template:e.template,pubKey:i()(e,"pub","")}}));return function(){return e.apply(this,arguments)}}(),o.getAccountBalance=function(){var e=d()((function*(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,i=yield this.getDbAccount(),o=i.address;return this.getBalances((t?[{address:o}]:[]).concat(e.map((function(e){return{address:o,tokenAddress:e}}))),n,r)}));return function(t){return e.apply(this,arguments)}}(),o.updatePendingTxs=function(){var e=d()((function*(e){throw new P.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),o.getAccountNonce=function(){var e=d()((function*(){return Promise.resolve(null)}));return function(){return e.apply(this,arguments)}}(),o.fixActionDirection=function(){var e=d()((function*(e){var t,n,r,i,o=e.action,a=e.accountAddress;(o.direction=C.IDecodedTxDirection.OTHER,o.type===C.IDecodedTxActionType.NATIVE_TRANSFER)&&(o.direction=yield this.buildTxActionDirection({from:(null==(t=o.nativeTransfer)?void 0:t.from)||"",to:(null==(n=o.nativeTransfer)?void 0:n.to)||"",address:a}));o.type===C.IDecodedTxActionType.TOKEN_TRANSFER&&(o.direction=yield this.buildTxActionDirection({from:(null==(r=o.tokenTransfer)?void 0:r.from)||"",to:(null==(i=o.tokenTransfer)?void 0:i.to)||"",address:a}));return o}));return function(t){return e.apply(this,arguments)}}(),o.fixDecodedTx=function(){var e=d()((function*(e){var t,n;e.createdAt=null!=(t=e.createdAt)?t:Date.now();var r=null==(n=e.encodedTx)?void 0:n.nonce;e.nonce=u()(r)?e.nonce:new T.a(r).toNumber();for(var i=e.owner,o=0;o<e.actions.length;o+=1){var a=e.actions[o];yield this.fixActionDirection({action:a,accountAddress:i})}if(e.outputActions)for(var s=0;s<e.outputActions.length;s+=1){var c=e.outputActions[s];yield this.fixActionDirection({action:c,accountAddress:i})}return Promise.resolve(e)}));return function(t){return e.apply(this,arguments)}}(),o.fixHistoryTx=function(){var e=d()((function*(e){return e.decodedTx=yield this.fixDecodedTx(e.decodedTx),Promise.resolve(e)}));return function(t){return e.apply(this,arguments)}}(),o.buildHistoryTx=function(){var e=d()((function*(e){var t=e.historyTxToMerge,n=(e.encodedTx,e.decodedTx),r=e.signedTx,i=e.isSigner,o=e.isLocalCreated,a=(null==r?void 0:r.txid)||(null==n?void 0:n.txid)||"";if(!a)throw new Error("buildHistoryTx txid not found");var s=yield this.getAccountAddress();n.txid=a||n.txid,n.owner=s,i&&(n.signer=s),null!=r&&r.txKey&&(n.extraInfo?n.extraInfo.txKey=r.txKey:n.extraInfo={txKey:r.txKey});var u=R(R({id:this.networkId+"_"+a+"_"+this.accountId,isLocalCreated:Boolean(o)},t),{},{decodedTx:n});return u=yield this.fixHistoryTx(u),Promise.resolve(u)}));return function(t){return e.apply(this,arguments)}}(),o.checkIsScamHistoryTx=function(){var e=d()((function*(e){return!1}));return function(t){return e.apply(this,arguments)}}(),o.fetchOnChainHistory=function(){var e=d()((function*(e){throw new P.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),o.fixAddressCase=function(e){return Promise.resolve(e)},o.buildTxActionDirection=function(){var e=d()((function*(e){var t=e.from,n=e.to,r=e.address;return t=yield this.fixAddressCase(t||""),n=yield this.fixAddressCase(n),r=yield this.fixAddressCase(r),t===n&&t===r?C.IDecodedTxDirection.SELF:t&&t===r?C.IDecodedTxDirection.OUT:n&&n===r?C.IDecodedTxDirection.IN:C.IDecodedTxDirection.OTHER}));return function(t){return e.apply(this,arguments)}}(),o.getNextNonce=function(){var e=d()((function*(e,t){var n,r,i=null!=(n=null==(r=(yield this.engine.providerManager.getAddresses(e,[t.address]))[0])?void 0:r.nonce)?n:0,o=(yield this.engine.getHistory(e,t.id,void 0,!1),yield x.default.history.getMaxPendingNonce({accountId:this.accountId,networkId:e})),a=yield x.default.history.getPendingNonceList({accountId:this.accountId,networkId:e}),s=Math.max(u()(o)?0:o+1,i);if(Number.isNaN(s)&&(s=i),s>i)for(var c=i;c<s;c+=1)if(!a.includes(c)){s=c;break}if(s<i&&(s=i),s-i>=b.HISTORY_CONSTS.PENDING_QUEUE_MAX_LENGTH)throw new P.PendingQueueTooLong(b.HISTORY_CONSTS.PENDING_QUEUE_MAX_LENGTH);return s}));return function(t,n){return e.apply(this,arguments)}}(),o.validateSendAmount=function(e,t,n){return Promise.resolve(!0)},o.notifyChainChanged=function(e,t){},o.getFetchBalanceAddress=function(e){return Promise.resolve(e.address)},o.getPrivateKeyByCredential=function(t){return Promise.resolve(e.from(t.startsWith("0x")?t.slice(2):t,"hex"))},o.getMinDepositAmount=function(){var e=d()((function*(){return"0"}));return function(){return e.apply(this,arguments)}}(),o.specialCheckEncodedTx=function(){var e=d()((function*(e){return{success:!0}}));return function(t){return e.apply(this,arguments)}}(),o.getAllUsedAddress=function(){var e=d()((function*(){return Promise.resolve([])}));return function(){return e.apply(this,arguments)}}(),f()(r)}(j)}.call(this,n(26).Buffer)},3913:function(e,t,n){"use strict";n.r(t),function(e){n.d(t,"KeyringHardwareBase",(function(){return v}));var r=n(2),i=n.n(r),o=n(6),a=n.n(o),s=n(9),u=n.n(s),c=n(14),d=n.n(c),l=n(7),f=n.n(l),p=n(431),y=n(163);function h(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f()(e);if(t){var i=f()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return d()(this,n)}}var v=function(t){u()(r,t);var n=h(r);function r(){return n.apply(this,arguments)}var o=r.prototype;return o.getHardwareInfo=function(){var e=i()((function*(){var e,t,n,r=yield this.engine.getHWDeviceByWalletId(this.vault.walletId);return{connectId:null!=(e=null==r?void 0:r.mac)?e:"",deviceId:null!=(t=null==r?void 0:r.deviceId)?t:"",deviceType:null!=(n=null==r?void 0:r.deviceType)?n:""}}));return function(){return e.apply(this,arguments)}}(),o.getWalletPassphraseState=function(){var e=i()((function*(){var e=yield this.engine.getWallet(this.vault.walletId);return{passphraseState:null==e?void 0:e.passphraseState,useEmptyPassphrase:!Object(y.isPassphraseWallet)(e)}}));return function(){return e.apply(this,arguments)}}(),o.getHardwareSDKInstance=function(){var t=i()((function*(){var t,n,r,i,o;return null!=(o=yield null==(t=e)||null==(n=t.$backgroundApiProxy)||null==(r=n.backgroundApi)||null==(i=r.serviceHardware)||null==i.getSDKInstance?void 0:i.getSDKInstance())?o:p.HardwareSDK}));return function(){return t.apply(this,arguments)}}(),o.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},a()(r)}(n(3903).KeyringBase)}.call(this,n(58))},3914:function(e,t,n){"use strict";n.r(t),n.d(t,"KeyringHdBase",(function(){return T}));var r=n(3),i=n.n(r),o=n(2),a=n.n(o),s=n(6),u=n.n(s),c=n(9),d=n.n(c),l=n(14),f=n.n(l),p=n(7),y=n.n(p),h=n(610),v=n(23);function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function w(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function m(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=y()(e);if(t){var i=y()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f()(this,n)}}var T=function(e){d()(n,e);var t=m(n);function n(){return t.apply(this,arguments)}var r=n.prototype;return r.getPrivateKeys=function(){var e=a()((function*(e,t){var n=(yield this.getDbAccount()).path.split("/"),r=t||[n.pop()],i=n.join("/"),o=(yield this.engine.dbApi.getCredential(this.walletId,e)).seed;if("undefined"===typeof o)throw new v.OneKeyInternalError("Unable to get credential.");var a=(yield this.engine.providerManager.getChainInfoByNetworkId(this.networkId)).curve;return Object(h.batchGetPrivateKeys)(a,o,e,i,r).reduce((function(e,t){var n;return w(w({},e),{},((n={})[t.path]=t.extendedKey.key,n))}),{})}));return function(t,n){return e.apply(this,arguments)}}(),r.getAddress=function(){throw new Error("Method not implemented.")},r.batchGetAddress=function(){throw new Error("Method not implemented.")},r.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},u()(n)}(n(3905).KeyringSoftwareBase)},3915:function(e,t,n){"use strict";n.r(t),n.d(t,"KeyringImportedBase",(function(){return h}));var r=n(2),i=n.n(r),o=n(6),a=n.n(o),s=n(9),u=n.n(s),c=n(14),d=n.n(c),l=n(7),f=n.n(l),p=n(23);function y(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f()(e);if(t){var i=f()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return d()(this,n)}}var h=function(e){u()(n,e);var t=y(n);function n(){return t.apply(this,arguments)}var r=n.prototype;return r.getPrivateKeys=function(){var e=i()((function*(e,t){if("undefined"!==typeof t)throw new p.NotImplemented("Getting private keys from extended private key");var n=(yield this.engine.dbApi.getCredential(this.accountId,e)).privateKey;if("undefined"===typeof n)throw new p.OneKeyInternalError("Unable to get credential.");return{"":n}}));return function(t,n){return e.apply(this,arguments)}}(),r.getAddress=function(){throw new Error("Method not implemented.")},r.batchGetAddress=function(){throw new Error("Method not implemented.")},r.prepareAccountByAddressIndex=function(){throw new Error("Method not implemented.")},a()(n)}(n(3905).KeyringSoftwareBase)},3916:function(e,t,n){"use strict";n.r(t),n.d(t,"KeyringWatchingBase",(function(){return h}));var r=n(2),i=n.n(r),o=n(6),a=n.n(o),s=n(9),u=n.n(s),c=n(14),d=n.n(c),l=n(7),f=n.n(l),p=n(23);function y(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f()(e);if(t){var i=f()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return d()(this,n)}}var h=function(e){u()(n,e);var t=y(n);function n(){return t.apply(this,arguments)}var r=n.prototype;return r.signTransaction=function(){var e=i()((function*(e,t){throw new p.OneKeyInternalError("signTransaction is not supported for watching accounts")}));return function(t,n){return e.apply(this,arguments)}}(),r.signMessage=function(){var e=i()((function*(e,t){throw new p.OneKeyInternalError("signMessage is not supported for watching accounts")}));return function(t,n){return e.apply(this,arguments)}}(),r.getAddress=function(){throw new Error("Method not implemented.")},r.batchGetAddress=function(){throw new Error("Method not implemented.")},r.prepareAccountByAddressIndex=function(){throw new Error("Method not implemented.")},a()(n)}(n(3903).KeyringBase)},3918:function(e,t,n){"use strict";n.r(t),n.d(t,"convertDeviceError",(function(){return s}));var r=n(70),i=n(90),o=n(19);n(24);function a(e,t){return"string"!==typeof t?null:e===r.HardwareErrorCode.DeviceInitializeFailed&&t.includes("ECONNABORTED")?new i.ConnectTimeoutError({message:t}):t.includes("Bridge network error")?new i.BridgeNetworkError({message:t}):null}function s(e){var t,n=e||{},s=n.code,u=n.error,c=n.message,d=null!=(t=null!=u?u:c)?t:"Unknown error";if(a(s,d))return a(s,d);switch(o.default.hardwareSDK.info("Device Utils Convert Device Error:",s,d),s){case r.HardwareErrorCode.UnknownError:return new i.UnknownHardwareError(e);case r.HardwareErrorCode.DeviceFwException:return new i.FirmwareVersionTooLow(e);case r.HardwareErrorCode.DeviceUnexpectedMode:return"string"===typeof d&&-1!==d.indexOf("ui-device_bootloader_mode")?new i.NotInBootLoaderMode(e):new i.UnknownHardwareError(e);case r.HardwareErrorCode.DeviceCheckDeviceIdError:return new i.DeviceNotSame(e);case r.HardwareErrorCode.DeviceNotFound:return new i.DeviceNotFind(e);case r.HardwareErrorCode.DeviceUnexpectedBootloaderMode:return new i.NotInBootLoaderMode(e);case r.HardwareErrorCode.DeviceInterruptedFromOutside:case r.HardwareErrorCode.DeviceInterruptedFromUser:return new i.UserCancelFromOutside(e);case r.HardwareErrorCode.DeviceNotSupportPassphrase:return new i.NotSupportPassphraseError(e);case r.HardwareErrorCode.IFrameLoadFail:return new i.InitIframeLoadFail(e);case r.HardwareErrorCode.IframeTimeout:return new i.InitIframeTimeout(e);case r.HardwareErrorCode.FirmwareUpdateDownloadFailed:return new i.FirmwareDownloadFailed(e);case r.HardwareErrorCode.FirmwareUpdateManuallyEnterBoot:return new i.FirmwareUpdateManuallyEnterBoot(e);case r.HardwareErrorCode.FirmwareUpdateAutoEnterBootFailure:return new i.FirmwareUpdateAutoEnterBootFailure(e);case r.HardwareErrorCode.FirmwareUpdateLimitOneDevice:return new i.FirmwareUpdateLimitOneDevice(e);case r.HardwareErrorCode.CallMethodNeedUpgradeFirmware:return new i.FirmwareVersionTooLow(e);case r.HardwareErrorCode.NewFirmwareUnRelease:return new i.NewFirmwareUnRelease(e);case r.HardwareErrorCode.NewFirmwareForceUpdate:return new i.NewFirmwareForceUpdate(e);case r.HardwareErrorCode.NetworkError:return new i.NetworkError(e);case r.HardwareErrorCode.BlePermissionError:return new i.NeedBluetoothTurnedOn(e);case r.HardwareErrorCode.BleLocationError:return new i.NeedBluetoothPermissions({message:d});case r.HardwareErrorCode.BleLocationServicesDisabled:return new i.BleLocationServiceError({message:d});case r.HardwareErrorCode.BleDeviceNotBonded:return new i.DeviceNotBonded(e);case r.HardwareErrorCode.BleDeviceBondError:return new i.DeviceBondError(e);case r.HardwareErrorCode.BleWriteCharacteristicError:return new i.BleWriteCharacteristicError(e);case r.HardwareErrorCode.BleScanError:return new i.BleScanError({message:d});case r.HardwareErrorCode.BleAlreadyConnected:return new i.BleAlreadyConnectedError(e);case r.HardwareErrorCode.RuntimeError:return-1!==d.indexOf("EIP712 blind sign is disabled")?new i.OpenBlindSign(e):-1!==d.indexOf("Unknown message")||-1!==d.indexOf("Failure_UnexpectedMessage")?new i.UnknownMethod(e):new i.UnknownHardwareError(e);case r.HardwareErrorCode.PinInvalid:return new i.InvalidPIN(e);case r.HardwareErrorCode.DeviceCheckPassphraseStateError:return new i.InvalidPassphrase(e);case r.HardwareErrorCode.DeviceOpenedPassphrase:return new i.DeviceOpenedPassphrase(e);case r.HardwareErrorCode.DeviceNotOpenedPassphrase:return new i.DeviceNotOpenedPassphrase(e);case r.HardwareErrorCode.PinCancelled:case r.HardwareErrorCode.ActionCancelled:return new i.UserCancel(e);case r.HardwareErrorCode.BridgeNotInstalled:case i.CustomOneKeyHardwareError.NeedOneKeyBridge:return new i.NeedOneKeyBridge(e);case r.HardwareErrorCode.BridgeNetworkError:return new i.BridgeNetworkError(e);case r.HardwareErrorCode.BridgeTimeoutError:return new i.BridgeTimeoutError(e);case r.HardwareErrorCode.PollingTimeout:return new i.ConnectTimeoutError(e);case r.HardwareErrorCode.PollingStop:return new i.ConnectPollingStopError(e);case r.HardwareErrorCode.BlindSignDisabled:return new i.OpenBlindSign(e);case r.HardwareErrorCode.FileAlreadyExists:return new i.FileAlreadyExistError(e);case r.HardwareErrorCode.CheckDownloadFileError:return new i.IncompleteFileError(e);case r.HardwareErrorCode.NotInSigningMode:return new i.NotInSigningModeError(e);default:return new i.UnknownHardwareError(e)}}},4117:function(e,t,n){"use strict";n.r(t),function(e){n.d(t,"toBip32StringPath",(function(){return u})),n.d(t,"getPathIndex",(function(){return c})),n.d(t,"getRootKey",(function(){return d})),n.d(t,"getXprvString",(function(){return f})),n.d(t,"generateExportedCredential",(function(){return y})),n.d(t,"decodePrivateKeyByXprv",(function(){return v})),n.d(t,"encodePrivateKey",(function(){return g}));var r=n(2),i=n.n(r),o=n(4230),a=n(610),s=n(4233);function u(e){return"m/"+e.map((function(e){return e%s.HARDENED_THRESHOLD+(e>=s.HARDENED_THRESHOLD?"'":"")})).join("/")}function c(e){return e.split("/").slice(3,4)[0].slice(0,-1)}function d(e,t){return l.apply(this,arguments)}function l(){return(l=i()((function*(e,t){var n=Object(a.mnemonicFromEntropy)(t,e);return yield Object(o.mnemonicToRootKeypair)(n,s.DERIVATION_SCHEME)}))).apply(this,arguments)}function f(e,t){return p.apply(this,arguments)}function p(){return(p=i()((function*(t,n){var r="string"===typeof t?yield d(t,n):t;return o.bech32.encode("xprv",e.concat([r.slice(0,64),r.slice(96)]))}))).apply(this,arguments)}function y(e,t,n){return h.apply(this,arguments)}function h(){return(h=i()((function*(t,n,r){var i=c(r),a=yield d(t,n);return o.bech32.encode("xprv",e.concat([a.slice(0,64),a.slice(96,128),e.from(i,"utf8")]))}))).apply(this,arguments)}function v(t){var n=o.bech32.decode(t),r=n.data.slice(96),i=Object(o.toPublic)(n.data.slice(0,64));return e.concat([n.data.slice(0,64),i,n.data.slice(64,96),r])}function g(t){return{rootKey:t.slice(0,128),index:e.from(t.slice(128)).toString("utf8")}}}.call(this,n(26).Buffer)},4233:function(e,t,n){"use strict";n.r(t),n.d(t,"HARDENED_THRESHOLD",(function(){return r})),n.d(t,"DERIVATION_SCHEME",(function(){return i}));var r=2147483648,i=2},4925:function(e,t,n){"use strict";n.r(t),function(e){var r=n(1639),i=n.n(r),o=n(3),a=n.n(o),s=n(2),u=n.n(s),c=n(6),d=n.n(c),l=n(107),f=n.n(l),p=n(21),y=n.n(p),h=n(118),v=n(46),g=n(150),w=n(23);function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function T(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach((function(t){a()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var A=function(){function t(t){var n=this;this.getAssociatedAddresses=Object(g.memoizee)(function(){var e=u()((function*(e){return(yield n.request.get("/accounts/"+e+"/addresses").then((function(e){return e.data}))).map((function(e){return e.address}))}));return function(t){return e.apply(this,arguments)}}(),{promise:!0,maxAge:Object(v.getTimeDurationMs)({minute:3})}),this.getUTXOs=Object(g.memoizee)(function(){var e=u()((function*(e,t,r){var i=r["2/0"],o=(yield n.backendRequest.get("/utxos?stakeAddress="+i+"&xpub="+e)).data,a=t.split("/")[3];return o.map((function(e){var t=e.path;if(t&&t.length>0){var n=t.split("/");n.splice(3,1,a),t=n.join("/")}return T(T({},e),{},{path:t,output_index:e.tx_index})}))}));return function(t,n,r){return e.apply(this,arguments)}}(),{promise:!0,maxAge:Object(v.getTimeDurationMs)({minute:1})}),this.getHistory=Object(g.memoizee)(function(){var e=u()((function*(e,t){return n.backendRequest.get("/history",{params:{stakeAddress:e,address:t}}).then((function(e){return e.data}))}));return function(t,n){return e.apply(this,arguments)}}(),{promise:!0,maxAge:Object(v.getTimeDurationMs)({seconds:30})}),this.getAssetDetail=Object(g.memoizee)(function(){var t=u()((function*(t){var r,o,a,s=t.asset,u=t.networkId,c=t.dangerouseFallbackDecimals,d=(yield n.request.get("/assets/"+s)).data,l=d.asset_name,f=d.metadata,p=e.from(l,"hex").toString("utf8"),y=!!/^[\x00-\x7F]+$/.test(p)?p:l;if(i()(null==f?void 0:f.decimals)&&i()(c))throw new w.OneKeyInternalError("Invalid token address: "+s);return{id:u+"--"+s,address:s,decimals:null!=(r=null==f?void 0:f.decimals)?r:c,impl:"ada",isNative:!1,networkId:u,symbol:null!=(o=null==f?void 0:f.ticker)?o:y,name:null!=(a=null==f?void 0:f.name)?a:y,tokenIdOnNetwork:s,logoURI:""}}));return function(e){return t.apply(this,arguments)}}(),{promise:!0,maxAge:Object(v.getTimeDurationMs)({minute:1})}),this.request=f.a.create({baseURL:t,timeout:2e4}),this.backendRequest=f.a.create({baseURL:Object(h.getFiatEndpoint)()+"/cardano",timeout:2e4})}var n=t.prototype;return n.latestBlock=function(){var e=u()((function*(){var e,t=yield this.request.get("/blocks/latest").then((function(e){return e.data}));return{height:Number(null!=(e=t.height)?e:0)}}));return function(){return e.apply(this,arguments)}}(),n.getAddress=function(){var e=u()((function*(e){return this.request.get("/addresses/"+e).then((function(e){return e.data}))}));return function(t){return e.apply(this,arguments)}}(),n.getAddressDetails=function(){var e=u()((function*(e){try{return(yield this.request.get("/addresses/"+e+"/total")).data}catch(t){return{address:e,tx_count:0}}}));return function(t){return e.apply(this,arguments)}}(),n.getAccount=function(){var e=u()((function*(e){return this.request.get("/accounts/"+e).then((function(e){return e.data}))}));return function(t){return e.apply(this,arguments)}}(),n.getBalance=function(){var e=u()((function*(e){var t,n=yield this.request.get("/accounts/"+e).then((function(e){return e.data}));return null!=(t=new y.a(n.controlled_amount))?t:0}));return function(t){return e.apply(this,arguments)}}(),n.getBalanceWithLovelace=function(){var e=u()((function*(e){var t;return{unit:"lovelace",quantity:null!=(t=(yield this.request.get("/accounts/"+e).then((function(e){return e.data}))).controlled_amount)?t:"0"}}));return function(t){return e.apply(this,arguments)}}(),n.getRawTransaction=function(){var e=u()((function*(e){return this.request.get("/txs/"+e).then((function(e){return e.data}))}));return function(t){return e.apply(this,arguments)}}(),n.submitTx=function(){var t=u()((function*(t){var n=null;return n="string"===typeof t?e.from(t,"hex"):e.from(t),this.request.post("/tx/submit",n,{headers:{"Content-Type":"application/cbor"}}).then((function(e){return e.data}))}));return function(e){return t.apply(this,arguments)}}(),n.getAssetsBalances=function(){var e=u()((function*(e){return this.request.get("/accounts/"+e+"/addresses/assets").then((function(e){return e.data}))}));return function(t){return e.apply(this,arguments)}}(),d()(t)}();t.default=A}.call(this,n(26).Buffer)},6104:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return ke}));var r,i=n(13),o=n.n(i),a=n(342),s=n.n(a),u=n(3),c=n.n(u),d=n(1639),l=n.n(d),f=n(4),p=n.n(f),y=n(2),h=n.n(y),v=n(6),g=n.n(v),w=n(9),m=n.n(w),T=n(14),A=n.n(T),O=n(7),b=n.n(O),I=n(21),E=n.n(I),x=n(367),P=n(46),D=n(11),k=n(19),C=n(150),S=n(23),N=n(317),R=n(182),B=n(117),j=n(52),H=n(3912),K=n(4230),F=n(1611),_=n(4233),M=function(e){var t,n=Object(K.getAddressType)(e);if(n===K.AddressTypes.BOOTSTRAP)return K.base58.encode(e);var r=((t={})[K.AddressTypes.BASE]="addr",t[K.AddressTypes.POINTER]="addr",t[K.AddressTypes.ENTERPRISE]="addr",t[K.AddressTypes.REWARD]="stake",t),i=Object(K.getShelleyAddressNetworkId)(e)===F.NetworkId.TESTNET_OR_PREPROD,o=r[n]+(i?"_test":"");return K.bech32.encode(o,e)},U=function(e){return Object(K.getPubKeyBlake2b224Hash)(function(e){return e.slice(0,32)}(e))},L=function(e,t){var n=Object(K.packRewardAddress)(U(e),t);return M(n)},V=function(e,t,n){var r=Object(K.packBaseAddress)(U(e),U(t),n);return M(r)},W=function(e){return(e.startsWith("addr1")||e.startsWith("addr_test1"))&&Object(K.isValidShelleyAddress)(e)},q=n(4117),G=function(e){return{address:e.address,addressParameters:{path:e.path,addressType:0,stakingPath:e.path.slice(0,-3)+"2/0"}}},X=n(4925),Y={getCardanoApi:{getCardanoApi:function(){var e=h()((function*(){var e=yield Promise.all([n.e(46),n.e(90)]).then(n.bind(null,6113));return{composeTxPlan:e.onekeyUtils.composeTxPlan,signTransaction:e.onekeyUtils.signTransaction,hwSignTransaction:e.trezorUtils.signTransaction,txToOneKey:e.onekeyUtils.txToOneKey,dAppGetBalance:e.dAppUtils.getBalance,dAppGetAddresses:e.dAppUtils.getAddresses,dAppGetUtxos:e.dAppUtils.getUtxos,dAppConvertCborTxToEncodeTx:e.dAppUtils.convertCborTxToEncodeTx,dAppSignData:e.dAppUtils.signData}}));return function(){return e.apply(this,arguments)}}()}.getCardanoApi,ensureSDKReady:function(){var e=h()((function*(){return Promise.resolve(!0)}));return function(){return e.apply(this,arguments)}}()},z=n(3918),J=n(431),Q=n(3913);function $(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Z(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$(Object(n),!0).forEach((function(t){c()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}!function(e){e[e.BASE=0]="BASE",e[e.BASE_SCRIPT_KEY=1]="BASE_SCRIPT_KEY",e[e.BASE_KEY_SCRIPT=2]="BASE_KEY_SCRIPT",e[e.BASE_SCRIPT_SCRIPT=3]="BASE_SCRIPT_SCRIPT",e[e.POINTER=4]="POINTER",e[e.POINTER_SCRIPT=5]="POINTER_SCRIPT",e[e.ENTERPRISE=6]="ENTERPRISE",e[e.ENTERPRISE_SCRIPT=7]="ENTERPRISE_SCRIPT",e[e.BYRON=8]="BYRON",e[e.REWARD=14]="REWARD",e[e.REWARD_SCRIPT=15]="REWARD_SCRIPT"}(r||(r={}));var ee=function(e,t){return e.map((function(e){var n=t.find((function(t){return t.tx_hash===e.txHash&&+t.output_index===e.outputIndex}));if(!n)throw Error("Cannot transform utxo "+e.txHash+":"+e.outputIndex);return{path:n.path,prev_hash:e.txHash,prev_index:e.outputIndex}}))},te=function(e){return{policyId:e.slice(0,56),assetNameInHex:e.slice(56)}},ne=function(e){if(0!==e.length){var t=[];e.forEach((function(e){var n=te(e.unit).policyId;t.includes(n)||t.push(n)}));var n=[];return t.forEach((function(t){var r=[];e.forEach((function(e){var n=te(e.unit);n.policyId===t&&r.push({assetNameBytes:n.assetNameInHex,amount:e.quantity})})),n.push({policyId:t,tokenAmounts:r})})),n}},re=function(e,t){return e.map((function(e){return Z(Z({},e.isChange?{addressParameters:t}:{address:e.address}),{},{amount:e.amount,tokenBundle:ne(e.assets)})}))};function ie(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function oe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ie(Object(n),!0).forEach((function(t){c()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ie(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ae(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=b()(e);if(t){var i=b()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return A()(this,n)}}var se="m/1852'/"+D.COINTYPE_ADA+"'",ue=function(){var e=h()((function*(){var e=(yield Object(J.CoreSDKLoader)()).PROTO;return{addressType:e.CardanoAddressType.BASE,derivationType:e.CardanoDerivationType.ICARUS,protocolMagic:764824073,networkId:F.NetworkId.MAINNET}}));return function(){return e.apply(this,arguments)}}(),ce=function(e){m()(n,e);var t=ae(n);function n(){return t.apply(this,arguments)}var r=n.prototype;return r.prepareAccounts=function(){var e=h()((function*(e){var t,n=e.indexes,r=e.names,i=0!==n[0],a=[].concat(o()(i?[n[0]-1]:[]),o()(n)),s=a.map((function(e){return se+"/"+e+"'/0/0"})),u=a.map((function(e){return se+"/"+e+"'/2/0"})),c=yield this.getHardwareSDKInstance(),d=yield this.getHardwareInfo(),l=d.connectId,f=d.deviceId,p=yield this.getWalletPassphraseState(),y=yield ue(),h=y.derivationType,v=y.addressType,g=y.networkId,w=y.protocolMagic,m=s.map((function(e,t){return{addressParameters:{addressType:v,path:e,stakingPath:u[t]},networkId:g,protocolMagic:w,derivationType:h,showOnOneKey:!1}}));try{t=yield c.cardanoGetAddress(l,f,oe(oe({},p),{},{bundle:m}))}catch(H){throw k.default.common.error(H),new S.OneKeyHardwareError(H)}if(!t.success||!t.payload)throw Object(z.convertDeviceError)(t.payload);if(t.payload.length!==a.length)throw new S.OneKeyInternalError("Unable to get publick key.");var T=yield this.vault.getClient(),A=[],O=0;for(var b of t.payload){var I=b.address,E=b.xpub,x=b.serializedPath,P=b.stakeAddress;if(I){var C,N=(r||[])[O]||"CARDANO #"+(a[O]+1),R=((C={})["0/0"]=I,C);P&&(R["2/0"]=P);var j=x.slice(0,-4);if((!i||O>0)&&A.push({id:this.walletId+"--"+j,name:N,type:B.AccountType.UTXO,path:x,coinType:D.COINTYPE_ADA,xpub:null!=E?E:"",address:I,addresses:R}),1===a.length)break;if(!((yield T.getAddressDetails(I)).tx_count>0))break;O+=1,yield new Promise((function(e){return setTimeout(e,200)}))}}return A}));return function(t){return e.apply(this,arguments)}}(),r.getAddress=function(){var e=h()((function*(e){var t,n=yield this.getHardwareSDKInstance(),r=yield this.getHardwareInfo(),i=r.connectId,o=r.deviceId,a=yield this.getWalletPassphraseState(),s=e.path,u=s.split("/").slice(0,4).join("/")+"/2/0",c=yield ue(),d=c.derivationType,l=c.addressType,f=c.networkId,p=c.protocolMagic,y=yield n.cardanoGetAddress(i,o,oe(oe({},a),{},{addressParameters:{addressType:l,path:s,stakingPath:u},networkId:f,protocolMagic:p,derivationType:d,isCheck:!0,showOnOneKey:!0}));if(y.success&&null!=(t=y.payload)&&t.address)return y.payload.address;throw Object(z.convertDeviceError)(y.payload)}));return function(t){return e.apply(this,arguments)}}(),r.batchGetAddress=function(){var e=h()((function*(e){var t=yield this.getHardwareSDKInstance(),n=yield this.getHardwareInfo(),r=n.connectId,i=n.deviceId,o=yield this.getWalletPassphraseState(),a=yield ue(),s=a.derivationType,u=a.addressType,c=a.networkId,d=a.protocolMagic,l=yield t.cardanoGetAddress(r,i,oe(oe({},o),{},{bundle:e.map((function(e){var t=e.path,n=e.showOnOneKey,r=t.split("/").slice(0,4).join("/")+"/2/0";return{addressParameters:{addressType:u,path:t,stakingPath:r},networkId:c,protocolMagic:d,derivationType:s,isCheck:!0,showOnOneKey:!!n}}))}));if(!l.success)throw Object(z.convertDeviceError)(l.payload);return l.payload.map((function(e){return{path:e.serializedPath,address:e.address}}))}));return function(t){return e.apply(this,arguments)}}(),r.signTransaction=function(){var e=h()((function*(e){var t,n=(yield Object(J.CoreSDKLoader)()).PROTO,r=yield this.getHardwareSDKInstance(),i=yield this.getHardwareInfo(),o=i.connectId,a=i.deviceId,s=yield this.getWalletPassphraseState(),u=e.payload.encodedTx,c=yield this.getDbAccount(),d=G(c),l=yield ue(),f=l.derivationType,p=l.networkId,y=l.protocolMagic,h=yield(yield this.vault.getClient()).getUTXOs(c.xpub,c.path,c.addresses),v=u.inputs,g=u.outputs,w=u.fee,m=u.tx,T=!!u.signOnly,A=m.rawTxHex,O=yield Y.getCardanoApi();if(T&&A){var b=c.path.split("/").slice(0,4).join("/")+"/2/0",I={payment:{hash:null,path:c.path},stake:{hash:null,path:b}};t=yield O.txToOneKey(A,p,I,c.xpub,d)}else t={signingMode:n.CardanoTxSigningMode.ORDINARY_TRANSACTION,outputs:re(g,d.addressParameters),fee:w,protocolMagic:y,networkId:p};k.default.hardwareSDK.info("cardano signTx params: ",t);var E=yield r.cardanoSignTransaction(o,a,oe(oe({},s),{},{inputs:ee(v,h),derivationType:f},t));if(!E.success)throw Object(z.convertDeviceError)(E.payload);return{rawTx:yield O.hwSignTransaction(m.body,E.payload.witnesses,{signOnly:!!u.signOnly}),txid:m.hash}}));return function(t){return e.apply(this,arguments)}}(),r.signMessage=function(){var e=h()((function*(e){k.default.common.info("signMessage",e);var t=yield this.getDbAccount(),n=yield this.getHardwareInfo(),r=n.connectId,i=n.deviceId,o=yield this.getWalletPassphraseState(),a=yield this.getHardwareSDKInstance(),s=yield ue(),u=s.derivationType,c=s.networkId;return(yield Promise.all(e.map(function(){var e=h()((function*(e){var n=e.payload,s=yield a.cardanoSignMessage(r,i,oe(oe({},o),{},{path:t.path,networkId:c,derivationType:u,message:n.payload}));if(!s.success)throw Object(z.convertDeviceError)(s.payload);return s.payload}));return function(t){return e.apply(this,arguments)}}()))).map((function(e){return JSON.stringify(e)}))}));return function(t){return e.apply(this,arguments)}}(),g()(n)}(Q.KeyringHardwareBase),de=n(1345),le=n(3914),fe=function(e){return[_.HARDENED_THRESHOLD+1852,_.HARDENED_THRESHOLD+1815,_.HARDENED_THRESHOLD+e,2,0]},pe=function(e,t){return e.reduce((function(e,t){return Object(K.derivePrivate)(e,t,_.DERIVATION_SCHEME)}),t)},ye=function(e,t){var n=pe(e,t);return Object(K.toPublic)(n.slice(0,64))},he=function(e,t,n){var r=fe(e),i=ye(r,t);return{path:r,address:L(i,n)}},ve=function(e,t,n){var r,i=(r=e,[_.HARDENED_THRESHOLD+1852,_.HARDENED_THRESHOLD+1815,_.HARDENED_THRESHOLD+r,0,0]),o=ye(i,t),a=fe(e),s=ye(a,t),u=function(e,t){return pe(e,t).slice(64).toString("hex")}(i.slice(0,3),t);return{path:Object(q.toBip32StringPath)(i),address:V(o,s,n),xpub:u}},ge=function(e,t,n){return t.map((function(t){return{baseAddress:ve(t,e,n),stakingAddress:he(t,e,n)}}))},we=function(){var e=h()((function*(e,t,n,r){var i=yield Object(q.getRootKey)(t,e);return ge(i,n,r)}));return function(t,n,r,i){return e.apply(this,arguments)}}();function me(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=b()(e);if(t){var i=b()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return A()(this,n)}}var Te=function(e){m()(n,e);var t=me(n);function n(){return t.apply(this,arguments)}var r=n.prototype;return r.getSigners=function(){var e=h()((function*(e,t){var n,r=yield this.getDbAccount();if(1!==t.length)throw new S.OneKeyInternalError("Starcoin signers number should be 1.");if(t[0]!==r.address)throw new S.OneKeyInternalError("Wrong address required for signing.");var i=(yield this.getPrivateKeys(e))[r.path];if("undefined"===typeof i)throw new S.OneKeyInternalError("Unable to get signer.");return(n={})[r.address]=new de.Signer(i,e,"ed25519"),n}));return function(t,n){return e.apply(this,arguments)}}(),r.prepareAccounts=function(){var e=h()((function*(e){var t=e.password,n=e.indexes,r=e.names,i=e.skipCheckAccountExist,a=0!==n[0],s=[].concat(o()(a?[n[0]-1]:[]),o()(n)),u=(yield this.engine.dbApi.getCredential(this.walletId,t)).entropy,c=yield we(u,t,s,F.NetworkId.MAINNET);if(c.length!==s.length)throw new S.OneKeyInternalError("Unable to get address");var d=yield this.vault.getClient(),l=[],f=0;for(var p of c){var y,h=p.baseAddress,v=p.stakingAddress,g=h.address,w=h.path,m=h.xpub,T=(r||[])[f]||"CARDANO #"+(s[f]+1),A=w.slice(0,-4);if(!a||f>0)l.push({id:this.walletId+"--"+A,name:T,type:B.AccountType.UTXO,path:w,coinType:D.COINTYPE_ADA,xpub:m,address:g,addresses:(y={},y["0/0"]=g,y["2/0"]=v.address,y)});if(1===s.length)break;if(i)f+=1;else{if(!((yield d.getAddressDetails(g)).tx_count>0))break;f+=1,yield new Promise((function(e){return setTimeout(e,200)}))}}return l}));return function(t){return e.apply(this,arguments)}}(),r.signTransaction=function(){var e=h()((function*(e,t){k.default.sendTx.info("signTransaction result",e);var n=e.payload.encodedTx,r=yield this.getDbAccount(),i=t.password,o=void 0===i?"":i,a=(yield this.engine.dbApi.getCredential(this.walletId,o)).entropy,s=yield Object(q.getXprvString)(o,a),u=Object(q.getPathIndex)(r.path),c=yield Y.getCardanoApi(),d=yield c.signTransaction(n.tx.body,r.address,Number(u),n.inputs,s,!!n.signOnly,!1);return{rawTx:d.signedTx,txid:d.txid,encodedTx:e.encodedTx}}));return function(t,n){return e.apply(this,arguments)}}(),r.signMessage=function(){var e=h()((function*(e,t){var n=yield this.getDbAccount(),r=t.password,i=void 0===r?"":r,o=(yield this.engine.dbApi.getCredential(this.walletId,i)).entropy,a=yield Object(q.getXprvString)(i,o),s=Object(q.getPathIndex)(n.path),u=yield Y.getCardanoApi();return(yield Promise.all(e.map((function(e){var t=e.payload;return u.dAppSignData(t.addr,t.payload,a,Number(s))})))).map((function(e){return JSON.stringify(e)}))}));return function(t,n){return e.apply(this,arguments)}}(),g()(n)}(le.KeyringHdBase);function Ae(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=b()(e);if(t){var i=b()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return A()(this,n)}}var Oe=function(e){m()(n,e);var t=Ae(n);function n(){return t.apply(this,arguments)}var r=n.prototype;return r.getPrivateKeys=function(){var e=h()((function*(e,t){var n;if("undefined"!==typeof t)throw new S.NotImplemented("Getting private keys from extended private key");var r=yield this.getDbAccount(),i=(yield this.engine.dbApi.getCredential(this.accountId,e)).privateKey;if("undefined"===typeof i)throw new S.OneKeyInternalError("Unable to get credential.");return(n={})[r.path]=i,n}));return function(t,n){return e.apply(this,arguments)}}(),r.getSigners=function(){var e=h()((function*(e,t){var n,r=yield this.getDbAccount();if(1!==t.length)throw new S.OneKeyInternalError("Starcoin signers number should be 1.");if(t[0]!==r.address)throw new S.OneKeyInternalError("Wrong address required for signing.");var i=(yield this.getPrivateKeys(e))[r.path];if("undefined"===typeof i)throw new S.OneKeyInternalError("Unable to get signer.");return(n={})[r.address]=new de.Signer(i,e,"ed25519"),n}));return function(t,n){return e.apply(this,arguments)}}(),r.prepareAccounts=function(e){var t,n=e.privateKey,r=e.name,i=Object(q.encodePrivateKey)(n),o=parseInt(i.index),a=ge(i.rootKey,[o],F.NetworkId.MAINNET)[0],s=a.baseAddress,u=a.stakingAddress,c=s.address,d=s.path,l=s.xpub;return Promise.resolve([{id:"imported--"+D.COINTYPE_ADA+"--"+l,name:r||"",type:B.AccountType.UTXO,path:d,coinType:D.COINTYPE_ADA,xpub:l,address:c,addresses:(t={},t["0/0"]=c,t["2/0"]=u.address,t)}])},r.signTransaction=function(){var e=h()((function*(e,t){k.default.sendTx.info("signTransaction result",e);var n=e.payload.encodedTx,r=yield this.getDbAccount(),i=(yield this.getSigners(t.password||"",[r.address]))[r.address],o=yield i.getPrvkey(),a=Object(q.encodePrivateKey)(o),s=yield Object(q.getXprvString)(a.rootKey),u=Object(q.getPathIndex)(r.path),c=yield Y.getCardanoApi(),d=yield c.signTransaction(n.tx.body,r.address,Number(u),n.inputs,s,!!n.signOnly,!1);return{rawTx:d.signedTx,txid:d.txid,encodedTx:e.encodedTx}}));return function(t,n){return e.apply(this,arguments)}}(),r.signMessage=function(){var e=h()((function*(e,t){var n=yield this.getDbAccount(),r=(yield this.getSigners(t.password||"",[n.address]))[n.address],i=yield r.getPrvkey(),o=Object(q.encodePrivateKey)(i),a=yield Object(q.getXprvString)(o.rootKey),s=Object(q.getPathIndex)(n.path),u=yield Y.getCardanoApi();return(yield Promise.all(e.map((function(e){var t=e.payload;return u.dAppSignData(t.addr,t.payload,a,Number(s))})))).map((function(e){return JSON.stringify(e)}))}));return function(t,n){return e.apply(this,arguments)}}(),g()(n)}(n(3915).KeyringImportedBase);function be(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=b()(e);if(t){var i=b()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return A()(this,n)}}var Ie=function(e){m()(n,e);var t=be(n);function n(){return t.apply(this,arguments)}return n.prototype.prepareAccounts=function(){var e=h()((function*(e){var t,n=e.target,r=e.name,i=e.accountIdPrefix,o=yield this.vault.validateAddress(n);if("undefined"===typeof o)throw new S.InvalidAddress;var a,s=yield this.vault.getClient();try{a=yield s.getAddress(o)}catch(c){throw new S.InvalidAccount}var u=((t={})["0/0"]=o,t["2/0"]=a.stake_address,t);return Promise.resolve([{id:i+"--"+D.COINTYPE_ADA+"--"+n,name:r||"",type:B.AccountType.UTXO,path:"",coinType:D.COINTYPE_ADA,xpub:"",address:o,addresses:u}])}));return function(t){return e.apply(this,arguments)}}(),g()(n)}(n(3916).KeyringWatchingBase),Ee=n(2724);function xe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Pe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?xe(Object(n),!0).forEach((function(t){c()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function De(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=b()(e);if(t){var i=b()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return A()(this,n)}}var ke=function(e){m()(n,e);var t=De(n);function n(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).keyringMap={hd:Te,hw:ce,imported:Oe,watching:Ie,external:Ie},e.settings=Ee.default,e.getClientCache=Object(C.memoizee)((function(e){return new X.default(e)}),{maxAge:Object(P.getTimeDurationMs)({minute:3})}),e.getInputOrOutputBalance=function(e,t){var n,r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"lovelace",o=e.filter((function(e){return e.unit===i}));if(!o||o.length<=0)return{balance:"0",balanceValue:"0"};var a=null!=(n=null==(r=o[0])?void 0:r.quantity)?n:"0";return{balance:new E.a(a).shiftedBy(-t).toFixed(),balanceValue:a}},e.getOutputAmount=function(e,t){var n,r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"lovelace",o=e.find((function(e){return!e.isChange}));if(!o)return{amount:new E.a(0).shiftedBy(-t).toFixed(),amountValue:"0"};if("lovelace"===i)return{amount:new E.a(o.amount).shiftedBy(-t).toFixed(),amountValue:o.amount};var a=o.assets.find((function(e){return e.unit===i}));return{amount:new E.a(null!=(n=null==a?void 0:a.quantity)?n:0).shiftedBy(-t).toFixed(),amountValue:null!=(r=null==a?void 0:a.quantity)?r:"0"}},e.getStakeAddress=Object(C.memoizee)(function(){var t=h()((function*(t){return W(t)&&t.startsWith("stake")?t:(yield e.engine.dbApi.getAccountByAddress({address:t,coinType:D.COINTYPE_ADA})).addresses["2/0"]}));return function(e){return t.apply(this,arguments)}}(),{maxAge:Object(P.getTimeDurationMs)({minute:3}),promise:!0}),e}var r=n.prototype;return r.getClient=function(){var e=h()((function*(){var e=yield this.getRpcUrl();return this.getClientCache(e)}));return function(){return e.apply(this,arguments)}}(),r.getOutputAccount=function(){var e=h()((function*(){var e=yield this.getDbAccount({noCache:!0});return{id:e.id,name:e.name,type:e.type,path:e.path,coinType:e.coinType,tokens:[],address:e.address,addresses:JSON.stringify(e.addresses),template:e.template}}));return function(){return e.apply(this,arguments)}}(),r.getFetchBalanceAddress=function(e){if(e.type===B.AccountType.UTXO&&"object"===typeof e.addresses)return Promise.resolve(e.addresses["2/0"]);if("string"===typeof e.addresses)try{var t=JSON.parse(e.addresses);return Promise.resolve(t["2/0"])}catch(n){return Promise.resolve(e.address)}return Promise.resolve(e.address)},r.getClientEndpointStatus=function(){var e=h()((function*(){var e=performance.now(),t=yield this.getClient(),n=yield t.latestBlock();return{responseTime:Math.floor(performance.now()-e),latestBlock:n.height}}));return function(){return e.apply(this,arguments)}}(),r.validateCanCreateNextAccount=function(){var e=h()((function*(e,t){var n=yield Promise.all([this.engine.getWallet(e),this.engine.getNetwork(this.networkId)]),r=p()(n,2),i=r[0],o=r[1],a=Object(N.getLastAccountId)(i,o.impl,t);if(!a)return!0;var s=yield this.engine.dbApi.getAccounts([a]),u=p()(s,1)[0];if("undefined"!==typeof u&&!(yield this.checkAccountExistence(u.address))){var c=Object(R.getAccountNameInfoByTemplate)(o.impl,t).label;throw new S.PreviousAccountIsEmpty(c)}return!0}));return function(t,n){return e.apply(this,arguments)}}(),r.checkAccountExistence=function(){var e=h()((function*(e){var t=!1;try{var n=yield this.getClient();t=(yield n.getAddressDetails(e)).tx_count>0}catch(r){}return Promise.resolve(t)}));return function(t){return e.apply(this,arguments)}}(),r.validateAddress=function(){var e=h()((function*(e){return e.length<35?Promise.reject(new S.InvalidAddress):W(e)||function(e){return(e.startsWith("Ae2")||e.startsWith("DdzFF"))&&Object(K.isValidBootstrapAddress)(e)}(e)?Promise.resolve(e):Promise.reject(new S.InvalidAddress)}));return function(t){return e.apply(this,arguments)}}(),r.validateWatchingCredential=function(e){var t=!1;try{this.settings.watchingAccountEnabled&&W(e)&&(t=!0)}catch(n){}return Promise.resolve(t)},r.validateImportedCredential=function(e){return Promise.resolve(this.settings.importedAccountEnabled&&/^xprv/.test(e)&&e.length>=165)},r.getExportedCredential=function(){var e=h()((function*(e){var t=(yield this.engine.dbApi.getCredential(this.walletId,e)).entropy,n=yield this.getDbAccount();return Object(q.generateExportedCredential)(e,t,n.path)}));return function(t){return e.apply(this,arguments)}}(),r.attachFeeInfoToEncodedTx=function(e){return Promise.resolve(e.encodedTx)},r.decodedTxToLegacy=function(e){return Promise.resolve({})},r.decodeTx=function(){var e=h()((function*(e,t){var n,r=this,i=e.inputs,o=e.outputs,a=e.transferInfo,s=yield this.engine.getNetwork(this.networkId),u=yield this.getDbAccount(),c=yield this.getClient(),d=yield this.engine.getNativeTokenInfo(this.networkId),l=[],f=yield this.engine.getNativeTokenInfo(this.networkId);if(!(null==a||null==(n=a.token)||!n.length)){var p,y,h;if(!(f=yield this.engine.ensureTokenInDB(this.networkId,null!=(p=a.token)?p:"")))f=yield c.getAssetDetail({asset:null!=(h=a.token)?h:"",networkId:this.networkId,dangerouseFallbackDecimals:e.signOnly?0:void 0});var v=this.getOutputAmount(o,null!=(y=f.decimals)?y:s.decimals,a.token),g={tokenInfo:f,from:u.address,to:a.to,amount:v.amount,amountValue:v.amountValue,extraInfo:null};l.push({type:j.IDecodedTxActionType.TOKEN_TRANSFER,direction:o[0].address===u.address?j.IDecodedTxDirection.OUT:j.IDecodedTxDirection.SELF,tokenTransfer:g})}var w=this.getOutputAmount(o,s.decimals),m={tokenInfo:d,utxoFrom:i.map((function(e){var t=r.getInputOrOutputBalance(e.amount,s.decimals),n=t.balance,i=t.balanceValue;return{address:e.address,balance:n,balanceValue:i,symbol:s.symbol,isMine:!0}})),utxoTo:o.map((function(e){return{address:e.address,balance:new E.a(e.amount).shiftedBy(s.decimals).toFixed(),balanceValue:e.amount,symbol:s.symbol,isMine:e.address===u.address}})),from:u.address,to:a.to,amount:w.amount,amountValue:w.amountValue,extraInfo:null};return l.push({type:j.IDecodedTxActionType.NATIVE_TRANSFER,direction:o[0].address===u.address?j.IDecodedTxDirection.OUT:j.IDecodedTxDirection.SELF,nativeTransfer:m}),{txid:"",owner:u.address,signer:u.address,nonce:0,actions:l,status:j.IDecodedTxStatus.Pending,networkId:this.networkId,accountId:this.accountId,extraInfo:null,totalFeeInNative:e.totalFeeInNative}}));return function(t,n){return e.apply(this,arguments)}}(),r.buildEncodedTxFromTransfer=function(){var e=h()((function*(e){if(!e.to)throw new Error("Invalid transferInfo.to params");var t=e.to,n=e.amount,r=e.token,i=yield this.getDbAccount(),o=yield this.engine.getNetwork(this.networkId),a=o.decimals,s=o.feeDecimals,u=yield this.engine.ensureTokenInDB(this.networkId,null!=r?r:"");if(!u||l()(u.decimals))throw new S.OneKeyInternalError("Token not found: "+(r||"main"));var c,d=yield this.getClient(),f=i.xpub,y=i.path,h=i.addresses,v=yield Promise.all([d.getUTXOs(f,y,h),Y.ensureSDKReady()]),g=p()(v,1)[0],w=new E.a(n).shiftedBy(a),m=r?{address:t,amount:void 0,assets:[{quantity:w.toFixed(),unit:r}]}:{address:t,amount:w.toFixed(),assets:[]},T=yield Y.getCardanoApi();try{c=yield T.composeTxPlan(e,i.xpub,g,i.address,[m])}catch(k){if("UTXO_VALUE_TOO_SMALL"===k.code||"UTXO_VALUE_TOO_SMALL"===k.message)throw new S.InsufficientBalance;throw k}var A=G(i),O=c,b=O.fee,I=O.inputs,x=O.outputs,P=O.totalSpent,D=O.tx;return{inputs:I,outputs:x,fee:b,totalSpent:P,totalFeeInNative:new E.a(b).shiftedBy(-1*s).toFixed(),transferInfo:e,tx:D,changeAddress:A,signOnly:!1}}));return function(t){return e.apply(this,arguments)}}(),r.buildEncodedTxFromApprove=function(e){throw new S.NotImplemented},r.updateEncodedTxTokenApprove=function(e,t){throw new S.NotImplemented},r.updateEncodedTx=function(e){return Promise.resolve(e)},r.buildUnsignedTxFromEncodedTx=function(){var e=h()((function*(e){var t={inputs:e.inputs,outputs:e.outputs,payload:{},encodedTx:e};return Promise.resolve(t)}));return function(t){return e.apply(this,arguments)}}(),r.fetchOnChainHistory=function(){var e=h()((function*(e){var t=this,n=e.localHistory,r=void 0===n?[]:n,i=yield this.getClient(),o=yield this.getDbAccount(),a=yield this.getStakeAddress(o.address),s=(yield this.engine.getNetwork(this.networkId)).decimals,u=yield this.engine.getNativeTokenInfo(this.networkId),c=[];try{var d;c=null!=(d=yield i.getHistory(a,o.address))?d:[]}catch(f){}var l=c.map(function(){var e=h()((function*(e){try{var n,i=r.find((function(t){return t.decodedTx.txid===e.tx_hash}));if(i&&i.decodedTx.isFinal)return null;var a=e.tx,c=a.fee,d=a.actions,l=a.block_hash,p=a.tx_timestamp,y=d.map(function(){var e=h()((function*(e){var n=e.from,r=e.to,i=e.amount,o=(e.type,e.direction);if("NATIVE_TRANSFER"===e.type)return{type:j.IDecodedTxActionType.NATIVE_TRANSFER,direction:o,nativeTransfer:{tokenInfo:u,utxoFrom:e.utxoFrom,utxoTo:e.utxoTo,from:n,to:r,amount:i,amountValue:e.amountValue,extraInfo:null}};if("TOKEN_TRANSFER"===e.type){var a,c=yield t.engine.ensureTokenInDB(t.networkId,e.token.tokenIdOnNetwork);return!(!c||"undefined"===typeof c.decimals)&&{type:j.IDecodedTxActionType.TOKEN_TRANSFER,direction:o,tokenTransfer:{tokenInfo:null!=c?c:e.token,from:n,to:r,amount:new E.a(e.amount).shiftedBy(-(null!=(a=null==c?void 0:c.decimals)?a:s)).toFixed(),amountValue:e.amount,extraInfo:null}}}}));return function(t){return e.apply(this,arguments)}}()),v=(yield Promise.all(y)).filter(Boolean),g={txid:e.tx_hash,owner:o.address,signer:o.address,nonce:0,actions:v,status:l?j.IDecodedTxStatus.Confirmed:j.IDecodedTxStatus.Pending,networkId:t.networkId,accountId:t.accountId,extraInfo:null,totalFeeInNative:new E.a(c).shiftedBy(-s).toFixed()};return g.updatedAt="undefined"!==typeof p?1e3*p:Date.now(),g.createdAt=null!=(n=null==i?void 0:i.decodedTx.createdAt)?n:g.updatedAt,g.isFinal=g.status===j.IDecodedTxStatus.Confirmed,yield t.buildHistoryTx({decodedTx:g,historyTxToMerge:i})}catch(f){return Promise.resolve(null)}}));return function(t){return e.apply(this,arguments)}}());return(yield Promise.all(l)).filter(Boolean)}));return function(t){return e.apply(this,arguments)}}(),r.broadcastTransaction=function(){var e=h()((function*(e){k.default.engine.info("broadcastTransaction START:",{rawTx:e.rawTx});var t=yield this.getClient();try{yield t.submitTx(e.rawTx)}catch(n){throw k.default.sendTx.info("broadcastTransaction ERROR:",n),n}return k.default.engine.info("broadcastTransaction END:",{txid:e.txid,rawTx:e.rawTx}),Pe(Pe({},e),{},{encodedTx:e.encodedTx})}));return function(t){return e.apply(this,arguments)}}(),r.fetchFeeInfo=function(){var e=h()((function*(e){var t=yield this.engine.getNetwork(this.networkId);return{customDisabled:!0,limit:e.totalFeeInNative,prices:["1"],defaultPresetIndex:"0",feeSymbol:t.symbol,feeDecimals:t.feeDecimals,nativeSymbol:t.symbol,nativeDecimals:t.decimals,tx:null}}));return function(t){return e.apply(this,arguments)}}(),r.getTransactionStatuses=function(){var e=h()((function*(e){var t=yield this.getClient();return Promise.all(e.map(function(){var e=h()((function*(e){try{var n=yield t.getRawTransaction(e);return n.index||n.block_height?x.TransactionStatus.CONFIRM_AND_SUCCESS:x.TransactionStatus.PENDING}catch(r){return x.TransactionStatus.PENDING}}));return function(t){return e.apply(this,arguments)}}()))}));return function(t){return e.apply(this,arguments)}}(),r.getBalances=function(){var e=h()((function*(e){var t,n=yield this.getClient();if(e.every((function(e){return e.address.startsWith("stake")})))return yield Promise.all(e.map(function(){var e=h()((function*(e){try{return yield n.getBalance(e.address)}catch(t){return new E.a(0)}}));return function(t){return e.apply(this,arguments)}}()));var r=yield this.getStakeAddress(null==(t=e[0])?void 0:t.address),i=[n.getBalance(r)];e.some((function(e){return e.tokenAddress}))&&i.push(n.getAssetsBalances(r));try{var o=yield Promise.all(i),a=s()(o),u=a[0],c=a.slice(1);return e.map((function(e){e.address;var t=e.tokenAddress;if(!t)return u;if(Array.isArray(c)&&c.length){var n,r,i=null!=(n=null==(r=c[0].find((function(e){return e.unit===t})))?void 0:r.quantity)?n:0;return new E.a(i)}return new E.a(0)}))}catch(d){return e.map((function(){return new E.a(0)}))}}));return function(t){return e.apply(this,arguments)}}(),r.validateTokenAddress=function(){var e=h()((function*(e){var t=yield this.getClient();try{var n,r=yield t.getAssetDetail({asset:e,networkId:this.networkId});return null!=(n=r.address)?n:r.tokenIdOnNetwork}catch(i){throw i}}));return function(t){return e.apply(this,arguments)}}(),r.fetchTokenInfos=function(){var e=h()((function*(e){var t=this,n=yield this.getClient();return Promise.all(e.map(function(){var e=h()((function*(e){var r=yield n.getAssetDetail({asset:e,networkId:t.networkId});return{decimals:r.decimals,name:r.name,symbol:r.symbol}}));return function(t){return e.apply(this,arguments)}}()))}));return function(t){return e.apply(this,arguments)}}(),r.getPrivateKeyByCredential=function(){var e=h()((function*(e){return Promise.resolve(Object(q.decodePrivateKeyByXprv)(e))}));return function(t){return e.apply(this,arguments)}}(),r.getBalanceForDapp=function(){var e=h()((function*(e){var t=yield this.getClient(),n=yield this.getStakeAddress(e),r=[t.getBalanceWithLovelace(n),t.getAssetsBalances(n)],i=yield Promise.all(r),a=p()(i,2),s=a[0],u=a[1],c=[s].concat(o()(u));return(yield Y.getCardanoApi()).dAppGetBalance(c)}));return function(t){return e.apply(this,arguments)}}(),r.getUtxosForDapp=function(){var e=h()((function*(e){var t=yield this.getDbAccount(),n=yield this.getClient(),r=t.xpub,i=t.path,o=t.addresses,a=yield n.getUTXOs(r,i,o);return(yield Y.getCardanoApi()).dAppGetUtxos(t.address,a,e)}));return function(t){return e.apply(this,arguments)}}(),r.getAccountAddressForDapp=function(){var e=h()((function*(){var e=yield this.getDbAccount();return(yield Y.getCardanoApi()).dAppGetAddresses([e.address])}));return function(){return e.apply(this,arguments)}}(),r.getStakeAddressForDapp=function(){var e=h()((function*(){var e=yield this.getDbAccount(),t=yield this.getStakeAddress(e.address);return(yield Y.getCardanoApi()).dAppGetAddresses([t])}));return function(){return e.apply(this,arguments)}}(),r.buildTxCborToEncodeTx=function(){var e=h()((function*(e){var t=yield this.getDbAccount(),n=G(t),r=yield this.getClient(),i=yield this.getStakeAddress(t.address),o=yield r.getAssociatedAddresses(i),a=t.xpub,s=t.path,u=t.addresses,c=yield r.getUTXOs(a,s,u),d=yield Y.getCardanoApi();return Pe(Pe({},yield d.dAppConvertCborTxToEncodeTx(e,c,o,n)),{},{changeAddress:n})}));return function(t){return e.apply(this,arguments)}}(),g()(n)}(H.VaultBase)}}]);