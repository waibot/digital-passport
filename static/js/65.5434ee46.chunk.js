(this.webpackJsonp=this.webpackJsonp||[]).push([[65],{3903:function(e,n,t){"use strict";t.r(n),t.d(n,"KeyringBase",(function(){return y})),t.d(n,"KeyringBaseMock",(function(){return h}));var r=t(2),i=t.n(r),o=t(6),a=t.n(o),c=t(9),u=t.n(c),s=t(14),d=t.n(s),l=t(7),f=t.n(l);function p(e){var n=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,r=f()(e);if(n){var i=f()(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return d()(this,t)}}var y=function(e){u()(t,e);var n=p(t);function t(e){var t;return(t=n.call(this,e.options)).vault=e,t}return t.prototype.addressFromBase=function(){var e=i()((function*(e){return this.vault.addressFromBase(e)}));return function(n){return e.apply(this,arguments)}}(),a()(t)}(t(1585).VaultContext),h=function(e){u()(t,e);var n=p(t);function t(){return n.apply(this,arguments)}return a()(t)}(y)},3905:function(e,n,t){"use strict";t.r(n),t.d(n,"KeyringSoftwareBase",(function(){return x}));var r=t(4),i=t.n(r),o=t(3),a=t.n(o),c=t(2),u=t.n(c),s=t(6),d=t.n(s),l=t(9),f=t.n(l),p=t(14),y=t.n(p),h=t(7),v=t.n(h),g=t(19),w=t(23);function m(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function T(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?m(Object(t),!0).forEach((function(n){a()(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):m(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function I(e){var n=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,r=v()(e);if(n){var i=v()(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return y()(this,t)}}var x=function(e){f()(t,e);var n=I(t);function t(){return n.apply(this,arguments)}var r=t.prototype;return r.signTransaction=function(){var e=u()((function*(e,n){var t=n.password;if("undefined"===typeof t)throw new w.OneKeyInternalError("Software signing requires a password.");var r=yield this.getSigners(t,e.inputs.map((function(e){return e.address})));return g.default.engine.info("signTransaction",this.networkId,e),T(T({},yield this.engine.providerManager.signTransaction(this.networkId,e,r)),{},{encodedTx:e.encodedTx})}));return function(n,t){return e.apply(this,arguments)}}(),r.signMessage=function(){var e=u()((function*(e,n){var t=this,r=n.password;if("undefined"===typeof r)throw new w.OneKeyInternalError("Software signing requires a password.");var o=yield this.getDbAccount(),a=Object.values(yield this.getSigners(r,[o.address])),c=i()(a,1)[0];return g.default.engine.info("signMessage",this.networkId,e),Promise.all(e.map((function(e){return t.engine.providerManager.signMessage(t.networkId,e,c)})))}));return function(n,t){return e.apply(this,arguments)}}(),r.getAddress=function(){throw new Error("Method not implemented.")},r.batchGetAddress=function(){throw new Error("Method not implemented.")},r.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},d()(t)}(t(3903).KeyringBase)},3912:function(e,n,t){"use strict";t.r(n),function(e){t.d(n,"VaultBaseChainOnly",(function(){return R})),t.d(n,"VaultBase",(function(){return j}));var r=t(202),i=t.n(r),o=t(3),a=t.n(o),c=t(60),u=t.n(c),s=t(2),d=t.n(s),l=t(6),f=t.n(l),p=t(9),y=t.n(p),h=t(14),v=t.n(h),g=t(7),w=t.n(g),m=t(21),T=t.n(m),I=t(167),x=t.n(I),O=t(11),b=t(19),A=t(24),E=t(68),P=t(23),S=t(182),C=t(947),N=t(52),D=t(1585);function B(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function k(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?B(Object(t),!0).forEach((function(n){a()(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):B(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function _(e){var n=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,r=w()(e);if(n){var i=w()(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return v()(this,t)}}if(A.default.isExtensionUi)throw new Error("engine/VaultBase is not allowed imported from ui");var R=function(e){y()(t,e);var n=_(t);function t(){return n.apply(this,arguments)}var r=t.prototype;return r.initProvider=function(){var e=d()((function*(){var e=(yield this.getNetwork()).impl;u()(C.IMPL_MAPPINGS[e])||(this.engineProvider=yield this.engine.providerManager.getProvider(this.networkId))}));return function(){return e.apply(this,arguments)}}(),r.proxyJsonRPCCall=function(){var e=d()((function*(e){throw new P.NotImplemented}));return function(n){return e.apply(this,arguments)}}(),r.createClientFromURL=function(e){throw new P.NotImplemented},r.getEthersProvider=function(){var e=d()((function*(){throw new P.NotImplemented}));return function(){return e.apply(this,arguments)}}(),r.getClientEndpointStatus=function(){var e=d()((function*(e){var n=this.createClientFromURL(e),t=performance.now(),r=(yield n.getInfo()).bestBlockNumber;return{responseTime:Math.floor(performance.now()-t),latestBlock:r}}));return function(n){return e.apply(this,arguments)}}(),r.checkRpcBatchSupport=function(){var e=d()((function*(e){throw new P.NotImplemented}));return function(n){return e.apply(this,arguments)}}(),r.getDisplayAddress=function(){var e=d()((function*(e){return Promise.resolve(e)}));return function(n){return e.apply(this,arguments)}}(),r.validateAddress=function(){var e=d()((function*(e){var n=yield this.engineProvider.verifyAddress(e),t=n.normalizedAddress;if(!n.isValid||!t)throw new P.InvalidAddress;return Promise.resolve(t)}));return function(n){return e.apply(this,arguments)}}(),r.validateImportedCredential=function(e){return Promise.resolve(this.settings.importedAccountEnabled&&/^(0x)?[0-9a-zA-Z]{64}$/.test(e))},r.validateWatchingCredential=function(){var e=d()((function*(e){return Promise.resolve(this.settings.watchingAccountEnabled&&(yield this.engineProvider.verifyAddress(e)).isValid)}));return function(n){return e.apply(this,arguments)}}(),r.validateTokenAddress=function(){var e=d()((function*(e){var n=yield this.engineProvider.verifyTokenAddress(e),t=n.normalizedAddress;if(!n.isValid||"undefined"===typeof t)throw new P.InvalidTokenAddress;return Promise.resolve(t)}));return function(n){return e.apply(this,arguments)}}(),r.validateCanCreateNextAccount=function(){var e=d()((function*(e,n){return Promise.resolve(!0)}));return function(n,t){return e.apply(this,arguments)}}(),r.checkAccountExistence=function(){var e=d()((function*(e,n){return Promise.resolve(!0)}));return function(n,t){return e.apply(this,arguments)}}(),r.getBalances=function(){var e=d()((function*(e,n,t){return(yield this.engine.providerManager.getClient(this.networkId)).getBalances(e.map((function(e){var n=e.address,t=e.tokenAddress;return{address:n,coin:k({},"string"===typeof t?{tokenAddress:t}:{})}})))}));return function(n,t,r){return e.apply(this,arguments)}}(),r.getFrozenBalance=function(){var e=d()((function*(e){return 0}));return function(n){return e.apply(this,arguments)}}(),r.fetchBalanceDetails=function(){var e=d()((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.password;return Promise.resolve(void 0)}));return function(){return e.apply(this,arguments)}}(),r.getTransactionStatuses=function(e){return this.engine.providerManager.getTransactionStatuses(this.networkId,e)},r.getTransactionFeeInNative=function(e){return Promise.resolve("")},r.isContractAddress=function(){var e=d()((function*(e){return!1}));return function(n){return e.apply(this,arguments)}}(),r.getAccountNameInfoMap=function(){var e=d()((function*(){var e=yield this.getNetwork();return Object(S.getAccountNameInfoByImpl)(e.impl)}));return function(){return e.apply(this,arguments)}}(),r.canAutoCreateNextAccount=function(){var e=d()((function*(e){return Promise.resolve(!1)}));return function(n){return e.apply(this,arguments)}}(),r.filterAccounts=function(){var e=d()((function*(e){var n=e.accounts;e.networkId;return Promise.resolve(n)}));return function(n){return e.apply(this,arguments)}}(),r.shouldChangeAccountWhenNetworkChanged=function(){var e=d()((function*(e){e.previousNetwork,e.newNetwork,e.activeAccountId;return Promise.resolve({shouldReloadAccountList:!1,shouldChangeActiveAccount:!1})}));return function(n){return e.apply(this,arguments)}}(),r.getAccountNameInfosByImportedOrWatchingCredential=function(){var e=d()((function*(e){return Promise.resolve([])}));return function(n){return e.apply(this,arguments)}}(),r.checkIsUnlimitedAllowance=function(){var e=d()((function*(e){throw new P.NotImplemented}));return function(n){return e.apply(this,arguments)}}(),r.checkIsApprovedForAll=function(){var e=d()((function*(e){throw new P.NotImplemented}));return function(n){return e.apply(this,arguments)}}(),r.checkIsBatchTransfer=function(){var e=d()((function*(e){throw new P.NotImplemented}));return function(n){return e.apply(this,arguments)}}(),r.getFeePricePerUnit=function(){var e=d()((function*(){throw new P.NotImplemented}));return function(){return e.apply(this,arguments)}}(),r.fetchRpcChainId=function(){var e=d()((function*(e){return null}));return function(n){return e.apply(this,arguments)}}(),r.getTxWaitingSeconds=function(){var e=d()((function*(){return[]}));return function(){return e.apply(this,arguments)}}(),r.getUserNFTAssets=function(){var e=d()((function*(e){e.serviceData;return Promise.resolve(void 0)}));return function(n){return e.apply(this,arguments)}}(),f()(t)}(D.VaultContext),j=function(n){y()(r,n);var t=_(r);function r(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).uuid=x.a.v4().toString(),e}var o=r.prototype;return o.init=function(){var e=d()((function*(e){yield this.initProvider(),yield this.initKeyring(e)}));return function(n){return e.apply(this,arguments)}}(),o.initKeyring=function(){var e=d()((function*(e){this.keyring=yield e.keyringCreator(this)}));return function(n){return e.apply(this,arguments)}}(),o.signTransaction=function(){var e=d()((function*(e,n){return this.keyring.signTransaction(e,n)}));return function(n,t){return e.apply(this,arguments)}}(),o.signAndSendTransaction=function(){var e=d()((function*(e,n,t){var r=yield this.signTransaction(e,n);return t?k(k({},r),{},{encodedTx:e.encodedTx}):this.broadcastTransaction(k(k({},r),{},{encodedTx:e.encodedTx}))}));return function(n,t,r){return e.apply(this,arguments)}}(),o.broadcastTransaction=function(){var e=d()((function*(e,n){b.default.engine.info("broadcastTransaction START:",{rawTx:e.rawTx});var t=yield this.engine.providerManager.broadcastTransaction(this.networkId,e.rawTx,n);return b.default.engine.info("broadcastTransaction END:",{txid:t,rawTx:e.rawTx}),k(k({},e),{},{txid:t,encodedTx:e.encodedTx})}));return function(n,t){return e.apply(this,arguments)}}(),o.buildEncodedTxFromBatchTransfer=function(){var e=d()((function*(e){throw new P.NotImplemented}));return function(n){return e.apply(this,arguments)}}(),o.buildEncodedTxsFromSetApproveForAll=function(){var e=d()((function*(e,n){throw new P.NotImplemented}));return function(n,t){return e.apply(this,arguments)}}(),o.activateAccount=function(){var e=d()((function*(){throw new P.NotImplemented}));return function(){return e.apply(this,arguments)}}(),o.activateToken=function(){var e=d()((function*(e,n){throw new P.NotImplemented}));return function(n,t){return e.apply(this,arguments)}}(),o.getTokenAllowance=function(){var e=d()((function*(e,n){throw new P.NotImplemented}));return function(n,t){return e.apply(this,arguments)}}(),o.batchTokensAllowance=function(){var e=d()((function*(e,n){throw new P.NotImplemented}));return function(n,t){return e.apply(this,arguments)}}(),o.getOutputAccount=function(){var e=d()((function*(){var e=yield this.getDbAccount({noCache:!0});return{id:e.id,name:e.name,type:e.type,path:e.path,coinType:e.coinType,tokens:[],address:e.address,template:e.template,pubKey:i()(e,"pub","")}}));return function(){return e.apply(this,arguments)}}(),o.getAccountBalance=function(){var e=d()((function*(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],t=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,i=yield this.getDbAccount(),o=i.address;return this.getBalances((n?[{address:o}]:[]).concat(e.map((function(e){return{address:o,tokenAddress:e}}))),t,r)}));return function(n){return e.apply(this,arguments)}}(),o.updatePendingTxs=function(){var e=d()((function*(e){throw new P.NotImplemented}));return function(n){return e.apply(this,arguments)}}(),o.getAccountNonce=function(){var e=d()((function*(){return Promise.resolve(null)}));return function(){return e.apply(this,arguments)}}(),o.fixActionDirection=function(){var e=d()((function*(e){var n,t,r,i,o=e.action,a=e.accountAddress;(o.direction=N.IDecodedTxDirection.OTHER,o.type===N.IDecodedTxActionType.NATIVE_TRANSFER)&&(o.direction=yield this.buildTxActionDirection({from:(null==(n=o.nativeTransfer)?void 0:n.from)||"",to:(null==(t=o.nativeTransfer)?void 0:t.to)||"",address:a}));o.type===N.IDecodedTxActionType.TOKEN_TRANSFER&&(o.direction=yield this.buildTxActionDirection({from:(null==(r=o.tokenTransfer)?void 0:r.from)||"",to:(null==(i=o.tokenTransfer)?void 0:i.to)||"",address:a}));return o}));return function(n){return e.apply(this,arguments)}}(),o.fixDecodedTx=function(){var e=d()((function*(e){var n,t;e.createdAt=null!=(n=e.createdAt)?n:Date.now();var r=null==(t=e.encodedTx)?void 0:t.nonce;e.nonce=u()(r)?e.nonce:new T.a(r).toNumber();for(var i=e.owner,o=0;o<e.actions.length;o+=1){var a=e.actions[o];yield this.fixActionDirection({action:a,accountAddress:i})}if(e.outputActions)for(var c=0;c<e.outputActions.length;c+=1){var s=e.outputActions[c];yield this.fixActionDirection({action:s,accountAddress:i})}return Promise.resolve(e)}));return function(n){return e.apply(this,arguments)}}(),o.fixHistoryTx=function(){var e=d()((function*(e){return e.decodedTx=yield this.fixDecodedTx(e.decodedTx),Promise.resolve(e)}));return function(n){return e.apply(this,arguments)}}(),o.buildHistoryTx=function(){var e=d()((function*(e){var n=e.historyTxToMerge,t=(e.encodedTx,e.decodedTx),r=e.signedTx,i=e.isSigner,o=e.isLocalCreated,a=(null==r?void 0:r.txid)||(null==t?void 0:t.txid)||"";if(!a)throw new Error("buildHistoryTx txid not found");var c=yield this.getAccountAddress();t.txid=a||t.txid,t.owner=c,i&&(t.signer=c),null!=r&&r.txKey&&(t.extraInfo?t.extraInfo.txKey=r.txKey:t.extraInfo={txKey:r.txKey});var u=k(k({id:this.networkId+"_"+a+"_"+this.accountId,isLocalCreated:Boolean(o)},n),{},{decodedTx:t});return u=yield this.fixHistoryTx(u),Promise.resolve(u)}));return function(n){return e.apply(this,arguments)}}(),o.checkIsScamHistoryTx=function(){var e=d()((function*(e){return!1}));return function(n){return e.apply(this,arguments)}}(),o.fetchOnChainHistory=function(){var e=d()((function*(e){throw new P.NotImplemented}));return function(n){return e.apply(this,arguments)}}(),o.fixAddressCase=function(e){return Promise.resolve(e)},o.buildTxActionDirection=function(){var e=d()((function*(e){var n=e.from,t=e.to,r=e.address;return n=yield this.fixAddressCase(n||""),t=yield this.fixAddressCase(t),r=yield this.fixAddressCase(r),n===t&&n===r?N.IDecodedTxDirection.SELF:n&&n===r?N.IDecodedTxDirection.OUT:t&&t===r?N.IDecodedTxDirection.IN:N.IDecodedTxDirection.OTHER}));return function(n){return e.apply(this,arguments)}}(),o.getNextNonce=function(){var e=d()((function*(e,n){var t,r,i=null!=(t=null==(r=(yield this.engine.providerManager.getAddresses(e,[n.address]))[0])?void 0:r.nonce)?t:0,o=(yield this.engine.getHistory(e,n.id,void 0,!1),yield E.default.history.getMaxPendingNonce({accountId:this.accountId,networkId:e})),a=yield E.default.history.getPendingNonceList({accountId:this.accountId,networkId:e}),c=Math.max(u()(o)?0:o+1,i);if(Number.isNaN(c)&&(c=i),c>i)for(var s=i;s<c;s+=1)if(!a.includes(s)){c=s;break}if(c<i&&(c=i),c-i>=O.HISTORY_CONSTS.PENDING_QUEUE_MAX_LENGTH)throw new P.PendingQueueTooLong(O.HISTORY_CONSTS.PENDING_QUEUE_MAX_LENGTH);return c}));return function(n,t){return e.apply(this,arguments)}}(),o.validateSendAmount=function(e,n,t){return Promise.resolve(!0)},o.notifyChainChanged=function(e,n){},o.getFetchBalanceAddress=function(e){return Promise.resolve(e.address)},o.getPrivateKeyByCredential=function(n){return Promise.resolve(e.from(n.startsWith("0x")?n.slice(2):n,"hex"))},o.getMinDepositAmount=function(){var e=d()((function*(){return"0"}));return function(){return e.apply(this,arguments)}}(),o.specialCheckEncodedTx=function(){var e=d()((function*(e){return{success:!0}}));return function(n){return e.apply(this,arguments)}}(),o.getAllUsedAddress=function(){var e=d()((function*(){return Promise.resolve([])}));return function(){return e.apply(this,arguments)}}(),f()(r)}(R)}.call(this,t(26).Buffer)},3913:function(e,n,t){"use strict";t.r(n),function(e){t.d(n,"KeyringHardwareBase",(function(){return v}));var r=t(2),i=t.n(r),o=t(6),a=t.n(o),c=t(9),u=t.n(c),s=t(14),d=t.n(s),l=t(7),f=t.n(l),p=t(431),y=t(163);function h(e){var n=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,r=f()(e);if(n){var i=f()(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return d()(this,t)}}var v=function(n){u()(r,n);var t=h(r);function r(){return t.apply(this,arguments)}var o=r.prototype;return o.getHardwareInfo=function(){var e=i()((function*(){var e,n,t,r=yield this.engine.getHWDeviceByWalletId(this.vault.walletId);return{connectId:null!=(e=null==r?void 0:r.mac)?e:"",deviceId:null!=(n=null==r?void 0:r.deviceId)?n:"",deviceType:null!=(t=null==r?void 0:r.deviceType)?t:""}}));return function(){return e.apply(this,arguments)}}(),o.getWalletPassphraseState=function(){var e=i()((function*(){var e=yield this.engine.getWallet(this.vault.walletId);return{passphraseState:null==e?void 0:e.passphraseState,useEmptyPassphrase:!Object(y.isPassphraseWallet)(e)}}));return function(){return e.apply(this,arguments)}}(),o.getHardwareSDKInstance=function(){var n=i()((function*(){var n,t,r,i,o;return null!=(o=yield null==(n=e)||null==(t=n.$backgroundApiProxy)||null==(r=t.backgroundApi)||null==(i=r.serviceHardware)||null==i.getSDKInstance?void 0:i.getSDKInstance())?o:p.HardwareSDK}));return function(){return n.apply(this,arguments)}}(),o.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},a()(r)}(t(3903).KeyringBase)}.call(this,t(58))},3914:function(e,n,t){"use strict";t.r(n),t.d(n,"KeyringHdBase",(function(){return T}));var r=t(3),i=t.n(r),o=t(2),a=t.n(o),c=t(6),u=t.n(c),s=t(9),d=t.n(s),l=t(14),f=t.n(l),p=t(7),y=t.n(p),h=t(610),v=t(23);function g(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function w(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?g(Object(t),!0).forEach((function(n){i()(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):g(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function m(e){var n=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,r=y()(e);if(n){var i=y()(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return f()(this,t)}}var T=function(e){d()(t,e);var n=m(t);function t(){return n.apply(this,arguments)}var r=t.prototype;return r.getPrivateKeys=function(){var e=a()((function*(e,n){var t=(yield this.getDbAccount()).path.split("/"),r=n||[t.pop()],i=t.join("/"),o=(yield this.engine.dbApi.getCredential(this.walletId,e)).seed;if("undefined"===typeof o)throw new v.OneKeyInternalError("Unable to get credential.");var a=(yield this.engine.providerManager.getChainInfoByNetworkId(this.networkId)).curve;return Object(h.batchGetPrivateKeys)(a,o,e,i,r).reduce((function(e,n){var t;return w(w({},e),{},((t={})[n.path]=n.extendedKey.key,t))}),{})}));return function(n,t){return e.apply(this,arguments)}}(),r.getAddress=function(){throw new Error("Method not implemented.")},r.batchGetAddress=function(){throw new Error("Method not implemented.")},r.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},u()(t)}(t(3905).KeyringSoftwareBase)},3915:function(e,n,t){"use strict";t.r(n),t.d(n,"KeyringImportedBase",(function(){return h}));var r=t(2),i=t.n(r),o=t(6),a=t.n(o),c=t(9),u=t.n(c),s=t(14),d=t.n(s),l=t(7),f=t.n(l),p=t(23);function y(e){var n=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,r=f()(e);if(n){var i=f()(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return d()(this,t)}}var h=function(e){u()(t,e);var n=y(t);function t(){return n.apply(this,arguments)}var r=t.prototype;return r.getPrivateKeys=function(){var e=i()((function*(e,n){if("undefined"!==typeof n)throw new p.NotImplemented("Getting private keys from extended private key");var t=(yield this.engine.dbApi.getCredential(this.accountId,e)).privateKey;if("undefined"===typeof t)throw new p.OneKeyInternalError("Unable to get credential.");return{"":t}}));return function(n,t){return e.apply(this,arguments)}}(),r.getAddress=function(){throw new Error("Method not implemented.")},r.batchGetAddress=function(){throw new Error("Method not implemented.")},r.prepareAccountByAddressIndex=function(){throw new Error("Method not implemented.")},a()(t)}(t(3905).KeyringSoftwareBase)},3916:function(e,n,t){"use strict";t.r(n),t.d(n,"KeyringWatchingBase",(function(){return h}));var r=t(2),i=t.n(r),o=t(6),a=t.n(o),c=t(9),u=t.n(c),s=t(14),d=t.n(s),l=t(7),f=t.n(l),p=t(23);function y(e){var n=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,r=f()(e);if(n){var i=f()(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return d()(this,t)}}var h=function(e){u()(t,e);var n=y(t);function t(){return n.apply(this,arguments)}var r=t.prototype;return r.signTransaction=function(){var e=i()((function*(e,n){throw new p.OneKeyInternalError("signTransaction is not supported for watching accounts")}));return function(n,t){return e.apply(this,arguments)}}(),r.signMessage=function(){var e=i()((function*(e,n){throw new p.OneKeyInternalError("signMessage is not supported for watching accounts")}));return function(n,t){return e.apply(this,arguments)}}(),r.getAddress=function(){throw new Error("Method not implemented.")},r.batchGetAddress=function(){throw new Error("Method not implemented.")},r.prepareAccountByAddressIndex=function(){throw new Error("Method not implemented.")},a()(t)}(t(3903).KeyringBase)},3918:function(e,n,t){"use strict";t.r(n),t.d(n,"convertDeviceError",(function(){return c}));var r=t(70),i=t(90),o=t(19);t(24);function a(e,n){return"string"!==typeof n?null:e===r.HardwareErrorCode.DeviceInitializeFailed&&n.includes("ECONNABORTED")?new i.ConnectTimeoutError({message:n}):n.includes("Bridge network error")?new i.BridgeNetworkError({message:n}):null}function c(e){var n,t=e||{},c=t.code,u=t.error,s=t.message,d=null!=(n=null!=u?u:s)?n:"Unknown error";if(a(c,d))return a(c,d);switch(o.default.hardwareSDK.info("Device Utils Convert Device Error:",c,d),c){case r.HardwareErrorCode.UnknownError:return new i.UnknownHardwareError(e);case r.HardwareErrorCode.DeviceFwException:return new i.FirmwareVersionTooLow(e);case r.HardwareErrorCode.DeviceUnexpectedMode:return"string"===typeof d&&-1!==d.indexOf("ui-device_bootloader_mode")?new i.NotInBootLoaderMode(e):new i.UnknownHardwareError(e);case r.HardwareErrorCode.DeviceCheckDeviceIdError:return new i.DeviceNotSame(e);case r.HardwareErrorCode.DeviceNotFound:return new i.DeviceNotFind(e);case r.HardwareErrorCode.DeviceUnexpectedBootloaderMode:return new i.NotInBootLoaderMode(e);case r.HardwareErrorCode.DeviceInterruptedFromOutside:case r.HardwareErrorCode.DeviceInterruptedFromUser:return new i.UserCancelFromOutside(e);case r.HardwareErrorCode.DeviceNotSupportPassphrase:return new i.NotSupportPassphraseError(e);case r.HardwareErrorCode.IFrameLoadFail:return new i.InitIframeLoadFail(e);case r.HardwareErrorCode.IframeTimeout:return new i.InitIframeTimeout(e);case r.HardwareErrorCode.FirmwareUpdateDownloadFailed:return new i.FirmwareDownloadFailed(e);case r.HardwareErrorCode.FirmwareUpdateManuallyEnterBoot:return new i.FirmwareUpdateManuallyEnterBoot(e);case r.HardwareErrorCode.FirmwareUpdateAutoEnterBootFailure:return new i.FirmwareUpdateAutoEnterBootFailure(e);case r.HardwareErrorCode.FirmwareUpdateLimitOneDevice:return new i.FirmwareUpdateLimitOneDevice(e);case r.HardwareErrorCode.CallMethodNeedUpgradeFirmware:return new i.FirmwareVersionTooLow(e);case r.HardwareErrorCode.NewFirmwareUnRelease:return new i.NewFirmwareUnRelease(e);case r.HardwareErrorCode.NewFirmwareForceUpdate:return new i.NewFirmwareForceUpdate(e);case r.HardwareErrorCode.NetworkError:return new i.NetworkError(e);case r.HardwareErrorCode.BlePermissionError:return new i.NeedBluetoothTurnedOn(e);case r.HardwareErrorCode.BleLocationError:return new i.NeedBluetoothPermissions({message:d});case r.HardwareErrorCode.BleLocationServicesDisabled:return new i.BleLocationServiceError({message:d});case r.HardwareErrorCode.BleDeviceNotBonded:return new i.DeviceNotBonded(e);case r.HardwareErrorCode.BleDeviceBondError:return new i.DeviceBondError(e);case r.HardwareErrorCode.BleWriteCharacteristicError:return new i.BleWriteCharacteristicError(e);case r.HardwareErrorCode.BleScanError:return new i.BleScanError({message:d});case r.HardwareErrorCode.BleAlreadyConnected:return new i.BleAlreadyConnectedError(e);case r.HardwareErrorCode.RuntimeError:return-1!==d.indexOf("EIP712 blind sign is disabled")?new i.OpenBlindSign(e):-1!==d.indexOf("Unknown message")||-1!==d.indexOf("Failure_UnexpectedMessage")?new i.UnknownMethod(e):new i.UnknownHardwareError(e);case r.HardwareErrorCode.PinInvalid:return new i.InvalidPIN(e);case r.HardwareErrorCode.DeviceCheckPassphraseStateError:return new i.InvalidPassphrase(e);case r.HardwareErrorCode.DeviceOpenedPassphrase:return new i.DeviceOpenedPassphrase(e);case r.HardwareErrorCode.DeviceNotOpenedPassphrase:return new i.DeviceNotOpenedPassphrase(e);case r.HardwareErrorCode.PinCancelled:case r.HardwareErrorCode.ActionCancelled:return new i.UserCancel(e);case r.HardwareErrorCode.BridgeNotInstalled:case i.CustomOneKeyHardwareError.NeedOneKeyBridge:return new i.NeedOneKeyBridge(e);case r.HardwareErrorCode.BridgeNetworkError:return new i.BridgeNetworkError(e);case r.HardwareErrorCode.BridgeTimeoutError:return new i.BridgeTimeoutError(e);case r.HardwareErrorCode.PollingTimeout:return new i.ConnectTimeoutError(e);case r.HardwareErrorCode.PollingStop:return new i.ConnectPollingStopError(e);case r.HardwareErrorCode.BlindSignDisabled:return new i.OpenBlindSign(e);case r.HardwareErrorCode.FileAlreadyExists:return new i.FileAlreadyExistError(e);case r.HardwareErrorCode.CheckDownloadFileError:return new i.IncompleteFileError(e);case r.HardwareErrorCode.NotInSigningMode:return new i.NotInSigningModeError(e);default:return new i.UnknownHardwareError(e)}}},4756:function(e,n,t){"use strict";t.r(n),function(e){t.d(n,"KeyringHd",(function(){return S}));var r=t(4),i=t.n(r),o=t(2),a=t.n(o),c=t(6),u=t.n(c),s=t(9),d=t.n(s),l=t(14),f=t.n(l),p=t(7),y=t.n(p),h=t(143),v=t(665),g=t(610),w=t(11),m=t(19),T=t(23),I=t(1345),x=t(117),O=t(3914),b=t(303),A=t(866);function E(e){var n=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,r=y()(e);if(n){var i=y()(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return f()(this,t)}}var P="m/44'/"+w.COINTYPE_APTOS+"'",S=function(n){d()(r,n);var t=E(r);function r(){return t.apply(this,arguments)}var o=r.prototype;return o.getSigners=function(){var e=a()((function*(e,n){var t,r=yield this.getDbAccount();if(1!==n.length)throw new T.OneKeyInternalError("Starcoin signers number should be 1.");if(n[0]!==r.address)throw new T.OneKeyInternalError("Wrong address required for signing.");var i=(yield this.getPrivateKeys(e))[r.path];if("undefined"===typeof i)throw new T.OneKeyInternalError("Unable to get signer.");return(t={})[r.address]=new I.Signer(i,e,"ed25519"),t}));return function(n,t){return e.apply(this,arguments)}}(),o.prepareAccounts=function(){var e=a()((function*(e){var n=e.password,t=e.indexes,r=e.names,i=(yield this.engine.dbApi.getCredential(this.walletId,n)).seed,o=Object(g.batchGetPublicKeys)("ed25519",i,n,P,t.map((function(e){return e.toString()+"'/0'/0'"})));if(o.length!==t.length)throw new T.OneKeyInternalError("Unable to get publick key.");var a=[],c=0;for(var u of o){var s=u.path,d=u.extendedKey.key,l=d.toString("hex"),f=v.sha3_256.create();f.update(d),f.update("\0");var p=Object(b.addHexPrefix)(f.hex()),y=(r||[])[c]||"APT #"+(t[c]+1);a.push({id:this.walletId+"--"+s,name:y,type:x.AccountType.SIMPLE,path:s,coinType:w.COINTYPE_APTOS,pub:l,address:p}),c+=1}return a}));return function(n){return e.apply(this,arguments)}}(),o.signTransaction=function(){var e=a()((function*(e,n){var t,r;m.default.common.info("signTransaction result",e);var i=yield this.getDbAccount(),o=(yield this.engine.getNetwork(this.networkId)).rpcURL,a=new h.AptosClient(o),c=(yield this.getSigners(n.password||"",[i.address]))[i.address],u=null==(t=e.inputs)||null==(r=t[0])?void 0:r.publicKey;if(!u)throw new T.OneKeyInternalError("Unable to get sender public key.");var s=yield Object(A.generateUnsignedTransaction)(a,e);return Object(A.signRawTransaction)(c,u,s)}));return function(n,t){return e.apply(this,arguments)}}(),o.signMessage=function(){var n=a()((function*(n,t){var r=yield this.getDbAccount(),o=(yield this.getSigners(t.password||"",[r.address]))[r.address];return Promise.all(n.map(function(){var n=a()((function*(n){var t=JSON.parse(n.message).fullMessage,r=yield o.sign(e.from(t)),a=i()(r,1)[0];return Object(b.addHexPrefix)(a.toString("hex"))}));return function(e){return n.apply(this,arguments)}}()))}));return function(e,t){return n.apply(this,arguments)}}(),u()(r)}(O.KeyringHdBase)}.call(this,t(26).Buffer)},4757:function(e,n,t){"use strict";t.r(n),function(e){t.d(n,"KeyringImported",(function(){return E}));var r=t(4),i=t.n(r),o=t(2),a=t.n(o),c=t(6),u=t.n(c),s=t(9),d=t.n(s),l=t(14),f=t.n(l),p=t(7),y=t.n(p),h=t(143),v=t(665),g=t(748),w=t(11),m=t(23),T=t(1345),I=t(117),x=t(3915),O=t(303),b=t(866);function A(e){var n=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,r=y()(e);if(n){var i=y()(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return f()(this,t)}}var E=function(n){d()(r,n);var t=A(r);function r(){return t.apply(this,arguments)}var o=r.prototype;return o.getSigners=function(){var e=a()((function*(e,n){var t,r=yield this.getDbAccount();if(1!==n.length)throw new m.OneKeyInternalError("Starcoin signers number should be 1.");if(n[0]!==r.address)throw new m.OneKeyInternalError("Wrong address required for signing.");var i=(yield this.getPrivateKeys(e))[r.path];if("undefined"===typeof i)throw new m.OneKeyInternalError("Unable to get signer.");return(t={})[r.address]=new T.Signer(i,e,"ed25519"),t}));return function(n,t){return e.apply(this,arguments)}}(),o.prepareAccounts=function(){var e=a()((function*(e){var n=e.privateKey,t=e.name;if(32!==n.length)throw new m.OneKeyInternalError("Invalid private key.");var r=g.ed25519.publicFromPrivate(n),i=r.toString("hex"),o=v.sha3_256.create();o.update(r),o.update("\0");var a=Object(O.addHexPrefix)(o.hex());return Promise.resolve([{id:"imported--"+w.COINTYPE_APTOS+"--"+i,name:t||"",type:I.AccountType.SIMPLE,path:"",coinType:w.COINTYPE_APTOS,pub:i,address:a}])}));return function(n){return e.apply(this,arguments)}}(),o.signTransaction=function(){var e=a()((function*(e,n){var t,r,i=yield this.getDbAccount(),o=(yield this.engine.getNetwork(this.networkId)).rpcURL,a=new h.AptosClient(o),c=yield this.getSigners(n.password||"",[i.address]),u=null==(t=e.inputs)||null==(r=t[0])?void 0:r.publicKey;if(!u)throw new m.OneKeyInternalError("Unable to get sender public key.");var s=c[i.address],d=yield Object(b.generateUnsignedTransaction)(a,e);return Object(b.signRawTransaction)(s,u,d)}));return function(n,t){return e.apply(this,arguments)}}(),o.signMessage=function(){var n=a()((function*(n,t){var r=yield this.getDbAccount(),o=(yield this.getSigners(t.password||"",[r.address]))[r.address];return Promise.all(n.map(function(){var n=a()((function*(n){var t=yield o.sign(e.from(n));return i()(t,1)[0].toString("hex")}));return function(e){return n.apply(this,arguments)}}()))}));return function(e,t){return n.apply(this,arguments)}}(),u()(r)}(x.KeyringImportedBase)}.call(this,t(26).Buffer)},6118:function(e,n,t){"use strict";t.r(n),t.d(n,"default",(function(){return ce}));var r=t(15),i=t.n(r),o=t(316),a=t.n(o),c=t(3),u=t.n(c),s=t(4),d=t.n(s),l=t(823),f=t.n(l),p=t(60),y=t.n(p),h=t(202),v=t.n(h),g=t(2),w=t.n(g),m=t(6),T=t.n(m),I=t(9),x=t.n(I),O=t(14),b=t.n(O),A=t(7),E=t.n(A),P=t(73),S=t(143),C=t(21),N=t.n(C),D=t(112),B=t(367),k=t(46),_=t(302),R=t(19),j=t(150),H=t(23),F=t(52),K=t(196),U=t(303),M=t(3912),L=t(3918),V=t(11),G=t(117),W=t(3913),z=t(866);function Y(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function q(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Y(Object(t),!0).forEach((function(n){u()(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Y(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function J(e){var n=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,r=E()(e);if(n){var i=E()(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return b()(this,t)}}var Q="m/44'/"+V.COINTYPE_APTOS+"'",X=function(e){x()(t,e);var n=J(t);function t(){return n.apply(this,arguments)}var r=t.prototype;return r.getPublicKey=function(){var e=w()((function*(e,n,t){var r,i=yield this.getHardwareSDKInstance(),o=yield this.getWalletPassphraseState();try{r=yield i.aptosGetPublicKey(e,n,q({bundle:t.map((function(e){return{path:e}}))},o))}catch(a){throw R.default.common.error(a),new H.OneKeyHardwareError(a)}if(!r.success)throw R.default.common.error(r.payload),Object(L.convertDeviceError)(r.payload);return r.payload.map((function(e){return e.publicKey})).filter((function(e){return!!e}))}));return function(n,t,r){return e.apply(this,arguments)}}(),r.prepareAccounts=function(){var e=w()((function*(e){var n,t=e.type,r=e.indexes,i=e.names,o=r.map((function(e){return Q+"/"+e+"'/0'/0'"})),a="SEARCH_ACCOUNTS"===t,c=yield this.getHardwareSDKInstance(),u=yield this.getHardwareInfo(),s=u.connectId,d=u.deviceId,l=yield this.getWalletPassphraseState();try{n=yield c.aptosGetAddress(s,d,q({bundle:o.map((function(e){return{path:e,showOnOneKey:!1}}))},l))}catch(x){throw R.default.common.error(x),new H.OneKeyHardwareError(x)}if(!n.success)throw R.default.common.error(n.payload),Object(L.convertDeviceError)(n.payload);var f,p,y=[];a||(!(null==(f=n.payload)||null==(p=f[0])||!p.publicKey)||(y=yield this.getPublicKey(s,d,o)));var h=[],v=0;for(var g of n.payload){var w=g.address,m=g.path,T=g.publicKey;if(w){var I=(i||[])[v]||"APT #"+(r[v]+1);h.push({id:this.walletId+"--"+m,name:I,type:G.AccountType.SIMPLE,path:m,coinType:V.COINTYPE_APTOS,pub:null!=T?T:y[v]||"",address:Object(U.addHexPrefix)(w)}),v+=1}}return h}));return function(n){return e.apply(this,arguments)}}(),r.getAddress=function(){var e=w()((function*(e){var n,t=yield this.getHardwareSDKInstance(),r=yield this.getHardwareInfo(),i=r.connectId,o=r.deviceId,a=yield this.getWalletPassphraseState(),c=yield t.aptosGetAddress(i,o,q({path:e.path,showOnOneKey:e.showOnOneKey},a));if(c.success&&null!=(n=c.payload)&&n.address)return c.payload.address.toLowerCase();throw Object(L.convertDeviceError)(c.payload)}));return function(n){return e.apply(this,arguments)}}(),r.batchGetAddress=function(){var e=w()((function*(e){var n=yield this.getHardwareSDKInstance(),t=yield this.getHardwareInfo(),r=t.connectId,i=t.deviceId,o=yield this.getWalletPassphraseState(),a=yield n.aptosGetAddress(r,i,q(q({},o),{},{bundle:e.map((function(e){return{path:e.path,showOnOneKey:!!e.showOnOneKey}}))}));if(!a.success)throw Object(L.convertDeviceError)(a.payload);return a.payload.map((function(e){var n,t;return{path:null!=(n=e.path)?n:"",address:null!=(t=e.address)?t:""}}))}));return function(n){return e.apply(this,arguments)}}(),r.signTransaction=function(){var e=w()((function*(e,n){R.default.common.info("signTransaction",e);var t=yield this.getDbAccount(),r=(yield this.engine.getNetwork(this.networkId)).rpcURL,i=new S.AptosClient(r),o=yield Object(z.generateUnsignedTransaction)(i,e),a=new S.BCS.Serializer;o.serialize(a);var c=yield this.getHardwareInfo(),u=c.connectId,s=c.deviceId,d=yield this.getWalletPassphraseState(),l=yield this.getHardwareSDKInstance(),f=yield l.aptosSignTransaction(u,s,q({path:t.path,rawTx:Object(P.bytesToHex)(a.getBytes())},d));if(f.success){var p=f.payload,y=p.signature,h=p.public_key;return Object(z.buildSignedTx)(o,h,y)}throw Object(L.convertDeviceError)(f.payload)}));return function(n,t){return e.apply(this,arguments)}}(),r.signMessage=function(){var e=w()((function*(e,n){R.default.common.info("signMessage",e);var t=yield this.getDbAccount(),r=yield this.getHardwareInfo(),i=r.connectId,o=r.deviceId,a=yield this.getWalletPassphraseState(),c=yield this.getHardwareSDKInstance();return Promise.all(e.map(function(){var e=w()((function*(e){var n,r,u=JSON.parse(e.message),s=yield c.aptosSignMessage(i,o,q({path:t.path,payload:{message:u.message,address:u.address,application:u.application,chainId:null==u||null==(n=u.chainId)?void 0:n.toString(),nonce:null==u||null==(r=u.nonce)?void 0:r.toString()}},a));if(!s.success)throw Object(L.convertDeviceError)(s.payload);return Object(U.addHexPrefix)(s.payload.signature)}));return function(n){return e.apply(this,arguments)}}()))}));return function(n,t){return e.apply(this,arguments)}}(),T()(t)}(W.KeyringHardwareBase),$=t(4756),Z=t(4757);function ee(e){var n=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,r=E()(e);if(n){var i=E()(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return b()(this,t)}}var ne=function(e){x()(t,e);var n=ee(t);function t(){return n.apply(this,arguments)}return t.prototype.prepareAccounts=function(){var e=w()((function*(e){var n=e.name,t=e.target,r=e.accountIdPrefix,i=yield this.vault.validateAddress(t);if("undefined"===typeof i)throw new H.InvalidAddress;return Promise.resolve([{id:r+"--"+V.COINTYPE_APTOS+"--"+t,name:n||"",type:G.AccountType.SIMPLE,path:"",coinType:V.COINTYPE_APTOS,pub:"",address:i}])}));return function(n){return e.apply(this,arguments)}}(),T()(t)}(t(3916).KeyringWatchingBase),te=t(2717),re=["max_gas_amount"];function ie(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function oe(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?ie(Object(t),!0).forEach((function(n){u()(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ie(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function ae(e){var n=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,r=E()(e);if(n){var i=E()(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return b()(this,t)}}var ce=function(e){x()(t,e);var n=ae(t);function t(){for(var e,t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return(e=n.call.apply(n,[this].concat(r))).keyringMap={hd:$.KeyringHd,hw:X,imported:Z.KeyringImported,watching:ne,external:ne},e.settings=te.default,e.getClientCache=Object(j.memoizee)(function(){var n=w()((function*(n){return e.getAptosClient(n)}));return function(e){return n.apply(this,arguments)}}(),{promise:!0,max:1,maxAge:Object(k.getTimeDurationMs)({minute:3})}),e}var r=t.prototype;return r.getClient=function(){var e=w()((function*(){var e=yield this.getRpcUrl();return this.getClientCache(e)}));return function(){return e.apply(this,arguments)}}(),r.getAptosClient=function(e){return new S.AptosClient(e)},r.getClientEndpointStatus=function(){var e=w()((function*(e){var n=yield this.getClientCache(e),t=performance.now(),r=(yield n.getLedgerInfo()).block_height,i=parseInt(r);return{responseTime:Math.floor(performance.now()-t),latestBlock:i}}));return function(n){return e.apply(this,arguments)}}(),r._getPublicKey=function(){var e=w()((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.prefix,t=void 0===n||n,r=yield this.getDbAccount(),i=r.pub;return t&&(i=Object(U.addHexPrefix)(i)),Promise.resolve(i)}));return function(){return e.apply(this,arguments)}}(),r.validateAddress=function(){var e=w()((function*(e){return Object(k.isHexString)(e)&&64===Object(U.stripHexPrefix)(e).length?Promise.resolve(e):Promise.reject(new H.InvalidAddress)}));return function(n){return e.apply(this,arguments)}}(),r.validateWatchingCredential=function(){var e=w()((function*(e){var n=this;return this.validateAddress(e).then((function(e){return n.settings.watchingAccountEnabled&&!!e})).catch((function(){return!1}))}));return function(n){return e.apply(this,arguments)}}(),r.checkAccountExistence=function(){var e=w()((function*(e){var n=yield this.getClient();try{var t=yield n.getAccount(Object(U.stripHexPrefix)(e)),r=v()(t,"authentication_key",null);return!y()(r)}catch(i){if("resource_not_found"===v()(i,"errorCode",null))return!1;throw i}}));return function(n){return e.apply(this,arguments)}}(),r.getBalances=function(){var e=w()((function*(e){var n=yield this.getClient(),t=f()(e,(function(e){return e.address})),r=new Map;return yield Promise.all(Object.entries(t).map(function(){var e=w()((function*(e){var t=d()(e,2),i=t[0],o=t[1];try{var a=yield Object(z.getAccountResource)(n,i);o.forEach((function(e){var n=e.tokenAddress,t=z.APTOS_COINSTORE+"<"+(null!=n?n:z.APTOS_NATIVE_COIN)+">",o=null==a?void 0:a.find((function(e){return e.type===t})),c=v()(o,"data.coin.value",0),u=i+"-"+(null!=n?n:z.APTOS_NATIVE_COIN);try{r.set(u,new N.a(c))}catch(s){}}))}catch(c){}}));return function(n){return e.apply(this,arguments)}}())),e.map((function(e){var n,t=e.address,i=e.tokenAddress,o=t+"-"+(null!=i?i:z.APTOS_NATIVE_COIN);return null!=(n=r.get(o))?n:new N.a(0)}))}));return function(n){return e.apply(this,arguments)}}(),r.fetchTokenInfos=function(){var e=w()((function*(e){var n=yield this.getClient();return Promise.all(e.map(function(){var e=w()((function*(e){try{return yield Object(z.getTokenInfo)(n,e)}catch(t){}}));return function(n){return e.apply(this,arguments)}}()))}));return function(n){return e.apply(this,arguments)}}(),r.activateAccount=function(){var e=w()((function*(){Object(_.openDapp)("https://aptoslabs.com/testnet-faucet")}));return function(){return e.apply(this,arguments)}}(),r.activateToken=function(){var e=w()((function*(e,n){var t=(yield this.getDbAccount()).address;if(yield Object(z.getAccountCoinResource)(yield this.getClient(),t,e))return Promise.resolve(!0);var r=Object(z.generateRegisterToken)(e);r.sender=t,r.forcePendingTx=!0;var i=yield this.buildUnsignedTxFromEncodedTx(r);return i.payload=oe(oe({},i.payload),{},{encodedTx:r}),!!(yield this.signAndSendTransaction(i,{password:n},!1)).txid}));return function(n,t){return e.apply(this,arguments)}}(),r.validateTokenAddress=function(){var e=w()((function*(e){var n=e.split("::"),t=d()(n,3),r=t[0],i=t[1],o=t[2];if(i&&o)try{return(yield this.validateAddress(Object(U.hexlify)(r,{hexPad:"left"}))).toLowerCase()+"::"+i+"::"+o}catch(a){}throw new H.InvalidTokenAddress}));return function(n){return e.apply(this,arguments)}}(),r.attachFeeInfoToEncodedTx=function(){var e=w()((function*(e){var n=e.feeInfoValue,t=n.price,r=n.limit;if("undefined"!==typeof t&&"string"!==typeof t)throw new H.OneKeyInternalError("Invalid gas price.");if("string"!==typeof r)throw new H.OneKeyInternalError("Invalid fee limit");var i=yield this.getNetwork(),o=Object(K.convertFeeGweiToValue)({value:t||"0.000000001",network:i}),c=e.encodedTx.bscTxn;if(!y()(c)&&!a()(c)){var u=new S.BCS.Deserializer(Object(P.hexToBytes)(c)),s=S.TxnBuilderTypes.RawTransaction.deserialize(u),d=new S.TxnBuilderTypes.RawTransaction(s.sender,s.sequence_number,s.payload,BigInt(r),BigInt(o),s.expiration_timestamp_secs,s.chain_id),l=new S.BCS.Serializer;d.serialize(l),c=Object(P.bytesToHex)(l.getBytes())}var f=oe(oe({},e.encodedTx),{},{gas_unit_price:o,max_gas_amount:r,bscTxn:c});return Promise.resolve(f)}));return function(n){return e.apply(this,arguments)}}(),r.decodedTxToLegacy=function(e){return Promise.resolve({})},r.decodeTx=function(){var e=w()((function*(e,n){var t,r=yield this.engine.getNetwork(this.networkId),i=yield this.getDbAccount(),o=yield this.engine.getNativeTokenInfo(this.networkId),a=e.type,c=e.function,u=e.type_arguments;null!=e&&e.sender||(e.sender=i.address);var s=null,l=Object(z.getTransactionTypeByPayload)({type:null!=a?a:"entry_function_payload",function_name:c,type_arguments:u});if(l===F.IDecodedTxActionType.NATIVE_TRANSFER||l===F.IDecodedTxActionType.TOKEN_TRANSFER){var f,p=l===F.IDecodedTxActionType.TOKEN_TRANSFER,y=e.sender,h=e.type_arguments||[],v=d()(h,1)[0],g=e.arguments||[],w=d()(g,2),m=w[0],T=w[1],I="nativeTransfer";if(p&&(I="tokenTransfer",!(o=yield this.engine.ensureTokenInDB(this.networkId,v)))){var x=yield this.fetchTokenInfos([v]),O=d()(x,1)[0];if(O&&(o={id:"1",isNative:!1,networkId:this.networkId,tokenIdOnNetwork:v,name:O.name,symbol:O.symbol,decimals:O.decimals,logoURI:""}),!o)throw new Error("Invalid token address")}var b={tokenInfo:o,from:null!=y?y:"",to:m,amount:new N.a(T).shiftedBy(-o.decimals).toFixed(),amountValue:T,extraInfo:null};(f={type:l})[I]=b,s=f}else if(l===F.IDecodedTxActionType.FUNCTION_CALL){var A,E;s={type:F.IDecodedTxActionType.FUNCTION_CALL,direction:F.IDecodedTxDirection.OTHER,functionCall:{target:e.sender,functionName:null!=c?c:"",args:null!=(A=null==(E=e.arguments)?void 0:E.map((function(e){if("string"===typeof e||"number"===typeof e||"boolean"===typeof e||"bigint"===typeof e)return e.toString();if(e instanceof Array)try{return Object(U.hexlify)(e)}catch(n){return JSON.stringify(e)}return""})))?A:[],extraInfo:{}}}}else s={type:F.IDecodedTxActionType.UNKNOWN,direction:F.IDecodedTxDirection.OTHER,unknownAction:{extraInfo:{}}};var P={txid:"",owner:i.address,signer:i.address,nonce:0,actions:[s],status:F.IDecodedTxStatus.Pending,networkId:this.networkId,accountId:this.accountId,feeInfo:{price:Object(K.convertFeeValueToGwei)({value:null!=(t=e.gas_unit_price)?t:"1",network:r}),limit:e.max_gas_amount},extraInfo:null,encodedTx:e};return Promise.resolve(P)}));return function(n,t){return e.apply(this,arguments)}}(),r.buildEncodedTxFromTransfer=function(){var e=w()((function*(e){if(!e.to)throw new Error("Invalid transferInfo.to params");var n,t=e.to,r=e.amount,i=e.token,o=(yield this.getDbAccount()).address;if(i&&""!==i){var a=yield this.engine.ensureTokenInDB(this.networkId,i);if("undefined"===typeof a)throw new H.OneKeyInternalError("Failed to get token info.");n=new N.a(r).shiftedBy(a.decimals).toFixed()}else{var c=yield this.getNetwork();n=new N.a(r).shiftedBy(c.decimals).toFixed()}return oe(oe({},Object(z.generateTransferCoin)(t,n,i)),{},{sender:o})}));return function(n){return e.apply(this,arguments)}}(),r.buildEncodedTxFromApprove=function(e){throw new H.NotImplemented},r.updateEncodedTxTokenApprove=function(e,n){throw new H.NotImplemented},r.updateEncodedTx=function(){var e=w()((function*(e,n,t){var r,i=e;if("transfer"===t.type&&[z.APTOS_NATIVE_TRANSFER_FUNC,z.APTOS_TRANSFER_FUNC].includes(null!=(r=null==i?void 0:i.function)?r:"")){var o=(yield this.engine.getNativeTokenInfo(this.networkId)).decimals,a=n.amount,c=i.arguments||[],u=d()(c,1)[0];i.arguments=[u,new N.a(a).shiftedBy(o).toFixed()]}return Promise.resolve(i)}));return function(n,t,r){return e.apply(this,arguments)}}(),r.buildUnsignedTxFromEncodedTx=function(){var e=w()((function*(e){var n=e,t=BigInt(Math.floor(Date.now()/1e3)+100);if(y()(e.bscTxn)||a()(e.bscTxn))e.expiration_timestamp_secs&&BigInt(e.expiration_timestamp_secs)<t&&(n.expiration_timestamp_secs=t.toString());else{var r=new S.BCS.Deserializer(Object(P.hexToBytes)(e.bscTxn)),i=S.TxnBuilderTypes.RawTransaction.deserialize(r),o=new S.TxnBuilderTypes.RawTransaction(i.sender,i.sequence_number,i.payload,i.max_gas_amount,i.gas_unit_price,i.expiration_timestamp_secs>t?i.expiration_timestamp_secs:t,i.chain_id),c=new S.BCS.Serializer;o.serialize(c),n.bscTxn=Object(P.bytesToHex)(c.getBytes())}var u=yield this.getDbAccount();return Promise.resolve({inputs:[{address:Object(U.stripHexPrefix)(u.address),value:new N.a(0),publicKey:Object(U.stripHexPrefix)(u.pub)}],outputs:[],payload:{encodedTx:n},encodedTx:n})}));return function(n){return e.apply(this,arguments)}}(),r.fetchFeeInfo=function(){var e=w()((function*(e,n){var t,r,o=oe(oe({},e),{},{gas_unit_price:"100"}),a=(o.max_gas_amount,i()(o,re)),c=yield this.getClient(),u=yield this.getNetwork();if(n){var s;if(e.bscTxn&&(null==(s=e.bscTxn)?void 0:s.length)>0){var l=new S.BCS.Deserializer(Object(P.hexToBytes)(e.bscTxn)),f=S.TxnBuilderTypes.RawTransaction.deserialize(l);t=f.max_gas_amount.toString(),r=f.gas_unit_price.toString()}else{var p,y;t=null!=(p=e.gas_unit_price)?p:z.DEFAULT_GAS_LIMIT_NATIVE_TRANSFER,r=null!=(y=e.gas_unit_price)?y:"100"}return{nativeSymbol:u.symbol,nativeDecimals:u.decimals,feeSymbol:u.feeSymbol,feeDecimals:u.feeDecimals,limit:t,prices:[Object(K.convertFeeValueToGwei)({value:r,network:u})],defaultPresetIndex:"0"}}var h=yield Promise.all([c.client.transactions.estimateGasPrice(),this.buildUnsignedTxFromEncodedTx(a)]),v=d()(h,2),g=v[0],w=v[1];try{var m,T,I,x,O=w.encodedTx;if(O.bscTxn&&(null==(m=O.bscTxn)?void 0:m.length)>0){var b=new S.BCS.Deserializer(Object(P.hexToBytes)(O.bscTxn));x=S.TxnBuilderTypes.RawTransaction.deserialize(b)}else x=yield Object(z.generateUnsignedTransaction)(c,w);var A=new Uint8Array(64),E=(yield Object(z.buildSignedTx)(x,null!=(T=null==(I=w.inputs)?void 0:I[0].publicKey)?T:"",Object(P.bytesToHex)(A))).rawTx,C=yield(yield this.getClient()).submitBCSSimulation(Object(P.hexToBytes)(E),{estimateGasUnitPrice:!0,estimateMaxGasAmount:!0});if(!C||0===C.length)throw new Error;var D=null==C?void 0:C[0],B=e.function===z.APTOS_NATIVE_TRANSFER_FUNC,k=new N.a(D.gas_used);if(k.isEqualTo(0)||!B&&!D.success)throw Object(z.convertRpcError)(D.vm_status);t=N.a.min(k.multipliedBy(2),new N.a(D.max_gas_amount)).toFixed(0),r=Object(K.convertFeeValueToGwei)({value:D.gas_unit_price,network:u})}catch(_){if(_ instanceof H.OneKeyError)throw _;t=e.function===z.APTOS_NATIVE_TRANSFER_FUNC||e.function===z.APTOS_TRANSFER_FUNC?z.DEFAULT_GAS_LIMIT_NATIVE_TRANSFER:z.DEFAULT_GAS_LIMIT_TRANSFER,r=Object(K.convertFeeValueToGwei)({value:g.gas_estimate.toString(),network:u})}return{nativeSymbol:u.symbol,nativeDecimals:u.decimals,feeSymbol:u.feeSymbol,feeDecimals:u.feeDecimals,limit:t,prices:[r],defaultPresetIndex:"0"}}));return function(n,t){return e.apply(this,arguments)}}(),r.broadcastTransaction=function(){var e=w()((function*(e){var n=yield this.getClient();R.default.engine.info("broadcastTransaction START:",{rawTx:e.rawTx});try{var t=(yield n.submitSignedBCSTransaction(Object(P.hexToBytes)(e.rawTx))).hash;R.default.engine.info("broadcastTransaction Done:",{txid:t,rawTx:e.rawTx});var r=!0;try{yield Object(z.waitPendingTransaction)(n,t),r=!1}catch(o){if(v()(e.encodedTx,"forcePendingTx",!1))throw R.default.engine.info("broadcastTransaction wait Pending Error:",{txid:t,rawTx:e.rawTx}),o}return R.default.engine.info("broadcastTransaction wait Pending END:",{txid:t,rawTx:e.rawTx}),oe(oe({},e),{},{pendingTx:r,txid:t})}catch(o){if(o instanceof H.OneKeyInternalError)throw o;var i=(o||{}).message;throw Object(z.convertRpcError)(i)}}));return function(n){return e.apply(this,arguments)}}(),r.getExportedCredential=function(){var e=w()((function*(e){var n=yield this.getDbAccount();if(n.id.startsWith("hd-")||n.id.startsWith("imported")){var t=this.keyring,r=Object.values(yield t.getPrivateKeys(e)),i=d()(r,1)[0];return"0x"+Object(D.decrypt)(e,i).toString("hex")}throw new H.OneKeyInternalError("Only credential of HD or imported accounts can be exported")}));return function(n){return e.apply(this,arguments)}}(),r.fetchOnChainHistory=function(){var e=w()((function*(e){var n=this,t=e.localHistory,r=void 0===t?[]:t;if(e.tokenIdOnNetwork)return Promise.resolve([]);var i=yield this.getClient(),o=yield this.getDbAccount(),a=(yield this.engine.getNativeTokenInfo(this.networkId)).decimals,c=(yield i.getAccountTransactions(o.address)).map(function(){var e=w()((function*(e){var t=r.find((function(n){return n.decodedTx.txid===e.hash}));if(t&&t.decodedTx.isFinal)return Promise.resolve(null);try{var c,u=(null==e?void 0:e.payload)||{},s=u.arguments,l=u.type_arguments,f=u.function;u.code;if(null==e||!e.payload)return yield Promise.resolve(null);var p=d()(l,1)[0],y=v()(e,"sender",void 0),h=null==f?void 0:f.split("::"),g=d()(h,1)[0],w=Object(z.getTransactionType)(e),m={from:y,to:g,value:""},T={type:F.IDecodedTxActionType.UNKNOWN};if(w===F.IDecodedTxActionType.NATIVE_TRANSFER||w===F.IDecodedTxActionType.TOKEN_TRANSFER){var I,x=s||[],O=d()(x,2),b=O[0],A=O[1],E=w===F.IDecodedTxActionType.TOKEN_TRANSFER,P=F.IDecodedTxDirection.IN;y===o.address&&(P=b===o.address?F.IDecodedTxDirection.SELF:F.IDecodedTxDirection.OUT);var S=yield n.engine.getNativeTokenInfo(n.networkId),C="nativeTransfer";if(E){if(C="tokenTransfer","undefined"===typeof(S=yield n.engine.ensureTokenInDB(n.networkId,p)))throw new H.OneKeyInternalError("Failed to get token info.")}else m.to=b,m.value=A;(I={type:w,direction:P})[C]={tokenInfo:S,from:y,to:b,amount:new N.a(A).shiftedBy(-S.decimals).toFixed(),amountValue:A,extraInfo:null},T=I}else if(w===F.IDecodedTxActionType.TOKEN_ACTIVATE){var D,B,_,j,K=yield n.engine.ensureTokenInDB(n.networkId,p),U={name:null!=(D=null==K?void 0:K.name)?D:"",symbol:null!=(B=null==K?void 0:K.symbol)?B:"",decimals:null!=(_=null==K?void 0:K.decimals)?_:6,logoURI:null!=(j=null==K?void 0:K.logoURI)?j:""};"undefined"===typeof K&&(U=oe(oe({},yield Object(z.getTokenInfo)(i,p)),{},{logoURI:""})),T={type:w,tokenActivate:oe(oe({},U),{},{tokenAddress:p,networkId:n.networkId,extraInfo:null})}}else w===F.IDecodedTxActionType.FUNCTION_CALL&&(T={type:F.IDecodedTxActionType.FUNCTION_CALL,direction:F.IDecodedTxDirection.OTHER,functionCall:{target:y,functionName:null!=f?f:"",args:s,extraInfo:{}}});var M=new N.a(v()(e,"gas_used",0)).multipliedBy(v()(e,"gas_unit_price",0)),L=v()(e,"success",void 0),V=F.IDecodedTxStatus.Pending;!1===L?V=F.IDecodedTxStatus.Failed:!0===L&&(V=F.IDecodedTxStatus.Confirmed);var G={txid:e.hash,owner:o.address,signer:y,nonce:0,actions:[T],status:V,networkId:n.networkId,accountId:n.accountId,encodedTx:m,extraInfo:null,totalFeeInNative:new N.a(M).shiftedBy(-a).toFixed()};return G.updatedAt=v()(e,"timestamp",Object(k.getTimeStamp)())/1e3,G.createdAt=null!=(c=null==t?void 0:t.decodedTx.createdAt)?c:G.updatedAt,G.isFinal=G.status===F.IDecodedTxStatus.Confirmed,yield n.buildHistoryTx({decodedTx:G,historyTxToMerge:t})}catch(W){R.default.common.error(W)}return Promise.resolve(null)}));return function(n){return e.apply(this,arguments)}}());return(yield Promise.all(c)).filter(Boolean)}));return function(n){return e.apply(this,arguments)}}(),r.getTransactionStatuses=function(){var e=w()((function*(e){var n=yield this.getClient();return Promise.all(e.map(function(){var e=w()((function*(e){try{var t=yield n.getTransactionByHash(e),r=v()(t,"success",void 0),i=B.TransactionStatus.PENDING;return!1===r?i=B.TransactionStatus.CONFIRM_BUT_FAILED:!0===r&&(i=B.TransactionStatus.CONFIRM_AND_SUCCESS),yield Promise.resolve(i)}catch(o){if("transaction_not_found"===o.errorCode)return Promise.resolve(B.TransactionStatus.NOT_FOUND)}}));return function(n){return e.apply(this,arguments)}}()))}));return function(n){return e.apply(this,arguments)}}(),r.getTransactionByHash=function(){var e=w()((function*(e){return(yield this.getClient()).getTransactionByHash(e)}));return function(n){return e.apply(this,arguments)}}(),T()(t)}(M.VaultBase)}}]);