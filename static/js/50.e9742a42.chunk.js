(this.webpackJsonp=this.webpackJsonp||[]).push([[50],{3930:function(e,t,n){"use strict";var r,o,a;n.r(t),n.d(t,"StakingRoutes",(function(){return r})),n.d(t,"EthStakingSource",(function(){return o})),n.d(t,"KeleStakingMode",(function(){return a})),function(e){e.StakingAmount="StakingAmount",e.StakedETHOnKele="StakedETHOnKele",e.StakedETHOnLido="StakedETHOnLido",e.UnstakeAmount="UnstakeAmount",e.WithdrawAmount="WithdrawAmount",e.Feedback="Feedback",e.KeleEthStakeShouldUnderstand="KeleEthStakeShouldUnderstand",e.KeleEthUnstakeShouldUnderstand="KeleEthUnstakeShouldUnderstand",e.LidoEthStakeShouldUnderstand="LidoEthStakeShouldUnderStand",e.LidoEthUnstakeShouldUnderstand="LidoEthUnstakeShouldUnderStand",e.LidoEthUnstake="LidoEthUnstake",e.LidoEthUnstakeRoutes="LidoEthUnstakeRoutes",e.ETHPoolSelector="ETHPoolSelector",e.KeleStakingModeSelector="KeleStakingModeSelector",e.ETHStake="ETHStake"}(r||(r={})),function(e){e.Kele="Kele",e.Lido="Lido"}(o||(o={})),function(e){e.normal="normal",e.fast="fast"}(a||(a={}))},3933:function(e,t,n){"use strict";n.r(t);var r=n(4071);n.d(t,"default",(function(){return r.Hidden}))},3997:function(e,t,n){e.exports=n.p+"static/media/lido_pool.3f0c026b.png"},3998:function(e,t,n){"use strict";n.r(t),n.d(t,"StakingTypes",(function(){return o})),n.d(t,"coingeckoId2StakingTypes",(function(){return p})),n.d(t,"getStakeSelectNetworkAccountFilter",(function(){return b})),n.d(t,"isAccountCompatibleWithStakingTypes",(function(){return h})),n.d(t,"isSupportStakingType",(function(){return g})),n.d(t,"getLidoTokenEvmAddress",(function(){return O})),n.d(t,"isSTETH",(function(){return v})),n.d(t,"fetchStEthRate",(function(){return k})),n.d(t,"buildWithdrawStEthTransaction",(function(){return w}));var r,o,a=n(2),i=n.n(a),s=n(130),c=n(36),d=n(17),u=n(4e3),l=n(552),f=[c.OnekeyNetwork.eth,c.OnekeyNetwork.goerli],m=[];!function(e){e.eth="eth",e.matic="matic"}(o||(o={}));var p={ethereum:o.eth},j=((r={})[o.eth]=[c.OnekeyNetwork.eth,c.OnekeyNetwork.goerli],r[o.matic]=[c.OnekeyNetwork.eth,c.OnekeyNetwork.goerli],r),b=function(e){var t=j[e];if(t&&0!==t.length)return function(e){var n=e.network;return!!n&&t.includes(n.id)}},h=function(e,t){var n=j[t];return!(!n||0===n.length)&&n.some((function(t){return Object(s.isAccountCompatibleWithNetwork)(e,t)}))},g=function(e){var t=function(e){var t=e.tokenIdOnNetwork,n=e.networkId;return n?t?n+"--"+t:""+n:""}({networkId:e.networkId,tokenIdOnNetwork:e.tokenIdOnNetwork});return f.includes(t)?o.eth:m.includes(t)?o.matic:void 0},O=function(e,t){if(e)return e!==c.OnekeyNetwork.goerli||t?e!==c.OnekeyNetwork.eth||t?void 0:l.MainnetLidoContractAddress:l.TestnetLidoContractAddress},v=function(e,t){return!(!e||!t)&&(e===c.OnekeyNetwork.goerli&&t.toLowerCase()===l.TestnetLidoContractAddress.toLowerCase()||e===c.OnekeyNetwork.eth&&t.toLowerCase()===l.MainnetLidoContractAddress.toLowerCase())};function k(e){return y.apply(this,arguments)}function y(){return(y=i()((function*(e){var t=e.networkId,n=e.account,r=e.amount||"0.1",o=yield d.default.engine.getNativeTokenInfo(t),a=yield d.default.serviceStaking.getStEthToken({networkId:t}),i=yield d.default.engine.getNetwork(t),s={networkOut:i,networkIn:i,tokenOut:o,tokenIn:a,slippagePercentage:"1",typedValue:r,independentField:"INPUT",activeAccount:n,receivingAddress:n.address};return yield u.SwapQuoter.client.fetchQuote(s)}))).apply(this,arguments)}function w(e){return x.apply(this,arguments)}function x(){return(x=i()((function*(e){var t=e.networkId,n=e.account,r=e.typedValue,o=yield d.default.engine.getNativeTokenInfo(t),a=yield d.default.serviceStaking.getStEthToken({networkId:t}),i=yield d.default.engine.getNetwork(t),s={networkOut:i,networkIn:i,tokenOut:o,tokenIn:a,slippagePercentage:"1",typedValue:r,independentField:"INPUT",activeAccount:n,receivingAddress:n.address},c=yield u.SwapQuoter.client.fetchQuote(s),l=null==c?void 0:c.data;if(!l)throw new Error("failed to build unstake params");return{params:s,quote:l}}))).apply(this,arguments)}},4e3:function(e,t,n){"use strict";n.r(t),n.d(t,"SwapQuoter",(function(){return q}));var r=n(3),o=n.n(r),a=n(2),i=n.n(a),s=n(6),c=n.n(s),d=n(107),u=n.n(d),l=n(21),f=n.n(l),m=n(69),p=n(52),j=n(11),b=n(19),h=n(17),g=n(188),O=n(36),v=n(568),k=n(946);function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function w(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var x=function(){function e(){this.type=k.QuoterType.zeroX,this.client=u.a.create({timeout:1e4})}var t=e.prototype;return t.getBaseUrl=function(){var e=i()((function*(e){var t,n=yield h.default.serviceSwap.getServerEndPoint();return((t={})[O.OnekeyNetwork.eth]=n+"/0x/quote?chainID=ethereum",t[O.OnekeyNetwork.bsc]=n+"/0x/quote?chainID=bsc",t[O.OnekeyNetwork.polygon]=n+"/0x/quote?chainID=polygon",t[O.OnekeyNetwork.fantom]=n+"/0x/quote?chainID=fantom",t[O.OnekeyNetwork.avalanche]=n+"/0x/quote?chainID=avalanche",t[O.OnekeyNetwork.celo]=n+"/0x/quote?chainID=celo",t[O.OnekeyNetwork.optimism]=n+"/0x/quote?chainID=optimism",t[O.OnekeyNetwork.arbitrum]=n+"/0x/quote?chainID=arbitrum",t)[e]}));return function(t){return e.apply(this,arguments)}}(),t.isSupported=function(e,t){return e.id===t.id&&v.zeroXenabledNetworkIds.includes(e.id)},t.getProviderLogo=function(e){return"https://common.onekey-asset.com/logo/"+e+".png"},t.fetch0xQuote=function(){var e=i()((function*(e,t){var n=this,r=(yield this.client.get(e,{params:t})).data.data;return{providers:(null==r?void 0:r.sources.filter((function(e){return Number(e.proportion)>0}))).map((function(e){return{name:e.name.split("_").join(" "),logoUrl:n.getProviderLogo(e.name)}})),data:r}}));return function(t,n){return e.apply(this,arguments)}}(),t.fetchQuote=function(){var e=i()((function*(e){var t,n=e.networkIn,r=e.networkOut,o=e.tokenIn,a=e.tokenOut,i=e.slippagePercentage,s=e.independentField,c=e.typedValue,d=e.activeAccount,u=e.receivingAddress;if(this.isSupported(n,r)&&u===d.address){var l=+i/100,f={sellToken:o.tokenIdOnNetwork||g.nativeTokenAddress,buyToken:a.tokenIdOnNetwork||g.nativeTokenAddress,slippagePercentage:Number.isNaN(l)?"0.03":String(l),feeRecipient:g.feeRecipient,affiliateAddress:g.affiliateAddress};"INPUT"===s?f.sellAmount=new g.TokenAmount(o,c).toFormat():f.buyAmount=new g.TokenAmount(a,c).toFormat();var m=yield this.getBaseUrl(o.networkId);if(m){var p=yield this.fetch0xQuote(m,f),j=p.providers,b=p.data,h={type:this.type,instantRate:b.price,allowanceTarget:b.allowanceTarget,buyAmount:b.buyAmount,buyTokenAddress:b.buyTokenAddress,sellAmount:b.sellAmount,sellTokenAddress:b.sellTokenAddress,arrivalTime:null!=(t=v.estimatedTime[n.id])?t:30,percentageFee:b.percentageFee,providers:j};return b.data&&(h.txData={from:d.address,to:b.to,data:b.data,value:b.value}),h.instantRate="INPUT"===s?b.price:Object(g.div)(1,b.price),{data:h}}}}));return function(t){return e.apply(this,arguments)}}(),t.buildTransaction=function(){var e=i()((function*(e){var t=e.networkIn,n=e.networkOut,r=e.tokenIn,o=e.tokenOut,a=e.slippagePercentage,i=e.independentField,s=e.typedValue,c=e.activeAccount,d=e.txData,u=e.receivingAddress;if(this.isSupported(t,n)&&u===c.address){if(d)return{data:d};var l=+a/100,f={sellToken:r.tokenIdOnNetwork||g.nativeTokenAddress,buyToken:o.tokenIdOnNetwork||g.nativeTokenAddress,slippagePercentage:Number.isNaN(l)?"0.03":String(l),feeRecipient:g.feeRecipient,affiliateAddress:g.affiliateAddress,takerAddress:c.address};"INPUT"===i?f.sellAmount=new g.TokenAmount(r,s).toFormat():f.buyAmount=new g.TokenAmount(o,s).toFormat();var m=yield this.getBaseUrl(r.networkId);if(m)return{data:w(w({},(yield this.fetch0xQuote(m,f)).data),{},{from:c.address})}}}));return function(t){return e.apply(this,arguments)}}(),t.queryTransactionProgress=function(){var e=i()((function*(e){var t=e.networkId,n=e.accountId,r=e.nonce;if(void 0!==r)return{status:yield h.default.serviceHistory.queryTransactionNonceStatus({networkId:t,accountId:n,nonce:r})};var o=yield h.default.serviceNetwork.rpcCall(t,{method:"eth_getTransactionReceipt",params:[e.hash]});return o?{status:1===Number(o.status)?"sucesss":"failed"}:Date.now()-e.addedTime>864e5?{status:"failed"}:void 0}));return function(t){return e.apply(this,arguments)}}(),c()(e)}();function I(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?I(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):I(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function S(e){return e.tokenIdOnNetwork?e.tokenIdOnNetwork:"So11111111111111111111111111111111111111112"}var T=function(){function e(){this.type=k.QuoterType.jupiter,this.client=u.a.create({timeout:6e4})}var t=e.prototype;return t.getBaseURL=function(){var e=i()((function*(){return(yield h.default.serviceSwap.getServerEndPoint())+"/jupiter"}));return function(){return e.apply(this,arguments)}}(),t.isSupported=function(e,t){return e.id===t.id&&"sol"===e.impl},t.fetchPrice=function(){var e=i()((function*(e,t){var n=(yield this.getBaseURL())+"/v1/price",r=yield this.client.get(n,{params:{id:S(e),vsToken:S(t)}});if(r.data)return r.data.data}));return function(t,n){return e.apply(this,arguments)}}(),t.buildSwapTransaction=function(){var e=i()((function*(e,t,n){var r=(yield this.getBaseURL())+"/v1/swap",o=(yield this.client.post(r,{route:e,userPublicKey:t,outputMint:n})).data;if(!(null!=o&&o.cleanupTransaction||null!=o&&o.setupTransaction))return null==o?void 0:o.swapTransaction}));return function(t,n,r){return e.apply(this,arguments)}}(),t.findBestTransaction=function(){var e=i()((function*(e,t,n){for(var r=0;r<e.length;r+=1){var o=e[r],a=yield this.buildSwapTransaction(o,t,n);if(a)return{transaction:a,route:o}}}));return function(t,n,r){return e.apply(this,arguments)}}(),t.doQuote=function(){var e=i()((function*(e,t){var n,r=(yield this.getBaseURL())+"/v1/quote",o=yield this.client.get(r,{params:e});if(o.data){var a=o.data.data,i=yield this.findBestTransaction(a,t,e.outputMint);if(i)return _(_({},i),{},{percentageFee:null==o||null==(n=o.data)?void 0:n.percentageFee})}}));return function(t,n){return e.apply(this,arguments)}}(),t.refreshRecentBlockBash=function(){var e=i()((function*(e,t){return h.default.engine.solanaRefreshRecentBlockBash({transaction:t,accountId:e,networkId:O.OnekeyNetwork.sol})}));return function(t,n){return e.apply(this,arguments)}}(),t.findRouteAndTransaction=function(){var e=i()((function*(e){var t=e.tokenIn,n=e.tokenOut,r=e.typedValue,o=e.independentField,a=e.activeAccount,i={inputMint:S(t),outputMint:S(n),amount:Object(g.getTokenAmountString)("OUTPUT"===o?n:t,r),swapMode:"ExactIn",slippage:e.slippagePercentage,onlyDirectRoutes:!0};"OUTPUT"===o&&(i.swapMode="ExactOut");var s=yield this.doQuote(i,a.address);return s||(i.onlyDirectRoutes=!1,yield this.doQuote(i,a.address))}));return function(t){return e.apply(this,arguments)}}(),t.fetchRawQuote=function(){var e=i()((function*(e){var t=e.tokenIn,n=e.tokenOut,r=yield this.findRouteAndTransaction(e);if(r){var o=r.route,a=r.transaction,i=r.percentageFee;if(o)return{data:{type:this.type,instantRate:Object(g.calculateRate)(t.decimals,n.decimals,o.inAmount,o.outAmount),sellTokenAddress:S(t),buyTokenAddress:S(n),providers:[{name:"Jupiter",logoUrl:"https://common.onekey-asset.com/logo/Jupiter.png"}],arrivalTime:30,sellAmount:String(o.inAmount),buyAmount:String(o.outAmount),percentageFee:i,txData:a}}}}));return function(t){return e.apply(this,arguments)}}(),t.fetchAdjustedQuote=function(){var e=i()((function*(e){var t=e.tokenIn,n=e.tokenOut,r=e.typedValue;if("OUTPUT"===e.independentField){var o=yield this.fetchPrice(t,n);if(o){var a=Object(g.div)(r,o.price),i=_({},e);i.independentField="INPUT",i.typedValue=a;var s=yield this.findRouteAndTransaction(i);if(s){var c=s.route,d=s.transaction,u=new f.a(Object(g.getTokenAmountString)(n,r)),l=new f.a(c.outAmount).isGreaterThan(u.multipliedBy(.95));if(c&&l)return{data:{type:this.type,instantRate:Object(g.calculateRate)(t.decimals,n.decimals,c.inAmount,c.outAmount),sellTokenAddress:S(t),buyTokenAddress:S(n),providers:[{name:"Jupiter",logoUrl:"https://common.onekey-asset.com/logo/Jupiter.png"}],arrivalTime:30,sellAmount:String(c.inAmount),buyAmount:String(Object(g.getTokenAmountString)(n,r)),txData:d}}}}}}));return function(t){return e.apply(this,arguments)}}(),t.fetchQuote=function(){var e=i()((function*(e){if(e.activeAccount.address===e.receivingAddress){var t=yield this.fetchRawQuote(e);return t||this.fetchAdjustedQuote(e)}}));return function(t){return e.apply(this,arguments)}}(),t.buildTransaction=function(){var e=i()((function*(e){if(e.activeAccount.address===e.receivingAddress){var t=e.activeAccount;if(e.txData)if("string"===typeof e.txData)return{data:yield this.refreshRecentBlockBash(t.id,e.txData)};var n=yield this.findRouteAndTransaction(e);if(n){var r=n.transaction;return{data:yield this.refreshRecentBlockBash(r,t.id)}}}}));return function(t){return e.apply(this,arguments)}}(),t.queryTransactionProgress=function(){var e=i()((function*(e){var t=e.networkId,n=e.accountId,r=e.hash;return{status:yield h.default.serviceHistory.queryTransactionByTxid({networkId:t,accountId:n,txid:r})}}));return function(t){return e.apply(this,arguments)}}(),c()(e)}();function A(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function R(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?A(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):A(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var M=function(){function e(){this.type=k.QuoterType.mdex,this.client=u.a.create({timeout:1e4})}var t=e.prototype;return t.isSupported=function(e,t){return e.id===t.id&&!!v.quoterServerEndpoints[e.id]},t.fetchQuote=function(){var e=i()((function*(e){var t,n=e.networkIn,r=e.networkOut,o=e.tokenIn,a=e.tokenOut,i=e.slippagePercentage,s=e.independentField,c=e.typedValue,d=e.activeAccount,u=e.receivingAddress;if(this.isSupported(n,r)&&u===d.address){var l=+i/100,f={sellToken:o.tokenIdOnNetwork||g.nativeTokenAddress,buyToken:a.tokenIdOnNetwork||g.nativeTokenAddress,slippagePercentage:Number.isNaN(l)?"0.03":String(l),feeRecipient:g.feeRecipient,affiliateAddress:g.affiliateAddress};"INPUT"===s?f.sellAmount=new g.TokenAmount(o,c).toFormat():f.buyAmount=new g.TokenAmount(a,c).toFormat();var m=v.quoterServerEndpoints[o.networkId];if(m){var p=(yield this.client.get(m,{params:f})).data,j={type:this.type,instantRate:p.price,allowanceTarget:p.allowanceTarget,buyAmount:p.buyAmount,buyTokenAddress:p.buyTokenAddress,sellAmount:p.sellAmount,sellTokenAddress:p.sellTokenAddress,providers:null!=(t=v.networkProviderInfos[o.networkId])?t:[{name:"OneKey Swap"}],arrivalTime:15};return p.data&&(j.txData={from:d.address,to:p.to,data:p.data,value:p.value}),j.instantRate="INPUT"===s?p.price:Object(g.div)(1,p.price),{data:j}}}}));return function(t){return e.apply(this,arguments)}}(),t.buildTransaction=function(){var e=i()((function*(e){var t=e.networkIn,n=e.networkOut,r=e.tokenIn,o=e.tokenOut,a=e.slippagePercentage,i=e.independentField,s=e.typedValue,c=e.activeAccount,d=e.txData,u=e.receivingAddress;if(this.isSupported(t,n)&&u===c.address){if(d)return{data:d};var l=+a/100,f={sellToken:r.tokenIdOnNetwork||g.nativeTokenAddress,buyToken:o.tokenIdOnNetwork||g.nativeTokenAddress,slippagePercentage:Number.isNaN(l)?"0.03":String(l),feeRecipient:g.feeRecipient,affiliateAddress:g.affiliateAddress,takerAddress:c.address};"INPUT"===i?f.sellAmount=new g.TokenAmount(r,s).toFormat():f.buyAmount=new g.TokenAmount(o,s).toFormat();var m=v.quoterServerEndpoints[r.networkId];if(m)return{data:R(R({},(yield this.client.get(m,{params:f})).data),{},{from:c.address})}}}));return function(t){return e.apply(this,arguments)}}(),t.queryTransactionProgress=function(){var e=i()((function*(e){var t=e.networkId,n=e.accountId,r=e.nonce;if(void 0!==r)return{status:yield h.default.serviceHistory.queryTransactionNonceStatus({networkId:t,accountId:n,nonce:r})};var o=yield h.default.serviceNetwork.rpcCall(t,{method:"eth_getTransactionReceipt",params:[e.hash]});return o?{status:1===Number(o.status)?"sucesss":"failed"}:Date.now()-e.addedTime>36e5?{status:"failed"}:void 0}));return function(t){return e.apply(this,arguments)}}(),c()(e)}();function C(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function N(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?C(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):C(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var P,B=function(){function e(){this.type=k.QuoterType.socket,this.client=u.a.create({timeout:3e4})}var t=e.prototype;return t.prepare=function(){this.refreshSupportedChains()},t.getBaseURL=function(){var e=i()((function*(){return(yield h.default.serviceSwap.getServerEndPoint())+"/socketBridge"}));return function(){return e.apply(this,arguments)}}(),t.fetchTokenPrice=function(){var e=i()((function*(e){var t,n=(yield this.getBaseURL())+"/token-price",r=yield this.client.get(n,{params:{tokenAddress:Object(g.getEvmTokenAddress)(e),chainId:Object(g.getChainIdFromNetworkId)(e.networkId)}});return null==r||null==(t=r.data)?void 0:t.result}));return function(t){return e.apply(this,arguments)}}(),t.fetchInstantTokenRate=function(){var e=i()((function*(e,t){var n=yield this.fetchTokenPrice(e),r=yield this.fetchTokenPrice(t);if(n&&r)return new f.a(r.tokenPrice).div(n.tokenPrice).toNumber()}));return function(t,n){return e.apply(this,arguments)}}(),t.fetchInstantTokenRateFromChain=function(){var e=i()((function*(e,t,n){var r,o,a,i,s=(yield this.getBaseURL())+"/quote",c={fromChainId:Object(g.getChainIdFromNetworkId)(e.networkId),fromTokenAddress:Object(g.getEvmTokenAddress)(e),toChainId:Object(g.getChainIdFromNetworkId)(t.networkId),toTokenAddress:Object(g.getEvmTokenAddress)(t),fromAmount:Object(g.getTokenAmountString)(e,"1"),userAddress:n,sort:"output",singleTxOnly:!0},d=yield this.client.get(s,{params:c}),u=null==(r=d)||null==(o=r.data)?void 0:o.result;if(u){if(u.routes.length>0){var l=u.routes[0],f=Object(g.calculateRate)(e.decimals,t.decimals,l.fromAmount,l.toAmount);return Number(f)}if(u.bridgeRouteErrors){var m=Object.values(u.bridgeRouteErrors).find((function(e){return e.maxAmount||e.minAmount}));if(m){var p=(null==m?void 0:m.maxAmount)||(null==m?void 0:m.minAmount);if(p&&(c.fromAmount=p,(u=null==(a=d=yield this.client.get(s,{params:c}))||null==(i=a.data)?void 0:i.result)&&u.routes.length>0)){var j=u.routes[0],b=Object(g.calculateRate)(e.decimals,t.decimals,j.fromAmount,j.toAmount);return Number(b)}}}}}));return function(t,n,r){return e.apply(this,arguments)}}(),t.refreshSupportedChains=function(){var e=i()((function*(){var e=yield this.fetchSupportedChains(),t=e.filter((function(e){return e.sendingEnabled})).map((function(e){return String(e.chainId)})),n=e.filter((function(e){return e.receivingEnabled})).map((function(e){return String(e.chainId)}));t.length>0&&(this.supportedSendingChainIds=t),n.length>0&&(this.supportedReceivingChainIds=n)}));return function(){return e.apply(this,arguments)}}(),t.fetchSupportedChains=function(){var e=i()((function*(){var e,t=yield this.getBaseURL(),n=yield this.client.get(t+"/supported/chains");return null==n||null==(e=n.data)?void 0:e.result}));return function(){return e.apply(this,arguments)}}(),t.getBridgeInfo=function(){var e=i()((function*(e){this.supportedBridges||(this.supportedBridges=yield this.fetchSupportedBridges());var t=this.supportedBridges.filter((function(t){return t.name===e||t.bridgeName===e}))[0];return{icon:null==t?void 0:t.icon,displayName:null==t?void 0:t.displayName}}));return function(t){return e.apply(this,arguments)}}(),t.fetchSupportedBridges=function(){var e=i()((function*(){var e,t=yield this.getBaseURL(),n=yield this.client.get(t+"/supported/bridges");return null==n||null==(e=n.data)?void 0:e.result}));return function(){return e.apply(this,arguments)}}(),t.isSupported=function(e,t){var n="evm"===e.impl&&"evm"===t.impl;if(!n)return!1;if(!this.supportedReceivingChainIds||!this.supportedSendingChainIds)return n;var r=Object(g.getChainIdFromNetwork)(e),o=Object(g.getChainIdFromNetwork)(t);return n&&this.supportedSendingChainIds.includes(r)&&this.supportedReceivingChainIds.includes(o)},t.fetchTransactionData=function(){var e=i()((function*(e){var t=yield this.getBaseURL();return(yield this.client.post(t+"/build-tx",{route:e})).data.result}));return function(t){return e.apply(this,arguments)}}(),t.fetchSimpleQuoteFromInput=function(){var e=i()((function*(e){var t,n,r=(yield this.getBaseURL())+"/quote";if(e.networkIn.id===e.networkOut.id&&"OUTPUT"!==e.independentField){var o;try{o=yield this.client.get(r,{params:{fromChainId:Object(g.getChainIdFromNetworkId)(e.networkIn.id),fromTokenAddress:Object(g.getEvmTokenAddress)(e.tokenIn),toChainId:Object(g.getChainIdFromNetworkId)(e.networkOut.id),toTokenAddress:Object(g.getEvmTokenAddress)(e.tokenOut),fromAmount:Object(g.getTokenAmountString)(e.tokenIn,e.typedValue),userAddress:e.activeAccount.address,recipient:e.receivingAddress,sort:"output",singleTxOnly:!0}})}catch(b){return}var a=null==(t=o)||null==(n=t.data)?void 0:n.result;if(a&&a.routes.length>0){var i=a.routes.find((function(e){return!!e.isOnlySwapRoute}));if(i){var s,c,d=i.fromAmount,u=Object(g.getEvmTokenAddress)(e.tokenIn),l=i.toAmount,f=Object(g.getEvmTokenAddress)(e.tokenOut),m=Object(g.calculateRate)(e.tokenIn.decimals,e.tokenOut.decimals,d,l),p=yield this.fetchTransactionData(i);p&&p.approvalData&&p.approvalData.allowanceTarget&&(s=p.approvalData.allowanceTarget),p&&(c={from:e.activeAccount.address,value:p.value,to:p.txTarget,data:p.txData});var j=[];if(i.userTxs)j=i.userTxs.filter((function(e){return e.protocol})).map((function(e){return e.protocol})).map((function(e){return{name:e.displayName,logoUrl:e.icon}}));return{data:{type:this.type,sellAmount:d,sellTokenAddress:u,buyAmount:l,buyTokenAddress:f,instantRate:m,allowanceTarget:s,txData:c,arrivalTime:30,providers:j}}}}}}));return function(t){return e.apply(this,arguments)}}(),t.fetchSimpleQuote=function(){var e=i()((function*(e){if("INPUT"===e.independentField)return this.fetchSimpleQuoteFromInput(e);var t=e.tokenIn,n=e.tokenOut,r=e.typedValue,o=yield this.fetchInstantTokenRateFromChain(t,n,e.activeAccount.address);if(o){var a=Object(g.div)(r,o),i=N({},e);i.independentField="INPUT",i.typedValue=a;var s=yield this.fetchSimpleQuoteFromInput(i);if(null==s||!s.data)return s;var c=new f.a(s.data.buyAmount),d=new f.a(Object(g.getTokenAmountString)(n,r));if(c.isGreaterThan(d.multipliedBy(.95))){var u=s.data;return u.buyAmount=Object(g.getTokenAmountString)(n,r),{data:u}}}}));return function(t){return e.apply(this,arguments)}}(),t.fetchMultichainQuoteFromInput=function(){var e=i()((function*(e){var t,n,r=this,o=(yield this.getBaseURL())+"/quote";if("OUTPUT"!==e.independentField){var a;try{a=yield this.client.get(o,{params:{fromChainId:Object(g.getChainIdFromNetworkId)(e.networkIn.id),fromTokenAddress:Object(g.getEvmTokenAddress)(e.tokenIn),toChainId:Object(g.getChainIdFromNetworkId)(e.networkOut.id),toTokenAddress:Object(g.getEvmTokenAddress)(e.tokenOut),fromAmount:Object(g.getTokenAmountString)(e.tokenIn,e.typedValue),userAddress:e.activeAccount.address,recipient:e.receivingAddress,sort:"output",singleTxOnly:!0}})}catch(k){return}var i=null==(t=a)||null==(n=t.data)?void 0:n.result;if(i&&i.routes.length>0){var s,c,d=i.routes[0],u=d.fromAmount,l=Object(g.getEvmTokenAddress)(e.tokenIn),f=d.toAmount,m=Object(g.getEvmTokenAddress)(e.tokenOut),p=Object(g.calculateRate)(e.tokenIn.decimals,e.tokenOut.decimals,u,f),j=yield this.fetchTransactionData(d);j&&j.approvalData&&j.approvalData.allowanceTarget&&(s=j.approvalData.allowanceTarget),j&&(c={from:e.activeAccount.address,value:j.value,to:j.txTarget,data:j.txData});var b=yield Promise.all(d.usedBridgeNames.map((function(e){return r.getBridgeInfo(e)}))),h=d.usedBridgeNames.map((function(e,t){var n,r;return{name:null==(n=b[t])?void 0:n.displayName,logoUrl:null==(r=b[t])?void 0:r.icon}}));return{data:{type:this.type,sellAmount:u,sellTokenAddress:l,buyAmount:f,buyTokenAddress:m,instantRate:p,allowanceTarget:s,txData:c,arrivalTime:d.serviceTime,providers:h,additionalParams:{socketUsedBridgeNames:d.usedBridgeNames}}}}var O=null==i?void 0:i.bridgeRouteErrors;if(O){var v=Object.values(O).filter((function(e){return e.maxAmount||e.minAmount})).map((function(e){return{max:e.maxAmount,min:e.minAmount}}));if(v.length>0)return{limited:Object(g.calculateRange)(v)}}}}));return function(t){return e.apply(this,arguments)}}(),t.fetchMultichainQuote=function(){var e=i()((function*(e){if("INPUT"===e.independentField)return this.fetchMultichainQuoteFromInput(e);var t=e.tokenIn,n=e.tokenOut,r=e.typedValue,o=yield this.fetchInstantTokenRateFromChain(t,n,e.activeAccount.address);if(o){var a=Object(g.div)(r,o),i=N({},e);i.independentField="INPUT",i.typedValue=a;var s=yield this.fetchMultichainQuoteFromInput(i);if(null==s||!s.data)return s;var c=new f.a(s.data.buyAmount),d=new f.a(Object(g.getTokenAmountString)(n,r));if(c.isGreaterThan(d.multipliedBy(.95))){var u=s.data;return u.buyAmount=Object(g.getTokenAmountString)(n,r),{data:u}}}}));return function(t){return e.apply(this,arguments)}}(),t.fetchQuote=function(){var e=i()((function*(e){if(this.isSupported(e.networkIn,e.networkOut))return e.networkIn.id===e.networkOut.id?this.fetchSimpleQuote(e):this.fetchMultichainQuote(e)}));return function(t){return e.apply(this,arguments)}}(),t.buildTransaction=function(){var e=i()((function*(e){var t=e.txData,n=e.additionalParams;if(t)return{data:t,attachment:{socketUsedBridgeNames:null==n?void 0:n.socketUsedBridgeNames}};var r,o,a=yield this.fetchQuote(e);if(null!=a&&a.data&&(null!=a&&null!=(r=a.data)&&r.txData))return{data:null==a?void 0:a.data.txData,attachment:{socketUsedBridgeNames:null==(o=a.data.additionalParams)?void 0:o.socketUsedBridgeNames}}}));return function(t){return e.apply(this,arguments)}}(),t.querySocketBridgeStatus=function(){var e=i()((function*(e){var t,n;try{var r=yield this.getBaseURL();n=yield this.client.get(r+"/bridge-status",{params:e})}catch(i){return}var o,a=n.data.result;return"COMPLETED"===a.sourceTxStatus&&"COMPLETED"===a.destinationTxStatus||"COMPLETED"===(null==(t=a.refuel)?void 0:t.status)?{status:"sucesss",destinationTransactionHash:a.destinationTransactionHash||(null==(o=a.refuel)?void 0:o.destinationTransactionHash)}:"FAILED"===a.destinationTxStatus||"FAILED"===a.sourceTxStatus?{status:"failed"}:void 0}));return function(t){return e.apply(this,arguments)}}(),t.queryCrosschainTransactionProgress=function(){var e=i()((function*(e){var t=e.nonce,n=e.networkId,r=e.accountId,o=e.tokens,a=e.attachment;if(void 0!==t&&o)for(var i=o.from,s=o.to,c=Object(g.getChainIdFromNetworkId)(i.networkId),d=Object(g.getChainIdFromNetworkId)(s.networkId),u=yield h.default.serviceHistory.getTransactionsWithNonce({nonce:t,networkId:n,accountId:r}),l=0;l<u.length;l+=1){var f,m=u[l].decodedTx.txid,p=yield this.querySocketBridgeStatus({fromChainId:c,toChainId:d,transactionHash:m,bridgeName:null==a||null==(f=a.socketUsedBridgeNames)?void 0:f[0]});if("sucesss"===(null==p?void 0:p.status))return{status:p.status,destinationTransactionHash:p.destinationTransactionHash};if("failed"===(null==p?void 0:p.status))return{status:p.status};if(null!=p&&p.destinationTransactionHash)return{destinationTransactionHash:p.destinationTransactionHash}}if(Date.now()-e.addedTime>864e5)return{status:"failed"}}));return function(t){return e.apply(this,arguments)}}(),t.querySimpleTransactionProgress=function(){var e=i()((function*(e){var t=e.networkId,n=e.accountId,r=e.nonce;if(void 0!==r)return{status:yield h.default.serviceHistory.queryTransactionNonceStatus({networkId:t,accountId:n,nonce:r})};var o=yield h.default.serviceNetwork.rpcCall(t,{method:"eth_getTransactionReceipt",params:[e.hash]});return o?{status:1===Number(o.status)?"sucesss":"failed"}:Date.now()-e.addedTime>864e5?{status:"failed"}:void 0}));return function(t){return e.apply(this,arguments)}}(),t.queryTransactionProgress=function(){var e=i()((function*(e){var t=e.tokens;if(t){var n=t.from,r=t.to;return n.networkId===r.networkId?this.querySimpleTransactionProgress(e):this.queryCrosschainTransactionProgress(e)}}));return function(t){return e.apply(this,arguments)}}(),c()(e)}(),D=((P={})[O.OnekeyNetwork.btc]="BTC",P[O.OnekeyNetwork.eth]="ETH",P[O.OnekeyNetwork.bsc]="BSC",P[O.OnekeyNetwork.heco]="HECO",P[O.OnekeyNetwork.polygon]="POLYGON",P[O.OnekeyNetwork.avalanche]="AVAXC",P[O.OnekeyNetwork.okt]="OKExChain",P[O.OnekeyNetwork.fantom]="FTM",P[O.OnekeyNetwork.arbitrum]="ARB",P[O.OnekeyNetwork.celo]="CELO",P[O.OnekeyNetwork.optimism]="Optimism",P[O.OnekeyNetwork.sol]="SOL",P[O.OnekeyNetwork.trx]="TRX",P[O.OnekeyNetwork.near]="NEAR",P[O.OnekeyNetwork.etc]="ETC",P[O.OnekeyNetwork.ethw]="ETHW",P[O.OnekeyNetwork.etf]="ETHF",P[O.OnekeyNetwork.doge]="DOGE",P[O.OnekeyNetwork.ltc]="LTC",P[O.OnekeyNetwork.bch]="BCH",P[O.OnekeyNetwork.apt]="APT",P[O.OnekeyNetwork.algo]="ALGO",P),E={};function F(e){var t;return null!=(t=D[e.id])?t:""}var L=function(){var e=t.prototype;function t(){this.type=k.QuoterType.swftc,this.coinsLastUpdate=0,this.coinCodeRecords={},this.coinCodeRecordsLastUpdate=0,this.networkAddrRecords={},this.networkAddrRecordsLastUpdate=0,this.client=u.a.create({timeout:6e4})}return e.getBaseUrl=function(){var e=i()((function*(){return(yield h.default.serviceSwap.getServerEndPoint())+"/swft"}));return function(){return e.apply(this,arguments)}}(),e.prepare=function(){this.getCoins()},e.isSupported=function(e,t){return!0},e.modifyTxId=function(){var e=i()((function*(e,t){var n=(yield this.getBaseUrl())+"/modifyTxId";return(yield this.client.post(n,{orderId:e,depositTxid:t})).data.data}));return function(t,n){return e.apply(this,arguments)}}(),e.getGroupedCoins=function(){var e=i()((function*(){var e=yield this.getCoins();return this.groupCoinsByChainId(e)}));return function(){return e.apply(this,arguments)}}(),e.getCoin=function(){var e=i()((function*(e,t){var n,r=F(e);return null==(n=(yield this.getNetworkAddrRecords())[r])?void 0:n[t]}));return function(t,n){return e.apply(this,arguments)}}(),e.getLocalCoins=function(){var e=i()((function*(){var e=h.default.serviceSwap;return this.coins?this.coins:yield e.getSwftcCoins()}));return function(){return e.apply(this,arguments)}}(),e.saveLocalCoins=function(){var e=i()((function*(e){var t=h.default.serviceSwap;yield t.setSwftcCoins(e),this.coins=e,this.coinsLastUpdate=Date.now()}));return function(t){return e.apply(this,arguments)}}(),e.getRemoteCoins=function(){var e=i()((function*(){var e=(yield this.getBaseUrl())+"/queryCoinList";return(yield this.client.post(e)).data.data}));return function(){return e.apply(this,arguments)}}(),e.updateCoins=function(){var e=i()((function*(){var e=yield this.getRemoteCoins();this.saveLocalCoins(e)}));return function(){return e.apply(this,arguments)}}(),e.getCoins=function(){var e=i()((function*(){var e=this,t=yield this.getLocalCoins();return t||(t=yield this.getRemoteCoins(),yield this.saveLocalCoins(t)),Date.now()-this.coinsLastUpdate>36e5&&setTimeout((function(){return e.updateCoins()}),10),t}));return function(){return e.apply(this,arguments)}}(),e.getNetworkAddrRecords=function(){var e=i()((function*(){if(this.networkAddrRecords&&Date.now()-this.networkAddrRecordsLastUpdate<36e5)return this.networkAddrRecords;var e=yield this.getCoins(),t={};return e.forEach((function(e){t[e.mainNetwork]||(t[e.mainNetwork]={});var n=e.contact||g.nativeTokenAddress;t[e.mainNetwork][n]=e})),this.networkAddrRecords=t,this.networkAddrRecordsLastUpdate=Date.now(),this.networkAddrRecords}));return function(){return e.apply(this,arguments)}}(),e.groupCoinsByChainId=function(e){var t={};return e.forEach((function(e){var n=function(e){if(E[e])return E[e];for(var t=Object.keys(D),n=0;n<t.length;n+=1){var r=t[n],o=D[r];if(o&&(E[o]=r,o===e))return r}}(e.mainNetwork);if(n){t[n]||(t[n]=[]);var r=e.contact||g.nativeTokenAddress;t[n].push(r)}})),t},e.fetchSwftcQuote=function(){var e=i()((function*(e){var t=e.networkIn,n=e.networkOut,r=e.tokenOut,o=e.tokenIn;if(this.isSupported(t,n)){var a=yield this.getNetworkAddrRecords(),i=F(t),s=F(n),c=Object(g.getEvmTokenAddress)(o),d=Object(g.getEvmTokenAddress)(r);if(i&&s){var u,l,f,m,p=null==(u=a[i])||null==(l=u[c])?void 0:l.coinCode,j=null==(f=a[s])||null==(m=f[d])?void 0:m.coinCode,b=(yield this.getBaseUrl())+"/getBaseInfo";if(p&&j)return{depositCoinCode:p,receiveCoinCode:j,rate:(yield this.client.post(b,{depositCoinCode:p,receiveCoinCode:j})).data.data}}}}));return function(t){return e.apply(this,arguments)}}(),e.fetchQuote=function(){var e=i()((function*(e){var t=e.independentField,n=e.tokenIn,r=e.typedValue,o=e.tokenOut,a=yield this.fetchSwftcQuote(e);if(a){var i={type:this.type,instantRate:a.rate.instantRate,sellTokenAddress:Object(g.getEvmTokenAddress)(n),buyTokenAddress:Object(g.getEvmTokenAddress)(o),providers:[{name:"SwftBridge",logoUrl:"https://common.onekey-asset.com/logo/SwftBridge.png"}],arrivalTime:300,sellAmount:"",buyAmount:"",percentageFee:a.rate.percentageFee};"INPUT"===t?(i.sellAmount=Object(g.getTokenAmountString)(n,r),i.buyAmount=Object(g.getTokenAmountString)(o,function(e,t,n,r){var o=new f.a(e),a=new f.a(t),i=new f.a(n),s=new f.a(r);return o.minus(o.multipliedBy(a)).multipliedBy(i).minus(s).toFixed()}(r,Object(g.plus)(a.rate.depositCoinFeeRate,"0"),a.rate.instantRate,a.rate.chainFee))):(i.buyAmount=Object(g.getTokenAmountString)(o,r),i.sellAmount=Object(g.getTokenAmountString)(n,function(e,t,n,r){var o=new f.a(e),a=new f.a(t),i=new f.a(n),s=new f.a(r);return o.plus(s).div(i).div(new f.a(1).minus(a)).toFixed()}(r,Object(g.plus)(a.rate.depositCoinFeeRate,"0"),a.rate.instantRate,a.rate.chainFee)));var s=new g.TokenAmount(n,a.rate.depositMax).toNumber(),c=new g.TokenAmount(n,a.rate.depositMin).toNumber();return{data:i,limited:{max:s.toFixed(),min:c.toFixed()}}}}));return function(t){return e.apply(this,arguments)}}(),e.buildTransaction=function(){var e=i()((function*(e){var t=e.typedValue,n=e.independentField,r=e.activeAccount,o=e.tokenIn,a=e.networkIn,i=e.receivingAddress,s=yield this.fetchSwftcQuote(e);if(s&&r){var c=s.depositCoinCode,d=s.receiveCoinCode,u=s.rate,l="",m="";"INPUT"===n?(l=t,m=Object(g.multiply)(t,u.instantRate)):(m=t,l=Object(g.div)(t,u.instantRate));var p=r.address,j=null!=i?i:r.address,b=r.address,O=yield this.createOrder(c,d,new f.a(l).toFixed(8,f.a.ROUND_DOWN),new f.a(m).toFixed(8,f.a.ROUND_DOWN),p,j,b);return O&&O.data?o.tokenIdOnNetwork?{data:yield h.default.engine.buildEncodedTxFromTransfer({networkId:a.id,accountId:r.id,transferInfo:{from:r.address,to:O.data.platformAddr,amount:l,token:o.tokenIdOnNetwork}}),attachment:{swftcOrderId:O.data.orderId}}:{data:yield h.default.engine.buildEncodedTxFromTransfer({networkId:a.id,accountId:r.id,transferInfo:{from:r.address,to:O.data.platformAddr,amount:l}}),attachment:{swftcOrderId:O.data.orderId}}:{error:{code:O.resCode,msg:O.resMsg}}}}));return function(t){return e.apply(this,arguments)}}(),e.createOrder=function(){var e=i()((function*(e,t,n,r,o,a,i){var s={equipmentNo:o,destinationAddr:a,refundAddr:i,depositCoinAmt:n,receiveCoinAmt:r,depositCoinCode:e,receiveCoinCode:t,sourceType:"H5",sourceFlag:"ONEKEY"},c=(yield this.getBaseUrl())+"/accountExchange";return(yield this.client.post(c,s)).data}));return function(t,n,r,o,a,i,s){return e.apply(this,arguments)}}(),e.getTxOrderInfo=function(){var e=i()((function*(e){var t,n,r=null!=(t=null==(n=e.attachment)?void 0:n.swftcOrderId)?t:e.thirdPartyOrderId;if(r){var o=(yield this.getBaseUrl())+"/queryOrderState";return(yield u.a.post(o,{equipmentNo:e.from,sourceType:"H5",orderId:r})).data.data}}));return function(t){return e.apply(this,arguments)}}(),e.queryTransactionProgress=function(){var e=i()((function*(e){var t,n,r=null!=(t=null==(n=e.attachment)?void 0:n.swftcOrderId)?t:e.thirdPartyOrderId;if(r){var o=(yield this.getBaseUrl())+"/queryOrderState",a=(yield u.a.post(o,{equipmentNo:e.from,sourceType:"H5",orderId:r})).data.data;if("complete"===a.tradeState)return{status:"sucesss",destinationTransactionHash:a.transactionId};if(a.transactionId)return{destinationTransactionHash:a.transactionId}}var i=e.networkId,s=e.accountId,c=e.nonce,d=e.hash;if("evm"===Object(m.getNetworkImpl)(i)&&void 0!==c){var l=yield h.default.serviceHistory.queryTransactionNonceStatus({networkId:i,accountId:s,nonce:c});if("canceled"===l||"failed"===l)return{status:l}}else if("evm"!==Object(m.getNetworkImpl)(i)){var f=yield h.default.serviceHistory.queryTransactionByTxid({networkId:i,accountId:s,txid:d});if("canceled"===f||"failed"===f)return{status:f}}if(Date.now()-e.addedTime>864e5)return{status:"failed"}}));return function(t){return e.apply(this,arguments)}}(),c()(t)}();function U(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function H(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?U(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):U(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var q=function(){function e(){this.httpClient=u.a.create({timeout:6e4}),this.jupiter=new T,this.swftc=new L,this.simple=new x,this.socket=new B,this.mdex=new M,this.quoters=[this.mdex,this.simple,this.socket,this.jupiter,this.swftc],this.transactionReceipts={},this.solTransactionReceipts={}}var t=e.prototype;return t.prepare=function(){this.quoters.forEach((function(e){null==e.prepare||e.prepare()}))},t.convertOrderToTransaction=function(){var e=i()((function*(e,t){var n=e.tokenIn,r=e.networkIn,o=e.activeAccount,a=e.sellAmount;if(a&&n){if(!t.platformAddr)throw new Error("failed to build transaction due to invalid platformAddr");var i=new f.a(a).shiftedBy(-n.decimals).toFixed();return n.tokenIdOnNetwork?yield h.default.engine.buildEncodedTxFromTransfer({networkId:r.id,accountId:o.id,transferInfo:{from:o.address,to:t.platformAddr,amount:i,token:n.tokenIdOnNetwork}}):yield h.default.engine.buildEncodedTxFromTransfer({networkId:r.id,accountId:o.id,transferInfo:{from:o.address,to:t.platformAddr,amount:i}})}}));return function(t,n){return e.apply(this,arguments)}}(),t.fetchLimitOrderQuote=function(){var e=i()((function*(e){var t,n,r=Object(g.convertLimitOrderParams)(e);if(r){r.quoterType="0x";var o=(yield h.default.serviceSwap.getServerEndPoint())+"/exchange/quote",a=null==(t=(yield this.httpClient.get(o,{params:r})).data)?void 0:t.data;if(a&&null!=(n=a.result)&&n.instantRate)return{instantRate:Object(g.formatAmountExact)(a.result.instantRate)}}}));return function(t){return e.apply(this,arguments)}}(),t.buildQuote=function(){var e=i()((function*(e){var t=e.responses,n=e.params;if(t&&0!==t.length){var r,o=t.filter((function(e){var t;return null==(t=e.result)?void 0:t.allowanceTarget})).map((function(e){return e.result.allowanceTarget})),a=yield h.default.engine.batchTokensAllowance({networkId:n.tokenIn.networkId,accountId:n.activeAccount.id,tokenIdOnNetwork:n.tokenIn.tokenIdOnNetwork,spenders:o});return a&&a.length===o.length&&o.forEach((function(e,t){var n=a[t];r||(r={}),r[e]=n})),t.map((function(e){var t,n=e.result,o=0;"swft"===n.quoter&&(o=.002);var a,i=o+Number(null!=(t=n.percentageFee)?t:0),s={type:n.quoter,quoterlogo:n.quoterLogo,instantRate:n.instantRate,sellAmount:n.sellAmount,sellTokenAddress:n.sellTokenAddress,buyAmount:n.buyAmount,buyTokenAddress:n.buyTokenAddress,providers:n.sources,percentageFee:n.percentageFee,allowanceTarget:n.allowanceTarget,arrivalTime:n.arrivalTime,needApproved:!1,estimatedBuyAmount:Object(g.multiply)(n.buyAmount,1-i),minAmountOut:n.minAmountOut,protocolFees:n.protocolFees,estimatedPriceImpact:n.estimatedPriceImpact};if(s.allowanceTarget&&r){var c=r[s.allowanceTarget];void 0!==c&&n.sellAmount&&(s.needApproved=Number(n.sellAmount)>c)}return e.limit&&(a={max:e.limit.max,min:e.limit.min}),{data:s,limited:a}}))}}));return function(t){return e.apply(this,arguments)}}(),t.fetchQuote=function(){var e=i()((function*(e){var t,n=Object(g.convertParams)(e);if(n){var r=yield h.default.serviceSwap.getCurrentUserSelectedQuoter();r&&(n.quoterType=r);var o=(yield h.default.serviceSwap.getServerEndPoint())+"/exchange/quote",a=null==(t=(yield this.httpClient.get(o,{params:n})).data)?void 0:t.data;if(a){var i=yield this.buildQuote({responses:[a],params:e});return null==i?void 0:i[0]}}}));return function(t){return e.apply(this,arguments)}}(),t.fetchQuotes=function(){var e=i()((function*(e){var t,n=Object(g.convertParams)(e);if(n){var r=(yield h.default.serviceSwap.getServerEndPoint())+"/exchange/quote_all",o=null==(t=(yield this.httpClient.get(r,{params:n})).data)?void 0:t.data;if(o){var a=yield this.buildQuote({responses:o,params:e});if(a)return a.filter((function(e){return Boolean(e)}))}}}));return function(t){return e.apply(this,arguments)}}(),t.parseRequestId=function(e){try{var t=e.config.headers,n=null==t?void 0:t["x-onekey-request-id"];if(!n){var r=null==t?void 0:t["X-Request-By"];if("string"===typeof r)n=JSON.parse(r)["x-onekey-request-id"]}return n}catch(o){b.default.common.error("Failed to get request id with reason",o.message)}},t.buildTransaction=function(){var e=i()((function*(e,t){var n,r=Object(g.convertBuildParams)(t);if(r){r.quoterType=e,r.disableValidate=Boolean(t.disableValidate);var o=(yield h.default.serviceSwap.getServerEndPoint())+"/exchange/build_tx",a=yield this.httpClient.post(o,r),i=this.parseRequestId(a),s=a.data;if(s.errMsg)throw new Error(s.errMsg);if(null!=s&&s.transaction)return"object"===typeof s.transaction?t.networkIn.impl===j.IMPL_APTOS?{data:H(H({},s.transaction),{},{sender:t.activeAccount.address}),result:s.result,requestId:i}:{data:H(H({},s.transaction),{},{from:t.activeAccount.address}),result:s.result,requestId:i}:{data:s.transaction,result:s.result,requestId:i};if(s.order&&null!=(n=s.result)&&n.instantRate)return{data:yield this.convertOrderToTransaction(t,s.order),result:s.result,attachment:{swftcOrderId:s.order.orderId,swftcPlatformAddr:s.order.platformAddr,swftcDepositCoinAmt:s.order.depositCoinAmt,swftcDepositCoinCode:s.order.depositCoinCode,swftcReceiveCoinAmt:s.order.receiveCoinAmt,swftcReceiveCoinCode:s.order.receiveCoinCode},requestId:i}}}));return function(t,n){return e.apply(this,arguments)}}(),t.fetchQuoteLegacy=function(){var e=i()((function*(e){for(var t=0;t<this.quoters.length;t+=1){var n=this.quoters[t];if(n.isSupported(e.networkOut,e.networkIn)){var r=yield n.fetchQuote(e);if(null!=r&&r.data)return r}}}));return function(t){return e.apply(this,arguments)}}(),t.buildTransactionLegacy=function(){var e=i()((function*(e,t){for(var n=0;n<this.quoters.length;n+=1){var r=this.quoters[n];if(r.type===e&&r.isSupported(t.networkOut,t.networkIn)){var o=yield r.buildTransaction(t);if(o)return o}}}));return function(t,n){return e.apply(this,arguments)}}(),t.queryTransactionProgress=function(){var e=i()((function*(e){if(Object(g.isSimpleTx)(e))return this.simple.queryTransactionProgress(e);for(var t=Object(g.getQuoteType)(e),n=0;n<this.quoters.length;n+=1){var r=this.quoters[n];if(r.type===t)return r.queryTransactionProgress(e)}}));return function(t){return e.apply(this,arguments)}}(),t.getHistoryTx=function(){var e=i()((function*(e){var t=h.default.serviceHistory,n=e.accountId,r=e.networkId,o=e.nonce;if(Object(m.getNetworkImpl)(e.networkId)!==j.IMPL_EVM||void 0===o)return(yield t.getLocalHistory({accountId:n,networkId:r})).find((function(t){return t.decodedTx.txid===e.hash}));var a=(yield t.getTransactionsWithNonce({accountId:n,networkId:r,nonce:o})).find((function(e){return e.decodedTx.status===p.IDecodedTxStatus.Confirmed}));return a||void 0}));return function(t){return e.apply(this,arguments)}}(),t.getTransactionReceipt=function(){var e=i()((function*(e,t){var n,r;if(this.transactionReceipts[e]||(this.transactionReceipts[e]={}),null!=(n=this.transactionReceipts[e])&&n[t])return null==(r=this.transactionReceipts[e])?void 0:r[t];var o=yield h.default.serviceNetwork.rpcCall(e,{method:"eth_getTransactionReceipt",params:[t]});return o?(this.transactionReceipts[e][t]=o,o):void 0}));return function(t,n){return e.apply(this,arguments)}}(),t.getSOLTransactionReceipt=function(){var e=i()((function*(e,t){var n,r;if(this.solTransactionReceipts[e]||(this.solTransactionReceipts[e]={}),null!=(n=this.solTransactionReceipts[e])&&n[t])return null==(r=this.solTransactionReceipts[e])?void 0:r[t];var o=yield h.default.serviceNetwork.rpcCall(e,{method:"getTransaction",params:[t,{encoding:"jsonParsed",maxSupportedTransactionVersion:0}]});return o?(this.solTransactionReceipts[e][t]=o,o):void 0}));return function(t,n){return e.apply(this,arguments)}}(),t.doQueryReceivedToken=function(){var e=i()((function*(e,t,n){if(Object(g.isEvmNetworkId)(t.networkId)){var r=yield this.getTransactionReceipt(t.networkId,e);if(r){var o,a=function(e){return"0x"+e.slice(2).replace(/^0+/,"").padStart(40,"0")};if(t.tokenIdOnNetwork){var i,s=null==(i=r.logs)?void 0:i.find((function(e){return a(e.address.toLowerCase())===t.tokenIdOnNetwork.toLowerCase()&&3===e.topics.length&&e.topics[2]&&a(e.topics[2])===n.toLowerCase()}));return null==s?void 0:s.data}var c=null==(o=r.logs)?void 0:o.find((function(e){if(2===e.topics.length){var t=e.topics[0];if("0x7fcf532c15f0a6db0bd6d0e038bea71d30d808c7d98cb3bf7268a95bf5081b65"===a(t).toLowerCase())return!0}return!1}));return null==c?void 0:c.data}}else if(Object(g.isSolNetworkId)(t.networkId)){var d=yield this.getSOLTransactionReceipt(t.networkId,e);if(d){var u=function(e){var r=t.tokenIdOnNetwork;return e.owner.toLowerCase()===n.toLowerCase()&&e.mint.toLowerCase()===r.toLowerCase()},l=d.meta.preTokenBalances.find(u),f=d.meta.postTokenBalances.find(u);if(l&&f)return Object(g.minus)(f.uiTokenAmount.amount,l.uiTokenAmount.amount)}}}));return function(t,n,r){return e.apply(this,arguments)}}(),t.getActualReceived=function(){var e=i()((function*(e){if(e.tokens){var t=e.receivingAddress,n=e.tokens,r=n.from,o=n.to;if("swftc"===(null==e?void 0:e.quoterType)){var a=yield this.swftc.getTxOrderInfo(e);if(a)return a.receiveCoinAmt}else{var i=yield this.getHistoryTx(e),s=(null==i?void 0:i.decodedTx.txid)||e.hash;if(Object(g.isEvmNetworkId)(r.networkId)&&Object(g.isEvmNetworkId)(o.networkId)&&t){if(s&&r.networkId===o.networkId){var c=yield this.doQueryReceivedToken(s,o.token,t);if(c)return Object(g.getTokenAmountValue)(e.tokens.to.token,c).toFixed()}else if(e.destinationTransactionHash){var d=yield this.doQueryReceivedToken(e.destinationTransactionHash,o.token,t);if(d)return Object(g.getTokenAmountValue)(e.tokens.to.token,d).toFixed()}}else if(Object(g.isSolNetworkId)(r.networkId)&&Object(g.isSolNetworkId)(o.networkId)&&t){var u=yield this.doQueryReceivedToken(e.hash,o.token,t);if(u)return Object(g.getTokenAmountValue)(e.tokens.to.token,u).toFixed()}}}}));return function(t){return e.apply(this,arguments)}}(),t.getTxCompletedTime=function(){var e=i()((function*(e){if(e.tokens){var t=e.tokens.to;if(Object(g.isEvmNetworkId)(t.networkId)){var n=e.hash,r=yield this.getHistoryTx(e);null!=r&&r.decodedTx.txid&&(n=null==r?void 0:r.decodedTx.txid),e.destinationTransactionHash&&(n=e.destinationTransactionHash);var o=yield this.getTransactionReceipt(t.networkId,n);if(null!=o&&o.blockHash){var a=yield h.default.serviceNetwork.rpcCall(t.networkId,{method:"eth_getBlockByHash",params:[o.blockHash,!0]});if(null!=a&&a.timestamp)return new f.a(a.timestamp).multipliedBy(1e3).toFixed()}}}}));return function(t){return e.apply(this,arguments)}}(),t.getTxActualNetworkFee=function(){var e=i()((function*(e){if(e.tokens){var t=e.tokens.from;if(Object(g.isEvmNetworkId)(t.networkId)){var n=yield this.getHistoryTx(e),r=(null==n?void 0:n.decodedTx.txid)||e.hash,o=yield this.getTransactionReceipt(t.networkId,r);if(o&&o.gasUsed&&o.effectiveGasPrice){var a=yield h.default.engine.getNetwork(e.networkId);return Object(g.calculateNetworkFee)({limit:o.gasUsed,price:Object(g.div)(o.effectiveGasPrice,10**9)},a)}}}}));return function(t){return e.apply(this,arguments)}}(),t.swftModifyTxId=function(){var e=i()((function*(e,t){return this.swftc.modifyTxId(e,t)}));return function(t,n){return e.apply(this,arguments)}}(),c()(e)}();q.client=new q},4036:function(e,t,n){"use strict";n.r(t),n.d(t,"useSwapSend",(function(){return j})),n.d(t,"useSwapSignMessage",(function(){return b}));var r=n(2),o=n.n(r),a=n(1),i=n(130),s=n(19),c=n(17),d=n(111),u=n(137),l=n(16),f=n(80),m=n(95),p=n(188);function j(){var e=Object(d.default)(),t=Object(u.useAppSelector)((function(e){return e.settings.validationSetting}));return Object(a.useCallback)(function(){var n=o()((function*(n){var r=n.encodedTx,o=n.accountId,a=n.networkId,d=n.payloadInfo,u=n.onFail,j=n.onSuccess,b=n.onDetail,h=n.gasEstimateFallback,g=n.showSendFeedbackReceipt,O=Object(p.createLoggerTimer)(),v=Object(i.getWalletIdFromAccountId)(o),k=yield c.default.engine.getWallet(v),y=(yield c.default.servicePassword.getPassword())&&!(null!=t&&t.Payment);if("hw"===k.type||"external"!==k.type&&y)try{O.start(p.LoggerTimerTags.sendTransaction);var w=yield c.default.serviceSwap.sendTransaction({accountId:o,networkId:a,encodedTx:r,payload:d,autoFallback:h}),x=w.result,I=w.decodedTx;O.end(p.LoggerTimerTags.sendTransaction),yield null==j?void 0:j({result:x,decodedTx:I}),g&&setTimeout((function(){e.navigate(l.RootRoutes.Modal,{screen:l.ModalRoutes.Send,params:{screen:m.SendModalRoutes.SendFeedbackReceipt,params:{networkId:a,accountId:o,txid:x.txid,type:"Send"}}})}),10)}catch(T){var _,S=(null==T||null==(_=T.data)?void 0:_.message)||T.message;s.default.swap.error("swap send failed with message "+S),f.deviceUtils.showErrorToast(T,S),null==u||u(T)}else e.navigate(l.RootRoutes.Modal,{screen:l.ModalRoutes.Send,params:{screen:m.SendModalRoutes.SendConfirm,params:{accountId:o,networkId:a,payloadInfo:d,feeInfoEditable:!0,feeInfoUseFeeInTx:!1,encodedTx:r,hideSendFeedbackReceipt:!g,onDetail:b,onSuccess:function(e,t){var n;null==j||j({result:e,decodedTx:null!=(n=null==t?void 0:t.decodedTx)?n:void 0})}}}})}));return function(e){return n.apply(this,arguments)}}(),[t,e])}function b(){var e=Object(d.default)(),t=Object(u.useAppSelector)((function(e){return e.settings.validationSetting}));return Object(a.useCallback)(function(){var n=o()((function*(n){var r=n.accountId,o=n.networkId,a=n.unsignedMessage,s=n.onSuccess,d=n.onFail,u=Object(p.createLoggerTimer)(),j=Object(i.getWalletIdFromAccountId)(r),b=yield c.default.engine.getWallet(j),h=(yield c.default.servicePassword.getPassword())&&!(null!=t&&t.Payment);if("hw"===b.type||"external"!==b.type&&h)try{u.start(p.LoggerTimerTags.signMessage);var g=yield c.default.serviceTransaction.signMessage({accountId:r,networkId:o,unsignedMessage:a});u.end(p.LoggerTimerTags.signMessage),yield null==s?void 0:s(g)}catch(v){var O;f.deviceUtils.showErrorToast(v,(null==v||null==(O=v.data)?void 0:O.message)||v.message),null==d||d(v)}else e.navigate(l.RootRoutes.Modal,{screen:l.ModalRoutes.Send,params:{screen:m.SendModalRoutes.SignMessageConfirm,params:{accountId:r,networkId:o,unsignedMessage:a,onSuccess:s}}})}));return function(e){return n.apply(this,arguments)}}(),[e,t])}},4142:function(e,t,n){"use strict";n.r(t),n.d(t,"Options",(function(){return c}));var r=n(64),o=n(27),a=n(12),i=n(106),s=n(0),c=function(e){var t=e.title,c=e.subtitle,d=e.logo,u=e.num,l=e.onPress;return Object(s.jsxs)(r.default,{onPress:l,bg:"surface-default",px:"4",py:"3",flexDirection:"row",justifyContent:"space-between",borderRadius:12,children:[Object(s.jsxs)(a.default,{flexDirection:"row",alignItems:"center",children:[Object(s.jsxs)(a.default,{mr:"3",position:"relative",children:[Object(s.jsx)(a.default,{w:"10",h:"10",borderRadius:"full",overflow:"hidden",children:Object(s.jsx)(i.default,{w:"10",h:"10",source:n(4143)})}),Object(s.jsx)(a.default,{w:"5",h:"5",background:"surface-subdued",flexDirection:"row",justifyContent:"center",alignItems:"center",borderRadius:"full",position:"absolute",bottom:"-1",right:"-1",children:Object(s.jsx)(i.default,{w:"4",h:"4",source:d})})]}),Object(s.jsxs)(a.default,{children:[Object(s.jsx)(o.default.Body1Strong,{children:t}),Object(s.jsx)(o.default.Body2,{color:"text-subdued",children:c})]})]}),Object(s.jsx)(a.default,{flexDirection:"row",justifyContent:"center",alignItems:"center",children:Object(s.jsx)(o.default.Body1Strong,{color:"text-success",children:u})})]})}},4143:function(e,t,n){e.exports=n.p+"static/media/eth_logo.ff687f08.png"},4144:function(e,t,n){"use strict";n.r(t),n.d(t,"SwapTransactionsCancelApprovalBottomSheetModal",(function(){return l}));var r=n(474),o=n(41),a=n(54),i=n(51),s=n(27),c=n(1),d=n(88),u=n(0),l=function(e){var t=e.close,n=e.onSubmit,l=Object(d.default)(),f=Object(c.useCallback)((function(){t(),n()}),[t,n]);return Object(u.jsxs)(r.default,{closeOverlay:t,title:"",showHeader:!1,children:[Object(u.jsx)(i.default,{h:"16",children:Object(u.jsx)(s.default.Heading,{fontSize:60,children:" \u2139\ufe0f "})}),Object(u.jsx)(s.default.DisplayMedium,{mt:"4",children:l.formatMessage({id:"msg__need_to_send_str_transactions_to_change_allowance"},{0:"2"})}),Object(u.jsx)(s.default.Body1,{color:"text-subdued",my:"4",children:l.formatMessage({id:"msg__modifying_the_authorized_limit_of_usdt_requires_resetting_it_to_zero_first_so_two_authorization_transactions_may_be_initiated"})}),Object(u.jsxs)(o.default,{flexDirection:"row",space:"4",children:[Object(u.jsx)(a.default,{size:"xl",type:"basic",onPress:t,flex:"1",children:l.formatMessage({id:"action__cancel"})}),Object(u.jsx)(a.default,{size:"xl",type:"primary",onPress:f,flex:"1",children:l.formatMessage({id:"action__confirm"})})]})]})}},4297:function(e,t,n){"use strict";n.r(t),n.d(t,"useSwapSubmit",(function(){return P}));var r=n(3),o=n.n(r),a=n(4),i=n.n(a),s=n(48),c=n(2),d=n.n(c),u=n(1),l=n(21),f=n.n(l),m=n(88),p=n(130),j=n(151),b=n(19),h=n(17),g=n(25),O=n(16),v=n(185),k=n(186),y=n(259),w=n(46),x=n(99),I=n(4144),_=n(4e3),S=n(946),T=n(188),A=n(4036),R=n(0);function M(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function C(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?M(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):M(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var N=function(){var e=d()((function*(e){var t,n,r,o,a=e.hash,i=e.decodedTx,s=e.params,c=e.response,d=e.recipient,u=e.quote,l=null==c?void 0:c.result;if(void 0!==c&&void 0!==l){var m,p=[Object(k.clearState)()],b=l.sellAmount||u.sellAmount,g=l.buyAmount||u.buyAmount,O=u.type,w=u.quoterlogo,x=yield h.default.engine.getNetwork(s.tokenIn.networkId),I=yield h.default.engine.getNetwork(s.tokenIn.networkId),S=Object(T.getTokenAmountValue)(s.tokenIn,b),A=Object(T.getTokenAmountValue)(s.tokenOut,g),R=null==i?void 0:i.nonce;i&&(m=Object(T.calculateDecodedTxNetworkFee)(i,x));var M={networkId:s.tokenIn.networkId,token:s.tokenIn,amount:Object(T.formatAmount)(new f.a(l.sellAmount).shiftedBy(-s.tokenIn.decimals))||Object(T.formatAmount)(S)},C={networkId:s.tokenOut.networkId,token:s.tokenOut,amount:Object(T.formatAmount)(new f.a(l.buyAmount).shiftedBy(-s.tokenOut.decimals))||Object(T.formatAmount)(A)};p.push(Object(y.addTransaction)({accountId:s.activeAccount.id,networkId:s.tokenIn.networkId,transaction:{hash:a,from:s.activeAccount.address,addedTime:Date.now(),status:"pending",type:"swap",accountId:s.activeAccount.id,networkId:s.tokenIn.networkId,quoterType:O,quoterLogo:w,nonce:R,attachment:c.attachment,receivingAccountId:null==d?void 0:d.accountId,receivingAddress:null==d?void 0:d.address,providers:null!=(t=null==l?void 0:l.sources)?t:u.providers,arrivalTime:u.arrivalTime,percentageFee:u.percentageFee,protocalFees:u.protocolFees,networkFee:m,viewed:!1,tokens:{from:M,to:C,rate:Number(null!=(n=null==l?void 0:l.instantRate)?n:u.instantRate)}}}));var N,P=Object(v.appSelector)((function(e){return e.swapTransactions.slippage}));if(P&&P.autoReset&&p.push(Object(y.setSlippage)({mode:"auto"})),h.default.dispatch.apply(h.default,p),h.default.serviceToken.addAccountToken(s.tokenIn.networkId,s.activeAccount.id,s.tokenIn.tokenIdOnNetwork),s.tokenIn.networkId===s.tokenOut.networkId&&h.default.serviceToken.addAccountToken(s.tokenOut.networkId,s.activeAccount.id,s.tokenOut.tokenIdOnNetwork),"swftc"===(null==(r=c.result)?void 0:r.quoter)&&null!=(o=c.attachment)&&o.swftcOrderId)_.SwapQuoter.client.swftModifyTxId(null==(N=c.attachment)?void 0:N.swftcOrderId,a);var B=null==x?void 0:x.shortName,D=null==I?void 0:I.shortName;h.default.serviceSwap.addRecord({txid:a,from:{networkId:M.networkId,networkName:null!=B?B:"",tokenAddress:M.token.tokenIdOnNetwork,tokenName:M.token.name,amount:M.amount},to:{networkId:C.networkId,networkName:null!=D?D:"",tokenAddress:C.token.tokenIdOnNetwork,tokenName:C.token.name,amount:C.amount},params:s,response:c}),j.appUIEventBus.emit(j.AppUIEventBusNames.SwapAddTransaction)}}));return function(t){return e.apply(this,arguments)}}();var P=function(){var e=Object(m.default)(),t=Object(A.useSwapSend)(),n=Object(g.useNavigation)();return Object(u.useCallback)(function(){var r=d()((function*(r){var o,a,c=r.params,u=r.quote,l=r.recipient,m=r.onSuccess,g=r.setProgressStatus,k=r.openProgressStatus,y=r.closeProgressStatus;if(c&&u&&l){var A=c.activeAccount,M=new T.TokenAmount(c.tokenIn,Object(T.getTokenAmountValue)(c.tokenIn,u.sellAmount).toFixed()),P=new T.TokenAmount(c.tokenOut,Object(T.getTokenAmountValue)(c.tokenOut,u.buyAmount).toFixed());if(yield h.default.serviceSwap.checkAccountInWallets(A.id)){var B=c.tokenIn.networkId,D=yield h.default.engine.getNetwork(B);if(D){var E=Object(T.createLoggerTimer)();E.start(T.LoggerTimerTags.checkTokenBalance),null==g||g({title:e.formatMessage({id:"action__confirming_balance_str"},{0:""})});var F=yield h.default.serviceToken.getAccountBalanceFromRpc(D.id,A.id,[],!0),L=i()(F,1)[0],U=null==L||null==(o=L.main)?void 0:o.balance;U?b.default.swap.info(c.tokenIn.networkId+" native token balance is "+U):b.default.swap.info(c.tokenIn.networkId+" failed to fetch native token balance"),E.end(T.LoggerTimerTags.checkTokenBalance);var H=new f.a(null!=U?U:"0");if(H.isZero()){var q=yield h.default.engine.getNativeTokenInfo(B);s.default.show({title:e.formatMessage({id:"msg__str_insufficient_balance_to_pay_for_gas_fee"},{0:q.symbol.toUpperCase()})},{type:"error"})}else{var Q=yield h.default.serviceSwap.getReservedNetworkFee(D.id);if((c.tokenIn.tokenIdOnNetwork?H:H.minus(M.typedValue)).lt(Q)){var K=yield h.default.engine.getNativeTokenInfo(B);s.default.show({title:e.formatMessage({id:"msg__suggest_reserving_str_as_gas_fee"},{0:Q+" "+K.symbol.toUpperCase()})},{type:"error"})}else{var V,z=C(C({},c),{},{activeAccount:A,receivingAddress:null==l?void 0:l.address,txData:u.txData,additionalParams:u.additionalParams,sellAmount:u.sellAmount,buyAmount:u.buyAmount,disableValidate:!0});try{E.start(T.LoggerTimerTags.buildTransaction),null==g||g({title:e.formatMessage({id:"action__building_transaction_data_str"},{0:""})}),V=yield _.SwapQuoter.client.buildTransaction(u.type,z),E.end(T.LoggerTimerTags.buildTransaction)}catch(je){var W,G,J=(null==je||null==(W=je.response)||null==(G=W.data)?void 0:G.message)||je.message;return void s.default.show({title:J},{type:"error"})}if(void 0!==V&&null!=(a=V)&&a.data){var $=function(e){var t=e.swapQuote,n=e.quoteParams,r=e.inputAmount,o=e.outputAmount,a=e.account,i=e.receivingAddress,s=n.networkIn,c=n.networkOut,d=n.tokenIn,u=n.tokenOut,l=n.slippagePercentage,f=n.independentField;return{accountAddress:a.address,receivingAddress:i,send:{networkId:s.id,tokenInfo:d,amount:r.typedValue,amountValue:r.amount.toFixed()},receive:{networkId:c.id,tokenInfo:u,amount:o.typedValue,amountValue:o.amount.toFixed()},slippagePercentage:l,independentField:f,swapQuote:t}}({quoteParams:c,inputAmount:M,outputAmount:P,swapQuote:u,account:A,receivingAddress:null==l?void 0:l.address}),X=V.data;if(void 0!==X){var Y=V.result;if(Y){var Z,ee,te=Object(p.getWalletIdFromAccountId)(A.id),ne=yield h.default.engine.getWallet(te),re=!1;if(Y.allowanceTarget&&c.tokenIn.tokenIdOnNetwork){E.start(T.LoggerTimerTags.checkTokenAllowance);var oe=yield h.default.engine.getTokenAllowance({networkId:c.tokenIn.networkId,accountId:c.activeAccount.id,tokenIdOnNetwork:c.tokenIn.tokenIdOnNetwork,spender:Y.allowanceTarget});E.end(T.LoggerTimerTags.checkTokenAllowance),oe?(b.default.swap.info(c.tokenIn.networkId+" "+c.tokenIn.symbol+" allowance is "+oe),re=new f.a(Object(T.getTokenAmountString)(c.tokenIn,oe)).lt(Y.sellAmount)):b.default.swap.info(c.tokenIn.networkId+" "+c.tokenIn.symbol+" failed to fetch token allowance");var ae=yield h.default.serviceSwap.needToResetApproval(c.tokenIn);if(re&&ae&&Number(oe||"0")>0&&(ee=yield h.default.engine.buildEncodedTxFromApprove({spender:Y.allowanceTarget,networkId:c.tokenIn.networkId,accountId:A.id,token:c.tokenIn.tokenIdOnNetwork,amount:"0"})),re){var ie=Object(v.appSelector)((function(e){return e.settings.disableSwapExactApproveAmount}))?"unlimited":Object(T.getTokenAmountValue)(c.tokenIn,Y.sellAmount).toFixed();Z=yield h.default.engine.buildEncodedTxFromApprove({spender:Y.allowanceTarget,networkId:c.tokenIn.networkId,accountId:A.id,token:c.tokenIn.tokenIdOnNetwork,amount:ie}),ee&&ee.nonce&&(Z.nonce=Number(ee.nonce)+1)}}var se=[],ce=function(){var r=d()((function*(){null==g||g({title:e.formatMessage({id:"action__swapping_str"},{0:""})}),yield t({accountId:A.id,networkId:B,gasEstimateFallback:Boolean(Z),encodedTx:X,showSendFeedbackReceipt:!0,payloadInfo:{type:"InternalSwap",swapInfo:$},onDetail:function(e){n.navigate(O.RootRoutes.Modal,{screen:O.ModalRoutes.Swap,params:{screen:S.SwapRoutes.Transaction,params:{txid:e}}})},onSuccess:function(){var e=d()((function*(e){var t=e.result,n=e.decodedTx;V&&(yield N({hash:t.txid,decodedTx:n,params:z,response:V,quote:u,recipient:l}),j.appUIEventBus.emit(j.AppUIEventBusNames.SwapCompleted),null==m||m({result:t,decodedTx:n}))}));return function(t){return e.apply(this,arguments)}}(),onFail:function(){j.appUIEventBus.emit(j.AppUIEventBusNames.SwapError)}})}));return function(){return r.apply(this,arguments)}}();if(se.unshift(ce),Z){var de=function(){var r=d()((function*(r){var o={type:"InternalSwap"};"external"!==ne.type&&(o.swapInfo=C(C({},$),{},{isApprove:!0})),E.start(T.LoggerTimerTags.approval),null==g||g({title:e.formatMessage({id:"action__authorizing_str"},{0:""})}),yield t({accountId:A.id,networkId:B,payloadInfo:o,encodedTx:Z,gasEstimateFallback:Boolean(ee),onSuccess:function(){var e=d()((function*(){"hw"===ne.type&&n.navigate(O.RootRoutes.Modal,{screen:O.ModalRoutes.Send,params:{screen:O.SendModalRoutes.HardwareSwapContinue,params:{networkId:B,accountId:A.id}}}),yield null==r?void 0:r()}));return function(){return e.apply(this,arguments)}}()}),E.end(T.LoggerTimerTags.approval)}));return function(e){return r.apply(this,arguments)}}();se.unshift(de)}if(ee){var ue=function(){var n=d()((function*(n){var r={type:"InternalSwap"};"external"!==ne.type&&(r.swapInfo=C(C({},$),{},{isApprove:!0})),E.start(T.LoggerTimerTags.cancelApproval),null==g||g({title:e.formatMessage({id:"action__resetting_authorizing_str"},{0:""})}),yield t({accountId:A.id,networkId:B,payloadInfo:r,encodedTx:ee,onSuccess:function(){var e=d()((function*(){yield null==n?void 0:n()}));return function(){return e.apply(this,arguments)}}()}),E.end(T.LoggerTimerTags.cancelApproval)}));return function(e){return n.apply(this,arguments)}}();se.unshift(ue)}ee?Object(x.showOverlay)((function(e){return Object(R.jsx)(I.SwapTransactionsCancelApprovalBottomSheetModal,{close:e,onSubmit:d()((function*(){try{null==k||k(),yield Object(T.combinedTasks)(se)}finally{null==y||y()}}))})})):yield Object(T.combinedTasks)(se),yield Object(w.wait)(1e3)}else s.default.show({title:e.formatMessage({id:"msg__unknown_error"})},{type:"error"})}else s.default.show({title:e.formatMessage({id:"msg__unknown_error"})},{type:"error"})}else{var le,fe,me,pe=null!=(le=null==(fe=V)||null==(me=fe.error)?void 0:me.msg)?le:e.formatMessage({id:"msg__unknown_error"});s.default.show({title:pe},{type:"error"})}}}}else s.default.show({title:e.formatMessage({id:"msg__unknown_error"})},{type:"error"})}else s.default.show({title:e.formatMessage({id:"msg__account_deleted"},{0:A.name})},{type:"error"})}else s.default.show({title:e.formatMessage({id:"msg__unknown_error"})},{type:"error"})}));return function(e){return r.apply(this,arguments)}}(),[])}},4298:function(e,t,n){e.exports=n.p+"static/media/logo.b0cff82f.png"},5229:function(e,t,n){e.exports=n.p+"static/media/eth_staking.c3ba7ecb.png"},5230:function(e,t,n){e.exports=n.p+"static/media/eth_unstake.3014a6f3.png"},5231:function(e,t,n){e.exports=n.p+"static/media/logo_black.0d059a6e.png"},5290:function(e,t,n){"use strict";n.r(t);var r=n(3),o=n.n(r),a=n(50),i=n(57),s=n(63),c=n(1),d=n(44),u=n(88),l=n(36),f=n(25),m=n(663),p=n(4142),j=n(3930),b=n(0),h=function(){var e=Object(u.default)(),t=Object(d.useRoute)(),r=t.params.networkId,o=Object(f.useAppSelector)((function(e){return e.staking.ethStakingApr})),a=Object(c.useMemo)((function(){if(!o)return[];var e=r===l.OnekeyNetwork.goerli?o.testnet:o.mainnet;return[{name:j.EthStakingSource.Kele,value:Object(m.formatAmount)(e.kele,2)+"%",logo:n(1363)},{name:j.EthStakingSource.Lido,value:Object(m.formatAmount)(e.lido,2)+"%",logo:n(3997)}]}),[r,o]);return Object(b.jsx)(i.default,{header:e.formatMessage({id:"form__str_pools"},{0:"ETH"}),footer:null,children:Object(b.jsx)(s.default,{space:4,children:a.map((function(e){return Object(b.jsx)(p.Options,{title:"ETH",subtitle:e.name,logo:e.logo,num:e.value,onPress:function(){null==t.params.onSelector||t.params.onSelector(e.name)}},e.name)}))})})},g=n(580),O=n(195),v=n.n(O),k=n(64),y=n(818),w=n(41),x=n(54),I=n(51),_=n(20),S=n(48),T=n(2),A=n.n(T),R=n(4),M=n.n(R),C=n(12),N=n(40),P=n(27),B=n(106),D=n(21),E=n.n(D),F=n(17),L=n(1608),U=n(125),H=n(203),q=n(16),Q=n(490),K=n(95),V=(n(1348),n(301)),z=(n(24),function(e){e.text,e.onTextChange,Object(V.default)().height,Object(c.useMemo)((function(){return new RegExp("^(0|([1-9][0-9]*))?\\.?([0-9]{1,18})?$")}),[]);return null}),W=n(6102),G=n(130),J=n(188),$=n(552);function X(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?X(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):X(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Z(e,t){return Object(c.useEffect)((function(){Object(J.isEvmNetworkId)(e)&&Object(G.isAccountCompatibleWithNetwork)(t,e)&&F.default.serviceStaking.fetchKeleUnstakeOverview({networkId:e,accountId:t})}),[e,t]),Object(f.useAppSelector)((function(n){var r,o;return null==(r=n.staking.keleUnstakeOverviews)||null==(o=r[t])?void 0:o[e]}))}function ee(e,t){return Object(f.useAppSelector)((function(n){var r,o;return null==(r=n.staking.keleMinerOverviews)||null==(o=r[null!=t?t:""])?void 0:o[null!=e?e:""]}))}function te(e){return Object(f.useAppSelector)((function(t){var n;return null==(n=t.staking.keleNetworkDashboardGlobal)?void 0:n[null!=e?e:""]}))}function ne(e){var t=Object(u.default)(),n=Math.floor(e/1440);if(n>0)return n+" "+t.formatMessage({id:"content__day"});var r=Math.floor(e/60);return r>0?r+" "+t.formatMessage({id:"content__hours"}):e+" "+t.formatMessage({id:"content__minutes_lowercase"})}function re(e,t){var n=function(e,t){return Object(f.useAppSelector)((function(n){var r,o;return null==(r=n.staking.keleIncomes)||null==(o=r[null!=t?t:""])?void 0:o[null!=e?e:""]}))}(e,t),r=function(e,t){return Object(f.useAppSelector)((function(n){var r,o;return null==(r=n.staking.keleOpHistory)||null==(o=r[null!=t?t:""])?void 0:o[null!=e?e:""]}))}(e,t);return Object(c.useMemo)((function(){var e=[];return n&&n.length&&(e=e.concat(n.map((function(e){return{type:"income",income:e,time:new Date(e.date).getTime()}})))),r&&r.length&&(e=e.concat(r.map((function(e){return{type:"op",op:e,time:Object(W.default)(e.history_time,"yyyy-MM-dd HH:mm:ss",new Date).getTime()}})))),e.sort((function(e,t){return t.time-e.time}))}),[n,r])}var oe=function(e,t){var n=Object(f.useAppSelector)((function(e){return e.staking.lidoOverview})),r=Object(f.useAppSelector)((function(n){var r,o;return null==(r=n.tokens.accountTokensBalance)||null==(o=r[null!=e?e:""])?void 0:o[null!=t?t:""]}));return Object(c.useMemo)((function(){var o,a,i;if(e&&t){var s=null==n||null==(o=n[t])?void 0:o[e],c=e===l.OnekeyNetwork.eth?$.MainnetLidoContractAddress:$.TestnetLidoContractAddress,d=null==r||null==(a=r[c.toLowerCase()])?void 0:a.balance;return Y(Y({},s),{},{balance:null!=d?d:null==s?void 0:s.balance,nfts:null!=(i=null==s?void 0:s.nfts)?i:[]})}}),[e,t,n,r])};function ae(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ie(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ae(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ae(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var se=function(e){return e.source===j.EthStakingSource.Lido?Object(b.jsxs)(C.default,{flexDirection:"row",alignItems:"center",children:[Object(b.jsx)(B.default,{w:"5",h:"5",source:n(3997)},"lido"),Object(b.jsx)(P.default.Body2Strong,{ml:"2",children:"Lido"}),Object(b.jsx)(N.default,{name:"ChevronRightMini"})]}):Object(b.jsxs)(C.default,{flexDirection:"row",alignItems:"center",children:[Object(b.jsx)(B.default,{w:"5",h:"5",source:n(1363)},"kele"),Object(b.jsx)(P.default.Body2Strong,{ml:"2",children:"Kele"}),Object(b.jsx)(N.default,{name:"ChevronRightMini"})]})},ce=function(e){var t=e.mode,n=Object(u.default)();return t===j.KeleStakingMode.fast?Object(b.jsxs)(C.default,{flexDirection:"row",alignItems:"center",children:[Object(b.jsx)(P.default.Body1Strong,{mr:"2",children:"\ud83d\ude85"}),Object(b.jsx)(P.default.Body2Strong,{children:n.formatMessage({id:"content__fast"})}),Object(b.jsx)(N.default,{name:"ChevronRightMini"})]}):Object(b.jsxs)(C.default,{flexDirection:"row",alignItems:"center",children:[Object(b.jsx)(P.default.Body1Strong,{mr:"2",children:"\ud83d\ude95"}),Object(b.jsx)(P.default.Body2Strong,{children:n.formatMessage({id:"content__normal"})}),Object(b.jsx)(N.default,{name:"ChevronRightMini"})]})};var de=n(336),ue=function(){var e=Object(u.default)(),t=Object(d.useRoute)(),r=Object(d.useNavigation)(),o=Object(c.useCallback)((function(){r.replace(q.RootRoutes.Modal,{screen:q.ModalRoutes.Staking,params:{screen:j.StakingRoutes.StakedETHOnKele,params:{networkId:t.params.networkId,accountId:t.params.accountId}}})}),[r,t.params]);return Object(b.jsx)(i.default,{header:e.formatMessage({id:"modal__transaction_submitted"}),hideSecondaryAction:!0,primaryActionTranslationId:"action__close",onPrimaryActionPress:o,children:Object(b.jsxs)(s.default,{alignItems:"center",justifyContent:"center",flex:1,children:[Object(b.jsx)(C.default,{w:"200px",h:"200px",children:Object(b.jsx)(de.default,{width:200,source:n(1607),autoPlay:!0,loop:!1})}),Object(b.jsx)(_.default,{typography:"DisplayMedium",children:e.formatMessage({id:"action__submit"})}),Object(b.jsx)(C.default,{h:8})]})})},le=n(19),fe=n(5229),me=n.n(fe);function pe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function je(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?pe(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var be=n(5230),he=n.n(be);var ge=n(236),Oe=n(341),ve=function(){var e,t=Object(u.default)(),n=Object(d.useRoute)().params,r=n.networkId,o=n.mode,a=n.onSelector,l=te(r),f=Number(null!=(e=null==l?void 0:l.validator_alive_predicted_hour)?e:"24"),m=f>24?t.formatMessage({id:"form__str_day"},{0:Math.ceil(f/24)}):t.formatMessage({id:"form__str_hours"},{0:f});return Object(c.useEffect)((function(){l||F.default.serviceStaking.getDashboardGlobal({networkId:r})}),[]),Object(b.jsx)(i.default,{header:t.formatMessage({id:"content__mode"}),footer:null,children:Object(b.jsxs)(s.default,{space:1,children:[Object(b.jsxs)(Oe.default,{flexDirection:"row",justifyContent:"space-between",alignItems:"center",borderRadius:8,p:"2",bgColor:o===j.KeleStakingMode.normal?"surface-selected":void 0,onPress:function(){return null==a?void 0:a(j.KeleStakingMode.normal)},children:[Object(b.jsx)(C.default,{flexDirection:"row",alignItems:"center",children:Object(b.jsxs)(w.default,{space:1,children:[Object(b.jsx)(P.default.Body1Strong,{children:"\ud83d\ude95"}),Object(b.jsx)(P.default.Body1Strong,{children:t.formatMessage({id:"content__normal"})})]})}),Object(b.jsxs)(C.default,{alignItems:"flex-end",children:[Object(b.jsxs)(P.default.Body2Strong,{children:["~ ",m]}),Object(b.jsx)(P.default.Body2Strong,{children:t.formatMessage({id:"content__estimated_time"})})]})]}),Object(b.jsxs)(Oe.default,{flexDirection:"row",justifyContent:"space-between",alignItems:"center",borderRadius:8,p:"2",bgColor:o===j.KeleStakingMode.fast?"surface-selected":void 0,onPress:function(){return null==a?void 0:a(j.KeleStakingMode.fast)},children:[Object(b.jsx)(C.default,{flexDirection:"row",alignItems:"center",children:Object(b.jsxs)(w.default,{space:1,children:[Object(b.jsx)(P.default.Body1Strong,{children:"\ud83d\ude85"}),Object(b.jsx)(P.default.Body1Strong,{children:t.formatMessage({id:"content__fast"})}),Object(b.jsx)(ge.default,{type:"info",title:t.formatMessage({id:"content__str_faster"},{0:"99.99%"}),size:"sm"})]})}),Object(b.jsxs)(C.default,{alignItems:"flex-end",children:[Object(b.jsxs)(P.default.Body2Strong,{children:["~ ",t.formatMessage({id:"form__str_minutes"},{0:"30"})]}),Object(b.jsx)(P.default.Body2Strong,{children:t.formatMessage({id:"content__estimated_time"})})]})]})]})})},ke=n(570),ye=function(e){return Object(b.jsx)(P.default.Body1Strong,{color:"text-success",children:e})},we=function(){var e=Object(u.default)();return Object(b.jsxs)(C.default,{children:[Object(b.jsxs)(s.default,{space:4,children:[Object(b.jsxs)(C.default,{py:"3",px:"4",flexDirection:"row",borderRadius:12,bg:"surface-default",children:[Object(b.jsx)(C.default,{mr:"3",children:Object(b.jsx)(N.default,{name:"ChartBarOutline"})}),Object(b.jsx)(P.Body1Strong,{children:e.formatMessage({id:"form__earn_up_to_str_per_year"},{a:ye,0:"4.58%"})})]}),Object(b.jsxs)(C.default,{py:"3",px:"4",flexDirection:"row",borderRadius:12,bg:"surface-default",children:[Object(b.jsx)(C.default,{mr:"3",children:Object(b.jsx)(N.default,{name:"ArrowsRightLeftOutline"})}),Object(b.jsx)(C.default,{flex:"1",children:Object(b.jsx)(P.Body1Strong,{children:e.formatMessage({id:"form__when_you_stake_str_you_receive_str_you_can_trade_this_liquid_asset_at_any_time"},{a:ye,b:ye,0:"ETH",1:"stETH"})})})]}),Object(b.jsxs)(C.default,{py:"3",px:"4",flexDirection:"row",borderRadius:12,bg:"surface-default",children:[Object(b.jsx)(C.default,{mr:"3",children:Object(b.jsx)(N.default,{name:"ClockOutline"})}),Object(b.jsx)(C.default,{flex:"1",children:Object(b.jsx)(P.Body1Strong,{children:e.formatMessage({id:"form__you_start_earning_str"},{a:ye})})})]}),Object(b.jsxs)(C.default,{py:"3",px:"4",flexDirection:"row",borderRadius:12,bg:"surface-default",children:[Object(b.jsx)(C.default,{mr:"3",children:Object(b.jsx)(N.default,{name:"GiftOutline"})}),Object(b.jsx)(C.default,{flex:"1",children:Object(b.jsx)(P.Body1Strong,{children:e.formatMessage({id:"form__rewards_are_automatically_credited_to_your_deposit_every_few_days"},{a:ye})})})]})]}),Object(b.jsx)(ke.default,{renderCustomTrigger:function(t,n){return Object(b.jsx)(C.default,{py:"4",children:n?Object(b.jsx)(x.default,{size:"sm",type:"plain",rightIconName:"ChevronDownMini",iconColor:"icon-subdued",textProps:{color:"text-subdued"},onPress:t,children:e.formatMessage({id:"action__learn_more"})}):Object(b.jsx)(x.default,{size:"sm",type:"plain",rightIconName:"ChevronUpMini",iconColor:"icon-subdued",textProps:{color:"text-subdued"},onPress:t,children:e.formatMessage({id:"action__collapse"})})})},children:Object(b.jsxs)(s.default,{children:[Object(b.jsx)(ke.default,{trigger:Object(b.jsx)(P.default.Body1,{color:"text-default",children:e.formatMessage({id:"form__how_does_the_lido_protocol_work"})}),children:Object(b.jsx)(P.default.Body1,{px:"2",color:"text-subdued",children:e.formatMessage({id:"form__how_does_the_lido_protocol_work_desc"})})}),Object(b.jsx)(ke.default,{trigger:Object(b.jsx)(P.default.Body1,{color:"text-default",children:e.formatMessage({id:"form__why_do_you_receive_steth"})}),children:Object(b.jsx)(P.default.Body1,{px:"2",color:"text-subdued",children:e.formatMessage({id:"form__why_do_you_receive_steth_desc"})})}),Object(b.jsx)(ke.default,{trigger:Object(b.jsx)(P.default.Body1,{color:"text-default",children:e.formatMessage({id:"form__what_is_the_possible_risk_of_lido"})}),children:Object(b.jsx)(P.default.Body1,{px:"2",color:"text-subdued",children:e.formatMessage({id:"form__what_is_the_possible_risk_of_lido_desc"})})})]})})]})},xe=function(){var e=Object(u.default)(),t=Object(d.useNavigation)(),n=Object(d.useRoute)().params,r=Object(c.useCallback)((function(){n.readonly?t.goBack():t.navigate(q.RootRoutes.Modal,{screen:q.ModalRoutes.Staking,params:{screen:j.StakingRoutes.ETHStake,params:{accountId:n.networkId,networkId:n.networkId,source:j.EthStakingSource.Lido}}})}),[t,n]);return Object(b.jsx)(i.default,{hideSecondaryAction:!0,primaryActionTranslationId:n.readonly?"action__i_got_it":"action__lets_go",onPrimaryActionPress:r,header:e.formatMessage({id:"form__staking"})+" ETH",scrollViewProps:{children:Object(b.jsx)(we,{})}})},Ie=n(3933),_e=n(4297),Se=n(3998);function Te(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ae(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Te(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Te(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Re=function(e){return"lido"===e.value?Object(b.jsxs)(C.default,{flexDirection:"row",alignItems:"center",children:[Object(b.jsx)(B.default,{w:"5",h:"5",source:n(3997)},"lido"),Object(b.jsx)(P.default.Body2Strong,{ml:"2",children:"Lido"}),Object(b.jsx)(N.default,{name:"ChevronRightMini"})]}):Object(b.jsxs)(C.default,{flexDirection:"row",alignItems:"center",children:[Object(b.jsx)(B.default,{w:"5",h:"5",source:n(4298)},"onekey"),Object(b.jsx)(P.default.Body2Strong,{ml:"2",children:"OneKey Swap"}),Object(b.jsx)(N.default,{name:"ChevronRightMini"})]})};var Me=n(45),Ce=function(){var e=Object(u.default)(),t=Object(d.useRoute)().params,r=t.source,o=t.onSelector,a=t.amount,l=t.networkId,f=Object(c.useState)(!0),m=M()(f,2),p=m[0],j=m[1],h=Object(Me.useAppSelector)((function(e){return e.staking.stEthRate})),g=Object(c.useMemo)((function(){return null==h?void 0:h[l]}),[h,l]);return Object(c.useEffect)((function(){function e(){return(e=A()((function*(){var e=Object(Me.getActiveWalletAccount)(),t=e.account,n=e.networkId;if(t&&n){var r,o=yield Object(Se.fetchStEthRate)({networkId:n,account:t,amount:a}),i=null==o||null==(r=o.data)?void 0:r.instantRate;i&&(F.default.dispatch(Object(Q.setStEthRate)({networkId:n,value:i})),j(!1))}}))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[a]),Object(b.jsx)(i.default,{footer:null,header:e.formatMessage({id:"form__route"}),children:Object(b.jsxs)(s.default,{space:"4",children:[Object(b.jsxs)(Oe.default,{flexDirection:"row",py:"3",px:"2",alignItems:"center",justifyContent:"space-between",bg:"lido"===r?"surface-selected":"background-default",borderRadius:12,onPress:function(){return null==o?void 0:o("lido")},children:[Object(b.jsxs)(C.default,{flexDirection:"row",alignItems:"center",children:[Object(b.jsx)(B.default,{w:"10",h:"10",mr:"3",source:n(3997)}),Object(b.jsxs)(C.default,{flexDirection:"column",justifyContent:"space-between",children:[Object(b.jsx)(P.default.Body1Strong,{children:"Lido"}),Object(b.jsx)(P.default.Body2,{color:"text-subdued",children:e.formatMessage({id:"form__str_day"},{0:"~ 1 - 3"}).toLowerCase()})]})]}),Object(b.jsxs)(C.default,{flexDirection:"column",alignItems:"flex-end",children:[Object(b.jsxs)(P.default.Body1Strong,{color:"text-success",children:[a||"0"," ETH"]}),Object(b.jsx)(P.default.Body2,{color:"text-subdued",children:e.formatMessage({id:"form__you_receive"})})]})]}),Object(b.jsxs)(Oe.default,{flexDirection:"row",py:"3",px:"2",alignItems:"center",justifyContent:"space-between",bg:"onekey"===r?"surface-selected":"background-default",borderRadius:12,onPress:function(){return null==o?void 0:o("onekey")},children:[Object(b.jsxs)(C.default,{flexDirection:"row",alignItems:"center",children:[Object(b.jsx)(B.default,{w:"10",h:"10",mr:"3",source:n(5231)}),Object(b.jsxs)(C.default,{flexDirection:"column",justifyContent:"space-between",children:[Object(b.jsx)(P.default.Body1Strong,{children:"OneKey Swap"}),Object(b.jsx)(P.default.Body2,{color:"text-subdued",children:e.formatMessage({id:"content__str_minutes_plural"},{0:"~ 1-5"})})]})]}),Object(b.jsxs)(C.default,{flexDirection:"column",alignItems:"flex-end",children:[a?Object(b.jsx)(C.default,{children:g&&!p?Object(b.jsxs)(P.default.Body1Strong,{color:"text-success",children:[Object(J.formatAmount)(Object(J.multiply)(g,a),6)," ETH"]}):Object(b.jsx)(C.default,{w:"6",h:"4",overflow:"hidden",borderRadius:12,children:Object(b.jsx)(y.default,{})})}):Object(b.jsx)(P.default.Body1Strong,{color:"text-success",children:"0 ETH"}),Object(b.jsx)(P.default.Body2,{color:"text-subdued",children:e.formatMessage({id:"form__you_receive"})})]})]})]})})},Ne=function(){var e=Object(u.default)();return Object(b.jsxs)(C.default,{children:[Object(b.jsxs)(I.default,{mt:"8",mb:"10",children:[Object(b.jsx)(B.default,{w:"24",h:"24",mb:"2",source:n(3997)}),Object(b.jsx)(P.default.DisplayLarge,{children:e.formatMessage({id:"title__lido_unstaking"})}),Object(b.jsx)(P.default.Body1,{color:"text-subdued",mt:"2",children:e.formatMessage({id:"title__lido_unstaking_desc"})})]}),Object(b.jsxs)(C.default,{children:[Object(b.jsxs)(C.default,{flexDirection:"row",mb:"8",children:[Object(b.jsx)(I.default,{w:"8",h:"8",mr:"2",borderRadius:"full",bg:"decorative-surface-one",children:Object(b.jsx)(P.default.Body2Strong,{color:"decorative-icon-one",children:"1"})}),Object(b.jsxs)(C.default,{flex:"1",children:[Object(b.jsx)(P.default.Body1Strong,{children:e.formatMessage({id:"form__request_withdrawal"})}),Object(b.jsx)(P.default.Body2,{color:"text-subdued",children:e.formatMessage({id:"form__request_withdrawal_desc"})})]})]}),Object(b.jsxs)(C.default,{flexDirection:"row",mb:"8",children:[Object(b.jsx)(I.default,{w:"8",h:"8",mr:"2",borderRadius:"full",bg:"decorative-surface-one",children:Object(b.jsx)(P.default.Body2Strong,{color:"decorative-icon-one",children:"2"})}),Object(b.jsxs)(C.default,{flex:"1",children:[Object(b.jsx)(P.default.Body1Strong,{children:e.formatMessage({id:"form__receive_lido_nft"})}),Object(b.jsx)(P.default.Body2,{color:"text-subdued",children:e.formatMessage({id:"form__receive_lido_nft_desc"})})]})]}),Object(b.jsxs)(C.default,{flexDirection:"row",mb:"8",children:[Object(b.jsx)(I.default,{w:"8",h:"8",mr:"2",borderRadius:"full",bg:"decorative-surface-one",children:Object(b.jsx)(P.default.Body2Strong,{color:"decorative-icon-one",children:"3"})}),Object(b.jsxs)(C.default,{flex:"1",children:[Object(b.jsx)(P.default.Body1Strong,{children:e.formatMessage({id:"form__claim"})}),Object(b.jsx)(P.default.Body2,{color:"text-subdued",children:e.formatMessage({id:"form__claim_desc"})})]})]})]})]})},Pe=function(){var e=Object(u.default)(),t=Object(d.useRoute)(),n=Object(d.useNavigation)(),r=Object(c.useCallback)((function(){n.navigate(q.RootRoutes.Modal,{screen:q.ModalRoutes.Staking,params:{screen:j.StakingRoutes.LidoEthUnstake,params:{accountId:t.params.accountId,networkId:t.params.networkId}}})}),[n,t.params]);return Object(b.jsx)(i.default,{hideSecondaryAction:!0,primaryActionTranslationId:"action__i_got_it",onPrimaryActionPress:r,header:e.formatMessage({id:"action_unstake"})+" ETH",scrollViewProps:{children:Object(b.jsx)(Ne,{})}})},Be=n(201),De=n(82),Ee=n(183),Fe=n(100),Le=n(3769),Ue=n(29),He=n(6),qe=n.n(He),Qe=function(){function e(e){this.tx=e.tx,this.onFinish=e.onFinish}var t=e.prototype;return t.run=function(){var e=this;this.runTask();var t=this.getMs();t?this.timer=setTimeout((function(){e.run()}),t):this.stop()},t.stop=function(){this.timer&&(clearTimeout(this.timer),this.timer=void 0)},t.getMs=function(){var e=this.tx.addedTime;return Date.now()-e<=36e5?2e4:3e5},t.queryTransactionProgress=function(){var e=A()((function*(e){var t=e.networkId,n=e.accountId,r=e.nonce;if(void 0!==r)return{status:yield F.default.serviceHistory.queryTransactionNonceStatus({networkId:t,accountId:n,nonce:r})}}));return function(t){return e.apply(this,arguments)}}(),t.runTask=function(){var e=A()((function*(){var e=this,t=this.tx,n=yield this.queryTransactionProgress(t);if(n){var r,o=n.status;if(o&&"pending"!==o)null==(r=this.onFinish)||r.call(this,{stop:function(){return e.stop()}})}}));return function(){return e.apply(this,arguments)}}(),qe()(e)}(),Ke=function(e){var t=e.tx;return Object(c.useEffect)((function(){var e=new Qe({tx:t,onFinish:function(e){(0,e.stop)(),F.default.dispatch(Object(Q.archiveTransaction)({accountId:t.accountId,networkId:t.networkId,txs:[t.hash]})),F.default.serviceStaking.fetchLidoOverview({accountId:t.accountId,networkId:t.networkId})}});return e.run(),function(){e.stop()}}),[]),null},Ve=function(e){var t=e.tx;return Object(c.useEffect)((function(){var e=new Qe({tx:t,onFinish:function(){var e=A()((function*(e){var n=e.stop,r=yield F.default.serviceStaking.fetchKeleOpHistory({networkId:t.networkId,accountId:t.accountId}),o=null==r?void 0:r.find((function(e){return e.transaction_id.toLowerCase()===t.hash.toLowerCase()})),a=Date.now();(o||a-t.addedTime>864e5)&&(n(),F.default.dispatch(Object(Q.archiveKeleTransaction)({accountId:t.accountId,networkId:t.networkId,txs:[t.hash]})),F.default.serviceStaking.fetchMinerOverview({networkId:t.networkId,accountId:t.accountId}))}));return function(t){return e.apply(this,arguments)}}()});return e.run(),function(){e.stop()}}),[]),null};function ze(e){return Number(e)>0?"+"+Object(m.formatAmount)(e,18):Object(m.formatAmount)(e,18)}var We=function(){var e,t,n=Object(u.default)(),r=Object(d.useNavigation)(),o=Object(d.useRoute)().params,a=o.networkId,i=o.accountId,s=ee(a,i),l=Object(c.useCallback)((function(){r.navigate(q.RootRoutes.Modal,{screen:q.ModalRoutes.Staking,params:{screen:j.StakingRoutes.KeleEthUnstakeShouldUnderstand,params:{networkId:a,accountId:i}}})}),[r,a,i]),f=Object(c.useCallback)((function(){r.navigate(q.RootRoutes.Modal,{screen:q.ModalRoutes.Staking,params:{screen:j.StakingRoutes.WithdrawAmount,params:{networkId:a,accountId:i}}})}),[r,a,i]);return Object(b.jsxs)(C.default,{borderRadius:12,flexDirection:"row",px:"3",py:"3",mt:"3",borderWidth:Ue.default.hairlineWidth,borderColor:"border-subdued",justifyContent:"space-between",children:[Object(b.jsxs)(C.default,{flex:"1",children:[Object(b.jsx)(P.default.Caption,{color:"text-subdued",fontSize:"14px",children:n.formatMessage({id:"form__staking_uppercase"})}),Object(b.jsxs)(C.default,{mb:"2",mt:"1",flexDirection:"row",alignItems:"center",children:[Object(b.jsx)(P.default.Body1,{children:Object(m.formatAmount)(null!=(e=null==s?void 0:s.amount.retail_staked)?e:"0",8)}),Object(b.jsx)(P.default.Body1,{children:" ETH"})]}),Object(b.jsx)(C.default,{flexDirection:"row",children:Object(b.jsx)(x.default,{size:"xs",onPress:l,children:n.formatMessage({id:"action_unstake"})})})]}),Object(b.jsx)(C.default,{w:"6",flexDirection:"row",justifyContent:"center",alignItems:"center",children:Object(b.jsx)(Fe.default,{orientation:"vertical",color:"divider"})}),Object(b.jsxs)(C.default,{flex:"1",children:[Object(b.jsx)(P.default.Caption,{color:"text-subdued",fontSize:"14px",children:n.formatMessage({id:"form__unstaked_uppercase"})}),Object(b.jsxs)(C.default,{mb:"2",mt:"1",flexDirection:"row",alignItems:"center",children:[Object(b.jsx)(P.default.Body1,{children:Object(m.formatAmount)(null!=(t=null==s?void 0:s.amount.withdrawable)?t:"0",8)}),Object(b.jsx)(P.default.Body1,{children:" ETH"})]}),Object(b.jsx)(C.default,{flexDirection:"row",children:Object(b.jsx)(x.default,{size:"xs",onPress:f,children:n.formatMessage({id:"action__withdraw"})})})]})]})},Ge=function(){var e,t,n=Object(u.default)(),r=Object(d.useRoute)().params,o=r.networkId,a=r.accountId,i=ee(o,a),s=Number(null!=(e=null==i?void 0:i.amount.retail_unstaking)?e:0),l=Z(o,a),f=null!=(t=null==l?void 0:l.estimate_use_sec)?t:60,p=ne(Math.floor(f/60));return Object(c.useEffect)((function(){if(s){var e=setInterval((function(){F.default.serviceStaking.fetchMinerOverview({networkId:o,accountId:a})}),3e4);return function(){return clearInterval(e)}}}),[o,a,s]),s?Object(b.jsx)(C.default,{mb:"2",children:Object(b.jsx)(Ee.default,{dismiss:!1,alertType:"info",title:n.formatMessage({id:"msg__unstaking_in_progress_str"},{0:Object(m.formatAmount)(s,8)+" ETH "}),description:n.formatMessage({id:"msg__unstaking_in_progress_str_desc"},{0:" "+p})})}):null},Je=function(){var e=Object(u.default)(),t=Object(d.useRoute)().params,n=t.networkId,r=t.accountId,o=function(e,t){return Object(f.useAppSelector)((function(n){var r,o;return null==(r=n.staking.kelePendingWithdraw)||null==(o=r[null!=t?t:""])?void 0:o[null!=e?e:""]}))}(n,r);return Object(c.useEffect)((function(){if(o){var e=setInterval((function(){F.default.serviceStaking.fetchPendingWithdrawAmount({networkId:n,accountId:r})}),12e4);return function(){return clearInterval(e)}}}),[n,r,o]),o?Object(b.jsx)(C.default,{mb:"2",children:Object(b.jsx)(Ee.default,{dismiss:!1,alertType:"info",title:e.formatMessage({id:"msg__withdraw_in_progress_str"},{0:Object(m.formatAmount)(o,8)+" ETH"})})}):null},$e=function(){var e=Object(u.default)(),t=Object(d.useRoute)().params,n=t.networkId,r=t.accountId,o=Object(f.useAppSelector)((function(e){return e.staking.keleTransactions})),a=Object(c.useMemo)((function(){var e,t;return o?(null!=(e=null==(t=o[r])?void 0:t[n])?e:[]).filter((function(e){return!e.archive&&"KeleStake"===e.type})):[]}),[o,n,r]),i=a.reduce((function(e,t){var n;return e+Number(null!=(n=t.amount)?n:0)}),0);return i>0?Object(b.jsxs)(C.default,{mb:"2",children:[Object(b.jsx)(Ee.default,{alertType:"info",title:e.formatMessage({id:"msg__str_is_staking_in_progress"},{0:i+" ETH"}),dismiss:!1}),a.map((function(e){return Object(b.jsx)(Ve,{tx:e},e.hash)}))]}):null},Xe=function(){var e,t,n,r,o,a,i,s=Object(u.default)(),l=Object(d.useRoute)().params,p=l.networkId,h=l.accountId,g=ee(p,h),O=Object(H.useNativeToken)(p),v=Object(f.useTokenBalance)({networkId:p,accountId:h,token:O}),k=Object(d.useNavigation)(),y=Object(H.useSimpleTokenPriceValue)({networkId:p}),w=te(p),_=Object(c.useCallback)((function(){k.navigate(q.RootRoutes.Modal,{screen:q.ModalRoutes.Staking,params:{screen:j.StakingRoutes.KeleEthUnstakeShouldUnderstand,params:{networkId:p,accountId:h,readonly:!0}}})}),[k,p,h]),S=Object(c.useCallback)((function(){k.navigate(q.RootRoutes.Modal,{screen:q.ModalRoutes.Staking,params:{screen:j.StakingRoutes.ETHStake,params:{accountId:h,networkId:p,source:j.EthStakingSource.Kele}}})}),[k,h,p]),T=Number(null!=(e=null==g||null==(t=g.amount)?void 0:t.total_amount)?e:0)+Number(null!=(n=null==g?void 0:g.amount.withdrawable)?n:0),A=Object(m.formatAmount)(T,8),R=Number(A)!==T,M=Number(null!=(r=null==g||null==(o=g.amount)?void 0:o.staking_amount)?r:0);return Object(b.jsxs)(C.default,{children:[Object(b.jsxs)(C.default,{flexDirection:"row",justifyContent:"space-between",w:"full",alignItems:"center",children:[Object(b.jsx)(P.default.Heading,{children:s.formatMessage({id:"content__total"})}),Object(b.jsx)(De.default,{type:"plain",name:"QuestionMarkCircleOutline",size:"sm",onPress:_})]}),Object(b.jsxs)(C.default,{mt:"2",children:[Object(b.jsxs)(C.default,{flexDirection:"row",alignItems:"center",children:[R?Object(b.jsx)(P.default.Caption,{mr:"1",children:"~"}):null,Object(b.jsx)(P.default.DisplayXLarge,{children:A+" ETH"})]}),Object(b.jsx)(U.FormatCurrency,{numbers:[null!=y?y:0,T],render:function(e){return Object(b.jsx)(P.default.Body2,{color:"text-subdued",children:y?e:"-"})}})]}),Object(b.jsx)(C.default,{my:"4",children:Object(b.jsx)(x.default,{size:"xl",w:"full",type:"primary",onPress:S,children:s.formatMessage({id:"title__stake_str"},{0:"ETH"})})}),Object(b.jsxs)(C.default,{flexDirection:"row",justifyContent:"space-between",children:[Object(b.jsx)(P.default.Body2,{color:"text-subdued",children:s.formatMessage({id:"form__available_to_stake"})}),Object(b.jsxs)(P.default.Body2,{color:"text-subdued",children:[Object(m.formatAmount)(v,6)," ETH"]})]}),Object(b.jsx)(We,{}),Object(b.jsxs)(C.default,{mt:"2",children:[M?Object(b.jsxs)(C.default,{p:"4",borderRadius:12,bg:"surface-default",flexDirection:"row",alignItems:"center",mb:"2",children:[Object(b.jsx)(I.default,{w:"10",h:"10",bg:"surface-neutral-default",borderRadius:"full",mr:"2",children:Object(b.jsx)(N.default,{name:"InboxArrowDownMini",size:16})}),Object(b.jsxs)(C.default,{flex:"1",children:[Object(b.jsx)(P.default.Body1,{children:s.formatMessage({id:"form__str_is_activating"},{0:M+" ETH"})}),Object(b.jsx)(P.default.Body2,{color:"text-subdued",children:s.formatMessage({id:"form__str_is_activating_eth_desc"},{0:"ETH",1:null!=(a=null==w?void 0:w.validator_alive_predicted_hour)?a:"24",3:(null!=(i=null==w?void 0:w.retail_deposit_far)?i:32).toFixed(2)+" ETH"})})]})]}):null,Object(b.jsx)(Ge,{}),Object(b.jsx)(Je,{}),Object(b.jsx)($e,{})]}),Object(b.jsx)(C.default,{my:"2",children:Object(b.jsx)(P.default.Heading,{children:s.formatMessage({id:"form__reward_history"})})})]})},Ye=function(e){var t,n=e.item,r=Object(u.default)(),o=Object(d.useRoute)().params.networkId,a=Object(H.useSimpleTokenPriceValue)({networkId:o});return Object(b.jsxs)(C.default,{w:"full",children:[Object(b.jsxs)(C.default,{justifyContent:"space-between",flexDirection:"row",mb:"1",children:[Object(b.jsx)(P.default.Body1Strong,{children:r.formatMessage({id:"title__reward"})}),Object(b.jsxs)(P.default.Body1Strong,{children:[ze(n.reward)," ETH"]})]}),Object(b.jsxs)(C.default,{justifyContent:"space-between",flexDirection:"row",children:[Object(b.jsx)(P.default.Body2,{color:"text-subdued",children:Object(Le.default)(new Date(n.date),"LLL dd yyyy")}),Object(b.jsx)(U.FormatCurrency,{numbers:[null!=a?a:0,null!=(t=n.reward)?t:0],render:function(e){return Object(b.jsx)(P.default.Body2,{ml:3,color:"text-subdued",children:a?e:"-"})}})]})]})},Ze=function(e){var t,n=e.item,r=Object(u.default)(),o=Object(d.useRoute)().params.networkId,a=Object(H.useSimpleTokenPriceValue)({networkId:o}),i=Number(n.op_type),s=r.formatMessage({id:"action__stake"}),c="";return 1===i?(s=r.formatMessage({id:"form__staking"}),n.remain_time&&(c=r.formatMessage({id:"transaction__pending"}))):2===i?(s=r.formatMessage({id:"form__unstaking"}),n.remain_time&&(c=r.formatMessage({id:"transaction__pending"}))):3!==i&&4!==i||(s=r.formatMessage({id:"action__withdraw"})),Object(b.jsxs)(C.default,{w:"full",children:[Object(b.jsxs)(C.default,{justifyContent:"space-between",flexDirection:"row",mb:"1",children:[Object(b.jsx)(P.default.Body1Strong,{children:s}),Object(b.jsxs)(P.default.Body1Strong,{children:[ze(n.amount)," ETH"]})]}),Object(b.jsxs)(C.default,{justifyContent:"space-between",flexDirection:"row",children:[Object(b.jsx)(P.default.Body2,{color:"text-subdued",children:Object(Le.default)(Object(W.default)(n.history_time,"yyyy-MM-dd HH:mm:ss",new Date),"LLL dd yyyy")}),c?Object(b.jsx)(C.default,{children:Object(b.jsx)(P.default.Body2,{color:"text-highlight",children:c})}):Object(b.jsx)(U.FormatCurrency,{numbers:[null!=a?a:0,null!=(t=n.amount)?t:0],render:function(e){return Object(b.jsx)(P.default.Body2,{ml:3,color:"text-subdued",children:a?e:"-"})}})]})]})},et=function(){var e=Object(u.default)();return Object(b.jsx)(C.default,{py:"10",children:Object(b.jsx)(Be.default,{emoji:"\ud83d\udd50",title:e.formatMessage({id:"transaction__history_empty_title"}),subTitle:e.formatMessage({id:"reward__history_empty_desc"})})})};var tt=n(13),nt=n.n(tt),rt=n(822);function ot(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function at(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ot(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ot(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var it=function(e){var t=new E.a(e);return t.lt("0.00000001")?Object(rt.formatDecimalZero)(t.toNumber()):Object(m.formatAmount)(e,18)},st=function(){var e=Object(u.default)(),t=Object(d.useNavigation)(),n=Object(d.useRoute)().params,r=n.networkId,o=n.accountId,a=oe(r,o),i=Object(c.useCallback)(A()((function*(){var e;if(a&&o){var n=(null!=(e=a.nfts)?e:[]).filter((function(e){return!e.isClaimed&&e.isFinalized})).map((function(e){return e.requestId})),i=yield F.default.serviceStaking.buildLidoClaimWithdrawals({requestIds:n,networkId:r}),s=yield F.default.engine.getAccount(o,r),c=at(at({},i),{},{from:s.address});t.navigate(q.RootRoutes.Modal,{screen:q.ModalRoutes.Send,params:{screen:q.SendModalRoutes.SendConfirm,params:{accountId:s.id,networkId:r,feeInfoEditable:!0,feeInfoUseFeeInTx:!1,encodedTx:c,onSuccess:function(e,t){var n;F.default.dispatch(Object(Q.addTransaction)({accountId:s.id,networkId:r,transaction:{hash:e.txid,accountId:s.id,networkId:r,type:"lidoClaim",nonce:null==t||null==(n=t.decodedTx)?void 0:n.nonce,addedTime:Date.now()}}))}}}})}})),[t,a,r,o]);return a&&a.nfts&&a.nfts.length&&a.withdrawal&&Number(a.withdrawal)>0?Object(b.jsx)(Ee.default,{alertType:"info",title:Object(J.formatAmountExact)(a.withdrawal,4)+" ETH "+e.formatMessage({id:"form__available_for_claim"}),dismiss:!1,onAction:i,action:e.formatMessage({id:"form__claim"})}):null},ct=function(){var e=Object(u.default)(),t=Object(d.useRoute)().params,n=t.networkId,r=t.accountId,o=Object(f.useAppSelector)((function(e){return e.staking.transactions})),a=Object(c.useMemo)((function(){var e,t;return o?(null!=(e=null==(t=o[r])?void 0:t[n])?e:[]).filter((function(e){return!e.archive})):[]}),[o,n,r]);return a.length>0?Object(b.jsxs)(C.default,{children:[Object(b.jsx)(Ee.default,{alertType:"info",title:e.formatMessage({id:"msg__there_are_str_requests_waiting_for_confirmation_currently"},{0:a.length}),dismiss:!1}),a.map((function(e){return Object(b.jsx)(Ke,{tx:e},e.hash)}))]}):null},dt=function(){var e,t=Object(u.default)(),n=Object(d.useRoute)().params,r=n.networkId,o=n.accountId,a=oe(r,o),i=Object(H.useNativeToken)(r),l=Object(f.useTokenBalance)({networkId:r,accountId:o,token:i}),p=Object(d.useNavigation)(),h=Object(H.useSimpleTokenPriceValue)({networkId:r}),g=Object(c.useCallback)((function(){p.navigate(q.RootRoutes.Modal,{screen:q.ModalRoutes.Staking,params:{screen:j.StakingRoutes.LidoEthUnstakeShouldUnderstand,params:{networkId:r,accountId:o}}})}),[p,r,o]),O=Object(c.useCallback)((function(){p.navigate(q.RootRoutes.Modal,{screen:q.ModalRoutes.Staking,params:{screen:j.StakingRoutes.LidoEthStakeShouldUnderstand,params:{readonly:!0,networkId:r,accountId:o}}})}),[p,r,o]),v=Object(c.useCallback)((function(){p.navigate(q.RootRoutes.Modal,{screen:q.ModalRoutes.Staking,params:{screen:j.StakingRoutes.ETHStake,params:{networkId:r,accountId:o,source:j.EthStakingSource.Lido}}})}),[p,r,o]),k=null!=(e=null==a?void 0:a.balance)?e:"0.00",y=Object(J.gt)(k,"0")?Object(m.formatAmount)(k,8):"0.00";return Object(b.jsxs)(C.default,{children:[Object(b.jsxs)(C.default,{flexDirection:"row",justifyContent:"space-between",w:"full",alignItems:"center",children:[Object(b.jsx)(P.default.Heading,{children:t.formatMessage({id:"content__total"})}),Object(b.jsx)(De.default,{type:"plain",name:"QuestionMarkCircleOutline",size:"sm",onPress:O})]}),Object(b.jsxs)(C.default,{mt:"2",children:[Object(b.jsx)(C.default,{flexDirection:"row",alignItems:"center",children:Object(b.jsx)(P.default.DisplayXLarge,{children:y+" stETH"})}),Object(b.jsx)(U.FormatCurrency,{numbers:[null!=h?h:0,k],render:function(e){return Object(b.jsx)(P.default.Body2,{color:"text-subdued",children:h?e:"-"})}})]}),Object(b.jsxs)(C.default,{my:"4",flexDirection:"row",children:[Object(b.jsx)(C.default,{flex:"1",children:Object(b.jsx)(x.default,{size:"xl",w:"full",type:"primary",onPress:v,children:t.formatMessage({id:"action__stake"})})}),Object(b.jsx)(C.default,{w:"4"}),Object(b.jsx)(C.default,{flex:"1",children:Object(b.jsx)(x.default,{size:"xl",w:"full",onPress:g,children:t.formatMessage({id:"action__unstake"})})})]}),Object(b.jsxs)(C.default,{flexDirection:"row",justifyContent:"space-between",children:[Object(b.jsx)(P.default.Body2,{color:"text-subdued",children:t.formatMessage({id:"form__available_to_stake"})}),Object(b.jsxs)(P.default.Body2,{color:"text-default",children:[Object(m.formatAmount)(l,6)," ETH"]})]}),Object(b.jsxs)(s.default,{space:"4",mt:"4",children:[Object(b.jsx)(st,{}),Object(b.jsx)(ct,{})]}),Object(b.jsx)(C.default,{my:"2",children:Object(b.jsx)(P.default.Heading,{children:t.formatMessage({id:"form__active_request"})})})]})},ut=function(){var e=Object(u.default)();return Object(b.jsx)(C.default,{py:"10",children:Object(b.jsx)(Be.default,{emoji:"\ud83d\udd50",title:e.formatMessage({id:"empty__no_data"})})})};var lt=n(76),ft=n(1363),mt=n.n(ft),pt=n(46);function jt(e){var t=e.title,n=e.titleAction,r=e.text,o=e.onChangeText,a=e.loading,i=e.desc;return Object(b.jsxs)(C.default,{height:"140px",children:[!!t&&Object(b.jsxs)(w.default,{space:2,alignItems:"center",justifyContent:"center",children:[Object(b.jsx)(C.default,{opacity:0,children:n}),Object(b.jsx)(_.default,{textAlign:"center",typography:"DisplayLarge",color:"text-subdued",children:t}),n]}),Object(b.jsx)(I.default,{flex:1,maxH:"64px",mt:2,mb:3,children:Object(b.jsx)(L.AutoSizeText,{autoFocus:!0,text:r,onChangeText:o,placeholder:"0"})}),a?Object(b.jsx)(lt.default,{size:"sm"}):!!i&&Object(b.jsx)(_.default,{typography:"Body1Strong",textAlign:"center",isTruncated:!0,children:i})]})}function bt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ht(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?bt(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):bt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var gt=n(108);var Ot=n(475),vt=n(234);function kt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var yt=Object(vt.default)(),wt=[{name:j.StakingRoutes.StakingAmount,component:function(){var e=Object(u.default)(),t=(Object(V.default)().height,Object(a.default)()),n=Object(c.useState)(!1),r=M()(n,2),o=r[0],s=r[1],l=Object(d.useNavigation)(),m=Object(d.useRoute)().params,p=m.networkId,h=m.tokenIdOnNetwork,g=m.accountId,O=Object(c.useState)(""),v=M()(O,2),k=v[0],y=v[1],w=Object(f.useNetworkSimple)(p),I=Object(H.useSingleToken)(p,null!=h?h:"").token,T=Object(f.useTokenBalanceWithoutFrozen)({networkId:p,accountId:g,token:I,fallback:"0"}),R=Object(c.useCallback)((function(){if(!I||!k)return"error";var t,n,r=new E.a(k),o=new E.a(T);return r.isNaN()||o.isNaN()?e.formatMessage({id:"form__amount_invalid"},{0:null!=(t=null==I?void 0:I.symbol)?t:""}):o.isLessThan(r)?e.formatMessage({id:"form__amount_invalid"},{0:null!=(n=null==I?void 0:I.symbol)?n:""}):void 0}),[k,e,T,I])(),N=Object(c.useMemo)((function(){return new E.a("0.01")}),[]),D=Object(c.useMemo)((function(){if(!N.isNaN()&&N.gt("0")){var e=new E.a(k);if(e.isNaN())return[!1,!1];if(e.lt(N))return[!1,e.gt("0")]}return[!0,!1]}),[N,k]),F=M()(D,2),L=F[0],Q=F[1],K=Object(c.useMemo)((function(){return Q?Object(b.jsx)(P.default.Body1Strong,{color:"text-critical",children:e.formatMessage({id:"form__str_minimum_stake_amount"},{0:N.toFixed(),1:null==I?void 0:I.symbol})}):void 0}),[e,N,Q,null==I?void 0:I.symbol]),z=function(e){var t,n,r,o=e.tokenInfo,a=e.desc,i=e.network,s=e.amount,d=e.setAmount,u=e.tokenBalance,l=null!=(t=null!=o&&o.tokenIdOnNetwork?null==i?void 0:i.tokenDisplayDecimals:null==i?void 0:i.nativeDisplayDecimals)?t:2,f=null!=(n=null==o?void 0:o.decimals)?n:18,m=Object(c.useMemo)((function(){return new RegExp("^(0|([1-9][0-9]*))?\\.?([0-9]{1,"+f+"})?$")}),[f]),p=Object(Me.useSettings)().selectedFiatMoneySymbol,j=(void 0===p?"usd":p).toUpperCase().trim(),h=Object(c.useState)(!1),g=M()(h,2),O=g[0],v=g[1],k=O?2:f,y=Object(c.useMemo)((function(){return new RegExp("^(0|([1-9][0-9]*))?\\.?([0-9]{1,"+k+"})?$")}),[k]),w=Object(H.useSimpleTokenPriceValue)({networkId:null==o?void 0:o.networkId,contractAdress:null==o?void 0:o.tokenIdOnNetwork}),x=Object(c.useState)(s),I=M()(x,2),S=I[0],T=I[1],A=Object(c.useMemo)((function(){return new E.a(null!=w?w:0)}),[w]),R=!A.isNaN()&&A.gt(0),C=Object(c.useCallback)((function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;return e?t?A.times(t||"0").toFixed(2,n):"":t}),[A]),N=Object(c.useCallback)((function(e){var t=C(O,e,E.a.ROUND_FLOOR);T(t)}),[C,O]),P=Object(c.useCallback)((function(e){if(e.length<s.length)d(e);else if(m.test(e))d(e);else{var t=new E.a(e);if(!t.isNaN()){var n=t.toFixed(f,E.a.ROUND_FLOOR);d(n)}}}),[s.length,f,d,m]),B=Object(b.jsx)(De.default,{name:"ArrowsUpDownOutline",size:"lg",type:"plain",circle:!0,onPress:function(){var e;S&&S===u&&!O&&(e=E.a.ROUND_FLOOR);var t=!O;v(t),T(C(t,s,e))}}),D=Object(c.useMemo)((function(){return a||(O?Object(b.jsxs)(_.default,{children:[(null==(e=Object(U.formatBalanceDisplay)(s||"0","",{fixed:l}))?void 0:e.amount)||s||"0"," ",null==o?void 0:o.symbol]}):Object(b.jsx)(U.FormatCurrencyToken,{token:o,value:s,render:function(e){return Object(b.jsx)(_.default,{children:e})}}));var e}),[s,l,a,O,o]);return Object(c.useEffect)((function(){return P(O?S?new E.a(S).div(A).toFixed():"":S)}),[O,P,S,A]),{validAmountRegex:m,title:null!=(r=O?j:null==o?void 0:o.symbol)?r:"--",titleAction:R?B:void 0,isFiatMode:O,descView:D,text:S,onTextChange:function(e){if(e.length<S.length)T(e);else if(y.test(e))T(e);else{var t=new E.a(e);if(!t.isNaN()){var n=t.toFixed(k,E.a.ROUND_FLOOR);T(n)}}},setTextByAmount:N}}({tokenInfo:I,desc:K,network:w,amount:k,setAmount:y,tokenBalance:T}),W=z.title,G=z.titleAction,J=z.descView,$=z.text,X=z.onTextChange,Y=(z.validAmountRegex,z.setTextByAmount),Z=z.isFiatMode;return Object(b.jsx)(i.default,{header:e.formatMessage({id:"title__stake_str"},{0:null==I?void 0:I.symbol.toUpperCase()}),primaryActionTranslationId:"action__next",hideSecondaryAction:!0,primaryActionProps:{isDisabled:!!R||!L,isLoading:o},onPrimaryActionPress:A()((function*(){if(w&&I){var t=Z?k:$;try{s(!0),yield Object(pt.wait)(100),l.navigate(q.RootRoutes.Modal,{screen:q.ModalRoutes.Staking,params:{screen:j.StakingRoutes.KeleEthStakeShouldUnderstand,params:{networkId:I.networkId,accountId:g,tokenIdOnNetwork:I.tokenIdOnNetwork,amount:t}}})}catch(o){var n,r=o.key;if("form__amount_invalid"===(void 0===r?"":r))S.default.show({title:e.formatMessage({id:"form__amount_invalid"},{0:null!=(n=null==I?void 0:I.symbol)?n:""})})}finally{s(!1)}}})),children:Object(b.jsxs)(C.default,{flex:1,flexDirection:"column",style:{userSelect:"none"},children:[Object(b.jsx)(C.default,{py:t?4:void 0,my:6,flex:1,justifyContent:"center",children:Object(b.jsx)(jt,{title:W,titleAction:G,desc:J,text:$,onChangeText:X})}),Object(b.jsxs)(C.default,{mt:"auto",children:[Object(b.jsxs)(C.default,{flexDirection:"row",alignItems:"center",children:[Object(b.jsxs)(C.default,{flex:1,children:[Object(b.jsx)(P.default.Caption,{color:"text-subdued",children:e.formatMessage({id:"content__available_balance"})}),Object(b.jsx)(C.default,{children:Object(b.jsx)(U.FormatBalanceToken,{token:I,render:function(e){return Object(b.jsx)(P.default.Body1Strong,{color:R&&k?"text-critical":"text-default",children:e})}})})]}),Object(b.jsx)(x.default,{isDisabled:Number(T)-.01<=0,onPress:function(){var e=Math.max(Number(T)-.01,0);Y(String(e))},children:e.formatMessage({id:"action__max"})})]}),Object(b.jsxs)(C.default,{borderRadius:12,flexDirection:"row",px:"16px",py:"12px",mt:"3",mb:"3",borderWidth:Ue.default.hairlineWidth,borderColor:"border-subdued",children:[Object(b.jsx)(B.default,{w:"10",h:"10",source:mt.a,mr:"4"}),Object(b.jsxs)(C.default,{children:[Object(b.jsxs)(C.default,{flexDirection:"row",children:[Object(b.jsx)(P.default.Body1,{children:"Kele Pool "}),Object(b.jsx)(P.default.Body1,{color:"text-success",children:"4.12% APY"})]}),Object(b.jsx)(P.default.Body2,{color:"text-subdued",children:e.formatMessage({id:"content__third_party_validator"})})]})]}),!1]})]})})}},{name:j.StakingRoutes.KeleEthStakeShouldUnderstand,component:function(){var e=Object(u.default)(),t=Object(d.useNavigation)(),n=Object(d.useRoute)().params,r=n.accountId,o=n.networkId,a=n.amount,s=Object(f.useNativeToken)(o),l=Object(c.useCallback)((function(){var e=t.getParent();null!=e&&e.canGoBack()&&e.goBack()}),[t]),m=Object(c.useCallback)(A()((function*(){var e=yield F.default.engine.getAccount(r,o);if(e&&s){try{yield F.default.serviceStaking.registerOnKele({payeeAddr:e.address,networkId:o})}catch(c){le.default.common.error("registerOnKele failed")}var n,i=new E.a(a).shiftedBy(s.decimals).toFixed(0);try{n=je(je({},yield F.default.serviceStaking.buildTxForStakingETHtoKele({value:i,networkId:o})),{},{from:e.address})}catch(d){return void S.default.show({title:d.message},{type:"error"})}l(),t.navigate(q.RootRoutes.Modal,{screen:q.ModalRoutes.Send,params:{screen:K.SendModalRoutes.SendConfirm,params:{networkId:o,accountId:r,payloadInfo:{type:"InternalStake",stakeInfo:{tokenInfo:s,amount:a,accountAddress:e.address}},feeInfoEditable:!0,feeInfoUseFeeInTx:!1,encodedTx:n}}})}})),[o,a,r,t,s,l]);return Object(b.jsx)(i.default,{hideSecondaryAction:!0,primaryActionTranslationId:"action__confirm",primaryActionProps:{onPromise:m},scrollViewProps:{children:Object(b.jsxs)(C.default,{children:[Object(b.jsxs)(I.default,{p:"6",children:[Object(b.jsx)(B.default,{w:"24",h:"24",source:me.a}),Object(b.jsx)(P.default.DisplayLarge,{my:"6",children:e.formatMessage({id:"title__eth_2_0_staking"})})]}),Object(b.jsx)(C.default,{children:Object(b.jsx)(C.default,{flexDirection:"row",mt:"5",children:Object(b.jsxs)(C.default,{flex:"1",children:[Object(b.jsx)(P.default.Body1Strong,{children:e.formatMessage({id:"content__in_the_rare_event_staked_eth_will_be_lost"})}),Object(b.jsx)(P.default.Body2,{color:"text-subdued",textBreakStrategy:"highQuality",children:e.formatMessage({id:"content__in_the_rare_event_staked_eth_will_be_lost_desc"})})]})})})]})}})}},{name:j.StakingRoutes.StakedETHOnKele,component:function(){var e=Object(d.useRoute)().params,t=e.networkId,n=e.accountId,r=re(t,n);Object(c.useEffect)((function(){F.default.serviceStaking.fetchPendingWithdrawAmount({networkId:t,accountId:n}),F.default.serviceStaking.fetchMinerOverview({accountId:n,networkId:t}),F.default.serviceStaking.fetchKeleIncomeHistory({accountId:n,networkId:t}),F.default.serviceStaking.fetchKeleOpHistory({accountId:n,networkId:t}),F.default.serviceStaking.getDashboardGlobal({networkId:t})}),[]);var o=Object(c.useCallback)((function(e){var t=e.item,n=e.index;return Object(b.jsxs)(C.default,{py:"4",px:"6",bg:"surface-default",overflow:"hidden",borderTopRadius:0===n?12:void 0,borderBottomRadius:r&&n===r.length-1?12:void 0,children:[t.op?Object(b.jsx)(Ze,{item:t.op}):null,t.income?Object(b.jsx)(Ye,{item:t.income}):null]})}),[r]);return Object(b.jsx)(i.default,{height:"560px",footer:null,flatListProps:{data:null!=r?r:[],renderItem:o,ListHeaderComponent:Xe,ListEmptyComponent:et,ItemSeparatorComponent:Fe.default,showsVerticalScrollIndicator:!1}})}},{name:j.StakingRoutes.UnstakeAmount,component:function(){var e,t,n,r,o=Object(u.default)(),a=(Object(V.default)().height,Object(d.useNavigation)()),s=Object(d.useRoute)().params,l=s.networkId,f=s.tokenIdOnNetwork,p=s.accountId,h=te(l),g=ee(l,p),O=Z(l,p),v=Object(H.useSimpleTokenPriceValue)({networkId:l}),k=null!=(e=null==g?void 0:g.amount.retail_staked)?e:"0",y=null!=(t=null==h?void 0:h.retail_min_amount)?t:"0",T=null!=(n=null==O?void 0:O.estimate_use_sec)?n:60,R=ne(Math.floor(T/60)),N=Object(c.useState)(""),B=M()(N,2),D=B[0],Q=B[1],z=Object(H.useSingleToken)(l,null!=f?f:"").token,W=Object(c.useMemo)((function(){if(!z||!D)return"error";var e=new E.a(D),t=new E.a(k),n=z.symbol;return e.isNaN()||t.isNaN()||t.isLessThan(e)?o.formatMessage({id:"form__amount_invalid"},{0:n}):void 0}),[D,o,k,z]),G=Object(c.useMemo)((function(){var e,t=new E.a(y),n=!t.isNaN()&&t.gt("0"),r=null!=(e=null==z?void 0:z.symbol)?e:"";if(n){var a=D.trim(),i=new E.a(a);if(a&&(i.isNaN()||i.gt(0)&&i.lt(t)))return o.formatMessage({id:"form__min_amount"})+" "+t.toFixed()+" "+r}}),[y,D,o,z]),J=(Object(c.useMemo)((function(){return new RegExp("^(0|([1-9][0-9]*))?\\.?([0-9]{1,18})?$")}),[]),Object(c.useCallback)((function(e){var t=new E.a(k);if(!t.lte(0)){var n=e>=100?k:Object(m.formatAmount)(t.multipliedBy(e).dividedBy(100),8);Q(n)}}),[k]));return Object(b.jsx)(i.default,{header:o.formatMessage({id:"title__unstake_str"},{0:null==z?void 0:z.symbol.toUpperCase()}),headerDescription:"Kelepool",primaryActionTranslationId:"action__next",hideSecondaryAction:!0,primaryActionProps:{isDisabled:!!W||!!G||new E.a(D).lte(0)},onPrimaryActionPress:A()((function*(){if(p&&z){var e=yield F.default.engine.getAccount(p,l),t={unstake_amt:D,address:e.address,type:"retail"},n={sign_time:Math.floor(Date.now()/1e3),token:"eth",addr:e.address,url:"/eth2/v2/miner/unstake",method:"post",api_param:t};a.navigate(q.RootRoutes.Modal,{screen:q.ModalRoutes.Send,params:{screen:K.SendModalRoutes.SignMessageConfirm,params:{accountId:e.id,networkId:z.networkId,unsignedMessage:{type:1,message:JSON.stringify(n)},onSuccess:function(){var e=A()((function*(e){var r=yield F.default.serviceStaking.unstake(ht(ht({},t),{},{networkId:z.networkId,pirvSignRaw:JSON.stringify(n),signHash:e}));0!==r.code&&r.message?S.default.show({title:r.message},{type:"error"}):(Q(""),F.default.serviceStaking.fetchMinerOverview({networkId:l,accountId:p}),a.replace(q.RootRoutes.Modal,{screen:q.ModalRoutes.Staking,params:{screen:j.StakingRoutes.Feedback,params:{networkId:l,accountId:p}}}))}));return function(t){return e.apply(this,arguments)}}()}}})}})),children:Object(b.jsxs)(C.default,{flex:"1",children:[Object(b.jsxs)(C.default,{flex:"1",flexDirection:"column",justifyContent:"space-between",children:[Object(b.jsxs)(I.default,{flex:"1",flexDirection:"column",justifyContent:"space-around",children:[Object(b.jsxs)(I.default,{flex:"1",maxH:"140px",children:[Object(b.jsx)(_.default,{textAlign:"center",typography:"DisplayLarge",color:"text-subdued",children:null!=(r=null==z?void 0:z.symbol.toUpperCase())?r:""}),Object(b.jsx)(I.default,{flex:"1",minH:"30px",children:Object(b.jsx)(L.AutoSizeText,{autoFocus:!0,text:D,onChangeText:Q,placeholder:"0"})}),Object(b.jsx)(I.default,{children:G?Object(b.jsx)(P.default.Body1Strong,{color:"text-critical",children:G}):Object(b.jsx)(U.FormatCurrency,{numbers:[null!=v?v:0,null!=D?D:0],render:function(e){return Object(b.jsx)(P.default.Body2,{color:"text-subdued",children:v?e:"$ 0"})}})})]}),Object(b.jsxs)(I.default,{children:[Object(b.jsxs)(w.default,{flexDirection:"row",alignItems:"center",space:"3",children:[Object(b.jsx)(x.default,{size:"sm",onPress:function(){return J(25)},children:"25%"}),Object(b.jsx)(x.default,{size:"sm",onPress:function(){return J(50)},children:"50%"}),Object(b.jsx)(x.default,{size:"sm",onPress:function(){return J(75)},children:"75%"}),Object(b.jsx)(x.default,{size:"sm",onPress:function(){return J(100)},children:o.formatMessage({id:"action__max"})})]}),Object(b.jsxs)(C.default,{h:"8",flexDirection:"row",alignItems:"center",justifyContent:"center",children:[Object(b.jsx)(P.default.Body2,{color:"text-subdued",mr:"1",children:o.formatMessage({id:"content__available_balance"})}),Object(b.jsxs)(P.default.Body2Strong,{color:W&&D?"text-critical":"text-default",children:[null!=k?k:""," ",null==z?void 0:z.symbol.toUpperCase()]})]})]})]}),Object(b.jsxs)(C.default,{flexDirection:"row",justifyContent:"space-between",children:[Object(b.jsx)(P.default.Body2,{color:"text-subdued",children:o.formatMessage({id:"form__est_arrival_time"})}),Object(b.jsx)(P.default.Body2,{children:R})]})]}),!1]})})}},{name:j.StakingRoutes.KeleEthUnstakeShouldUnderstand,component:function(){var e=Object(u.default)(),t=Object(d.useNavigation)(),n=Object(d.useRoute)().params,r=Object(c.useCallback)((function(){n.readonly?t.goBack():t.navigate(q.RootRoutes.Modal,{screen:q.ModalRoutes.Staking,params:{screen:j.StakingRoutes.UnstakeAmount,params:{accountId:n.accountId,networkId:n.networkId}}})}),[t,n]);return Object(b.jsx)(i.default,{header:e.formatMessage({id:"title__unstake_eth"}),hideSecondaryAction:!0,primaryActionTranslationId:"action__i_got_it",onPrimaryActionPress:r,scrollViewProps:{children:Object(b.jsxs)(C.default,{children:[Object(b.jsxs)(I.default,{p:"6",children:[Object(b.jsx)(B.default,{w:"24",h:"24",source:he.a}),Object(b.jsx)(P.default.DisplayLarge,{mt:"6",mb:"2",children:e.formatMessage({id:"title__unstake_eth"})}),Object(b.jsx)(P.default.Body2,{color:"text-subdued",children:e.formatMessage({id:"form__the_unstaking_process_will_be_completed_in_two_stages"})})]}),Object(b.jsxs)(C.default,{children:[Object(b.jsxs)(C.default,{flexDirection:"row",children:[Object(b.jsx)(I.default,{w:"8",h:"8",borderRadius:"full",bg:"decorative-surface-one",mr:"4",children:Object(b.jsx)(P.default.Body2Strong,{color:"decorative-icon-one",children:"1"})}),Object(b.jsxs)(C.default,{flex:"1",children:[Object(b.jsx)(P.default.Body1Strong,{children:e.formatMessage({id:"action__unstake"})}),Object(b.jsx)(P.default.Body2,{color:"text-subdued",children:e.formatMessage({id:"form__unstake_desc"})})]})]}),Object(b.jsxs)(C.default,{flexDirection:"row",mt:"5",children:[Object(b.jsx)(I.default,{w:"8",h:"8",borderRadius:"full",bg:"decorative-surface-one",mr:"4",children:Object(b.jsx)(P.default.Body2Strong,{color:"decorative-icon-one",children:"2"})}),Object(b.jsxs)(C.default,{flex:"1",children:[Object(b.jsx)(P.default.Body1Strong,{children:e.formatMessage({id:"action__withdraw"})}),Object(b.jsx)(P.default.Body2,{color:"text-subdued",textBreakStrategy:"highQuality",children:e.formatMessage({id:"form__withdraw_desc"})})]})]})]})]})}})}},{name:j.StakingRoutes.WithdrawAmount,component:function(){var e,t,n,r,o=Object(u.default)(),a=Object(f.useNavigation)(),l=Object(d.useRoute)(),p=(Object(V.default)().height,l.params),h=p.networkId,g=p.tokenIdOnNetwork,O=p.accountId,v=Object(f.useAccount)({accountId:O,networkId:h}).account,k=function(e,t){return Object(c.useEffect)((function(){Object(J.isEvmNetworkId)(e)&&Object(G.isAccountCompatibleWithNetwork)(t,e)&&F.default.serviceStaking.fetchWithdrawOverview({networkId:e,accountId:t})}),[e,t]),Object(f.useAppSelector)((function(n){var r,o;return null==(r=n.staking.keleWithdrawOverviews)||null==(o=r[t])?void 0:o[e]}))}(h,O),y=Object(H.useSimpleTokenPriceValue)({networkId:h}),T=null!=(e=null==k?void 0:k.balance)?e:"0",R=null!=(t=null==k?void 0:k.user_fee)?t:"0",N=Object(c.useState)(""),B=M()(N,2),D=B[0],Q=B[1],z=Object(H.useSingleToken)(h,null!=g?g:"").token,W=Object(c.useMemo)((function(){var e=new E.a(D),t=new E.a(R),n=e.minus(t);if(n.gt(0))return Object(m.formatAmount)(n,8)}),[D,R]),$=Object(c.useMemo)((function(){if(!z||!D)return"error";var e=new E.a(D),t=new E.a(T),n=z.symbol;return e.isNaN()||t.isNaN()||t.isLessThan(e)?o.formatMessage({id:"form__amount_invalid"},{0:n}):void 0}),[D,o,T,z]),X=Object(c.useMemo)((function(){var e,t=new E.a(R),n=!t.isNaN()&&t.gt("0"),r=D.trim(),a=null!=(e=null==z?void 0:z.symbol)?e:"";if(n&&r){var i=new E.a(r);if(i.isNaN()||i.gt(0)&&i.lte(t))return""+o.formatMessage({id:"form__field_large_than"},{0:t.toFixed()+" "+a})}}),[R,D,o,z]),Y=Object(c.useCallback)((function(e){var t=new E.a(T);if(!t.lte(0)){var n=e>=100?T:Object(m.formatAmount)(t.multipliedBy(e).dividedBy(100),8);Q(n)}}),[T]);return Object(c.useMemo)((function(){return new RegExp("^(0|([1-9][0-9]*))?\\.?([0-9]{1,18})?$")}),[]),Object(b.jsx)(i.default,{header:o.formatMessage({id:"action__withdraw"}),primaryActionTranslationId:"action__next",hideSecondaryAction:!0,primaryActionProps:{isDisabled:!!$||!!X||new E.a(D).lte(0)},onPrimaryActionPress:A()((function*(){if(O&&z){var e=yield F.default.engine.getAccount(O,h),t={token:"eth",amount:D,address:e.address};a.navigate(q.RootRoutes.Modal,{screen:q.ModalRoutes.Send,params:{screen:K.SendModalRoutes.SignMessageConfirm,params:{accountId:O,networkId:z.networkId,unsignedMessage:{type:1,message:JSON.stringify(t)},onSuccess:function(){var e=A()((function*(){var e=yield F.default.serviceStaking.withdraw({accountId:O,networkId:h,amount:D});0!==e.code&&e.message?S.default.show({title:e.message},{type:"error"}):(Q(""),F.default.serviceStaking.fetchPendingWithdrawAmount({accountId:O,networkId:h}),a.replace(q.RootRoutes.Modal,{screen:q.ModalRoutes.Staking,params:{screen:j.StakingRoutes.Feedback,params:{networkId:h,accountId:O}}}))}));return function(){return e.apply(this,arguments)}}()}}})}})),children:Object(b.jsxs)(C.default,{flex:"1",flexDirection:"column",justifyContent:"space-between",children:[Object(b.jsxs)(C.default,{flex:"1",flexDirection:"column",justifyContent:"space-between",children:[Object(b.jsxs)(I.default,{flex:1,flexDirection:"column",justifyContent:"space-around",children:[Object(b.jsxs)(I.default,{flex:1,maxH:"140px",children:[Object(b.jsx)(_.default,{textAlign:"center",typography:"DisplayLarge",color:"text-subdued",children:null!=(n=null==z?void 0:z.symbol.toUpperCase())?n:""}),Object(b.jsx)(I.default,{flex:"1",minH:"30px",children:Object(b.jsx)(L.AutoSizeText,{autoFocus:!0,text:D,onChangeText:Q,placeholder:"0"})}),Object(b.jsx)(I.default,{children:X?Object(b.jsx)(P.default.Body1Strong,{color:"text-critical",children:X}):Object(b.jsx)(U.FormatCurrency,{numbers:[null!=y?y:0,null!=D?D:0],render:function(e){return Object(b.jsx)(P.default.Body2,{color:"text-subdued",children:y?e:"$ 0"})}})})]}),Object(b.jsxs)(I.default,{children:[Object(b.jsxs)(w.default,{flexDirection:"row",alignItems:"center",space:"3",children:[Object(b.jsx)(x.default,{size:"sm",onPress:function(){return Y(25)},children:"25%"}),Object(b.jsx)(x.default,{size:"sm",onPress:function(){return Y(50)},children:"50%"}),Object(b.jsx)(x.default,{size:"sm",onPress:function(){return Y(75)},children:"75%"}),Object(b.jsx)(x.default,{size:"sm",onPress:function(){return Y(100)},children:o.formatMessage({id:"action__max"})})]}),Object(b.jsxs)(C.default,{flexDirection:"row",alignItems:"center",justifyContent:"center",h:"8",children:[Object(b.jsx)(P.default.Body2,{color:"text-subdued",mr:"1",children:o.formatMessage({id:"content__available_balance"})}),Object(b.jsxs)(P.default.Body2Strong,{color:$&&D?"text-critical":"text-default",children:[Object(m.formatAmount)(T,8)," ",null==z?void 0:z.symbol.toUpperCase()]})]})]})]}),Object(b.jsxs)(s.default,{space:"1",children:[Object(b.jsxs)(C.default,{flexDirection:"row",justifyContent:"space-between",children:[Object(b.jsx)(P.default.Body2,{color:"text-subdued",children:o.formatMessage({id:"content__gas_fee"})}),Object(b.jsxs)(P.default.Body2,{children:[R," ",null==z?void 0:z.symbol.toUpperCase()]})]}),Object(b.jsxs)(C.default,{flexDirection:"row",justifyContent:"space-between",children:[Object(b.jsx)(P.default.Body2,{color:"text-subdued",children:o.formatMessage({id:"form__receive_address"})}),Object(b.jsx)(P.default.Body2,{children:Object(gt.shortenAddress)(null!=(r=null==v?void 0:v.address)?r:"")})]}),W?Object(b.jsxs)(C.default,{flexDirection:"row",justifyContent:"space-between",children:[Object(b.jsx)(P.default.Body2,{color:"text-subdued",children:o.formatMessage({id:"form__actual_arrival"})}),Object(b.jsx)(P.default.Body2,{children:W})]}):null]})]}),!1]})})}},{name:j.StakingRoutes.Feedback,component:ue},{name:j.StakingRoutes.ETHPoolSelector,component:h},{name:j.StakingRoutes.LidoEthStakeShouldUnderstand,component:xe},{name:j.StakingRoutes.LidoEthUnstakeShouldUnderstand,component:Pe},{name:j.StakingRoutes.ETHStake,component:function(){var e,t=Object(u.default)(),n=Object(d.useRoute)().params,r=n.accountId,o=n.networkId,a=n.source,s=Object(d.useNavigation)(),p=Object(H.useSimpleTokenPriceValue)({networkId:o}),h=Object(c.useState)(null!=a?a:j.EthStakingSource.Lido),O=M()(h,2),T=O[0],R=O[1],B=Object(c.useState)(j.KeleStakingMode.fast),D=M()(B,2),V=D[0],W=D[1],G=Object(c.useState)(!1),$=M()(G,2),X=$[0],Y=$[1],Z=function(e,t){var n=Object(f.useAppSelector)((function(e){return e.staking.ethStakingApr}));if(!n)return"";var r=t?null==n?void 0:n.testnet:n.mainnet;return e===j.EthStakingSource.Kele?Object(J.formatAmount)(r.kele,2):Object(J.formatAmount)(r.lido,2)}(T,o===l.OnekeyNetwork.goerli);Object(c.useEffect)((function(){Z||F.default.serviceStaking.fetchEthAprSma()}),[]);var ee=Object(c.useState)(""),te=M()(ee,2),ne=te[0],re=te[1],oe=Object(H.useSingleToken)(o,"").token,ae=Object(f.useTokenBalanceWithoutFrozen)({networkId:o,accountId:r,token:oe,fallback:"0"}),de=Object(c.useMemo)((function(){if(!oe||!ne)return"error";var e=new E.a(ne),n=new E.a(ae),r=oe.symbol;return e.isNaN()||n.isNaN()||n.isLessThan(e)?t.formatMessage({id:"form__amount_invalid"},{0:r}):void 0}),[ne,t,ae,oe]),ue=Object(c.useMemo)((function(){var e,n=T===j.EthStakingSource.Kele?new E.a("0.01"):new E.a("0.0000001"),r=!n.isNaN()&&n.gt("0"),o=null!=(e=null==oe?void 0:oe.symbol)?e:"";if(r){var a=ne.trim(),i=new E.a(a);if(a&&(i.isNaN()||i.gt(0)&&i.lt(n)))return t.formatMessage({id:"form__min_amount"})+" "+n.toFixed()+" "+o}}),[ne,t,oe,T]),le=Object(c.useCallback)((function(e){var t=new E.a(ae);if(!t.lte(0)){var n=e>=100?ae:Object(m.formatAmount)(t.multipliedBy(e).dividedBy(100),8);re(n)}}),[ae]),fe=Object(c.useCallback)((function(){s.push(q.RootRoutes.Modal,{screen:q.ModalRoutes.Staking,params:{screen:j.StakingRoutes.ETHPoolSelector,params:{networkId:o,accountId:r,onSelector:function(e){R(e);var t=s.getParent();t?t.goBack():s.goBack()}}}})}),[s,o,r]),me=Object(c.useCallback)((function(){s.push(q.RootRoutes.Modal,{screen:q.ModalRoutes.Staking,params:{screen:j.StakingRoutes.KeleStakingModeSelector,params:{mode:V,networkId:o,onSelector:function(e){W(e);var t=s.getParent();t?t.goBack():s.goBack()}}}})}),[s,o,V]),pe=Object(c.useCallback)(function(){var e=A()((function*(e){var n=e.onClose;if(r&&oe){var a,i,c=new E.a(ne).shiftedBy(oe.decimals).toFixed(0);try{Y(!0),i=T===j.EthStakingSource.Kele?V===j.KeleStakingMode.fast?yield F.default.serviceStaking.buildTxForFastStakingETHtoKele({value:c,networkId:o}):yield F.default.serviceStaking.buildTxForStakingETHtoKele({value:c,networkId:o}):yield F.default.serviceStaking.buildTxForStakingETHtoLido({value:c,networkId:o})}catch(u){return void S.default.show({title:u.message},{type:"error"})}finally{Y(!1)}var d=yield F.default.engine.getAccount(r,o);i&&(a=ie(ie({},i),{},{from:d.address})),a?(null==n||n(),s.navigate(q.RootRoutes.Modal,{screen:q.ModalRoutes.Send,params:{screen:K.SendModalRoutes.SendConfirm,params:{networkId:o,accountId:r,payloadInfo:{type:"InternalStake",stakeInfo:{tokenInfo:oe,amount:ne,accountAddress:d.address}},feeInfoEditable:!0,feeInfoUseFeeInTx:!1,encodedTx:ie(ie({},a),{},{from:null==d?void 0:d.address}),onSuccess:function(e,n){var a,i;T===j.EthStakingSource.Kele?F.default.dispatch(Object(Q.addKeleTransaction)({accountId:d.id,networkId:o,transaction:{hash:e.txid,accountId:d.id,networkId:o,type:"KeleStake",amount:ne,nonce:null==n||null==(a=n.decodedTx)?void 0:a.nonce,addedTime:Date.now()}})):(F.default.serviceStaking.addStEthToUserAccount({networkId:o,accountId:r}),F.default.dispatch(Object(Q.addTransaction)({accountId:d.id,networkId:o,transaction:{hash:e.txid,accountId:d.id,networkId:o,type:"lidoStake",nonce:null==n||null==(i=n.decodedTx)?void 0:i.nonce,addedTime:Date.now()}})));S.default.show({title:t.formatMessage({id:"msg__success"})}),s.goBack()}}}})):S.default.show({title:"Failed to build encodedTx data"},{type:"error"})}}));return function(t){return e.apply(this,arguments)}}(),[T,oe,o,r,ne,s,t,V]);return Object(b.jsx)(i.default,{header:t.formatMessage({id:"title__stake_str"},{0:null==oe?void 0:oe.symbol.toUpperCase()}),primaryActionTranslationId:"action__stake",hideSecondaryAction:!0,primaryActionProps:{isLoading:X,isDisabled:!!de||!!ue||new E.a(ne).lte(0)},onPrimaryActionPress:pe,children:Object(b.jsxs)(C.default,{flex:"1",children:[Object(b.jsx)(C.default,{flex:"1",flexDirection:"column",justifyContent:"space-between",children:Object(b.jsxs)(I.default,{flex:"1",flexDirection:"column",justifyContent:"space-around",children:[Object(b.jsxs)(I.default,{flexGrow:"1",maxH:"140px",children:[Object(b.jsx)(_.default,{textAlign:"center",typography:"DisplayLarge",color:"text-subdued",children:null!=(e=null==oe?void 0:oe.symbol.toUpperCase())?e:""}),Object(b.jsx)(I.default,{flex:"1",minH:"30px",children:Object(b.jsx)(L.AutoSizeText,{autoFocus:!0,text:ne,onChangeText:re,placeholder:"0"})}),Object(b.jsx)(I.default,{children:ue?Object(b.jsx)(P.default.Body1Strong,{color:"text-critical",children:ue}):Object(b.jsx)(U.FormatCurrency,{numbers:[null!=p?p:0,null!=ne?ne:0],render:function(e){return Object(b.jsx)(P.default.Body2,{color:"text-subdued",children:p?e:"$ 0"})}})})]}),Object(b.jsxs)(I.default,{flexGrow:"0.5",flexShrink:"1",flexDirection:"column",children:[Object(b.jsx)(C.default,{h:"1",flexShrink:"1"}),Object(b.jsxs)(w.default,{flexDirection:"row",alignItems:"center",space:"3",children:[Object(b.jsx)(x.default,{size:"sm",onPress:function(){return le(25)},children:"25%"}),Object(b.jsx)(x.default,{size:"sm",onPress:function(){return le(50)},children:"50%"}),Object(b.jsx)(x.default,{size:"sm",onPress:function(){return le(75)},children:"75%"}),Object(b.jsx)(x.default,{size:"sm",onPress:function(){return le(100)},children:t.formatMessage({id:"action__max"})})]}),Object(b.jsx)(C.default,{h:"1",flexShrink:"1"}),Object(b.jsxs)(C.default,{h:"8",flexDirection:"row",alignItems:"center",justifyContent:"center",children:[Object(b.jsx)(P.default.Body2,{color:"text-subdued",mr:"1",children:t.formatMessage({id:"content__available_balance"})}),Object(b.jsxs)(P.default.Body2Strong,{color:de&&ne?"text-critical":"text-default",children:[Object(m.formatAmount)(null!=ae?ae:"",6)," ",null==oe?void 0:oe.symbol.toUpperCase()]})]})]}),Object(b.jsxs)(C.default,{w:"full",flexGrow:"0.5",flexShrink:"1",children:[Object(b.jsxs)(C.default,{flexDirection:"row",justifyContent:"space-between",alignItems:"center",h:"10",children:[Object(b.jsx)(P.default.Body2,{color:"text-subdued",children:t.formatMessage({id:"form__apy"})}),Z?Object(b.jsxs)(P.default.Body2,{color:"text-success",children:[Z,"%"]}):Object(b.jsx)(C.default,{w:"6",h:"4",overflow:"hidden",borderRadius:12,children:Object(b.jsx)(y.default,{})})]}),Object(b.jsxs)(C.default,{flexDirection:"row",justifyContent:"space-between",alignItems:"center",h:"10",children:[Object(b.jsx)(P.default.Body2,{color:"text-subdued",children:t.formatMessage({id:"form__protocol"})}),Object(b.jsx)(k.default,{onPress:fe,children:Object(b.jsx)(se,{source:T})})]}),T===j.EthStakingSource.Kele?Object(b.jsxs)(C.default,{flexDirection:"row",justifyContent:"space-between",alignItems:"center",h:"10",children:[Object(b.jsxs)(C.default,{flexDirection:"row",alignItems:"center",children:[Object(b.jsx)(P.default.Body2,{color:"text-subdued",children:t.formatMessage({id:"content__mode"})}),Object(b.jsx)(C.default,{ml:"2",children:Object(b.jsx)(g.default,{trigger:function(e){var t=Object.assign({},(v()(e),e));return Object(b.jsx)(k.default,ie(ie({},t),{},{children:Object(b.jsx)(N.default,{name:"QuestionMarkCircleOutline",size:16,color:"icon-subdued"})}))},bodyProps:{children:Object(b.jsx)(_.default,{children:t.formatMessage({id:"msg__send_tokens_to_the_system_s_financing_address"})})}})})]}),Object(b.jsx)(k.default,{onPress:me,children:Object(b.jsx)(ce,{mode:V})})]}):null]})]})}),Object(b.jsx)(z,{text:ne,onTextChange:re})]})})}},{name:j.StakingRoutes.StakedETHOnLido,component:function(){var e=Object(u.default)(),t=Object(d.useRoute)().params,r=t.networkId,o=t.accountId;Object(c.useEffect)((function(){F.default.serviceStaking.fetchLidoOverview({networkId:r,accountId:o}),F.default.serviceStaking.fetchEthAprSma()}),[]);var a=oe(r,o),s=Object(c.useMemo)((function(){return a?(a.nfts?nt()(a.nfts):[]).sort((function(e,t){return t.requestId-e.requestId})):[]}),[a]),l=Object(c.useCallback)((function(t){var r=t.item,o=t.index;return Object(b.jsx)(C.default,{py:"4",overflow:"hidden",borderTopRadius:0===o?12:void 0,borderBottomRadius:s&&o===s.length-1?12:void 0,flexDirection:"row",justifyContent:"space-between",children:Object(b.jsxs)(C.default,{flexDirection:"row",justifyContent:"space-between",alignItems:"center",w:"full",children:[Object(b.jsx)(B.default,{w:"8",h:"8",borderRadius:"full",source:n(4143),mr:"2"}),Object(b.jsxs)(C.default,{flex:"1",children:[Object(b.jsxs)(C.default,{w:"full",flexDirection:"row",justifyContent:"space-between",children:[Object(b.jsx)(P.default.Body1Strong,{mr:"2",children:e.formatMessage({id:"action_unstake"})}),Object(b.jsxs)(P.default.Body1Strong,{isTruncated:!0,children:["+",it(r.stETH),"ETH"]})]}),Object(b.jsxs)(C.default,{w:"full",flexDirection:"row",justifyContent:"space-between",children:[Object(b.jsx)(P.default.Body2,{color:"text-subdued",children:e.formatMessage({id:"form__est_str"},{0:e.formatMessage({id:"form__str_day"},{0:" 1 - 5"})})}),Object(b.jsx)(P.default.Body2,{color:"text-highlight",children:r.isFinalized?e.formatMessage({id:"form__available_for_claim"}):e.formatMessage({id:"transaction__pending"})})]})]})]})})}),[s,e]);return Object(b.jsx)(i.default,{height:"560px",footer:null,flatListProps:{data:s,renderItem:l,ListHeaderComponent:dt,ListEmptyComponent:ut,keyExtractor:function(e){return String(e.requestId)},ItemSeparatorComponent:Fe.default,showsVerticalScrollIndicator:!1},children:Object(b.jsx)(dt,{})})}},{name:j.StakingRoutes.LidoEthUnstake,component:function(){var e,t=Object(u.default)(),n=Object(d.useRoute)().params,r=n.networkId,o=n.accountId,a=Object(d.useNavigation)(),l=Object(H.useSimpleTokenPriceValue)({networkId:r}),p=oe(r,o),h=null!=(e=null==p?void 0:p.balance)?e:"0",g=Object(f.useAppSelector)((function(e){return e.staking.stEthRate})),O=Object(c.useState)("lido"),v=M()(O,2),y=v[0],T=v[1],R=Object(c.useState)(""),N=M()(R,2),B=N[0],D=N[1],V=Object(c.useState)(!1),W=M()(V,2),G=W[0],J=W[1],$=Object(_e.useSwapSubmit)(),X=Object(c.useMemo)((function(){if(!B)return"error";var e=new E.a(B),n=new E.a(h);return e.isNaN()||n.isNaN()||n.isLessThan(e)?t.formatMessage({id:"form__amount_invalid"},{0:"stETH"}):void 0}),[B,t,h,"stETH"]),Y=Object(c.useMemo)((function(){var e="lido"===y?new E.a(1e-7):new E.a(1e-9),n=B.trim(),r=new E.a(n);if(e.gt(0)&&n&&(r.isNaN()||r.gt(0)&&r.lt(e)))return t.formatMessage({id:"form__min_amount"})+" "+e.toFixed()+" stETH"}),[B,t,"stETH",y]),Z=Object(c.useCallback)((function(e){var t=new E.a(h);if(!t.lte(0)){var n=e>=100?h:Object(m.formatAmount)(t.multipliedBy(e).dividedBy(100),8);D(n)}}),[h]),ee=Object(c.useCallback)(A()((function*(){var e=yield F.default.engine.getAccount(o,r);if(e&&r){var n=yield Object(Se.buildWithdrawStEthTransaction)({networkId:r,account:e,typedValue:B}),i=n.params,s=n.quote;yield $({params:i,quote:s,recipient:e,onSuccess:function(){var n=A()((function*(n){var i=n.result,s=n.decodedTx;F.default.dispatch(Object(Q.addTransaction)({accountId:e.id,networkId:r,transaction:{hash:i.txid,accountId:e.id,networkId:r,type:"lidoUnstake",nonce:null==s?void 0:s.nonce,addedTime:Date.now()}})),a.replace(q.RootRoutes.Modal,{screen:q.ModalRoutes.Staking,params:{screen:j.StakingRoutes.StakedETHOnLido,params:{accountId:o,networkId:r}}}),S.default.show({title:t.formatMessage({id:"msg__success"})})}));return function(e){return n.apply(this,arguments)}}()})}})),[r,B,$,a,t,o]),te=Object(c.useCallback)(A()((function*(){var e=yield F.default.serviceStaking.getStEthToken({networkId:r}),n=new E.a(B).shiftedBy(e.decimals).toFixed(0),i=Math.floor(Date.now()/1e3)+86400,s=yield F.default.serviceStaking.buildStEthPermit({accountId:o,networkId:r,value:n,deadline:i});s?a.navigate(q.RootRoutes.Modal,{screen:q.ModalRoutes.Send,params:{screen:K.SendModalRoutes.SignMessageConfirm,params:{accountId:o,networkId:r,hideToast:!0,unsignedMessage:{type:4,message:s},closeImmediately:!0,onSuccess:function(){var e=A()((function*(e){var s="0x"+e.substring(2).substring(0,64),c="0x"+e.substring(2).substring(64,128),d=parseInt(e.substring(2).substring(128,130),16),u=yield F.default.engine.getAccount(o,r),l=Ae(Ae({},yield F.default.serviceStaking.buildRequestWithdrawalsWithPermit({networkId:r,amounts:[n],owner:u.address,permit:{v:d,s:c,r:s,value:n,deadline:i}})),{},{from:u.address});setTimeout((function(){a.navigate(q.RootRoutes.Modal,{screen:q.ModalRoutes.Send,params:{screen:K.SendModalRoutes.SendConfirm,params:{accountId:u.id,networkId:r,feeInfoEditable:!0,feeInfoUseFeeInTx:!1,encodedTx:l,onSuccess:function(e,n){var i;S.default.show({title:t.formatMessage({id:"msg__success"})}),F.default.dispatch(Object(Q.addTransaction)({accountId:u.id,networkId:r,transaction:{hash:e.txid,accountId:u.id,networkId:r,type:"lidoUnstake",nonce:null==n||null==(i=n.decodedTx)?void 0:i.nonce,addedTime:Date.now()}})),a.replace(q.RootRoutes.Modal,{screen:q.ModalRoutes.Staking,params:{screen:j.StakingRoutes.StakedETHOnLido,params:{accountId:o,networkId:r}}})}}}})}),10)}));return function(t){return e.apply(this,arguments)}}()}}}):S.default.show({title:t.formatMessage({id:"form__failed"})},{type:"error"})})),[r,B,a,t,o]),ne=Object(c.useCallback)(A()((function*(){try{J(!0),"onekey"===y?yield ee():yield te()}finally{J(!1)}})),[y,ee,te]),re=Object(c.useCallback)((function(){a.navigate(q.RootRoutes.Modal,{screen:q.ModalRoutes.Staking,params:{screen:j.StakingRoutes.LidoEthUnstakeRoutes,params:{source:y,amount:B,accountId:o,networkId:r,onSelector:function(e){T(e),a.goBack()}}}})}),[y,a,B,r,o]),ae=Object(c.useMemo)((function(){if("lido"!==y)return null==g?void 0:g[r]}),[y,g,r]);return Object(b.jsx)(i.default,{header:t.formatMessage({id:"title__unstake_str"},{0:"stETH"}),headerDescription:"Lido",primaryActionTranslationId:"action__next",hideSecondaryAction:!0,primaryActionProps:{isDisabled:!!X||new E.a(B).lte(0),onPress:ne,isLoading:G},children:Object(b.jsxs)(C.default,{flex:"1",children:[Object(b.jsxs)(C.default,{flex:"1",flexDirection:"column",justifyContent:"space-between",children:[Object(b.jsxs)(I.default,{flex:"1",flexDirection:"column",justifyContent:"space-around",children:[Object(b.jsxs)(I.default,{flex:"1",maxH:"140px",children:[Object(b.jsx)(_.default,{textAlign:"center",typography:"DisplayLarge",color:"text-subdued",children:"stETH"}),Object(b.jsx)(I.default,{flex:"1",minH:"30px",children:Object(b.jsx)(L.AutoSizeText,{autoFocus:!0,text:B,onChangeText:D,placeholder:"0"})}),Object(b.jsx)(I.default,{children:Y?Object(b.jsx)(P.default.Body1Strong,{color:"text-critical",children:Y}):Object(b.jsx)(U.FormatCurrency,{numbers:[null!=l?l:0,null!=B?B:0],render:function(e){return Object(b.jsx)(P.default.Body2,{color:"text-subdued",children:l?e:"$ 0"})}})})]}),Object(b.jsxs)(I.default,{children:[Object(b.jsx)(C.default,{h:"1",flexShrink:"1"}),Object(b.jsxs)(w.default,{flexDirection:"row",alignItems:"center",space:"3",children:[Object(b.jsx)(x.default,{size:"sm",onPress:function(){return Z(25)},children:"25%"}),Object(b.jsx)(x.default,{size:"sm",onPress:function(){return Z(50)},children:"50%"}),Object(b.jsx)(x.default,{size:"sm",onPress:function(){return Z(75)},children:"75%"}),Object(b.jsx)(x.default,{size:"sm",onPress:function(){return Z(100)},children:t.formatMessage({id:"action__max"})})]}),Object(b.jsx)(C.default,{h:"1",flexShrink:"1"}),Object(b.jsxs)(C.default,{h:"8",flexDirection:"row",alignItems:"center",justifyContent:"center",children:[Object(b.jsx)(P.default.Body2,{color:"text-subdued",mr:"1",children:t.formatMessage({id:"content__available_balance"})}),Object(b.jsxs)(P.default.Body2Strong,{color:X&&B?"text-critical":"text-default",children:[Object(m.formatAmount)(null!=h?h:"",6)," ","stETH"]})]})]})]}),Object(b.jsxs)(s.default,{children:[Object(b.jsxs)(C.default,{flexDirection:"row",justifyContent:"space-between",alignItems:"center",h:"10",children:[Object(b.jsx)(P.default.Body2,{color:"text-subdued",children:t.formatMessage({id:"form__est_arrival_time"})}),Object(b.jsx)(P.default.Body2Strong,{children:"lido"===y?t.formatMessage({id:"form__str_day"},{0:"~ 1 - 3"}).toLowerCase():t.formatMessage({id:"content__str_minutes_plural"},{0:"~ 1-5"})})]}),Object(b.jsx)(Ie.default,{children:ae?Object(b.jsxs)(C.default,{flexDirection:"row",justifyContent:"space-between",alignItems:"center",h:"10",children:[Object(b.jsx)(P.default.Body2,{color:"text-subdued",children:t.formatMessage({id:"form__est_receipt"})}),Object(b.jsxs)(P.default.Body2Strong,{children:[new E.a(ae).multipliedBy(B).toFixed(),"ETH"]})]}):null}),Object(b.jsxs)(C.default,{flexDirection:"row",justifyContent:"space-between",alignItems:"center",h:"10",children:[Object(b.jsx)(P.default.Body2,{color:"text-subdued",children:t.formatMessage({id:"form__route"})}),Object(b.jsx)(k.default,{onPress:re,children:Object(b.jsx)(Re,{value:y})})]})]})]}),Object(b.jsx)(z,{text:B,onTextChange:D})]})})}},{name:j.StakingRoutes.LidoEthUnstakeRoutes,component:Ce},{name:j.StakingRoutes.KeleStakingModeSelector,component:ve}];t.default=function(){var e=Object(a.default)();return Object(b.jsx)(yt.Navigator,{screenOptions:function(t){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?kt(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):kt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({headerShown:!1},Object(Ot.buildModalStackNavigatorOptions)({isVerticalLayout:e,navInfo:t}))},children:wt.map((function(e){return Object(b.jsx)(yt.Screen,{name:e.name,component:e.component},e.name)}))})}}}]);