(this.webpackJsonp=this.webpackJsonp||[]).push([[57],{3903:function(e,t,r){"use strict";r.r(t),r.d(t,"KeyringBase",(function(){return h})),r.d(t,"KeyringBaseMock",(function(){return y}));var n=r(2),o=r.n(n),i=r(6),a=r.n(i),c=r(9),s=r.n(c),u=r(14),d=r.n(u),l=r(7),f=r.n(l);function p(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=f()(e);if(t){var o=f()(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return d()(this,r)}}var h=function(e){s()(r,e);var t=p(r);function r(e){var r;return(r=t.call(this,e.options)).vault=e,r}return r.prototype.addressFromBase=function(){var e=o()((function*(e){return this.vault.addressFromBase(e)}));return function(t){return e.apply(this,arguments)}}(),a()(r)}(r(1585).VaultContext),y=function(e){s()(r,e);var t=p(r);function r(){return t.apply(this,arguments)}return a()(r)}(h)},3905:function(e,t,r){"use strict";r.r(t),r.d(t,"KeyringSoftwareBase",(function(){return I}));var n=r(4),o=r.n(n),i=r(3),a=r.n(i),c=r(2),s=r.n(c),u=r(6),d=r.n(u),l=r(9),f=r.n(l),p=r(14),h=r.n(p),y=r(7),v=r.n(y),g=r(19),w=r(23);function m(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function T(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?m(Object(r),!0).forEach((function(t){a()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):m(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function x(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=v()(e);if(t){var o=v()(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return h()(this,r)}}var I=function(e){f()(r,e);var t=x(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.signTransaction=function(){var e=s()((function*(e,t){var r=t.password;if("undefined"===typeof r)throw new w.OneKeyInternalError("Software signing requires a password.");var n=yield this.getSigners(r,e.inputs.map((function(e){return e.address})));return g.default.engine.info("signTransaction",this.networkId,e),T(T({},yield this.engine.providerManager.signTransaction(this.networkId,e,n)),{},{encodedTx:e.encodedTx})}));return function(t,r){return e.apply(this,arguments)}}(),n.signMessage=function(){var e=s()((function*(e,t){var r=this,n=t.password;if("undefined"===typeof n)throw new w.OneKeyInternalError("Software signing requires a password.");var i=yield this.getDbAccount(),a=Object.values(yield this.getSigners(n,[i.address])),c=o()(a,1)[0];return g.default.engine.info("signMessage",this.networkId,e),Promise.all(e.map((function(e){return r.engine.providerManager.signMessage(r.networkId,e,c)})))}));return function(t,r){return e.apply(this,arguments)}}(),n.getAddress=function(){throw new Error("Method not implemented.")},n.batchGetAddress=function(){throw new Error("Method not implemented.")},n.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},d()(r)}(r(3903).KeyringBase)},3912:function(e,t,r){"use strict";r.r(t),function(e){r.d(t,"VaultBaseChainOnly",(function(){return j})),r.d(t,"VaultBase",(function(){return H}));var n=r(202),o=r.n(n),i=r(3),a=r.n(i),c=r(60),s=r.n(c),u=r(2),d=r.n(u),l=r(6),f=r.n(l),p=r(9),h=r.n(p),y=r(14),v=r.n(y),g=r(7),w=r.n(g),m=r(21),T=r.n(m),x=r(167),I=r.n(x),A=r(11),b=r(19),O=r(24),E=r(68),P=r(23),C=r(182),k=r(947),N=r(52),D=r(1585);function B(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function S(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?B(Object(r),!0).forEach((function(t){a()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):B(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function R(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=w()(e);if(t){var o=w()(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return v()(this,r)}}if(O.default.isExtensionUi)throw new Error("engine/VaultBase is not allowed imported from ui");var j=function(e){h()(r,e);var t=R(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.initProvider=function(){var e=d()((function*(){var e=(yield this.getNetwork()).impl;s()(k.IMPL_MAPPINGS[e])||(this.engineProvider=yield this.engine.providerManager.getProvider(this.networkId))}));return function(){return e.apply(this,arguments)}}(),n.proxyJsonRPCCall=function(){var e=d()((function*(e){throw new P.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.createClientFromURL=function(e){throw new P.NotImplemented},n.getEthersProvider=function(){var e=d()((function*(){throw new P.NotImplemented}));return function(){return e.apply(this,arguments)}}(),n.getClientEndpointStatus=function(){var e=d()((function*(e){var t=this.createClientFromURL(e),r=performance.now(),n=(yield t.getInfo()).bestBlockNumber;return{responseTime:Math.floor(performance.now()-r),latestBlock:n}}));return function(t){return e.apply(this,arguments)}}(),n.checkRpcBatchSupport=function(){var e=d()((function*(e){throw new P.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.getDisplayAddress=function(){var e=d()((function*(e){return Promise.resolve(e)}));return function(t){return e.apply(this,arguments)}}(),n.validateAddress=function(){var e=d()((function*(e){var t=yield this.engineProvider.verifyAddress(e),r=t.normalizedAddress;if(!t.isValid||!r)throw new P.InvalidAddress;return Promise.resolve(r)}));return function(t){return e.apply(this,arguments)}}(),n.validateImportedCredential=function(e){return Promise.resolve(this.settings.importedAccountEnabled&&/^(0x)?[0-9a-zA-Z]{64}$/.test(e))},n.validateWatchingCredential=function(){var e=d()((function*(e){return Promise.resolve(this.settings.watchingAccountEnabled&&(yield this.engineProvider.verifyAddress(e)).isValid)}));return function(t){return e.apply(this,arguments)}}(),n.validateTokenAddress=function(){var e=d()((function*(e){var t=yield this.engineProvider.verifyTokenAddress(e),r=t.normalizedAddress;if(!t.isValid||"undefined"===typeof r)throw new P.InvalidTokenAddress;return Promise.resolve(r)}));return function(t){return e.apply(this,arguments)}}(),n.validateCanCreateNextAccount=function(){var e=d()((function*(e,t){return Promise.resolve(!0)}));return function(t,r){return e.apply(this,arguments)}}(),n.checkAccountExistence=function(){var e=d()((function*(e,t){return Promise.resolve(!0)}));return function(t,r){return e.apply(this,arguments)}}(),n.getBalances=function(){var e=d()((function*(e,t,r){return(yield this.engine.providerManager.getClient(this.networkId)).getBalances(e.map((function(e){var t=e.address,r=e.tokenAddress;return{address:t,coin:S({},"string"===typeof r?{tokenAddress:r}:{})}})))}));return function(t,r,n){return e.apply(this,arguments)}}(),n.getFrozenBalance=function(){var e=d()((function*(e){return 0}));return function(t){return e.apply(this,arguments)}}(),n.fetchBalanceDetails=function(){var e=d()((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.password;return Promise.resolve(void 0)}));return function(){return e.apply(this,arguments)}}(),n.getTransactionStatuses=function(e){return this.engine.providerManager.getTransactionStatuses(this.networkId,e)},n.getTransactionFeeInNative=function(e){return Promise.resolve("")},n.isContractAddress=function(){var e=d()((function*(e){return!1}));return function(t){return e.apply(this,arguments)}}(),n.getAccountNameInfoMap=function(){var e=d()((function*(){var e=yield this.getNetwork();return Object(C.getAccountNameInfoByImpl)(e.impl)}));return function(){return e.apply(this,arguments)}}(),n.canAutoCreateNextAccount=function(){var e=d()((function*(e){return Promise.resolve(!1)}));return function(t){return e.apply(this,arguments)}}(),n.filterAccounts=function(){var e=d()((function*(e){var t=e.accounts;e.networkId;return Promise.resolve(t)}));return function(t){return e.apply(this,arguments)}}(),n.shouldChangeAccountWhenNetworkChanged=function(){var e=d()((function*(e){e.previousNetwork,e.newNetwork,e.activeAccountId;return Promise.resolve({shouldReloadAccountList:!1,shouldChangeActiveAccount:!1})}));return function(t){return e.apply(this,arguments)}}(),n.getAccountNameInfosByImportedOrWatchingCredential=function(){var e=d()((function*(e){return Promise.resolve([])}));return function(t){return e.apply(this,arguments)}}(),n.checkIsUnlimitedAllowance=function(){var e=d()((function*(e){throw new P.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.checkIsApprovedForAll=function(){var e=d()((function*(e){throw new P.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.checkIsBatchTransfer=function(){var e=d()((function*(e){throw new P.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.getFeePricePerUnit=function(){var e=d()((function*(){throw new P.NotImplemented}));return function(){return e.apply(this,arguments)}}(),n.fetchRpcChainId=function(){var e=d()((function*(e){return null}));return function(t){return e.apply(this,arguments)}}(),n.getTxWaitingSeconds=function(){var e=d()((function*(){return[]}));return function(){return e.apply(this,arguments)}}(),n.getUserNFTAssets=function(){var e=d()((function*(e){e.serviceData;return Promise.resolve(void 0)}));return function(t){return e.apply(this,arguments)}}(),f()(r)}(D.VaultContext),H=function(t){h()(n,t);var r=R(n);function n(){for(var e,t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return(e=r.call.apply(r,[this].concat(n))).uuid=I.a.v4().toString(),e}var i=n.prototype;return i.init=function(){var e=d()((function*(e){yield this.initProvider(),yield this.initKeyring(e)}));return function(t){return e.apply(this,arguments)}}(),i.initKeyring=function(){var e=d()((function*(e){this.keyring=yield e.keyringCreator(this)}));return function(t){return e.apply(this,arguments)}}(),i.signTransaction=function(){var e=d()((function*(e,t){return this.keyring.signTransaction(e,t)}));return function(t,r){return e.apply(this,arguments)}}(),i.signAndSendTransaction=function(){var e=d()((function*(e,t,r){var n=yield this.signTransaction(e,t);return r?S(S({},n),{},{encodedTx:e.encodedTx}):this.broadcastTransaction(S(S({},n),{},{encodedTx:e.encodedTx}))}));return function(t,r,n){return e.apply(this,arguments)}}(),i.broadcastTransaction=function(){var e=d()((function*(e,t){b.default.engine.info("broadcastTransaction START:",{rawTx:e.rawTx});var r=yield this.engine.providerManager.broadcastTransaction(this.networkId,e.rawTx,t);return b.default.engine.info("broadcastTransaction END:",{txid:r,rawTx:e.rawTx}),S(S({},e),{},{txid:r,encodedTx:e.encodedTx})}));return function(t,r){return e.apply(this,arguments)}}(),i.buildEncodedTxFromBatchTransfer=function(){var e=d()((function*(e){throw new P.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),i.buildEncodedTxsFromSetApproveForAll=function(){var e=d()((function*(e,t){throw new P.NotImplemented}));return function(t,r){return e.apply(this,arguments)}}(),i.activateAccount=function(){var e=d()((function*(){throw new P.NotImplemented}));return function(){return e.apply(this,arguments)}}(),i.activateToken=function(){var e=d()((function*(e,t){throw new P.NotImplemented}));return function(t,r){return e.apply(this,arguments)}}(),i.getTokenAllowance=function(){var e=d()((function*(e,t){throw new P.NotImplemented}));return function(t,r){return e.apply(this,arguments)}}(),i.batchTokensAllowance=function(){var e=d()((function*(e,t){throw new P.NotImplemented}));return function(t,r){return e.apply(this,arguments)}}(),i.getOutputAccount=function(){var e=d()((function*(){var e=yield this.getDbAccount({noCache:!0});return{id:e.id,name:e.name,type:e.type,path:e.path,coinType:e.coinType,tokens:[],address:e.address,template:e.template,pubKey:o()(e,"pub","")}}));return function(){return e.apply(this,arguments)}}(),i.getAccountBalance=function(){var e=d()((function*(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,o=yield this.getDbAccount(),i=o.address;return this.getBalances((t?[{address:i}]:[]).concat(e.map((function(e){return{address:i,tokenAddress:e}}))),r,n)}));return function(t){return e.apply(this,arguments)}}(),i.updatePendingTxs=function(){var e=d()((function*(e){throw new P.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),i.getAccountNonce=function(){var e=d()((function*(){return Promise.resolve(null)}));return function(){return e.apply(this,arguments)}}(),i.fixActionDirection=function(){var e=d()((function*(e){var t,r,n,o,i=e.action,a=e.accountAddress;(i.direction=N.IDecodedTxDirection.OTHER,i.type===N.IDecodedTxActionType.NATIVE_TRANSFER)&&(i.direction=yield this.buildTxActionDirection({from:(null==(t=i.nativeTransfer)?void 0:t.from)||"",to:(null==(r=i.nativeTransfer)?void 0:r.to)||"",address:a}));i.type===N.IDecodedTxActionType.TOKEN_TRANSFER&&(i.direction=yield this.buildTxActionDirection({from:(null==(n=i.tokenTransfer)?void 0:n.from)||"",to:(null==(o=i.tokenTransfer)?void 0:o.to)||"",address:a}));return i}));return function(t){return e.apply(this,arguments)}}(),i.fixDecodedTx=function(){var e=d()((function*(e){var t,r;e.createdAt=null!=(t=e.createdAt)?t:Date.now();var n=null==(r=e.encodedTx)?void 0:r.nonce;e.nonce=s()(n)?e.nonce:new T.a(n).toNumber();for(var o=e.owner,i=0;i<e.actions.length;i+=1){var a=e.actions[i];yield this.fixActionDirection({action:a,accountAddress:o})}if(e.outputActions)for(var c=0;c<e.outputActions.length;c+=1){var u=e.outputActions[c];yield this.fixActionDirection({action:u,accountAddress:o})}return Promise.resolve(e)}));return function(t){return e.apply(this,arguments)}}(),i.fixHistoryTx=function(){var e=d()((function*(e){return e.decodedTx=yield this.fixDecodedTx(e.decodedTx),Promise.resolve(e)}));return function(t){return e.apply(this,arguments)}}(),i.buildHistoryTx=function(){var e=d()((function*(e){var t=e.historyTxToMerge,r=(e.encodedTx,e.decodedTx),n=e.signedTx,o=e.isSigner,i=e.isLocalCreated,a=(null==n?void 0:n.txid)||(null==r?void 0:r.txid)||"";if(!a)throw new Error("buildHistoryTx txid not found");var c=yield this.getAccountAddress();r.txid=a||r.txid,r.owner=c,o&&(r.signer=c),null!=n&&n.txKey&&(r.extraInfo?r.extraInfo.txKey=n.txKey:r.extraInfo={txKey:n.txKey});var s=S(S({id:this.networkId+"_"+a+"_"+this.accountId,isLocalCreated:Boolean(i)},t),{},{decodedTx:r});return s=yield this.fixHistoryTx(s),Promise.resolve(s)}));return function(t){return e.apply(this,arguments)}}(),i.checkIsScamHistoryTx=function(){var e=d()((function*(e){return!1}));return function(t){return e.apply(this,arguments)}}(),i.fetchOnChainHistory=function(){var e=d()((function*(e){throw new P.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),i.fixAddressCase=function(e){return Promise.resolve(e)},i.buildTxActionDirection=function(){var e=d()((function*(e){var t=e.from,r=e.to,n=e.address;return t=yield this.fixAddressCase(t||""),r=yield this.fixAddressCase(r),n=yield this.fixAddressCase(n),t===r&&t===n?N.IDecodedTxDirection.SELF:t&&t===n?N.IDecodedTxDirection.OUT:r&&r===n?N.IDecodedTxDirection.IN:N.IDecodedTxDirection.OTHER}));return function(t){return e.apply(this,arguments)}}(),i.getNextNonce=function(){var e=d()((function*(e,t){var r,n,o=null!=(r=null==(n=(yield this.engine.providerManager.getAddresses(e,[t.address]))[0])?void 0:n.nonce)?r:0,i=(yield this.engine.getHistory(e,t.id,void 0,!1),yield E.default.history.getMaxPendingNonce({accountId:this.accountId,networkId:e})),a=yield E.default.history.getPendingNonceList({accountId:this.accountId,networkId:e}),c=Math.max(s()(i)?0:i+1,o);if(Number.isNaN(c)&&(c=o),c>o)for(var u=o;u<c;u+=1)if(!a.includes(u)){c=u;break}if(c<o&&(c=o),c-o>=A.HISTORY_CONSTS.PENDING_QUEUE_MAX_LENGTH)throw new P.PendingQueueTooLong(A.HISTORY_CONSTS.PENDING_QUEUE_MAX_LENGTH);return c}));return function(t,r){return e.apply(this,arguments)}}(),i.validateSendAmount=function(e,t,r){return Promise.resolve(!0)},i.notifyChainChanged=function(e,t){},i.getFetchBalanceAddress=function(e){return Promise.resolve(e.address)},i.getPrivateKeyByCredential=function(t){return Promise.resolve(e.from(t.startsWith("0x")?t.slice(2):t,"hex"))},i.getMinDepositAmount=function(){var e=d()((function*(){return"0"}));return function(){return e.apply(this,arguments)}}(),i.specialCheckEncodedTx=function(){var e=d()((function*(e){return{success:!0}}));return function(t){return e.apply(this,arguments)}}(),i.getAllUsedAddress=function(){var e=d()((function*(){return Promise.resolve([])}));return function(){return e.apply(this,arguments)}}(),f()(n)}(j)}.call(this,r(26).Buffer)},3913:function(e,t,r){"use strict";r.r(t),function(e){r.d(t,"KeyringHardwareBase",(function(){return v}));var n=r(2),o=r.n(n),i=r(6),a=r.n(i),c=r(9),s=r.n(c),u=r(14),d=r.n(u),l=r(7),f=r.n(l),p=r(431),h=r(163);function y(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=f()(e);if(t){var o=f()(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return d()(this,r)}}var v=function(t){s()(n,t);var r=y(n);function n(){return r.apply(this,arguments)}var i=n.prototype;return i.getHardwareInfo=function(){var e=o()((function*(){var e,t,r,n=yield this.engine.getHWDeviceByWalletId(this.vault.walletId);return{connectId:null!=(e=null==n?void 0:n.mac)?e:"",deviceId:null!=(t=null==n?void 0:n.deviceId)?t:"",deviceType:null!=(r=null==n?void 0:n.deviceType)?r:""}}));return function(){return e.apply(this,arguments)}}(),i.getWalletPassphraseState=function(){var e=o()((function*(){var e=yield this.engine.getWallet(this.vault.walletId);return{passphraseState:null==e?void 0:e.passphraseState,useEmptyPassphrase:!Object(h.isPassphraseWallet)(e)}}));return function(){return e.apply(this,arguments)}}(),i.getHardwareSDKInstance=function(){var t=o()((function*(){var t,r,n,o,i;return null!=(i=yield null==(t=e)||null==(r=t.$backgroundApiProxy)||null==(n=r.backgroundApi)||null==(o=n.serviceHardware)||null==o.getSDKInstance?void 0:o.getSDKInstance())?i:p.HardwareSDK}));return function(){return t.apply(this,arguments)}}(),i.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},a()(n)}(r(3903).KeyringBase)}.call(this,r(58))},3914:function(e,t,r){"use strict";r.r(t),r.d(t,"KeyringHdBase",(function(){return T}));var n=r(3),o=r.n(n),i=r(2),a=r.n(i),c=r(6),s=r.n(c),u=r(9),d=r.n(u),l=r(14),f=r.n(l),p=r(7),h=r.n(p),y=r(610),v=r(23);function g(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function w(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?g(Object(r),!0).forEach((function(t){o()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):g(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function m(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=h()(e);if(t){var o=h()(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return f()(this,r)}}var T=function(e){d()(r,e);var t=m(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.getPrivateKeys=function(){var e=a()((function*(e,t){var r=(yield this.getDbAccount()).path.split("/"),n=t||[r.pop()],o=r.join("/"),i=(yield this.engine.dbApi.getCredential(this.walletId,e)).seed;if("undefined"===typeof i)throw new v.OneKeyInternalError("Unable to get credential.");var a=(yield this.engine.providerManager.getChainInfoByNetworkId(this.networkId)).curve;return Object(y.batchGetPrivateKeys)(a,i,e,o,n).reduce((function(e,t){var r;return w(w({},e),{},((r={})[t.path]=t.extendedKey.key,r))}),{})}));return function(t,r){return e.apply(this,arguments)}}(),n.getAddress=function(){throw new Error("Method not implemented.")},n.batchGetAddress=function(){throw new Error("Method not implemented.")},n.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},s()(r)}(r(3905).KeyringSoftwareBase)},3915:function(e,t,r){"use strict";r.r(t),r.d(t,"KeyringImportedBase",(function(){return y}));var n=r(2),o=r.n(n),i=r(6),a=r.n(i),c=r(9),s=r.n(c),u=r(14),d=r.n(u),l=r(7),f=r.n(l),p=r(23);function h(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=f()(e);if(t){var o=f()(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return d()(this,r)}}var y=function(e){s()(r,e);var t=h(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.getPrivateKeys=function(){var e=o()((function*(e,t){if("undefined"!==typeof t)throw new p.NotImplemented("Getting private keys from extended private key");var r=(yield this.engine.dbApi.getCredential(this.accountId,e)).privateKey;if("undefined"===typeof r)throw new p.OneKeyInternalError("Unable to get credential.");return{"":r}}));return function(t,r){return e.apply(this,arguments)}}(),n.getAddress=function(){throw new Error("Method not implemented.")},n.batchGetAddress=function(){throw new Error("Method not implemented.")},n.prepareAccountByAddressIndex=function(){throw new Error("Method not implemented.")},a()(r)}(r(3905).KeyringSoftwareBase)},3916:function(e,t,r){"use strict";r.r(t),r.d(t,"KeyringWatchingBase",(function(){return y}));var n=r(2),o=r.n(n),i=r(6),a=r.n(i),c=r(9),s=r.n(c),u=r(14),d=r.n(u),l=r(7),f=r.n(l),p=r(23);function h(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=f()(e);if(t){var o=f()(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return d()(this,r)}}var y=function(e){s()(r,e);var t=h(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.signTransaction=function(){var e=o()((function*(e,t){throw new p.OneKeyInternalError("signTransaction is not supported for watching accounts")}));return function(t,r){return e.apply(this,arguments)}}(),n.signMessage=function(){var e=o()((function*(e,t){throw new p.OneKeyInternalError("signMessage is not supported for watching accounts")}));return function(t,r){return e.apply(this,arguments)}}(),n.getAddress=function(){throw new Error("Method not implemented.")},n.batchGetAddress=function(){throw new Error("Method not implemented.")},n.prepareAccountByAddressIndex=function(){throw new Error("Method not implemented.")},a()(r)}(r(3903).KeyringBase)},3918:function(e,t,r){"use strict";r.r(t),r.d(t,"convertDeviceError",(function(){return c}));var n=r(70),o=r(90),i=r(19);r(24);function a(e,t){return"string"!==typeof t?null:e===n.HardwareErrorCode.DeviceInitializeFailed&&t.includes("ECONNABORTED")?new o.ConnectTimeoutError({message:t}):t.includes("Bridge network error")?new o.BridgeNetworkError({message:t}):null}function c(e){var t,r=e||{},c=r.code,s=r.error,u=r.message,d=null!=(t=null!=s?s:u)?t:"Unknown error";if(a(c,d))return a(c,d);switch(i.default.hardwareSDK.info("Device Utils Convert Device Error:",c,d),c){case n.HardwareErrorCode.UnknownError:return new o.UnknownHardwareError(e);case n.HardwareErrorCode.DeviceFwException:return new o.FirmwareVersionTooLow(e);case n.HardwareErrorCode.DeviceUnexpectedMode:return"string"===typeof d&&-1!==d.indexOf("ui-device_bootloader_mode")?new o.NotInBootLoaderMode(e):new o.UnknownHardwareError(e);case n.HardwareErrorCode.DeviceCheckDeviceIdError:return new o.DeviceNotSame(e);case n.HardwareErrorCode.DeviceNotFound:return new o.DeviceNotFind(e);case n.HardwareErrorCode.DeviceUnexpectedBootloaderMode:return new o.NotInBootLoaderMode(e);case n.HardwareErrorCode.DeviceInterruptedFromOutside:case n.HardwareErrorCode.DeviceInterruptedFromUser:return new o.UserCancelFromOutside(e);case n.HardwareErrorCode.DeviceNotSupportPassphrase:return new o.NotSupportPassphraseError(e);case n.HardwareErrorCode.IFrameLoadFail:return new o.InitIframeLoadFail(e);case n.HardwareErrorCode.IframeTimeout:return new o.InitIframeTimeout(e);case n.HardwareErrorCode.FirmwareUpdateDownloadFailed:return new o.FirmwareDownloadFailed(e);case n.HardwareErrorCode.FirmwareUpdateManuallyEnterBoot:return new o.FirmwareUpdateManuallyEnterBoot(e);case n.HardwareErrorCode.FirmwareUpdateAutoEnterBootFailure:return new o.FirmwareUpdateAutoEnterBootFailure(e);case n.HardwareErrorCode.FirmwareUpdateLimitOneDevice:return new o.FirmwareUpdateLimitOneDevice(e);case n.HardwareErrorCode.CallMethodNeedUpgradeFirmware:return new o.FirmwareVersionTooLow(e);case n.HardwareErrorCode.NewFirmwareUnRelease:return new o.NewFirmwareUnRelease(e);case n.HardwareErrorCode.NewFirmwareForceUpdate:return new o.NewFirmwareForceUpdate(e);case n.HardwareErrorCode.NetworkError:return new o.NetworkError(e);case n.HardwareErrorCode.BlePermissionError:return new o.NeedBluetoothTurnedOn(e);case n.HardwareErrorCode.BleLocationError:return new o.NeedBluetoothPermissions({message:d});case n.HardwareErrorCode.BleLocationServicesDisabled:return new o.BleLocationServiceError({message:d});case n.HardwareErrorCode.BleDeviceNotBonded:return new o.DeviceNotBonded(e);case n.HardwareErrorCode.BleDeviceBondError:return new o.DeviceBondError(e);case n.HardwareErrorCode.BleWriteCharacteristicError:return new o.BleWriteCharacteristicError(e);case n.HardwareErrorCode.BleScanError:return new o.BleScanError({message:d});case n.HardwareErrorCode.BleAlreadyConnected:return new o.BleAlreadyConnectedError(e);case n.HardwareErrorCode.RuntimeError:return-1!==d.indexOf("EIP712 blind sign is disabled")?new o.OpenBlindSign(e):-1!==d.indexOf("Unknown message")||-1!==d.indexOf("Failure_UnexpectedMessage")?new o.UnknownMethod(e):new o.UnknownHardwareError(e);case n.HardwareErrorCode.PinInvalid:return new o.InvalidPIN(e);case n.HardwareErrorCode.DeviceCheckPassphraseStateError:return new o.InvalidPassphrase(e);case n.HardwareErrorCode.DeviceOpenedPassphrase:return new o.DeviceOpenedPassphrase(e);case n.HardwareErrorCode.DeviceNotOpenedPassphrase:return new o.DeviceNotOpenedPassphrase(e);case n.HardwareErrorCode.PinCancelled:case n.HardwareErrorCode.ActionCancelled:return new o.UserCancel(e);case n.HardwareErrorCode.BridgeNotInstalled:case o.CustomOneKeyHardwareError.NeedOneKeyBridge:return new o.NeedOneKeyBridge(e);case n.HardwareErrorCode.BridgeNetworkError:return new o.BridgeNetworkError(e);case n.HardwareErrorCode.BridgeTimeoutError:return new o.BridgeTimeoutError(e);case n.HardwareErrorCode.PollingTimeout:return new o.ConnectTimeoutError(e);case n.HardwareErrorCode.PollingStop:return new o.ConnectPollingStopError(e);case n.HardwareErrorCode.BlindSignDisabled:return new o.OpenBlindSign(e);case n.HardwareErrorCode.FileAlreadyExists:return new o.FileAlreadyExistError(e);case n.HardwareErrorCode.CheckDownloadFileError:return new o.IncompleteFileError(e);case n.HardwareErrorCode.NotInSigningMode:return new o.NotInSigningModeError(e);default:return new o.UnknownHardwareError(e)}}},4168:function(e,t,r){"use strict";r.r(t),function(e){r.d(t,"isCfxNativeTransferType",(function(){return T})),r.d(t,"signTransactionWithSigner",(function(){return I})),r.d(t,"parseTransaction",(function(){return b})),r.d(t,"getTransactionStatus",(function(){return E})),r.d(t,"getApiExplorerTransferType",(function(){return P})),r.d(t,"ethAddressToCfxAddress",(function(){return C})),r.d(t,"pubkeyToAddress",(function(){return k}));var n=r(3),o=r.n(n),i=r(4),a=r.n(i),c=r(2),s=r.n(c),u=r(4163),d=r(22),l=r(138),f=r(150),p=r(52),h=r(4319),y=r(4358);function v(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function g(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?v(Object(r),!0).forEach((function(t){o()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):v(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var w=h.conflux.Transaction,m=Object(f.memoizee)(function(){var e=s()((function*(e,t){return t.getCode(e)}));return function(t,r){return e.apply(this,arguments)}}(),{promise:!0,normalizer:function(e){return a()(e,1)[0]}});function T(e,t){return x.apply(this,arguments)}function x(){return(x=s()((function*(e,t){var r=e.data,n=e.to;if(n&&"0x"===(yield m(n,t)))return!0;return!r||"0x"===r||"0x0"===r||"0"===r}))).apply(this,arguments)}function I(e,t){return A.apply(this,arguments)}function A(){return(A=s()((function*(t,r){var n=new w(t.encodedTx),o=Object(l.keccak256)(n.encode(!1)),i=yield r.sign(e.from(o.slice(2),"hex")),c=a()(i,2),s=c[0],u=c[1],f=[s.slice(0,32),s.slice(32)],p=f[0],h=f[1],y=new w(g(g({},t.encodedTx),{},{r:Object(d.hexZeroPad)("0x"+p.toString("hex"),32),s:Object(d.hexZeroPad)("0x"+h.toString("hex"),32),v:u}));return{digest:o,txid:y.hash,rawTx:y.serialize()}}))).apply(this,arguments)}function b(e,t){return O.apply(this,arguments)}function O(){return(O=s()((function*(e,t){if(yield T({data:e.data,to:e.to},t))return{actionType:p.IDecodedTxActionType.NATIVE_TRANSFER,abiDecodeResult:null};try{var r=t.CRC20(e.to),n=p.IDecodedTxActionType.UNKNOWN,o=r.abi.decodeData(e.data);if(o)switch(o.name){case"transfer":n=p.IDecodedTxActionType.TOKEN_TRANSFER;break;case"transferFrom":n=p.IDecodedTxActionType.TOKEN_TRANSFER;var i=o.object,a=i.sender,c=i.recipient;if(a!==e.from&&c!==e.from)return{actionType:p.IDecodedTxActionType.UNKNOWN,abiDecodeResult:null};break;case"approve":n=p.IDecodedTxActionType.TOKEN_APPROVE;break;default:n=p.IDecodedTxActionType.UNKNOWN}return{actionType:n,abiDecodeResult:o}}catch(s){return{actionType:p.IDecodedTxActionType.UNKNOWN,abiDecodeResult:null}}}))).apply(this,arguments)}function E(e){switch(e){case 0:return p.IDecodedTxStatus.Confirmed;case 1:return p.IDecodedTxStatus.Failed;case 2:case null:return p.IDecodedTxStatus.Dropped;default:return p.IDecodedTxStatus.Confirmed}}function P(e){return e?y.IOnChainTransferType.Transfer20:""===e?y.IOnChainTransferType.Call:y.IOnChainTransferType.Transaction}function C(e){return"0x1"+e.toLowerCase().slice(1)}function k(e,t){return N.apply(this,arguments)}function N(){return(N=s()((function*(e,t){var r=(yield e.getPubkey(!1)).slice(1),n=C(Object(l.keccak256)(r).slice(-40)),o=parseInt(t);return Object(u.encode)(n,o)}))).apply(this,arguments)}}.call(this,r(26).Buffer)},4319:function(e,t,r){"use strict";r.r(t),r.d(t,"conflux",(function(){return o}));var n=r(4573),o=r.n(n).a},4340:function(e,t,r){"use strict";r.r(t),function(e){r.d(t,"KeyringHardware",(function(){return F}));var n=r(4338),o=r.n(n),i=r(3),a=r.n(i),c=r(2),s=r.n(c),u=r(6),d=r.n(u),l=r(9),f=r.n(l),p=r(14),h=r.n(p),y=r(7),v=r.n(y),g=r(84),w=r(21),m=r.n(w),T=r(1459),x=r(46),I=r(3918),A=r(11),b=r(19),O=r(376),E=r(23),P=r(117),C=r(114),k=r(3913),N=r(4319);function D(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function B(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?D(Object(r),!0).forEach((function(t){a()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):D(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function S(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=v()(e);if(t){var o=v()(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return h()(this,r)}}var R=N.conflux.Transaction,j=N.conflux.address,H="m/44'/"+A.COINTYPE_CFX+"'/0'/0",F=function(t){f()(n,t);var r=S(n);function n(){return r.apply(this,arguments)}var i=n.prototype;return i.signTransaction=function(){var e=s()((function*(e){var t,r,n,i,a,c,s=yield this.getHardwareSDKInstance(),u=yield this.getAccountPath(),d=yield this.getHardwareInfo(),l=d.connectId,f=d.deviceId,p=yield this.getWalletPassphraseState(),h=e.encodedTx,y=B(B({},h),{},{epochHeight:Object(O.toBigIntHex)(new m.a(null!=(t=h.epochHeight)?t:0)),to:h.to?"0x"+j.decodeCfxAddress(h.to).hexAddress.toString("hex"):"",storageLimit:Object(O.toBigIntHex)(new m.a(null!=(r=h.storageLimit)?r:0)),nonce:Object(O.toBigIntHex)(new m.a(null!=(n=h.nonce)?n:0)),gasPrice:Object(O.toBigIntHex)(new m.a(null!=(i=h.gasPrice)?i:0)),data:null!=(a=h.data)?a:"0x",value:Object(O.toBigIntHex)(new m.a(null!=(c=h.value)?c:0))}),v=yield s.confluxSignTransaction(l,f,B({path:u,transaction:y},p));if(v.success){var g=v.payload,w=g.r,T=g.s,x=g.v,A=new R(B(B({},o()(y,(function(e){return!e}))),{},{r:w,s:T,v:new m.a(x).toNumber()}));return Promise.resolve({txid:A.hash,rawTx:A.serialize()})}throw Object(I.convertDeviceError)(v.payload)}));return function(t){return e.apply(this,arguments)}}(),i.signMessage=function(){var e=s()((function*(e,t){var r=this;return Promise.all(e.map(function(){var e=s()((function*(e){return r.handleSignMessage(e)}));return function(t){return e.apply(this,arguments)}}()))}));return function(t,r){return e.apply(this,arguments)}}(),i.prepareAccounts=function(){var e=s()((function*(e){var t,r=this,n=e.indexes,o=e.names,i=n.map((function(e){return H+"/"+e})),a=new m.a(yield this.getNetworkChainId()).toNumber(),c=yield this.getHardwareSDKInstance(),s=yield this.getHardwareInfo(),u=s.connectId,d=s.deviceId,l=yield this.getWalletPassphraseState();try{t=yield c.confluxGetAddress(u,d,B({bundle:i.map((function(e){return{path:e,showOnOneKey:!1,chainId:a}}))},l))}catch(f){throw b.default.common.error(f),new E.OneKeyHardwareError(f)}if(!t.success)throw b.default.common.error(t.payload),Object(I.convertDeviceError)(t.payload);return t.payload.map((function(e,t){var i,a=e.address,c=e.path;return{id:r.walletId+"--"+c,name:(o||[])[t]||"CFX #"+(n[t]+1),type:P.AccountType.VARIANT,path:c,coinType:A.COINTYPE_CFX,pub:"",address:"0x"+j.decodeCfxAddress(null!=a?a:"").hexAddress.toString("hex"),addresses:(i={},i[r.networkId]=null!=a?a:"",i)}})).filter((function(e){return!!e.address}))}));return function(t){return e.apply(this,arguments)}}(),i.getAddress=function(){var e=s()((function*(e){var t,r=yield this.getHardwareSDKInstance(),n=yield this.getHardwareInfo(),o=n.connectId,i=n.deviceId,a=yield this.getWalletPassphraseState(),c=new m.a(yield this.getNetworkChainId()).toNumber(),s=yield r.confluxGetAddress(o,i,B({path:e.path,showOnOneKey:e.showOnOneKey,chainId:c},a));if(s.success&&null!=(t=s.payload)&&t.address)return s.payload.address;throw Object(I.convertDeviceError)(s.payload)}));return function(t){return e.apply(this,arguments)}}(),i.batchGetAddress=function(){var e=s()((function*(e){var t=yield this.getHardwareSDKInstance(),r=yield this.getHardwareInfo(),n=r.connectId,o=r.deviceId,i=yield this.getWalletPassphraseState(),a=new m.a(yield this.getNetworkChainId()).toNumber(),c=yield t.confluxGetAddress(n,o,B(B({},i),{},{bundle:e.map((function(e){return{path:e.path,showOnOneKey:!!e.showOnOneKey,chainId:a}}))}));if(!c.success)throw Object(I.convertDeviceError)(c.payload);return c.payload.map((function(e){var t,r;return{path:null!=(t=e.path)?t:"",address:null!=(r=e.address)?r:""}}))}));return function(t){return e.apply(this,arguments)}}(),i.handleSignMessage=function(){var t=s()((function*(t){var r=yield this.getHardwareSDKInstance(),n=yield this.getAccountPath(),o=yield this.getHardwareInfo(),i=o.connectId,a=o.deviceId,c=yield this.getWalletPassphraseState();if(t.type===C.ETHMessageTypes.TYPED_DATA_V1)throw g.web3Errors.provider.unsupportedMethod("Sign message method="+t.type+" not supported for this device");if(t.type===C.ETHMessageTypes.ETH_SIGN||t.type===C.ETHMessageTypes.PERSONAL_SIGN){var s;try{if(!Object(x.isHexString)(t.message))throw new Error("not hex string");s=e.from(t.message.replace("0x",""),"hex")}catch(O){s=e.from("")}var u=t.message;0===s.length&&(u=e.from(t.message,"utf-8").toString("hex"));var d=yield r.confluxSignMessage(i,a,B({path:n,messageHex:u},c));if(!d.success)throw Object(I.convertDeviceError)(d.payload);return"0x"+(d.payload.signature||"")}if(t.type===C.ETHMessageTypes.TYPED_DATA_V3||t.type===C.ETHMessageTypes.TYPED_DATA_V4){var l,f,p,h=t.type===C.ETHMessageTypes.TYPED_DATA_V4,y=JSON.parse(t.message),v=T.TypedDataUtils.sanitizeData(y),w=(null==v||null==(l=v.types)||null==(f=l.CIP23Domain)?void 0:f.length)>0?"CIP23Domain":"EIP712Domain",m=T.TypedDataUtils.hashStruct(w,v.domain,v.types,h).toString("hex"),A=T.TypedDataUtils.hashStruct(v.primaryType,v.message,v.types,h).toString("hex"),b=yield r.confluxSignMessageCIP23(i,a,B({path:n,domainHash:m,messageHash:A},c));if(!b.success)throw Object(I.convertDeviceError)(b.payload);return"0x"+((null==b||null==(p=b.payload)?void 0:p.signature)||"")}throw g.web3Errors.rpc.methodNotFound("Sign message method="+t.type+" not found")}));return function(e){return t.apply(this,arguments)}}(),d()(n)}(k.KeyringHardwareBase)}.call(this,r(26).Buffer)},4358:function(e,t,r){"use strict";var n;r.r(t),r.d(t,"IOnChainTransferType",(function(){return n})),function(e){e.Transaction="transaction",e.Call="call",e.Transfer20="transfer_20"}(n||(n={}))},6108:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return de}));var n=r(4338),o=r.n(n),i=r(316),a=r.n(i),c=r(4),s=r.n(c),u=r(60),d=r.n(u),l=r(3),f=r.n(l),p=r(2),h=r.n(p),y=r(6),v=r.n(y),g=r(9),w=r.n(g),m=r(14),T=r.n(m),x=r(7),I=r.n(x),A=r(4163),b=r(554),O=r(107),E=r.n(O),P=r(21),C=r.n(P),k=r(112),N=r(46),D=r(19),B=r(1068),S=r(150),R=r(376),j=r(23),H=r(130),F=r(1345),K=r(52),M=r(196),U=r(3912),_=r(4340),V=r(610),L=r(11),W=r(117),G=r(3914),z=r(4168);function X(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=I()(e);if(t){var o=I()(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return T()(this,r)}}var Y="m/44'/"+L.COINTYPE_CFX+"'/0'/0",q=function(e){w()(r,e);var t=X(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.getSigners=function(){var e=h()((function*(e,t){var r,n=yield this.getDbAccount(),o=n.addresses[this.networkId];if(1!==t.length)throw new j.OneKeyInternalError("CFX signers number should be 1.");if(t[0]!==o)throw new j.OneKeyInternalError("Wrong address required for signing.");var i=(yield this.getPrivateKeys(e))[n.path];if("undefined"===typeof i)throw new j.OneKeyInternalError("Unable to get signer.");return(r={})[o]=new F.Signer(i,e,"secp256k1"),r}));return function(t,r){return e.apply(this,arguments)}}(),n.prepareAccounts=function(){var e=h()((function*(e){var t=e.password,r=e.indexes,n=e.names,o=(yield this.engine.dbApi.getCredential(this.walletId,t)).seed,i=Object(V.batchGetPublicKeys)("secp256k1",o,t,Y,r.map((function(e){return e.toString()})));if(i.length!==r.length)throw new j.OneKeyInternalError("Unable to get publick key.");var a=[],c=0;for(var s of i){var u,d=s.path,l=s.extendedKey.key.toString("hex"),f=yield this.vault.getNetworkChainId(),p=yield Object(z.pubkeyToAddress)(new F.Verifier(l,"secp256k1"),f),h=yield this.vault.addressToBase(p),y=(n||[])[c]||"CFX #"+(r[c]+1);a.push({id:this.walletId+"--"+d,name:y,type:W.AccountType.VARIANT,path:d,coinType:L.COINTYPE_CFX,pub:l,address:h,addresses:(u={},u[this.networkId]=p,u)}),c+=1}return a}));return function(t){return e.apply(this,arguments)}}(),n.signTransaction=function(){var e=h()((function*(e,t){var r=(yield this.getDbAccount()).addresses[this.networkId],n=(yield this.getSigners(t.password||"",[r]))[r];return Object(z.signTransactionWithSigner)(e,n)}));return function(t,r){return e.apply(this,arguments)}}(),n.signMessage=function(){var e=h()((function*(e,t){var r=this;if("undefined"===typeof t.password)throw new j.OneKeyInternalError("Software signing requires a password.");var n=(yield this.getDbAccount()).addresses[this.networkId],o=(yield this.getSigners(t.password||"",[n]))[n];return Promise.all(e.map((function(e){return r.engine.providerManager.signMessage(r.networkId,e,o)})))}));return function(t,r){return e.apply(this,arguments)}}(),v()(r)}(G.KeyringHdBase),J=r(748);function Q(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=I()(e);if(t){var o=I()(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return T()(this,r)}}var Z=function(e){w()(r,e);var t=Q(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.getSigners=function(){var e=h()((function*(e,t){var r,n=(yield this.getDbAccount()).addresses[this.networkId];if(1!==t.length)throw new j.OneKeyInternalError("CFX signers number should be 1.");if(t[0]!==n)throw new j.OneKeyInternalError("Wrong address required for signing.");var o=Object.values(yield this.getPrivateKeys(e)),i=s()(o,1)[0];return(r={})[n]=new F.Signer(i,e,"secp256k1"),r}));return function(t,r){return e.apply(this,arguments)}}(),n.prepareAccounts=function(){var e=h()((function*(e){var t,r=e.name,n=e.privateKey;if(32!==n.length)throw new j.OneKeyInternalError("Invalid private key.");var o=J.secp256k1.publicFromPrivate(n).toString("hex"),i=yield this.vault.getNetworkChainId(),a=yield Object(z.pubkeyToAddress)(new F.Verifier(o,"secp256k1"),i),c=yield this.vault.addressToBase(a);return Promise.resolve([{id:"imported--"+L.COINTYPE_CFX+"--"+o,name:r||"",type:W.AccountType.VARIANT,path:"",coinType:L.COINTYPE_CFX,pub:o,address:c,addresses:(t={},t[this.networkId]=a,t)}])}));return function(t){return e.apply(this,arguments)}}(),n.signTransaction=function(){var e=h()((function*(e,t){var r=(yield this.getDbAccount()).addresses[this.networkId],n=(yield this.getSigners(t.password||"",[r]))[r];return Object(z.signTransactionWithSigner)(e,n)}));return function(t,r){return e.apply(this,arguments)}}(),v()(r)}(r(3915).KeyringImportedBase);function $(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=I()(e);if(t){var o=I()(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return T()(this,r)}}var ee=function(e){w()(r,e);var t=$(r);function r(){return t.apply(this,arguments)}return r.prototype.prepareAccounts=function(){var e=h()((function*(e){var t,r=e.name,n=e.target,o=e.accountIdPrefix,i=yield this.vault.validateAddress(n),a=yield this.vault.addressToBase(i);return[{id:o+"--"+L.COINTYPE_CFX+"--"+a,name:r||"",type:W.AccountType.VARIANT,path:"",coinType:L.COINTYPE_CFX,pub:"",address:a,addresses:(t={},t[this.networkId]=i,t)}]}));return function(t){return e.apply(this,arguments)}}(),v()(r)}(r(3916).KeyringWatchingBase),te=r(4319),re=r(2713),ne=r(4358);function oe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ie(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?oe(Object(r),!0).forEach((function(t){f()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):oe(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function ae(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=I()(e);if(t){var o=I()(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return T()(this,r)}}var ce=te.conflux.Conflux,se=te.conflux.address,ue="0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff",de=function(e){w()(r,e);var t=ae(r);function r(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))).settings=re.default,e.keyringMap={hd:q,hw:_.KeyringHardware,imported:Z,watching:ee,external:ee},e.getApiExplorerCache=Object(S.memoizee)(function(){var e=h()((function*(e){return E.a.create({baseURL:e})}));return function(t){return e.apply(this,arguments)}}(),{promise:!0,max:1,maxAge:Object(N.getTimeDurationMs)({minute:3})}),e.getClientCache=Object(S.memoizee)(function(){var t=h()((function*(t,r){return e.getConfluxClient(t,r)}));return function(e,r){return t.apply(this,arguments)}}(),{promise:!0,max:1,maxAge:Object(N.getTimeDurationMs)({minute:3})}),e.getRpcClientCache=Object(S.memoizee)(function(){var e=h()((function*(e){return new B.JsonRPCRequest(e)}));return function(t){return e.apply(this,arguments)}}(),{promise:!0,max:1,maxAge:Object(N.getTimeDurationMs)({minute:3})}),e}var n=r.prototype;return n.getApiExplorer=function(){var e=h()((function*(){var e=yield this.engine.getNetwork(this.networkId),t=e.blockExplorerURL.name.replace(/(https:\/\/)/,"$1"+(e.isTestnet?"api-":"api."));return this.getApiExplorerCache(t)}));return function(){return e.apply(this,arguments)}}(),n.getClient=function(){var e=h()((function*(e){var t=yield this.getRpcUrl(),r=yield this.getNetworkChainId();return this.getClientCache(null!=e?e:t,r)}));return function(t){return e.apply(this,arguments)}}(),n.getRpcClient=function(){var e=h()((function*(e){var t=yield this.getRpcUrl();return this.getRpcClientCache(null!=e?e:t)}));return function(t){return e.apply(this,arguments)}}(),n.getConfluxClient=function(e,t){return new ce({url:e,networkId:Number(t)})},n.getBalances=function(){var e=h()((function*(e){var t=e.map((function(e){var t=e.address,r=e.tokenAddress;return{address:t,coin:ie({},"string"===typeof r?{tokenAddress:r}:{})}})).map((function(e){var t;return null!=(t=e.coin)&&t.tokenAddress?["cfx_call",[{to:e.coin.tokenAddress,data:"0x70a08231000000000000000000000000"+Object(A.decode)(e.address).hexAddress.toString("hex")},"latest_state"]]:["cfx_getBalance",[e.address,"latest_state"]]})),r=yield this.getRpcClient();return(yield r.batchCall(t,void 0,void 0,!0)).map((function(e){var t;return"undefined"!==typeof e&&(t=Object(R.fromBigIntHex)(e.slice(0,66))).isNaN()&&(t=void 0),t}))}));return function(t){return e.apply(this,arguments)}}(),n.attachFeeInfoToEncodedTx=function(){var e=h()((function*(e){var t=yield this.getNetwork(),r=e.encodedTx,n=e.feeInfoValue,o=n.limit,i=n.price,a=ie({},r);return d()(o)||(a.gas=Object(R.toBigIntHex)(new C.a(o)),a.gasLimit=Object(R.toBigIntHex)(new C.a(o))),d()(i)||(a.gasPrice=Object(M.convertFeeGweiToValue)({value:i||"0.000000001",network:t})),Promise.resolve(a)}));return function(t){return e.apply(this,arguments)}}(),n.decodedTxToLegacy=function(e){return Promise.resolve({})},n.decodeTx=function(){var e=h()((function*(e,t){var r,n=yield this.getAccountAddress(),o=yield this.getNetwork();return{txid:e.hash||"",owner:n,signer:e.from||n,nonce:e.nonce||0,actions:yield this.buildEncodedTxActions(e),status:K.IDecodedTxStatus.Pending,networkId:this.networkId,accountId:this.accountId,encodedTx:e,feeInfo:{limit:e.gasLimit,price:Object(M.convertFeeValueToGwei)({value:null!=(r=e.gasPrice)?r:"1",network:o}),priceValue:e.gasPrice},payload:t,extraInfo:null}}));return function(t,r){return e.apply(this,arguments)}}(),n.buildEncodedTxFromTransfer=function(){var e=h()((function*(e){if(!e.to)throw new Error("Invalid transferInfo.to params");var t=yield this.getNetwork(),r=e.amount,n=Boolean(e.token),o=new C.a(r);if(o.isNaN()&&(o=new C.a("0")),n){var i,a,c=yield this.engine.ensureTokenInDB(this.networkId,null!=(i=e.token)?i:"");if(!c)throw new Error("Token not found: "+e.token);var s=Object(R.toBigIntHex)(o.shiftedBy(c.decimals)),u="0x"+se.decodeCfxAddress(e.to).hexAddress.toString("hex"),d="0xa9059cbb"+b.defaultAbiCoder.encode(["address","uint256"],[u,s]).slice(2);return{from:e.from,to:null!=(a=e.token)?a:"",value:"0x0",data:d}}var l=Object(R.toBigIntHex)(o.shiftedBy(t.decimals));return{from:e.from,to:e.to,value:l,data:"0x"}}));return function(t){return e.apply(this,arguments)}}(),n.buildEncodedTxFromApprove=function(e){throw new Error("Method not implemented.")},n.updateEncodedTxTokenApprove=function(){var e=h()((function*(e,t){var r=(yield this.decodeTx(e)).actions[0];if(!r||r.type!==K.IDecodedTxActionType.TOKEN_APPROVE||!r.tokenApprove)throw new Error("Not a approve transaction.");var n,o=r.tokenApprove,i=o.tokenInfo,a=o.spender;if("Infinite"===t||t===ue)n=ue;else{var c=new C.a(t);if(c.isNaN())throw new Error("Invalid amount input: "+t);n=Object(R.toBigIntHex)(c.shiftedBy(i.decimals))}var s="0x095ea7b3"+b.defaultAbiCoder.encode(["address","uint256"],["0x"+se.decodeCfxAddress(a).hexAddress.toString("hex"),n]).slice(2);return ie(ie({},e),{},{data:s})}));return function(t,r){return e.apply(this,arguments)}}(),n.buildUnsignedTxFromEncodedTx=function(){var e=h()((function*(e){var t=e.from,r=e.to,n=e.value,o=e.data,i=yield this.getClient(),a=yield Promise.all([i.getStatus(),i.getNextNonce(e.from),i.estimateGasAndCollateral({from:t,to:r,value:n,data:o})]),c=s()(a,3),u=c[0],d=c[1],l=c[2];e.nonce=Number(d),e.epochHeight=u.epochNumber,e.chainId=u.chainId,e.storageLimit=new C.a(l.storageCollateralized).toFixed();var f={inputs:[],outputs:[],payload:{encodedTx:e},encodedTx:e};return Promise.resolve(f)}));return function(t){return e.apply(this,arguments)}}(),n.verifyAddress=function(){var e=h()((function*(e){var t=se.isValidCfxAddress(e);return Promise.resolve({normalizedAddress:t?e.toLowerCase():void 0,displayAddress:t?e.toLowerCase():void 0,isValid:t})}));return function(t){return e.apply(this,arguments)}}(),n.fetchFeeInfo=function(){var e=h()((function*(e){var t,r=e.gas,n=e.gasLimit,o=yield this.getNetwork(),i=yield this.getClient(),a=e.from,c=e.to,u=e.value,d=e.data,l=yield Promise.all([i.getGasPrice(),i.estimateGasAndCollateral({from:a,to:c,value:u,data:d})]),f=s()(l,2),p=f[0],h=f[1],y=C.a.max(null!=(t=h.gasLimit)?t:"0",null!=r?r:"0",null!=n?n:"0").toFixed();return{nativeSymbol:o.symbol,nativeDecimals:o.decimals,feeSymbol:o.feeSymbol,feeDecimals:o.feeDecimals,limit:y,prices:[new C.a(p.toString()).shiftedBy(-o.decimals).toFixed()],defaultPresetIndex:"1",tx:null}}));return function(t){return e.apply(this,arguments)}}(),n.updateEncodedTx=function(){var e=h()((function*(e,t,r){if(r.type===K.IEncodedTxUpdateType.transfer){var n=yield this.getNetwork();e.value=new C.a(t.amount).shiftedBy(n.decimals).toFixed()}return Promise.resolve(e)}));return function(t,r,n){return e.apply(this,arguments)}}(),n.getExportedCredential=function(){var e=h()((function*(e){var t=yield this.getDbAccount();if(t.id.startsWith("hd-")||t.id.startsWith("imported")){var r=this.keyring,n=Object.values(yield r.getPrivateKeys(e)),o=s()(n,1)[0];return"0x"+Object(k.decrypt)(e,o).toString("hex")}throw new j.OneKeyInternalError("Only credential of HD or imported accounts can be exported")}));return function(t){return e.apply(this,arguments)}}(),n.validateWatchingCredential=function(){var e=h()((function*(e){return Promise.resolve(this.settings.watchingAccountEnabled&&(yield this.verifyAddress(e)).isValid)}));return function(t){return e.apply(this,arguments)}}(),n.validateTokenAddress=function(){var e=h()((function*(e){var t=yield this.verifyAddress(e),r=t.normalizedAddress;if(!t.isValid||"undefined"===typeof r)throw new j.InvalidTokenAddress;return Promise.resolve(r)}));return function(t){return e.apply(this,arguments)}}(),n.getOutputAccount=function(){var e=h()((function*(){var e=yield this.getDbAccount({noCache:!0}),t={id:e.id,name:e.name,type:e.type,path:e.path,coinType:e.coinType,tokens:[],address:e.address||"",template:e.template};if(0===t.address.length&&Object(H.isAccountCompatibleWithNetwork)(e.id,this.networkId)){var r;if(!!e.pub&&!a()(e.pub)?r=yield this.engine.providerManager.addressFromPub(this.networkId,e.pub):a()(e.address.trim())||(r=yield this.addressFromBase(e)),!r)return t;t.address=r,yield this.engine.dbApi.updateAccountAddresses(e.id,this.networkId,r)}return t}));return function(){return e.apply(this,arguments)}}(),n.getAccountAddress=function(){var e=h()((function*(){return(yield this.getOutputAccount()).address}));return function(){return e.apply(this,arguments)}}(),n.getAccountBalance=function(){var e=h()((function*(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=yield this.getAccountAddress();return this.getBalances((t?[{address:r}]:[]).concat(e.map((function(e){return{address:r,tokenAddress:e}}))))}));return function(t){return e.apply(this,arguments)}}(),n.validateAddress=function(){var e=h()((function*(e){var t=yield this.verifyAddress(e),r=t.isValid,n=t.normalizedAddress;if(!r||"undefined"===typeof n)throw new j.InvalidAddress;return Promise.resolve(n)}));return function(t){return e.apply(this,arguments)}}(),n.fetchOnChainHistory=function(){var e=h()((function*(e){var t=this,r=e.tokenIdOnNetwork,n=e.localHistory,i=void 0===n?[]:n,c=yield this.getNetwork(),s=yield this.getApiExplorer(),u=yield this.getClient(),l=yield this.getAccountAddress(),f=[],p=Object(z.getApiExplorerTransferType)(r),y=o()({account:l,limit:50,transferType:p,contract:r},(function(e){return d()(e)||a()(e)}));try{var v=yield s.get("/account/transfers",{params:y});if(0!==v.data.code)return yield Promise.resolve([]);var g=v.data.data.list.map(function(){var e=h()((function*(e){var n,o=i.find((function(t){return t.decodedTx.txid===e.transactionHash}));if(o&&o.decodedTx.isFinal)return Promise.resolve(null);var a=ie(ie({},e),{},{hash:e.transactionHash,value:p===ne.IOnChainTransferType.Transfer20?"0x":Object(R.toBigIntHex)(new C.a(e.amount)),data:e.input});if(p!==ne.IOnChainTransferType.Transaction){var s=yield u.getTransactionByHash(e.transactionHash);if(s&&(a.gasFee=new C.a(s.gas).multipliedBy(s.gasPrice).toFixed(),a.nonce=new C.a(s.nonce).toNumber(),a.data=s.data,p===ne.IOnChainTransferType.Transfer20&&(a.to=s.to||e.contract||a.to)),p===ne.IOnChainTransferType.Transfer20){var d=yield t.engine.findToken({networkId:t.networkId,tokenIdOnNetwork:r});d&&f.push({type:K.IDecodedTxActionType.TOKEN_TRANSFER,tokenTransfer:t.buildTokenTransferAction({from:e.from,to:e.to,token:d,amount:e.amount})})}}var h={txid:a.hash||"",owner:l,signer:a.from||l,nonce:a.nonce||0,actions:f.length?f:yield t.buildEncodedTxActions(a),status:Object(z.getTransactionStatus)(e.status),networkId:t.networkId,accountId:t.accountId,encodedTx:a,extraInfo:null,totalFeeInNative:new C.a(a.gasFee).shiftedBy(-c.decimals).toFixed()};return h.updatedAt=1e3*e.timestamp,h.createdAt=null!=(n=null==o?void 0:o.decodedTx.createdAt)?n:h.updatedAt,h.isFinal=h.status===K.IDecodedTxStatus.Confirmed,t.buildHistoryTx({decodedTx:h,historyTxToMerge:{}})}));return function(t){return e.apply(this,arguments)}}());return(yield Promise.all(g)).filter(Boolean)}catch(w){return Promise.resolve([])}}));return function(t){return e.apply(this,arguments)}}(),n.buildEncodedTxActions=function(){var e=h()((function*(e){var t,r=yield this.getAccountAddress(),n=yield this.getClient(),o=yield Object(z.parseTransaction)(e,n),i=o.actionType,a=o.abiDecodeResult,c={type:K.IDecodedTxActionType.UNKNOWN,direction:yield this.buildTxActionDirection({from:e.from,to:e.to,address:r}),unknownAction:{extraInfo:{}}};if(e.value){var s=new C.a(e.value);!s.isNaN()&&s.gt(0)&&(t={type:K.IDecodedTxActionType.NATIVE_TRANSFER,nativeTransfer:yield this.buildNativeTransferAction(e)})}if(i===K.IDecodedTxActionType.NATIVE_TRANSFER&&(c.type=K.IDecodedTxActionType.NATIVE_TRANSFER,c.nativeTransfer=yield this.buildNativeTransferAction(e),t=void 0),i===K.IDecodedTxActionType.TOKEN_TRANSFER||i===K.IDecodedTxActionType.TOKEN_APPROVE){var u=yield this.engine.findToken({networkId:this.networkId,tokenIdOnNetwork:e.to});if(u&&a){var d,l,f=a.object,p=f.from,h=f.to,y=f.sender,v=f.recipient,g=f.amount,w=f.spender;if(c.type=i,i===K.IDecodedTxActionType.TOKEN_TRANSFER)c.tokenTransfer=this.buildTokenTransferAction({from:null!=(d=null!=(l=null!=p?p:y)?l:e.from)?d:r,to:null!=h?h:v,token:u,amount:g});i===K.IDecodedTxActionType.TOKEN_APPROVE&&(c.tokenApprove=this.buildTokenApproveAction({owner:e.from||r,spender:w,token:u,amount:g}))}}return[c,t].filter(Boolean)}));return function(t){return e.apply(this,arguments)}}(),n.buildNativeTransferAction=function(){var e=h()((function*(e){var t=yield this.engine.getNativeTokenInfo(this.networkId),r=new C.a(e.value),n=yield this.getNetwork();return{tokenInfo:t,from:e.from,to:e.to,amount:r.shiftedBy(-n.decimals).toFixed(),amountValue:r.toFixed(),extraInfo:null}}));return function(t){return e.apply(this,arguments)}}(),n.buildTokenTransferAction=function(e){var t=e.from,r=e.to,n=e.token,o=e.amount,i=new C.a(o);return{from:t,to:r,tokenInfo:n,amount:i.shiftedBy(-n.decimals).toFixed(),amountValue:i.toFixed(),extraInfo:null}},n.buildTokenApproveAction=function(e){var t=e.owner,r=e.spender,n=e.token,o=e.amount,i=new C.a(o);return{owner:t,spender:r,isMax:Object(R.toBigIntHex)(new C.a(o))===ue,tokenInfo:n,amount:i.shiftedBy(-n.decimals).toFixed(),amountValue:i.toFixed(),extraInfo:null}},n.proxyJsonRPCCall=function(){var e=h()((function*(e){var t=yield this.getClient();try{return t.request(e)}catch(r){throw Object(F.extractResponseError)(r)}}));return function(t){return e.apply(this,arguments)}}(),n.getClientEndpointStatus=function(){var e=h()((function*(e){var t=yield this.getClient(e),r=performance.now(),n=yield t.getEpochNumber();return{responseTime:Math.floor(performance.now()-r),latestBlock:n}}));return function(t){return e.apply(this,arguments)}}(),n.addressFromBase=function(){var e=h()((function*(e){var t=yield this.getNetworkChainId();return Object(A.encode)(e.address,parseInt(t))}));return function(t){return e.apply(this,arguments)}}(),n.addressToBase=function(){var e=h()((function*(e){return Promise.resolve("0x"+Object(A.decode)(e).hexAddress.toString("hex"))}));return function(t){return e.apply(this,arguments)}}(),n.fetchTokenInfos=function(e){return this.engine.providerManager.getTokenInfos(this.networkId,e)},n.broadcastTransaction=function(){var e=h()((function*(e,t){D.default.engine.info("broadcastTransaction START:",{rawTx:e.rawTx});var r=yield this.getClient(),n=yield r.sendRawTransaction(e.rawTx);return D.default.engine.info("broadcastTransaction END:",{txid:n,rawTx:e.rawTx}),ie(ie({},e),{},{txid:n,encodedTx:e.encodedTx})}));return function(t,r){return e.apply(this,arguments)}}(),v()(r)}(U.VaultBase)}}]);